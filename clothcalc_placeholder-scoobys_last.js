Number.prototype.round = function (point) {
  var exp = Math.pow(10,point);
  return (Math.round(this*exp)/exp);
};

if ( !console ) {
  console = {};
}

if ( !console.log ) {
  console.log = function(a){};
}

TWDB.images = new Object({
  ClothCalcButton:'data:image/png;base64,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',
  iconName:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAqBJREFUeNqslEtvElEUxy90gOHRDhQpDBIEaysKNQZpYpqiLroxaUjUrV/Bpd/BD6IrdySGmK5cVzf1sSgNgrzDAB0QBpgZxnPonYZSSLvwJj/unXMP/3vOfRyDpmnkfzUGf1Kp1Lw5A7BEwTYGVNpfaul0+kxsQbMAHOCmi/aBFtAF5IWRLbC7gLtPGOalPBpZG7J8cmKxHIDtN3AKaNcVw6gCYZNp/4XV+kaRJNKs16V3wSBG9pdyKTrjgr1aBsK7LPtqPBwStdsl1mbTGiuX98HuB6zzIpgnZgJuAHfWNc2ndjpEabcn3KtUtnERupfG64jZAH7XbN5bHg5ZVRTJT0Kq416PhATBsyJJUZj3AOarxPB7BQhuGo2Rcb9PTiVpcMDzuOnErCjMVqmUpKnarxLD1TxOgyF2X1F4TPHQbC4KNtug4HY30CFSrW5AFwKcswc4K4ar3YwbjU8xLQVSPOK4iUjW5xOw94miixfFBAy9s6kyc+5WOCHLG0qrRfqtlhLv93mcZGX53PdBsZisclwGhjlA0u8cM3O3vAFNiztrNccwlyOGdpvZPju9Cw1S9X+OxdZh+IO+itG0mH63go+bzWeD4+PJ3apxXPvChiqKabXXczgGAzaRz+99DYUOwVyeFdNTDNzK5dZQCDf8/c4OPp/vgAisAY/eZjLP8VTDjUYExHALHHRe08WwMrDJQuEhW6+zaMh7PFnoPgFH9Pngg69mvd5otFy+vVmr8RClq2W3W+hBqtNpDj2CsCQ4HGX40H75/R/A9g11cQ7A0xyD2EevKL4GH3WrWFz5Eoko9P/EgMUR6hk+oVVMkz4lrFsVSofWMIberQBNGX1qug/Us/PIVFpWMII/9Kgl+j2e8hGpraRnAwx0n38CDAD3lwpCS51YdAAAAABJRU5ErkJggg==',
  iconExperience:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAz9JREFUeNqsVNlPE0Ecntltt3u00FqK2KIQQCKERAQxKqCJB8YjMdEXH1Bjor6YoNEYH/wDJP4HJvpkYkxMCB7REOIRPDAicgkVa1sKEtqypff22u06g9Nkg6I+OMmXmZ3j+32/a6GqquB/DfiXfUqzxlbzmvUvQ/cHMhpBT2Y8FASZ4Ldk1CpEeN+AICAUjzy6cn/iyYUXaM0SAfBfyQBRwyGYL3edbeMpsSUbm9t07+7tM9VVFcxqZLrfqILEPR7BEgp4LTxtsohL0/RSdr7U7fHpiQitq6o2wBQh1hNXjNg9BKvXOytAOUwp0ncgBn3lgsCbyTlWzhAvlnloTaDZqxdPrp+ccjFbN9dsSKeltWYTV9F97dgph8HlUJLfYUK2Whw1LQEIQbSlqU64fulE9dGDbUzv0zcxnGlIFGE1wp2bnR121tdiNfNNlmJzA6QZvUFdZNW4k1LisyANLUqGqQrTFOXPpqJyOBoxS2XnHwTStlvnznfN6IgyPAvxDGeji8ytptzHLVwsA1XaCPJyFuRzyDBFIb+idD4+WuILyCWukDGt2I442SgvSlIIZx5CTQmUINgPHti78/j+2tP1hsdV63hRB/KoTtUcwJ0STQIw6gFgLGDPxbltz98PT9+YnHS60DvsZqYQPJqQmr65vfTgyIzY0NpZazfFjBwMA0XOAQVxRhIAfAmaQJDZtzAwON7tdE4jahDHRLiYKdIiuKrTCMg2SC0uivGXAyPjRpNZTUpZMBsEIJz4mfciTgZqPjPn8czMkfuZQlcUyLKYhBzGjAIvHd5dWaYkpuHQVxkMeO3qRNC2rM7KpcAaQ0TP8xy+KxEyBWiKD3/kiDppe3MN214jNnx2LoDRcGNiItLkGhLbfe7kRglnysr4K/fu2WUhbwq9qupWVDE+SDXWOdhXrz+8D4JDtm9LYKyvv38C+Sj7O3Y7jjSXH2czn6311W2NPQAMr9ZOeWIp6ZuPON8Nmzwy9DOfRsZEWVaW26z3Ud9UKLT97UZHLbo4617594CaudCPxuIioYjneXbBv5gjRqCmbXJrS22p1h1blZ6HzxZIvNWVZIXiNZC5kBx1BZmqiW+WxHuZ7IcAAwAW9VeYOecN4AAAAABJRU5ErkJggg==',
  iconDollar:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAwZJREFUeNqsk91P01AYxk+3buyj6+gGZXOTrwCSiRB0gkYiGXilYDSAqHjh56XXmhAT77nUS+/8AwhqTIQQE8CIfGNAkskE5thGYWPr1lk6unpqTkkz4M6T/HJOz2mfvu/7nBeTJAn8r6EB/3Fgxzxr0Fr5WQ4ioRmg9cFQssPzhDRoT4/QojMRIiBExKH64HlCsoAJQnTc7D11rulCcwZ3dWd4PkdpY2+jkfD4m1cDyypR6ai0MCRkhthaWttO17Y+HIiksOqNaBpsxdKgxKYHbgpnLpWxj148fzYK39tT0s5PU06nAGKB0Fr6bMfgxEZ5NS2BzTD8RkiCXUEHlqZztL9U6CMI83g6zWVVNTxUaFmMdLrLSn8mSJ8JY3UV0swsZRT5YkICd8/nQOWJFMCz8Wqv12s9wryDyJR6GWs89TWTnOTOpgGImq2UjSrUJpNaMD05/BqPbE12XL1CbEYKTapApPx7plGcDK4u7XR79WmDRgCfwxWVfgbThaAYV+zrLCAd5Ip/PfDu/afEUZFhCCPEDnFBqnq6rrfZikoaAoxo/7btLuM4DuA6A9AYrMDjEMNdDXtP+/tfjsB3M7KrigHqDpB3xJ7e2+U8ZsUX5ueXSi1ssMppEFykAO43ZQBN5MDcIkMvBFKPnzy4U4KMw45rJ2nZH0xsW3x9VOO9Gziul2zG7I7OVAgiv76P1jrxFBB5PBTeavZ4atpUl/pQB/yLlbJaDD/Wfmd241nyVnvLZc0fPchpdwBrbPTMrCSNesCAKgfJr60FI/l1w9UpQrJfx0ZWO7uKhhb3yWuDE1krhpswgYuDkJhyOghBavcVCzQBJoY+DK8cZ4B8LQiVCa4mb2O93eGqm2OKmrk0a+25SO1RZm0gFot/HPsyNRiJMus8z8uuChJyQBGTczegDpAF5eLaDYYCm6fuTAVlp08CgV2fnl2cYtlUCJ4xkITKTSm/N3HUBXKEJIJAUefQh0lECsLLZZHPlKuB5aUsR6hDokY040hMQAI8Wu+jWiuBgb8CDAAXATNfWNNYlgAAAABJRU5ErkJggg==',
  iconLuck:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA39JREFUeNqsVEtvG1UUPvO2x+OxnTp+xY7T2iRUlEcKqFCVV1cVEiD1HxQWSLACJCSoxAL27Nixh58AGxYQlJaXILIT0zhOnNiJY8f2vD32vLhj3UHTUnXFSJ/uvZp7vvude893CM/z4P/6iIesyRCo0D8XwcGjD+9RZAQOZhA4hAieUzhwhjBFMPHceZCQfoDcD4wKQiz5yecfvOWsMLeHxkgo8ZnpzrBFuDOLfnXhuU+/uP3l183WwQQT3hdMhFT5ahI0Q2effW39zSOif2V3sE/vjg+41qDN1RrbTJZOly8VV7/buPOLhNO9T1lwT35qMUSUtGb2ufqv26PpOmht5TBOovPlgQLE0IPR0SguHUminwFO8987pLCiOdG7H9164fK1p68uV4sXO80OJZA8p4pGUZIVxObBWuQ8PJZdcQaG9LvlWvKNN67zU9WcjUbSnIzEl8wjpP6o1fhplfxMfnz63oXXqzflfUkpTwtj/9yVWB5Wl6ugZx1Cyc5eghuRTbvgfv/xh++/EmRI40kMIZ09n7nalY+jh0oX9l07VngmHWU5OrpKlEGgYqBmTDA5LalljHcGWwPo0SmRWCLeFuPChqJqFh1WtryYv7BHnqA3csFQdGhYSrpMLkE5XgCdmsCutgcz2YGJoUOc4kEgYkT/9Ey3bIcJlJFYHXdGSNnjcQ/GPRkIA6AiLMECswB9QoKcmwJ34sC21gLbtkFVVejTQ+9sNNqaTCbz1yRDL2IPm/2meaJ63JByn2Ar3pO5iyDmU6DSBrT1Y6iwJXiRfwp4mXM5jXFFMq799POdzaBEaFx4flUrSlP5czEimizDVMq5pWqkFM8MiB4Jkgcd8xQ4k4G/v218lStk7UuVy7lERDz8Zmvz2BfiE1JY3dxWiqSY3U5P3mu2z1DRuLDGlA9GR4ykyOCYLpyeDLwSm7/712/1Hxv15g/bO/c2LMuWUejcDb4yC0H3CTXdALx2FFlJ1Xd3JqfDfjRJiWBODL/WPJ6PGa7rttGeISJS0WgEtgqnGe4EZK/TZ192rrXWxHKC0qA7sMfDc8WF1TQpmndZtj+bzWRsfDswPRHqHIGlEgiLCPliqVC2pxaXTCZoZDO5Vm/Urjy/rtd37nU1TdcxEQQiHtaCfM8JCEkE34MsPtlPxze3gufTR7WgoESCTRYOpEJrM5Taf75/BBgAw3Si4MpJ570AAAAASUVORK5CYII=',
  iconDanger:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAuNJREFUeNqsVE1rE1EUvfMy08xUbc0kU6U2H6WYSWwpRQgU6cZFV9KV4E/wBwiCP8Cf4dJuRARXVZCqYDbagk1tYwshhKZpmkzitJOkaZKZ8b72ThkL7vrgwPu65553z3tPWFpagqtqDK6wib6+QOQBAh+7CIfgJReo783btO+CTKC+jLhGEGnzKaJPRJIvpovoIE4QPU7qLQSIIIy4jbiFUChrmwIYzck0byKqiDrimCcVSVUQEUIkRiTp/tN0+smUZU2Wt7YarxnLlmSZBwUWJybSDxQlJRWLsFKvf86GQqs4/xsx4BBJ1TBiTGLs3suFhecJ29Zgbw/uVKth3bJiz+bmfjxOJiceRaOTgETQbIKezU51Z2dH1mOxZYy1uHrRJ19b1LSHiU5Hg40NgLU1AMOAm5Ikv7Dt6buuG4L1dYBcDniiouuyYLG4CLHYF4wtIwyPjB/zhu44OhQKAJubAKUSlh/rL8uQzOdV2N8/I4fDQ3D6fWhyBstSBccJu4xxMaLfTUFqNETooEGmeU7E2ymaWcbEAm4ZYGls+8wNpObqBNFGExkTvHvjkvXtg3p9H3Z30Zvji4sFLi73emekLhLxu7CN4Gc7UZS2K0kGXRObkc18j/F2dPRj3jBaJVTXoAwucfJN/GjfEbzi24LgBFOpD9it0NXoB3Rd944JA8YgF4mYjmnq3W5X8Zzh7RDxlYgKktSTZ2ZWpWj0PQ53EDUuiJO5vufRaweDVj4eL6HUMcU0VRFdO8KFT0RkqWpDmZ9/J0YiKzjcovJZfmXeG+vTkdu1SKRSCYdttVaL5rDIb/iRx8crw5nMsjA09I2I+JU4oifneGQeYZ+KyZ9Qu6UoRjUUqh8fHEzXNG1HyWReoas/cS1Pii6ILv8anqsOPQ/eb1VUtZxMJJrX4/Ff9rkS7z22Lnn0Dxn4jOPq/lDWxm46XaD5EyLpUEL3f/+Zv3lfz4ACAz7Ftv8P87e/AgwA2Gk+sVBbJGIAAAAASUVORK5CYII=',
  iconLaborpoints:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAeVJREFUeNqclM1OwkAUhVtaKMViA2K7cOfOV/JF2LLyFVjwEkRehK0rUxISBUUrP/2xP95LzjRjaSNxki80LXPmzLl3RlVOhwoahCa9T4mMyMGvkee5oteINYkWYUCQRSKQQPiswQt0iRvizvf92W63mwVBMJtMJrdYSD3XGTsxiT7hRlGk6LquaJqmLBaLCyyW1LmoEjPgbhCGodJsNo+Cq9WqVcrxRKwhhc1YxCXRI65YLE1TIWbhey5lVxRFl8I24YiFHBZiQSHG7ubzuYVv/P+QCIiY+GYxFdthgf50On3gSX/BLsWv4zj3LEoFSHTJjUsVU5IkqYTdiWcWElvHfHZ3FNOw1TZvqU5IbFU8S2KaXIAMYcaj0egxy7Ie/dEm21167o7H44FwNRwOn9Y0DMP4sCzr3XXdF8wvxLirt8Ta87xIVJG45rDJbSG2XC496rUlvd8QPvGG+aks9gV3n2CPFVtyjrZts5NnCHElD5ifKVI3HxCihpKr6Kc+nwCRkWma7GgNsQSIPjuKpVJu4qCb2PqOi8JBs1in0wnwfi/dHHn5OOWlq+Ybbv04jgtnJLzH98prSK04Ytw3NvcdaCOCFfGKTMOyWN2tkSLcDRy2EMEWbpO6g17lrPGfy5Gd/QgwADbFOC1FlFuVAAAAAElFTkSuQmCC',
  iconData:'data:image/png;base64,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',
  iconCache:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAUCAYAAAD/Rn+7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABTFJREFUeNqslslvHEUUxr+qrtk8i3Hs2M5GnDhOEBI4JBISiYBIIJYTBxBSDkjkHwAJceCfgAvc4Q4SBzhEQRFiEZdI2EoQkE1JnEw8GXuWnp6t1+KrnklwPDPxZSK9dLu76tev3vK9ES+/9gZWLl7Ae2fff3O6MPEcolBLpQCNHf+ZJVJa4n65cnvmj++/+3P6CPTs4bHyVP/dsZe8G1+LlVu5e5UQ6ZSC1k8mCpoXAQuzCrvqtagEbPDRL+PmGQfV68uHPl9yruf+ueXgaLu/Wux8YhDoO8DxpyF/cvAFn7xK646Tp/zN4kcfLu99pV7WOP7iNKYtjTCK4hPHp35o/SRsDYSktQhd58dPqs7ShWvlz7IyVR0nT6nqvTPphVNYPPMWEkELrlNHaNcQNGntBoJOG5HfhQ4C6CjsfYgQIfQj6EQ3gjN3BItBcHqzeNsZJ09luo1UuHIe316aR6ftQvkdJNFGx+nAbbmwIg+uG0BGPYCVZE2wMFrtXlH7Bl7I49wn5/D7jz+r1s0deNpD1/BCHWd9J57SiVSuIDz8fWkV65s+9nPx0gLQLAN2A5jMAGsdnoqbc7SpOSDPP4p3gMACyj6QndqNvVNZ+J6XJU9u5x0lz34A1FhfM1mg0uKeflnm5nn/BJ5S6YzMHFhC4anr8DcfYI4O7efudJpGB+dOCCy+K2KY/Y1GvqQxxXc1ftgjMDTHjgJ4TJ2OIjmMt5cO5LIplFs+I6rhM1aT3BZIgYytkdEpzCmPPD3IUxN55BeeRSpbouY8QIqeZPhhczUtPrcHOHFWxPH/7bxGcJ+O832yrw0Jmh8G8Jt11panh/GSLKzZXBKn/QJkZQMrUuIma+9tMgtBGvauKVy0S8N5KpNFemYPZCI1oEvGNNPrNnsO6rYR0m2KIcyBfbj1DYReB8N4invWGw6kyuFoJoNnul0sCEaPTob7dqGerUKYGpeDPCksBZlMj5Qmb5MbPB2buYc1ZAIYYLWM0O1iFM9su1GvwkkqJHifp4UygVK6ycbojuRJ0+Om3Uepu1/TsGQ6NnMv5LY1/RN79iYiAkfxWG6ouS7qThNGUSJqY8RU3t1oxAwxgqeMl55dgQ7Dx4dif3FQB/76chEJkw77CsTstuFpgKZmHFMzLobx4jHG/ygAmDepLBSg8nlYxSLmq+zcqV7pDOMpv+WgtXaNAtp8zLlHPjA39xJXwMwhSvXG0UCK6UzQbvLkBA/hmWmRlEm8UJjAhCWxls+hygguz89jodlBvcp9uvUojFt5yoCctasEN3pNscWML4K5OXF4GcmEhUtyJU5NPK22Osi0Rh6nA+VhGM8Ec2Z6N2oH9sGj7FxeuYrItpE7/jwKs2kcopDf+fVfyk8wwFNsZXiVEnx2FjUSLr3qhL2rSUu7pfHDx6uxSKeYBpXtvWfPxGb2RGZchb7RLZ56kOfyunG/iHKliN0EbTR7TbK6ehmTFGr63mNagzxlijpkOBuksBw4Pzk1KCd1rrQJ74Yi/t3TYjwsWsM859oSC9Sc1+zhRKVMhA/DOZzH17ZZKwxPwDGdzey0eciWN5qntB+JWuEgPvj0HQjmQjCxSrAGXAacXcdQUNU70C6HvOcazWEXBjh4LIpToVnddr2GYmPdSILQvh4rT1WsPNylU5js1OP2NmENeA1ZA2G3zWJtsa6cuLbCbofP3VinHv4SMRFL8/S3ugp32yFca2KsPJFQ6qukJU+GYWQJIf7Xjy2NsP3XsMD2JjHpgvYifVlK6Y6T958AAwBjoD0Kglj//QAAAABJRU5ErkJggg==',
  iconCount:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAv1JREFUeNqElMtPE1EUxs9MH0zfL2iAlkCLQkkBRR4hBk1oYkiMduUCNi5cuPZvcGPiyhjXGHGlMTFBXBAlEQUkkUBTWmyaYm1REAq0A9On045nmlszYIs3+WUyc+795rvnnHspQRBAHF6vFySDRuQEJSKDk6OI/CbwSAnI5GpDXKxGNIgWYRCKxMSFeeQYSRNqilHEjQGxeocsw+pCvGExqohvscrMxIipQ8UFuEmf7R2ZnyfuTohRxJEoVI84kLbb11ofKgMvmZXvQ1P97WblxGXteGBu/RDAFiLbFB3mKrmRbk2FWEQRxH2uWTuqLOwxvliBj6R09haL7AKkQjCzoWExbkP05Of0WWKiq662ZlNfOR11hqQ4oa1JrwU+Bxxdn8FXM5kvr+jIq4jVT98feQqAVc7jbnYW4KKVbZi+k/CADusR84Od5tw5OjMWLvWvkHVUrZypYO0BGsJ08GmYWQfYTgF4XMugUS7Ds88AsxtYZhOUaGs5Z6WKgFRMIAHB+/rKI3z2To2+8azGAXww9jEeOdSNt37p8+1qOF2n5wPG50kli9LmhCru5O4Wldboug5XXUyOByXf02HXdrvd0N+uOyYCvNRVtT4TxRX3brmHNXW0DRSb0Is1u6tPOrpcbiPIEjBg/8FoVP7zaUEb+7TrXDxLrHx8PM6jgXLyIy8glgDmhtPnAD4JP8JBCG+BKcWxpjRt3QRwFv/nTPZ+Kbg2Ygn1TM6DPHzcuBNg5fywNdjyBDMVSjuiQrHwy2zQrOKBy5EtC6dzViIdnX28oJ9j6Jw8ug/wjRr8Gs007RcxGkkZknXW7lmm6dLzjLpTPE5i8xZqiYkB9qY7yxwmWTjIlzudG2w8UO9h2gUZE8V3PxJGtpEjsuafgy5+yCIJOxVmX/lV4SPBLC5a2ktm1dEdtUyhNr5FC0H89hNB35CptFO5FST3GU2uHfG2MBIYSQ8WyKFOke1xlduiVtMWJNbZU3GeNGn+dLPWEuMluaOq5LTC3wpKxx8BBgAeuiDOQ7ICHgAAAABJRU5ErkJggg==',
  iconKilled:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAx9JREFUeNpslE1v20YQhmeXXxIlUYodObArNDXSHoIgSJt7Pg4OmpOBBOhP6M/rsafeCvTcOBc7iBPHlmQ7shSJkknxY7nsu8IoUBUTeEACu/vOvDOzFGVZ0v7+PvEjgAVc4DE2KEEOEpACBQpae+yVbyPkAB80wSZogSrQYAa+MFOQseg3YkuhOmiDu67r3tvd3X2wvb39gxBCHh0eHgyurt4WRfER6z0w5iB6XUyCCrgNfoLAk70Xe791Ot930jS2puGUajX/Wb/X/+fNwcEfKI1k62O2rVfFzLsBdhqN+uPXr1/97lUqt05PP9JoNCLHtmg8GftRFD2/s3XHu/x8qdiiYiFjuVwVC8B3v758+cr17FunZyd0dHREURRTM/CpWvFpOLpyRsPJz41G7SSezyOt9TVnZpqhlmLLem1tbGw87Pa69OnkA2XpHMWUlKaKhJxTI6jjOwmCVrDn16rzwWB4gTMT7rKSLGbxGNTDcFoOh0OK4xlJKVEYSddRZGyS40ra7mzR8fH7rX/fHLzgGtf4/P9GwwjbUXydqyy3pbCpUvUJ5aJZnCwyJNS93+9R96ynSxNlZ+HG5WkguSJmuqPTNFOW5VLFDRb7HBsV0JrMcDuOC+uKlCoKjI7ijMS6mOYi5lKKXFjIqlKlqushsxLfNUIMkFKWK0QttW3bOZ8pma9iy+uSCRK5DyEhrUXnVZGRDa/Skovs8jRHGkJblhVxJ/N1sYJnZWbELAgJKSjJMjTBeNAQtEljV5amRhSlsML1e2qviM3BKJyEkziad5I0hkVBzUawyKzQkpIkhdWMcL0Uajbkkfia2aqYGcDL4w/Hf+V5XptOZzvI0Gvf3qTNjRY5lkNJmUF0cU5jbEZ4xyymbxK7GAwGf8JCVyn1NC3SR59Or9v98/O679cIQWgynlBRqATZfeYz2U2ZGf8mmsafIcLmM9j7G93/BSL3Ly7P7w4GV+0wnFCr1Tr0PO8d9oY3ZVZyBM2LJqKpSRe8cxyn3Ww2A4B2/GjWznltKfbNz3E5HoqzjPhHeMH3tspDmvFayG+1tPmfAAMAqEx/WbBWiOIAAAAASUVORK5CYII=',
  miniMap:'data:image/png;base64,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',
  iconNew:'data:image/png;base64,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',
  iconSetting:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABGNJREFUeNqsVFtsFFUY/s7MbGfvpfcWSyvVUKhFtFHCEzZNVR54IJKIjRhr1BjjOwmP+oBv+m5MDDGSGKMPQpoYBRM1Sg2JQCllWwqUtnbb7rK7szv3c/GfAY0EjS+eZCaTOef/zv9dzmFKKfyfw/i3iZuXziV13RiRgg97XrhdQTUnmvQKFBYD35vx/PDiyOgL4X8Czv38NQLfedazipMa054JPbe9atmmVALpTBLEyLWtWsmqN76tbix/0tbd+9Oe/Yf/qmd/p7wwfbpp9caVN5hmvJvN59qhJALXRb3ugEuBVMaECAN4tgPH9VQQ+qtJM3l8YHjfZyNjL6n7Orw+fZqVb1973dCN9xVjeR74UIIj8ByEgQtBG/uuAAhYSgkhJAP0XqaxD+YufCe5VKf2jk/cBRQ8QOg1xkmn96RQeUH0mPRRuDaP6V8vYmB7H3q2duHKbAGSgIeHHgVjGjQjAT9gHa4XnLDrlRs89M/HgMtXfzBrm7cmdd1s83wbIdFSuoLjuKhZFq7OL2Jp+XeUShVsaW1GEHAkEgnomkGqSEAz+y6dP3s0leu88CflEUCNKUgW7Xx98SZR4qjUqkiYBjzXhl23wDkDDwVK5SoEAWWyGbS0tsFyXFatOQds1995F1DJ3aRLC6GQXh4uz8yiSp0Zmh5Pd3V2IplMYn39DoHVaKNZmlP0vwM7d2dh2x4xsXsCLge1u3gYUFKZkQmhZ2NgoB9t7S0EHqCtdQv2PL4Le596AruHB2EmDHI+RP+2bdhO61LEQNc06l6kyea+GFBKkY86k4rHHbW2tCCdTENFPhoGfSeRSplEMQVylbItkW/OIpvLwNB1elgsAWUwe09DVYnjQICRxjMzc9golalMYWOzjMvkbj6Xx/LKGnwvoPUaCoXrqFRrGBwaQt3x0aCHQK17GqpFenlEMcnDEBrt2tPdAS5CFIubWFhYopgYsVHptInm5hyVSGha9E8gSnTIRcMPxVIMaLvOTLlqlcxEslfTtVizXD6D4loR5c07oNRSMaO4CNK2EyN7HkME0yAzihSltY0qbMdbIR8KsYac46LjeN84rq/8IESa9GqinAku4iM3uKMfo/ufRisZFFIGSSx4Psd6pY7VYgTmk4DaGU3TCnGHT44eDjdWbp5cXrj8fMBZLzM0tFMeo6h0d1FkMlmYqSS29naBTgXK1QZWNmpYXa/Epjl2fX7swKFTh45MyhgwCrOeav6x1nCPU1MfKl1rJ2+QNtPYtXMoooM60Wvr6oBlOQTo4E61HjtLZi4bhnGsq3vrb9Th/bfNua8+ZmfPfDFRshonUplcv9lkIGs2UY2AR7o0qLuaFd00PoKQS7tRn89kMseOvPrW6Zdfe+fB6ysaU59/hBu3lvb98v3UK6bZNM4D/lDDcTMRGDMYDKbXBecrARdTzx08/Gn/w49cmph8+5/vw/uAvzypkxRDruvvoEj0UaCzlIAaZf02HdOCApt78eibD9T9IcAAnaJ+kwOqUbEAAAAASUVORK5CYII=',
  iconSupport:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABAtJREFUeNpMlFtPG0cUx89eWN921/h+aWyC4wUbohQRKTSqqjQoUtMH2j7x1Le+5CXqQ16jfId8ikSqlLa0apWH5KFUgMsllUkxYDA1dsAG1tjGFxbvpWfQuGKkn3ZnZ+a/M+f8zzAzMzNwpTEIj9gRB+KizwE63kO6SIdyQb+ZQBf2G0sXiYgXCVIGqaCFnCMN5IRSQ5pUVOev7IgIyUgYSbhEcezu1NR01GYbaWSznB6NmlYweP6hVCrm8/mlTqeTw3kF5AA5JTvmrwhJSBRJXR8amv4snZ4ZLZUi9o0N4Ox2iDx7BpzPB/VaTVlaWrr9x+JiZndz8zfTNLN0QyY3OjrK0diEiFBiaOjhN4oym1xY8PtKJWBPTqDudoPtwQOQ8ClJEqRSKUc0Hk+UstlgvdOpWpZFjtomYjYao4TH4/n06xs3vk2urw+KrRasVKvwFsUWj497mcLuRXG/yIqyzIqNBggvXzLs6mq4KIrOjmFs4fp6P3NejuOG7yYSD9PlstdlWTC3uQWL7ZauDroPwCWewn6pV6ydOg42NmJfnahyaGUFrmHSor3e5InHQ+Jc4Gmm/NjGbodCaefeHizMz8Of3e6FGovtMOHwWxwvktjiDuL/7O9/MlEu34rHYsKlf1otETwecjIXT+PlSyrKrdTsrL3jdMLS/Lyl+v0lFPodx5aREiIQW+j8gE9NKjG90wnxF+gIyyKWcpJxlh5T/igajUteL3Tu34fqxETbDIe38Tshj+whh8RbPMu2BJ9P5xwOYFgWTJ7vW4shYiSbNomkibhP04ARBjS0wxF2W9SQ//+U4TifgnN17JzpOmgsGQLSNVjqEUvTNOJw8IgSBDxeFn/lJ3ZBH8UNw1DwPY2MhSOR1MePH8uOp0+hevMmqKapEVsgGt+vt0qlctrI5cLw4gVMZrNSRdeHa37/JIoFWZbVGYYJBYLBqe+fPEnah4fBDIWgoiigvn9Pykolgjwt3EZha2t389WrdKxchnuyzNt0PflTs+loyXLdYbPB+MSE57tHj64FAoHLIK2urUEml9O7LtdfeIoKqVGeVv/x4dHRu2VVnXapqtMtivB5ICDcczqHa2637nI4WFlRWGcgcBmTTCYDv8zNQbFY3BIGBt7Q+jzrix11Ne3vlZGRX7vV6pdKPi+F63Vw+/3gbjZ5Bk1c2MbERiKwc3YGb16/hu3t7YIgCD/gWuL+KtHhabbIVVKo9Xo/ro2Pn+7kcl+4K5XrfLcLPPqOwfRrhgFnz5/DIcu2W83mut1u/xnXvEP+JaVEdPoJaFEfGW1Jqrfv3FnGToDeJAL1kQG6TuJbRyEy9wM9Xo3G3eDpLan11enl94EK2a7csiYd79ILsUEtcU59Zv0nwACopqbnHDzSLQAAAABJRU5ErkJggg==',
  attacker:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAeJJREFUeNrsVk1LAlEUfTM6qYy6TVcG7lwIEghBiC3bRJt+gbs2Cq37F9p/CNE2irgJkhZGLUQGMYNa6IC6MciJdNDXufEEVzUjQQRz4TCX+3HO9c6bhxLnnP2FyeyPzBF2hB3hXzO3lSJJkq7xMIEj8VRw8cxEbjW8AtQBpPjBj6R0c/0EmEalbrf7zuVy6fC313Iq4jrlqAZ4sMIpW/i1e36/f+j1elk8Hk96PB4VjaO1wY3FYhFOp9OUY6h9pZ6N3zGaM8Fg8CkcDtdzudxBrVZjqVSKQURFLrpWF4XgMpFIsEqlwqg2FArVqZc4bK8ak7+AhPd6Pd5sNnm1WuXJZNJcrRPYEiCfRyKRebFY5I1Gg3e7XZ7NZjlx2F71dDo9LZVKxnA4ZKPRiI3HY6Zp2hypZ2AXuBAg/1HX9Y92u80GgwHr9/usXC4bxGF71ZiqNplMtHw+vyThTqfDTNP8QOqY5gIyAuSfyLJ802q1voQLhcKSeoljo1MN2/H5fPeqqhqBQGCqKMolvVbgSqycC1+CcB61BgEH8Z56v+W2+DnFADqpEbFeCr4LcBGLipqYJU4rRWsDnAmhN2Bf4E3Ezu1wyRvcdAPgEM23BPJFbGaHSHL+cznCjrAj/O+EPwUYAEvcy6pPo+pUAAAAAElFTkSuQmCC',
  defender:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAYhJREFUeNrslr9rwlAQx9+LVpNMnfsnCOLSWQjZnPoHFNo/wL+hf4OjLl0zWulS2qFuLk4WyVCok5RUESEm5Mcz6fekllIpGEkQSg6OvFwe97l7dzkej+OYHUMkdiTJwTn4/4GL+25UVfWlVCoVbNu+jaLoHib/65MsSdJFuVy+FkKsgiA438cf33eAcM7jbrfLDMNw+/1+tF6vGQIgO6tWq4VKpaJ0Oh0B+0mqGRNY0zSu67pK74vFgs3n82+1LIshCZ56jQlMGZJQtmEY7ihtyxT8E4aabhT1zSZjNJY9nU53wASkp+u6DE0mUgfD6V2v14t+g7c6m80ouPfUwY7joKGN1V/1NU1ToBQPWQyQ58lkUoTu1JeOeTgcYhm0UgejcUIcd6vZbDq+72+A2wBQAh/fH6FmJiMTmd2MRqPXdrstttDBYMDG4/ESwVwlmpk0uZIo5ExRlLdGo+HV63UPDfUBWy2pH37InQv/9Kksy09YWp7nXcLHMrGP/LKXg3NwDj5UPgUYAFHjaDUOHPhzAAAAAElFTkSuQmCC',
  iconStar:'data:image/png;base64,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',
  iconStar2:'data:image/png;base64,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',
  iconInfo:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAASCAYAAAC9+TVUAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA15JREFUeNpEU8luXFUQPXd4t9/oHtLEWLax7AQJYwcnREAIIITMhp9AWSOxYM2GNTsW/AML9izZgBALghPSESSx20Ns2na3HSd2D2/k3Neic1uv71hV55yqEp/dXi6CPIMSOex4JoDzYcG9RJEX4B+U5joFEuSoOBKuVrCvJQ8zvtPz0zVEniodVBxdzhtPOqiJFPEwhuBP0jDXOXzPwQvp4OUYr/VCIygXko92Nzu4fW0OuPoq/t7r0qtb3vl5jiEdfv7V1xgOznHc2cVPP/yIxB/f6wtTm/h9czXAb60tvL8yy10Trd0ulASjyzLm9999C6c/LN/+78AO1QjNN8fdE9iv+UodjbqLB/8c4MZCHcJU0O6ckaaCSlLc+eJLzC3NI6hHOPj3cOJELi3OiOalKqYCH3+RTup4uPrGPBHtY7lhsH59YRK9d/QUp91DHPXOXiJKEkhDpWuRL8LAhSH2h+0eBtB4e+0Kft7YRsEELb4+i9j38eTxY7T3DnHy7HwsKx2NkgKyTCGNw9AVYehBMRuPdk7RFw4+/OgtbG8dwCQxlucaeNrpYWf/CJs7nVIT+zlKQSqlIaWAYXprYSiqES/THPfaJ4ilwbs3F9HtPUfVKMz4BTGmuFzVEyRSEIljHDjGQDtOWQ+1aiTqUwGSOMbv93eROS5Wr72GjdYOTBrj49UZhIEzyVDGgpSCFWqMphOiqRjEFCrwKiIKPIqW4e6jHmJdwa13rmBvv4uaTHFz4RK0LDAbuiwByRojnYLqCaGR08h1XXiei2ajKmpRgP4gRqt9Ch1F+GT9Ov6430aDbbB+YxHHo2Rc/kqxsAmnoMA5xr2SsUJj0vE9VwSewWiUorV9Smoebn2wgodbHUx7Ep+usWYqiqiorks9cjahZrqzLIdIU4ptBS9QDQPGEEX/+QC//rmH91amsbq2hLsPNuFEdeRC2RSDhhknisNPyfFMMHQiy3VIjQwDDQcj/HJvHxeygu6LnDSYpcI2KEV1mN7SltrY4hKlkzGlLE+QEp12lLA0kzgrM5Pz4eXmFDNrkdiDMqqw1qzAhGgUbOotPUW61kDyjMhExchxC5wNcRLLsl1kUVhhC1IqyugFo8ZpMiYn7J0s1xnPCBW+b+yWFDVCDNEfXuA/AQYASbZY3VIWOLoAAAAASUVORK5CYII=',
  iconSell:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA8JJREFUeNq8VltIVEEY3nO2E6adNdM0DArWaqtVW0MizSS6vEQFXcQeBCPouTITJCLCegmLpLeIoKjoQhFLV7rIqll0MbK7Ursdz+66tnn0uBfXPbunb7bZWgK3zhYNfMzMmTnzz/z/938zjKqquv9RJow3wDBMrMZGOFTTACOQDbBAAOgHREAGFMxX6XxthhKKHjAEg06jIJxdbzAU2WX59agsvwmLovvMxo13R/7qRHR3DDWkE4TzpkBAyPJ6H5bjvM7WVmezoqhlGHoADALhZGsxSWJEjEwGZgHzgKkul3Wm3X5yWzSqPq6svL4D34apGxWyKeK+8dZLZigDmA+Ujo0NFvT0HCkdHn5l+hlD1pWePqvZYmm5ju4YEIGhSCqGyEkqJelZWW/vsVXhsExOpxNFfx/Pc3Jm5kQz6bvdgX1VVfevoTlEjI23HpvErVkA19NzdEXcyL17TseWLQ+eNDd3n8R6hG26nJy0vajK6fxxSzJDitt9g1MUnyH+4flzbxeqW0uW5Epgf+z7p08jxG1mGs+UWPfF7/9oT/xQXV3gs1o/t5G82rp17m5B8G9qbXX50XcBwVRZxyK4+ra2tY9Ylsn/4c+sRcd5fn40GBSfmUz1X+lJBJrAY5rJACPktDk1NbNXYfcNaWn6nF9mjFRUWBfg/yiJJcmjlOhNToOKBwrKy/MW7txZuDk/P91CR2Wa0reWLrXuQSONUpwkraqJDOr3EgLed3Z6Lp048f5UwqjhO3TVNtvao9gUMRChSa6ZDJmUTXNhTCHsxoK7UBfv378ob/XqGWtiC0xgN7e0lPVh7By6nlRENZdID2RnudN5tVBVI5XoHwLeHjjQJa1cme8HSarIRLh0A6puKkdDWvOIkaQuFtq2AhKUGw4Pr2loKF6OHQ8ABQbDnGh8otc7OpFeI5NTSViX19v2ON7x+cKOw4e7b6JJFHsZMCc+ZrO5AzQ+Ec15ROk9vampdHtFRV4Nx7GTOG7KBZ43TQ+FPDP8fkfMUHt7/0Bj49OXaF4EOrCerNUQR29Us8WSXVJXV1RmNPJmqDYbRSESdPu26D548AVRjzsULkocTYYYmog89f1oR8e6EtSnBgdDntpaW68khUjgOwEiS30kj1JRb5VKig+IiOKVeRkZxphCBwJKCK58h+ZlIrJxI6mqd7wQdskOx2mTx/OhFveRoNczmfX1RYspleXfGfmjxwk8qFA2EReNAiYqOZ8p0/R/8jhJFqPEtwOJFZGcKQm5Qq4Hib4bwgnSpfma+KflmwADAByiwbZmDJRuAAAAAElFTkSuQmCC',
  iconSearch:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAKXRFWHRDcmVhdGlvbiBUaW1lAG5lIDIyIDQgMjAxMiAxMjo0Nzo0OCArMDEwMJeg7h0AAAAHdElNRQfcBBcTBzGRmTTGAAAACXBIWXMAAAsSAAALEgHS3X78AAAABGdBTUEAALGPC/xhBQAABAVJREFUeNodVMmLHUUcrq27q/e3zJKX5b1JJpPBN4oxBGMCCYp4CMaDIEJOHgQV/D/8GxQ8efDmzYgKXkRMJgQMQozzYiaTyThvmbf1+nqp6vI39qmpqq/6+31L4++/+PhoNJpEC9fUwzSnhHCdIYSm0QIWzyx54zAN0ryz4seLAs7AgZrDHa7JSrE7vz3sz2JYZZTABkYIXqJFgTGaxdlgFu8O5oWQo3mSlXIeZ62GY2gUkARj+vm7l4WssOH1D2NrnLizopwLMcv0Qj9RsZVY1CW1LCdUWqS0pKKRoIOoZFX5ytoKg88CyXAYnE6LHaQdKtw91W56fi6KP4ZD7PNGGHRFGUj8hJrEXx7PR8E82bpQh+kY8BwFyZrEjyz3jc3uB9evGZZFKEUYA7Egju7cu//dvbvvNVavcn3XdinDWRobGlNK0U9uXsIIN4dR0Vn/6MZ1zTSxYWCNYYYJY9wwLnU618+f//L+gy7XBK0SpJVFYlNRd0xyCJoWwqjU8vIKXGZwQ/dc6rqlxlOEMoUjIXzHvX319QDhs43m5rmOZWjgAohPDqcxwHOCp4v82+1tIQVRqihEKQWirKiE0jXiWJrrrfk+Ysz2fRAcIL3DKWvVHYKTmFerT3vfBNHdvf03t17a6qw1GzXXr/V2epPp7J/hYBzM33adF4gYhg4+ZYU4drdSKs3LEJNWkty2zR+zxdc//Qz6X7t6LY/jJI0PhqNzvv++Zx9ZNq4tCYQmYdq2yammy2BguEa6zj5WW4bxmZTPfXcnyz0lK8v0G/Xdvee41dIc1wEXLLMyTZvrOlMwM4OEUIhUhXPLfO55qVJtzjfKMovntmnKKNVfffmr7QfswsY7GFmuKzwnyYpKV9328rFdjOBSKGTxhedNGAuEEFKuntsYI6UrsSXllY3133d6ttZ9azoJRUGVcrgOdNlxqCnRNRoLSXVDaJrVtHWFwwoeSWVehMGtzum/B6NfHj02Mbm81l5i9H8QJgmoleYYY4UMnbs653bNsZomNTW3WVsQFliu4OatC+tSyh/+erw3mbRUBVZBi+il9RMI4VEiCXdNiBdSnBtFnmlML/I8y3IbhMjy5SIvOX/WHzydh2sa5XXdMw3WcE1Qu59VSRpJmSeLrOznpmW5Ng3DkFKtqKpS12snWx82G4M0f22pqQ6eEGxAfRl4DSHzTPvRzt501Pfs47bABgh5bAQhMJSlkQOdLmX5RYXy8f4uwjd962AcMqj+cdGL4NMbnY32if3++Mxqw7C9aHY0CRcaI3WbE6YRyo6m0HUJvxGD0aMw7f07ZXkpAd9tL0E/HvZeeJbx65+7ICY48Ww4v3h2teFa/fF8GmcgL1TixVEIpCChVzZP/geRJSzu2YducgAAAABJRU5ErkJggg==',
  iconChat:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAPCAYAAAC4EqxxAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA41JREFUeNrkl39oTWEYx7/n3t1rY8yw0a6xe8eda1lMkqaw/OF3mZQUkT/Ijz9WU6SU7A9lbMUf8o+lKBSh/NhClmnNlmVk0YhZ2MXYZjP33h3f9+6913GcO+eMojz16bzvOe/znPO87/M+73MUVVUxWJnpdg1auf55q4K/IHGRxt5CBfNHAa+q4MjuwYjWOmSO70ViCBnNCcjyn0GguxEBCA8vqlWx7J0nV0g1aSaZJI8sIQX4ByRO21FUpA5NwFaPig0zRmCizW9HD5xfnsFxKxmOYgUfa0Lo6zOw85aUkFKuXEhzv0nASCjntZAUkbExvsVOFhEXmUYaiZ9Ukq5f+GFaN+pwIIDRLheOLRiFlajhjaf9dhKQFJ8N32IvfHM6ULXxAVov8oE+lEvoaMkA4SsmoYSOi+5BgyHbyR4yzuDZJ3Kc7Cah39W1RZ5keFHoXU5n3eykk0Rx1yHtpLOVO3IzdpR5MdtrEMalJiOqVI7XyiFyJMYHC0kiOw30BqcrkpagqQv+z6LZRq6RZQTjyH7yUA2gUw3y1mGU74ro5GakqWRTpG8GMV7oyb5blSKjxhCN5GtsuVVrEtaNhvSTYRjdwmtKCpA2D4hvQZtakfPB/nXtlPfwhDdpNxmDhbm6Way2mDeqdSsQnXgTkmika1ISf9jD3LahIPsBtj/HA+2r0joDFdvaUs95smhZiZeDQ0gaojPUbPHF2vENYouLEy6cNJWfTyrNRLyUSchQ9xcS1Y06XMf9/IHXN+Q1UhFK3pSBrUvTmWeVMY392zqNfEXLO8CnNZYps7FZydT1l5ETIssOsMrCsTWkJ5buQEe+Vjfq8L3HqO/2OWf1ht0SR+c8u+K229UVAD1EO9flVbdY4VOXgWKtwTyLDufp+mKOF5PpZB2ZQETqbJUrc4bciWHLsm7U4fYyxz4cnXweDp9TQU54t0IE7yQyi44m8GB7fPWso/P+Dd1Ll4hzVnf+xqrM7LII0UuWzLhTyQWy2sIEWtK1fd9Z6nUcCG5ROlz+/kkaDjhlHHtEt/YsbA07bYjr1NkokEWFGSmMUXGJfZgvjxfGVPjNpitcK7rfK604JYjmnpNq+dO7ylzPekwOTkFfwIn2F+/QVH0JHcFKKA5WLYYlcJEsKkqNVlqubKTSMpLTpFZWSbfDqcK8WNJV/vDPg+laWvPzIMLpkUxANy1+gmVd5X/7W/omwACxMr4C5yIs3wAAAABJRU5ErkJggg==',
  iconClock:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA+1JREFUeNpclFlvG1UUx/+zeWa8xGOPndiJE9dxGxcUtWoKJA2q8sDSp4DYHgAhBHwUPggfgCdeKlQWARISBVpSitIqOHGSxvFuT7zMvnDH3EhRLf00M9Y9//s/5557mO3tbTz3YwgyIUXIE+YJMYJN6BDqhC5hQnAvBvLPiXCECEElFAkvfP7pR1/KIjtzWv3Tvf+4/tVpZ/QtXdci6FQwuCgWCgkXHIVCq4SbHBNkWs0WV3vWxWSib1ARlsaEDscEh+Dz9E+eppIlXOJ5/vpiYeHNzfW1im2MrH7zUOr1B57MuyU+Kb+tja2o5wVhBlVCkzAiWDy1HKVCKyklufH+u299XJjPLTKBx83EJaSTCSxfrrDpVCL78MHD7OHxSXEw8XO9M+N76jKso89VKhWJvGQI5WhU3vjskw+/uFxaWJREjjVNA8WFHPr9DmLxGF5ZW0ViRkFU4uPHRwcVlouYluP1aaoGS9ObE0Xx2tbtzfcKC/n5CC9geSkP1tJxclRDPjuDQjaJk9o+VCWOrVfXUS4txXy9/Y4sCi+R+BwhHqaZCFtgc/3m66tXl0uOZcCcGHhWfYxcjqxhWDBE3LQtmFYAhhh5Wm8ik8mA5zjFMEevgZH+JhqNc2fZUrFwnQ08WYxwyGUUyJKM+nGVCHdBdgdDNhFggYtEsHKljDtbt5BOpzDotsq0TLHQWVizuOfayb6mMdrZGfjAnaYpSCKe7u7g0e/3UVoso3h1BYLAo9ft45+9AwwnJrThOJ7ITg9QZM87tt9t+6NBFwLHQE3NwHFcyHIUi8UyLEaElJ0j58bCs02wpJksQ8doNIFlOz6VCEJnZnga7W5HU6JCdHYuz+zuHyEtEtHZWXgshxev3YBuOzg5rUP2A2g+CzWTxmisgxciY3q1bJ6+tHXdfGIO20qz2Yr5nIQ3bt9Cr91DXFXAMwIC0iaDoQY2peLrb+6i3uygdlxHUs0dnN9VlnZv4+i0d6+t2VVdnwQbL6+hfTZEXxvAtSw0221Y5Dk2bLI9h5XlJfxbPUTACloqnfkxjA91zp21hiN9x+C5aMcZKewvPy05iDAZNYVYyiCl4jDQHTQGI/z61z389scOTNOc5AuXvouI0gN6X8c8HS0a4dBxPfIteY92ax/IIndlPMzKjUYDju3CdYlYq4O96qEvilKXCP2gpNS7JG6fpjm9mx4dJZ3pKGFYW0qofdMYbz3ZO7hhmFbG0HWJ1N0ThMhISWdrqpr5WZKjoaMDmuJ0cvB0Frk0Xf9/p4wmyokjQji7FDrjfBrUo5MiTK1Pa26fjyBcENQvCHfoVZPpiApoG02oaPi06Pppr/0nwABCMa7R/XpFcQAAAABJRU5ErkJggg==',
  iconUpb:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA6BJREFUeNpcVN9v22QUPbEdx47TplnSNnaSdm1hDMZDN2CAoLww9oBE33jiCal/0SZN/BlIqHvhAU0CJgQriA5o0q5DbZw0bRonTWI7/sn9oi+Sh6WjOPp0j++553w3Fccxtre3QU+KIBIEgsSRJmQ5FH7uE4YcI4JHiMELwAlYoUrQEsgR8oQF9v7J1sc3Hcee/Prb3vf03+QkISFIkkm8sEAwCMuERULx7t333lIUVbftcW5r66MN3/Oig/phMBwOn9C5y8EI4xkZ62qesLqzs/N1GIa1ZrNZWlmp5u7c3tQLhVLasizsPt7FarUKvbz8peM4rSAIulRjccJXyJiU6+9/eOcrMSWiVNJxdtbE/v5zeu/iuHGEBw8f4YvPP4OmaWue590SBOGAz5LNLhL+J3OpfvgcPz19gmG3B9sewXXGEMmaSlXHu7ffhigJiONQIpk1PpYsNwYzMuakzAg9P8ThcR394SUWcvlpsWM7UFUFN99cB8lDLqch8H0jQSYlycCdEfxggotBG/3RFfLaPDIZGa47gSCIWNINpOi3eK0EURSKURSVuCLWSGpGFvH8uKlICsh9mDQvKAqMcgVKVsXloIe12nXcv/fp9Ls3brxejqKwzCPEyIQZWcjDZ4dh0F1cLKBlniIKQ3hhgPNuhySIoDNsbt5iEjHxvAyZoPPOMsnOQm7vqN8bDUvzRnR+1oXvezS3HDySyRwWRCL0KJ9SBJEqSb7BI8XCLs3IAk52dd7ptjY2NsJYdtBuNVFYKGJ9dQ2yLIFdvZ41wPJSmdyt0NzEWdCn3SVn5jCyWm0llFVRPG2/RP3oH6jaHMI4gmX16dMSHOp2xahgXsuxiCxGcbTEu1OSMhlZ73d6mqedztgdx/XG39OxRnTsxyFSpM267CEtp6ed1iqGQXNb5TIzUqIzJtPap2fi2X+uV98oXlp9mVKOuayGg4sGWhMPbbNDOVPQeHEM23Xjq751f6Jkd/P5vCglMjYhDAjto8OXz+699sE7Deuv0mBwBbN9gb29P/CCCFqtNtJpyRal9MCduGoUxo8L17JnLA1JMmbCmNChMB5l0rmTbFYtfvPoYernp7/ANE0/Lcvd+Xy+oWW1OjlrjsdjT1XVZ9R9mymTEjcg4t2xLXBSXNAvDvYb5rc/flfy/OBc140fyL1/qfCEztm2GNCFZwuyz4xjM08lNu3sws8R2DWp8r2mcYP6nMTiW9blQfe4qvA/AQYA7z2lEDB0G6EAAAAASUVORK5CYII=',
  iconMoti:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0VJREFUeNqUlMtvG0Ucx+e16117/U5ixzhxQo1MGypHFBOCOJJjkLj0VAmhihy5cOKf6aVHOHBqORYpAqHSoBYk0kei5qEm2LHX3oe9j9mZztCxFIkghZU+0mpW+53vfH+/38DNzU0CANAVGnjzRIJQEAsScMlHCqUFBUFekFE/jwS2wBUwAb+MGFJCDcH1rz7sfHMT42/F+zuCObUR/j/Oyhih5pcbG7c/YMnHDx498lKr7d0QQOnQF0wuOCr/L2f5rfWPbnUK+fXe74/h2Pet1KD/mVi/IpgVZJVDU6ErE/AiZ6Tre4H74CfA9/cAiyLIu90GKpXfZwD2lCtHuZHvY+VWQs+L4VarVTsZjczGycmq5TpG1OsDD2PNrczmKcRSLCVzbVTmlq7krCV7PAkp51RV+l9i+YjSLEqnF5quVw8nYwiDEIZWhgS5nEEZLzTn51e21ta2Mvd+bD/W9WcUIU85C8/nJzOzRe2PHibJ9kDXfZzJgCJjoLV/kF3p9iorpdK1rzc+/dza258/2N1diTlvi3/mBZZyTRSIqF46pYy9+M0w/moC0HmBETDDAF6fjJdri3UEn/yBD+/dB39HEeGusw5K5X2VI1AZyuNG8phTh/oAIUDH7o1BLqs9zVpgZ/Et/CuNEN3eBumXh2DIORho2IzKM6dKSE6MgRHUxScmxbgqM0owBua7zeJe2lx6bo/8oeM6vuOduSnj7O04tnJhiEPGDLtajRmEZqdeb31SLq2VxuPyQZIcEzUuMsyzhPOnXS+4Syg/qs5VhYbhQAjTIu3KcZyg9nC0vO64eNZ1Fmbaq/VOsVg5/v675OeUfh/UF38hyi6d9pLrjUUG8LlhmpoaJTmvtYeF/JDo2hcsDHLpnZ1GE2HU73bBDzS2XyLMhZA5FWOqzEwF2lU5AtX1PV/T/CdXW5W+Pbj5iiawFk3c5aGtnTLOWdX6p0XIuVmjqsNDleE0S02tRT0rN4GWdVAI42JMSHpQi696h0cLXNf6co7JBQPML1iT7SMKBgIOUC+VSs3ImdaXG7Zp2zcCQp7JfiWXuFmmESSqUPKeeyWH/zSgf4Jr793R3mzmkEteVYkSjZSgc+5mRmpO49cCDABebWpp4n76+wAAAABJRU5ErkJggg==',
  iconYield:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABBJJREFUeNpclFtv22QYxx87tuP4kJOTdG0X2qrQoiE2DlpXJgaTAAk0VdoNF1z1km/AFR8IkJC4Aa4QIHUCVrYO2q1dD2mbpkmd2Ens+GzH5nH1RqqI9JPt2O//fQ7/96HW1tbKAJBHZERAMkiIuMgIcchzSoyMCel9Ald+DFJF6sgsoiBZxEMGiEauqaBPNkixyXN4VTAVq99/f+XLaim/kqHGlRwTU549gu2d59Zf+/pPoijtkQgtxER0pEuu6X8BifRS7Pp8febTLJuRXFPFHCOwbAu8KMn5rvWRLOcX1r94+HpXVcfNk4a2fdj5BtccIQ2kTTZIox2nYqXE7oBSysKfh1uwf6xCo6VDGIVQlQvlxbnpzNAY1Xq9LsSxrwhsvJ7juTN14P3AMMwOrm+ScripWPa8a8YyjXX3R8AmPmSoBJwgBNuPhPN2R5AEDox+F16rK9zy/NRSs6XOn7b1RJILPK7nSMm0zPLy8qpS4O+ZTsg/edmB064F3aEDxsgDrT8E1zJA5sZwoRvw/c+PYDTswddfrdOfP7w/t/ficKk3cC5omk5r56Zit0QuXl2eyuQ9U4fYt0AbWuA4Lry1UIaP356FBYWDeonDesZQnyrCTE2mJEGi77zzZun3R5v1KMm8RLFhmubguD1sLFaYWZqigErGsDRbhLuf3IBaUQDXD2EOBWqFHDy4vQAjN4TG3i609hsQixW4++7Sq9/+uPlepVo9ScV6jj/e/Hu3teqYfdbBjx/cngY2mwVJFOHezWuX/ozRotE4dUAElaIMh+c6bD09gESq0a5j3UC7SqlYl+Oyz3ZPOk9FMO/YXgR72NGYosGq1yCJQ1icLkM5L0EYJxBQLJz0NOhbATzeV6FQDMB2HM73fTatWSqYZHOS3tEdxfGj7HSBybGYc+B50LrQ4aCpQlsfAsuwYGDkLJr+u99ewGlnEHcH9iDLi08kSdpkiOla6JnMK/MLsW3bH/Ssi88UKZJ4LgMCy2CKMewed2D76AJoloMgZuFcM8ENktHM9WvPZFn+g+f5NkPOYT8tDLY4xhfuhWrx7YH2YUX0pPmqQOdz2En0oRuOod3tg+7EoBvuOF8oa/l8/jHyz8Rnk0kwmRSWIEptP2Z0zQHqrGfxYRDwNDbaxBRNx4f2wMc2cF3s4EaxWPwVgzhIzypD3DsmEaYTIKIoylMURSuVSjuO49xsDvSVpmEslrKRMrR8GNrxqDpV2yoUChtYniNy6F3myjiKyViJSZQm7tjDwp6JorhjmuYbak+9ZbnRHC+IDUztF0EQ/sXvVDKSoqtiE8Hg0kwk5bSeGGkHozjCxRuGYShBEIS4yXN8d04aeDk4/y8GJNXJJI2uTFyNZVm+UqkwZLFDIvIm8+w/AQYAA2L5OdadVygAAAAASUVORK5CYII=',
  iconRate:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA85JREFUeNpsVNtOG1cUPXOzPeMxvoHHJnY8JnZtrECISKpQVEVFPKSRaB/6nk+I+pLP6BdEkapGVaVWEelD27QPBSyVqA1CDUGQggW48f0CnvHYnrHHnu6DjiuKamlJs/eeWd5n7bUPtbKyQiOEOIAdIABsAJzrA3RAFzAAUOQ9DETqI+A6YklRBPgA44AxQoaJTgEN8oxzDgBPyDRAmxD9S+YETACuirw/PSXdXW6dWUKperSv219nIJ8DtEhnYnz803u7mWHUCmw+5scbx6RzNCLDnUxGgzeXUqFPPn/zUrF3NOi8I31ULoiLwYXfvoD6GWAoOgKS1Zx6lC+9OImnG4/JqajLZFLEt/DZ8yc5e2n4Xckn2ert/aXpttm/IZT5xbFgdw9rI4nzH659dSzw7+18Dzz42EOANSKjiejuTt0TPyltocisduiJnNUCqWoJl8+qw/ehHgWEjYr8scavH12Jc7sQGwSDi2T4RzXKOmJAW85GmTgxdZ03GYpHFH0u+ETEc3fh5c91j1euviAaqmQw/yHD7FohX67xlIzUg5kIRwusw4yHdCuPRDeDJyb0SsnbCruuhGK23QskI7sw+Jkl/1JrGNs/9VDwQT0rJZRsMrFjbSBTeKv6IkzeNbgtv1qri2NTReiKwz50ERvR5HtsEwOTKYCiO/F21eSK7fK71nJz0BBEL1VJp/wHoLFFK9enu9xGO5nissSPFrFUEzcCqOCJs8R4VTwZv6y2/DJag/c9EPsh5QvYF++82TYEX6zxCnKeoHsmLksfpNQ6YnO5k6zKbD5jhNbOyBoGEbNPWnYTE+OYc/RuzKnWRjsRVwp+x9z0pP3+/No3RdQzhkhwXQmXazfTkaXMI2xemgjZJcetkS5x+91rE/dmN39ouFyxLBadCjrvJJ9/uYfq4pND562vM7VqRe90O4HyIb8Mde/IGlgDk3SDyNLz5ml4XuEyajBunE+wp4qiZv2FIknmHWsbmPItpcTAumotTcYajsgQGbONLP0YbMTc9q96TAzn1iGu465bzT6yUwE06LFYHhS95mctWAITtfEmDC+TceRm4JjWzP2qvnkanbb9AvHfeOHzpeMjGwogdW8h4bXNTtQOgiEV/Yl8QWYL24O9RHZO7tQX0xs/FhOWf38VTpyHVA8f2xC2nnVp6aFW6IUqq1yojZ4iynvwOjAZ/gN3f5EMkcXVc3t9q+/+/enVJPctxAUycc45WdRkd62Yz/aWDbMpSD5qPxwL42vqBJNRcNNeXC0H0cxJnnFHHTIYmtjm/y5QrKn6jwADAOdNghDsOz2+AAAAAElFTkSuQmCC',
  iconItem:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1BJREFUeNp0VE1vGzcUJJek90O25A9JVpQYdZLC7sUoArTJJe2tKBrAKJD+xl576KE99VQ0xwBBkIuLtqitRLEcWdZqP8TdJbfzNlRhuCmBAUjucjjz3uPjx8fH7MbggHcDtYMBrMN/hryxpoMKCIAICN2aiDSQAbmbV27/g2QC8IENYAfoA9uOlJTEwDtgAlwBKVBcJ5TOlnQqtoBhXdf3ksXi8yxLHuZLva2kLDbbG6cbnc4zW/NX+OfUkcbXVFpxeHhIJG1gANwHPr2cTr+dXl48TdL0bpZlO4sk7Z9PLj5eD+WDqNXSdc2Fc8KdMrsi62JyGzjUevl4djX75u3b88+MsWSXC+FxKSW3kBQneRD6qg+yrrGmjX3jyEhZSfZ6wMFsdnl8cT752jDbLcuKpUnCOOdM+YqtKcU8z2MCzKPxZH86nX3Uaa9/cXs4/HVre+cH+o8IpTFm982b10/iOP6urExgqopZaxn3OKswL9KSZbg7jELWaoVMreH+2vLJZLq+iNOvDg5q2+31KBmpt1gsekk8fwzJgbWGlWXBqqJkNQjoRo97731A7VLrJkxRFBAh07qQo9HoS8T1AWXfA0nOhTwBiY7CoElxrvNGFbLagMKMWUNYFBVTEraFADi7mi823k2nj3CsK46OjtphGFVZlt8CwXYURbIsS7bMQWgMex8O3sSMUJaaFVBIhKR8hX6//xtlcw2jBEmWptluVRaddrst4Y9ZY6GkwLPgzFiaa2xzqOXMD/wmBEQUBH7c6/V+oWxeUs2EYejt7e3Zs7PTp1rrTzY3O0EYhGy5zBt7FjGig3JNMSlkU2BKSawlYhj9QQUs3bOgUQdBYO7c2dPj8fgJSuNISrHVarU42aYMX28FpIpsS6n+HAwGP2P3nGz+W3TAUil1BZuvhZQpsufDpkIOpIfTFJ4mftyzyIfGa3i5v7//ve/7z3H2TJycnDBHaNzDzXHjHIpGIP3L94MLrDMoq5sqF2IOW78Pbg1/Gg6HP6KQX2D/bwoXv95C0NuEazmr90pdowebu2maDpHtCMqXuGiMkhqTNddJ5uSK/09zXJFSS2o5hK67WNfTKNaJm1OIrPxAw1zFcGWbGuLMXeDd+F458qan/SPAADZkjTT769JCAAAAAElFTkSuQmCC',
  tableBorder:'data:image/png;base64,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',
  iconReset:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABB5JREFUeNpMlM9vG0UUx2dm1/Z6vY7txE5cE5yQQOymMSERJGmjSFBVSqUgAVJVoR44IA4cOJdzVfE3IBAnJISK4FQOICSKhNS0KCQqpGnaJnZ+NI7t+Nfau17vr1nelHGVkT7aGdnzfW++8+bhvwhBRBTRjeVljBDyAUEgDEQBBQgAFNCBFofNTcAFPMSHeHNl5cUckIE4MAy8DAwNG0byWTBYhXkTqABF/m0AHcDmwZ4LsEEACRgAxmVKZ6+Uyx+NVasTgmUR2u2iI0KO1lKp39dHRu7woOwULIgGWCxDIZPJ9EQjQFr0vJlPi8Xr6Wo17bXb2G21kK3riBhG30ilMg0BXqmGw0VNkjSeld07LhMTuTdJYHJJVT/MFYuTLghQTUNFUdS3EolqJRyuEUq9uKaNnj0+nq9EIhtNWa7Dnm5PkAn5gT4gBbyaabdzHgULXBcVIpHqdwsLmxTjPULIMfxujJbL0fM7Owvvra/fuD0z80k+kWCCArOKnBJjmaXPqGrUsyzkQlY/53JPPEIOBEHYBrE89pHKYSq1fWtp6cut0dGvLm1tXePmk55Xvvf3999+yTA+LoliBJ+cCFang6qC4E7t7qZlx4k8ymTyx7EY+XdOvTL2UP5NafuMP86du+8gtNlnmrQVCDDPEPMstB2NGgbG4oVCYZnoutj+v5iIIwjm3fn575uK0mor9sTBlHFVlbrJocPArud57b14PG+KoooxZjXnCNlsVoZF6ESWcSMQQK+VSmfBUdxQFO3O4uItOxhsOIQmd8+b18wgDdX8+iDuUhRt+gu8NFQQZpfgsrMSEHPAE/VRKnV3I51epWDlxuTkT6YkFVzBE/YW7Q86MRq3XBsZrokfjtUuFVLqmyAiAYS/Ao/AAuenO1mWKhhd+TOX++FocHAVjF41BjzhYMF5FxRErDuG4UICDkWDZamyn2gu/Z0tvQMimF8AZhcQKMX0i+asq09tRB9Yomj8Ojf3Lbslf4XaqRLdgLS1wxXrgmGBGBwx9zR+T7LEX+A/a7z66fPM2C1MrUV+rA9ZV+9drH1eTHVetzwv4bruKKV0AjIf355ujVXtpg8ZFIVUQQOhJ/yNNnnRur3SsJSW2MzeV24+mmt98c8b9c+CWbHZr0kqcbGvJneUE7HVh3QIblKUaCg7sOcpF1N596CnnxMO6oLdf+TfbMidwWbEHNdDTrQeMsIt3AkgC/x1PSR1RW12N/mNSMkD2HPAM7N7bYiJeXzh+m1iDh8pj8OqeNzx2zETOZJLXR+LO1CX9t7aPvN10PIxn/aBGs/KO93DLN5G2Lkd1qOSJbkJrMM8pslWv9Lx13lNPQMO+bzb62O9IRxcj6DxxwrlQl3e8FQeuey3hTx8Czwb5lO91xRvX97zMjvRF2L/CTAAXkAASAqjjOQAAAAASUVORK5CYII=',
  iconFavorite:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAB3RJTUUH3AgMEgAGJU9QpgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAARnQU1BAACxjwv8YQUAAACBUExURYxiRFhBL29ONoFXO1A4Kap5U5RpSIlaQrCAW7WHZZ5wTTMkGRENCigaEx0eIi8yLj9AQjRJMTZ3LkxNSmlIRLZRSslPUUCJOcdaYEuSSTyDNXGudbVHO4a8iXzCiXu9hEwZGs0uMITGk4wwKcYaHLIWF7YsLc4eIpocHGYaGHEjIsd0iqMAAAEaSURBVHjaPZCLkoMgDEVDQLACorhFXWu3yqOP///Aje3OXmbCcAh3LoFTAxJASoWSo+Igm6oCFIwhLSaY1kJoOjJoUBiSNf9VcFBoze1R4tPY1+sDAYBpm0nhElIJsTWGAVRcx5xSSNuU8yM8388l1yXdSemyr7EUZxEBUZft0P2875hLpxmZ8j+4hes15iIsRQK0kQDB87rElDvDKBLTt7CFdV/XZZnn+dsyBE45LyGs15+DjaO3TL6hCGH5tHnvDcrD07Rqmqag5lE43VuCnGnTOklUzd/OOYokKSd1tt3XOajR924YLAIoTlNoW9e53vt+GLoDAurP0OjO2mNTCFIIqGV9qmjkdd1QbehHDDkH5Ch4JZU6/OQv63MYCIpCoiUAAAAASUVORK5CYII=',
  jobBG:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAMAAAANmfvwAAAAB3RJTUUH3AgMEhYndb71LwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAARnQU1BAACxjwv8YQUAAAAtUExURQAAADIhGS4hGTgoJEU2MTsyKyoeF09COxwXFzEdGyomI01EQi8vMRALCDo2NSmSYl8AAAABdFJOUwBA5thmAAABG0lEQVR42oWT23LDIAxEWd0A4/r/P7cCMw51gOohMwknuysJQhgqmRnBP1KYlxmeMpsBhMwsXsrMM8gy/LwUUSkxCnPGiwFYSzn7t+MqUTPyGNOJGM/xP1dRZPrEJnDht3URzo+XOTHp4PowRizHbAoXg6zbiMwnJdQje9SfOXIocCdZiYSgYJdJnmRFhMPHnFrYJVLTkPvoBlFi1LHtEN9+RXSNsB87sjM60ZCdkaugdhQ3WcDekf2D2H50iZFTXYCWjUjbI5ZOLnLfEkDiSgT3ZSTvacqwZqLQZaZWLBnPjfYJR/0mcF+obuU6f1tPUgkafnEvGSERHjVaWd2VU6qsUh8s8PVufF9oz16lPfu3RjcbazHNdkZv4BdMigWtQvNdCwAAAABJRU5ErkJggg==',
  button:'data:image/png;base64,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',  
  jobMode:'data:image/png;base64,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',  
  arrow:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAzxJREFUeNrsV9tOE0EY/vfQA1CsUqCcJAZDQkzAoARNiFdKNCbeeqEXmpgYE1/AK9/ASx7AV+AFNF6YoKGAjYC1FLFVeqTtbts9zoz/lilsGk2qCCTK33yZ7s50vu8/zL9bgTEGx2EiHJP9f8QndmQmcIgcznfKwTgOxWRO5kG0I/z82kKYfLQ56N8U0iD2Ppq9+kTwePuyFePz/JuFD3hPQ1T5qHEhbjHkIEIaYQ6M9ofG7lyZmA8PDoWDoV5SVCubmXxh/ev3dHRxNba4tZ3d5kJqXIjhEmK5hLDfybET4t7Jc+FbN6cvznX3D0ltHR04g1PYUimloFaquXSusL6dL0Q3UulI5FMixkU0oqJzMS2lR+CjhOhEDM+OjzydHh973NF5CmSPF0RJRn4BiG2BjaCEgIT3mCSrZbWWyJXKa5vJ1MqrpbUFLqKl9AguAU6+TyNG7l2bfDHc3zPj9flBkmUQRRFMXQdD19B7Ah6vD5w5x5xoVJUyBLt7iE5hcyMej6XSuZV4priYVbVvuERFKHzUuAgqNHnvQwz4PfLkg+tTcwG/L8woA9syoVZRECoQy8IoSPVoMCSlDInLJegKD4C/vR0yya36esctg7B0zabLJmFvqxZ9/XHHXObkRG4KvbOe6Jatl9RahmmVsFLcgYqigIkCcAMgmHPB+XDJzlPVwjklmQQZbyLRflIZ9GGSJ3G1GPCIZDzky0cLRrxxnMCV5zZE1+3LY3fPeIWJTDIFqmGCZjPQyS6xTXe35XVXJ0EuaJMFkEUBVJN8wWUxFLqimvS9YtIELinxcFd5we0Ri43Knjo/eGMo4LlfymehYliAP4SqxZyw1b0mCLYfHg2vE7hkHTdYKZv0HUakxKu9xitdbyqweqXvNRCnsM6GghdGg55nmdSWZFgECSlUEDV711tEAT2OY2lG0cuIZtNV19muNR2pxtn+aaPZa5k+Weq81Ot/XsznuhwiJ29FgyTQixgSRDHcEfQ6+YsmYrrObktNpEEszvT5HiqKqud18rKgk/WsRpbQu1LTuTRcJA2P4E9ap+DKbweHxDc2Wg3bQR6LkguME9iH/Wg8sX/8nevkL8xR2Q8BBgA2hPFRtbbr5wAAAABJRU5ErkJggg==',
  iconChatSM:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AoMDB4YZ3mPAAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABeklEQVQoz3WTvW4TURCFv2+DiFIipXbWCgqiySP4Idy6oEJyCV1eIR1FXoDCUqrU1JFQHiEikrVri9KioOAnEhwK3zU3KNxm9/6cM2fOzEi1ulW3Bxyr0yQz4AS4AxbAlbpsR+2v4b0V8FB9V0DbS7fXSYb/BfCmHbWbHbgAr4GXBZeaeIuPKklugcn4aLyxW3V76ntgNoCqSI/ugUWSVw1wXEk1yQo4B26SCNyo50lWZU+SmXrcqNNKGsDl+Gh8lmRezuftqD0DLofo5TttCkvxR9RJv+5P1XnJcd6v+1NgUsj/Ru9W3U/1aW3UkGOS32rzmAfAfVPqOOi2IkFteGh5XcK7pjg3AL4m+QD8GB4nuVc74GORnMK1sFt1J+qnQvBdvQA+D3Utaz/Ja/V5JeTFE2AJLNRZkgPgLfAF+Fbs31efAQd1nYGlAP26P0xyrf63wyqXb9VJO2o3DUDp1UmVv7VBFdFiAPIP+26qgGlp191UqVfAg6n6A0q42/cMWcqjAAAAAElFTkSuQmCC',
  iconChatNoColor:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWFJREFUeNqMUz1LA0EU3N1gY2OQs7HwI8L9gUAqG5VYWqS1EIOQIv4OtUxjKwS8NoWI+APyG0RCzrtLaWKwVPFYZ46nRLmNtzDs2903c7v35mmrslEC0jiJOG9prRvW2kPEPjAAAqCH/XB9bSNVMgywBDy+V6v7OOwi7oA4xFzHehGoIx5i7mDuJqPY+yYrfvmjsnmUlsufk4uzcyt7eYhHcStKogfAy26MoITN69fT9iU2noHafwLMJ49kH7iTw4MiAsyHgG/4c7C+klfcACfALVBTjgEO8xuGfxWL/sxZEYE+eUbKMf5zOFcAROb7Ruq4kqPuFMBNmT8gOYDStuN6LgHmB0ac01TukSfQBKdHcghM4ZxWEYEXGIn5GU8K79E5NMC8+tJIdOIbrMy1lsZQaAqP/sX7l6WOLMdYfg7fyKdNV3d27xfCp2PEez9kEci6igYAfnUV38irznbVlwADABPWyIVOu15aAAAAAElFTkSuQmCC',
  iconSave:'data:image/png;base64,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',
  iconPlus:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNpckTsKwkAQhvPYaFTUQhAEQbAVcyM7L+E5rLyF5BamMpAiRQKCVSBNECRqkvWfOCurAx/7w7xnTeNjJmNprwSN9v4ECWBrkNWgYmrBweTsMF3gcLUXeDBStRUcOAAjKeUljuMd9BD02Wdbf5V7nGCUZamSVad2NBJjMC+KIpB/liTJHr4ZJQpehDaWaH10XTf0PG+b5/k5y7IgTdOTdpV2Xmo3BUuwpopRFB2gV2ABJsAVnEEneoI7ad/3N2EYXqFvND77GlNb0NFQd674fESlgg0OsDTUz315CzAAWshhdQv5QQQAAAAASUVORK5CYII=',
  iconExport:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAr5JREFUeNqkU0tME1EUve/Np62hUyhBIfYTFI2u3Bj5LIplw8KthhgTTDRgDCvZoMQgbghrNkSWagyEhW4kAg3GaIsKwbYKjYQmiggBOrTQMv1M5413akoCRGPiTc7kZd57555z731E13X4n+CNz9DQEPj9/v07SMzxPEmnMzpjGvA8DxzHASHkMMGrqSl4PjKyb8PldDZ3dNzuWt/YCGK8DoXCn2R5a+WgAvLR4YB4IgFpRQGKP9YZgzaTaO+9e+9Re/uty/JWjOU1TUklkzuyLEcXFxcDszMz06Hw5/DS0tIyeYuXOJRlSONw/YMxa2dNTd3I8PBoqc1m293dBYp2jFLxPAcmkwnQkpZXVW1wcPA+TygF9lsNh2c8ZoDOFrc7elSSbPLaGmj5PFBRBBAEyGYZJFMpMJtMnNls1rfi8Q2jBkZVTiKuY0e6SyilntXVlURPD6hoC5AA6uuBNDUBRRJd0woq5ue/hH0+34RBYEf0Iq7paINHrfZIxJGKRArMxZrzXi8wSkAoGGVaIBCYjMXkNYMgh3iMKEWhl1S0RE9UA2XGfCByKhCXG1ekQMajis3N2Lpv0ves2MYkYgI35yKM3XCVVzys6OszZwWxcEFTc8CsEp7EGcAOEYFCKBh6P7+wEN6bAyMsjMVenKoOdff3U3b2HCZnwHQjL6rIKAXvhgY1m1HGxl4+KU4wNSpsQe8dnFDecPNqV6VLES3ZFShhChzRksDlYiByBETRVCje9+/LX9/5/ePFxLRuexsGWlpgWtedyk5K870JRj7MzkV/RoMJgeaY1XYMJMkONkmCsrIywOxPFSWd3htlggp0nHNg+W8P+gbasOEWHElLVVXlGW+jx1tbe+G82+2schx3WDOZTHx8fGL0wJvRobW19U8PzYY4LUlSc0ND/Z2LjZ4rh079heCf4pcAAwAOSzJPzSWG8AAAAABJRU5ErkJggg==',
  iconImport:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtBJREFUeNqkU1tIFGEU/uayt2xm3UxX000RLKVeBFES0awHKYIgKn1p8cWwNYqeRCiJXnoUwhDsoQdFkehJErxgEO4WKOqaGq4KZWFednZWV2fHnVv/iAYqRdA/fPMwZ853zne+81OGYeB/Dmu+2tvb4ff7D0YIMcOyVDwuG7qugWVZMAwDiqKOEgwPDKPnbc+BwGmPp6qh4V7j6traJDnvg8GpCUGI/DjcAZXZkglRFCFJEkCTLxuA/ZXN1dTc1F5Xd/emEAnrqqZJW7HYpiAIi6FQKDA2OvoxOPV5amFhYYnCU5LEmFR7WARyPuRc7e7o7kpLSXNGY1HQpG1zUqYMm80GIklTFUVra2t7TJOqNhI9Bh3HsYMkaojKSNxIPOyN9DpXoitgdRaaqkFVFWxvbyMsCKTbOEMzLB0RxTUKz1BPyPMIUgg02kIn2eP2KxIl8WXpZajNrcW55POwUAw0Q4OmG+A5DrOzM+M+n++aOcTrBJcIrOZQdFWHxEi7ckaWRjAuTuBlUSsKUwqhKRosjKlX1wKBwGA4LPw0Cab3kk8RISobZVI5nnOLm1GkJ7tRnVONVHsqEloCFE2BtViwvh5eHRoc6tq3sYXAQQZpRSf4+94Hrcvu7+5o8gbqC+qRz+WTZAWyIoMmBBRNIzgZ/DQzOzu1T7C8ayjprEDNvewtvn02Yldg0SictKUirkpQVJlIondtUnZkqa/vXcf+BrNWxkr6VoHXTIrvTs0TNzPNJbN5MBwuyOoGqSoT65KIUQwYUn0+FJob8fv79xeJjjXGUDNTA2PO8IhbW8qAf/pLYHR08dv8WNRKJ3TO6QbPn4CT5+FyuUCqdxIb479X2eyAJY9hqF+bn7+oAywOshuOjIz0/MqK8sqSkuKi7GxPRlZmFifLstjfP/Dm0J0x4PV6/3TRnARneJ6vKi298OhiRfmtI3/9heCfzi8BBgASRjBF6Hz+5AAAAABJRU5ErkJggg==',
  iconReset2:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtFJREFUeNqsVEtME1EUvfPrtCVRoNQfJEXjgoQJxJDACuOPhdEFRRYkJqzcGAILE3ThJ2FpIolujGyMIoSFWlQGIcYVIMVgEVrAFtLaUiJ105IWOh3m550pEJBqMPEmb8578947c++59w6haRr8F/sbka2w8Kjdbj+4Hx5CJyIIYs+G1Wp1dD15/A5RjSwtjU1Ofhnxer3T0Wj0ezKZkvdLRDmd9bc7H3R2JFMpYFkT6H5viKKQSCSCaOMTbvfo3Py8b3p65psgCBs5iUiSdPT19fGVlZXc+npaF0DXAFQEk4kBi8ViSCJLkhoMLvra22856VzhOhyOUxzHlWUyGZBlKfvSeBCQTqdhHQeJcwybZBiTthKL/SBzEJlqa2vPmM0sLcuy7p3hDYGoqWp2vWk0TUFPb+/TZDIp5iAiDl+oqzstiqLhviShR0T2mEGmqbqwGKIJlpejP4eGhl8ZpFvXq6uq6hH68XKooqKsWEjHoftZL3yemISz58+Bs6ERKIo09CQRGYYGt9v9Mh6Pr+wiQnuDJN14sPmti4fikhKDpASx4UqjQaAoCnpFoFcEiBlRdL12Pd8Oc2dQ4UjkPlfONQ3yvAmF1MWEltZWwwNVUbPZxbBYloWvU55x3+ycZzvTO4lOlBbXtLVcY/S5np2Lly7DgfxCQ2TQFKOWUCKgUCtXv6tLVVVtD5HPHzh+43rzTd/E8HZRhYMBYKk1oKkMsOY81IVBZCEWWwmPjX76sKv2trAgv+Dk3ELYzI/44VBRgXTsSJHqmZoBfyAIFqsdi9AMeRiqzWaDAX6gJ7G6mshFRMiiEB36OG7TF975xZbZQKgDNdl49LBL8fv9KK1gtMpaKpkZ5N+/+L1otsRWSh2OJkSPnrmlaEQ/aLGWl6/RDHP13p27IbPVMlNTXc1h5haDodDCvrt/ZwPj0BNg2fzwKg7pn/5HufrwTxu/BBgArZRH3O1yru8AAAAASUVORK5CYII=',
  questwiki:'data:image/png;base64,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',
  iconLight:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVlJREFUeNqMUj1LxEAQ3WyC4SBVKrsQm/sBBwdWtv4Df4UgVtZWVvZWdsJVNhbiP7CzFUKKoCBKCEnM98f6Bowsl128gZfJ7s68nXmzhhCCKWwBrIHl7zoF7oF2FkkEEkzgHPgUc6O9C2BPztkmuKHIcRxF27ZCYw86ghWdhmFIjhGJysqyFGmaHk95XOpmRR/f9w3yhmGotGFd1zGQHE5rSzp7n2RhGkNVlMyapommPS4dPsK99H2vy2d5nhMBXbSZEXDOB5Cc4pf8LBmisizL2DAMZ57nfevGSLhFFTPx4jgWQRA8bcdzRaVXpmky+YFRRVVVkbCX/z2kCc/yGCGaiKLoTRVrafQKiqJYT4LWdU3je1UF6giuHcf5EypJEhJvo4zUtLCUBUT/JOLRzi3gtgFlf+DJ7tPLgwZftm1Xruvu1gKmEIDgADefYP4Ly7LuMPtUFfsjwABKB8AI2XbIaQAAAABJRU5ErkJggg==',
  point : {
    red : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALBAMAAABbgmoVAAAAElBMVEVjb2zpHgdiDgWfGQpOCwT///8DM/q7AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcCgsHLALm6fVTAAAAKElEQVQI12NggALW0FAQFeriGgDkBBkbAbmszoLCrhgURA6qEqYPDAAyFQfwOzTDqQAAAABJRU5ErkJggg==',
    blue : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALBAMAAABbgmoVAAAAElBMVEVjb2wH0ekFWWIKj58ER07///8P2J0kAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcCgsHNw3fYCNYAAAAKElEQVQI12NggALW0FAQFeriGgDkBBkbAbmszoLCrhgURA6qEqYPDAAyFQfwOzTDqQAAAABJRU5ErkJggg=='
  },
  buttonSleep:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAZCAYAAABzVH1EAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpFRkU1NkIxNzg1N0VFMjExQTJEQUMwQTIxNTUxREQyOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3RTMwNEJCRTdFOEMxMUUyQjBDRURFM0I5NkY5QkY5NiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3RTMwNEJCRDdFOEMxMUUyQjBDRURFM0I5NkY5QkY5NiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY0RTU2QjE3ODU3RUUyMTFBMkRBQzBBMjE1NTFERDI5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVGRTU2QjE3ODU3RUUyMTFBMkRBQzBBMjE1NTFERDI5Ii8+IDwvcmRmOkRlc2NyaXB0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',
  buttonBank:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAZCAIAAAD8NuoTAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpFRkU1NkIxNzg1N0VFMjExQTJEQUMwQTIxNTUxREQyOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBNEZCQUJBMDg5QkUxMUUyODZDMkNGRjA0OThCNDIwNiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBNEZCQUI5Rjg5QkUxMUUyODZDMkNGRjA0OThCNDIwNiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjBGMDUxMUFGQkQ4OUUyMTE5MTMyRjkyRDBERDlFNjRDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkVGRTU2QjE3ODU3RUUyMTFBMkRBQzBBMjE1NTFERDI5Ii8+IDwvcmRmOkRlc2NyaXB0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',
  iconAlarm:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo5Q0JGRTU5MDhBOEFFMjExQkM0RkRGRTM4QUMzODJBMCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDMjVGQjlCMDhBOEExMUUyODFBMTg4RUE2RTEwNTY4QiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDMjVGQjlBRjhBOEExMUUyODFBMTg4RUE2RTEwNTY4QiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjlEQkZFNTkwOEE4QUUyMTFCQzRGREZFMzhBQzM4MkEwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjlDQkZFNTkwOEE4QUUyMTFCQzRGREZFMzhBQzM4MkEwIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bLqFjQAAA3tJREFUeNqsVVlIm0EQ3kRr1UgVTY23tR5oQKFFBKGKBwoKSl+qb0JREEQJ0vqgqFh8yYOFgDRajQ+tF6KgjXhGqxRCFashFCvxQoxgDPFITRRzTWd/+H+iEfriwPLvZme+neObCQ8AyEMKnzyweN/9YWhoqGJpaSk7KirKWF5e/iU5OVnnfq9Wq1+OjIxU2Gw2QWlp6WRxcbHyFgANmV39/f3SlJQUiIuLg/DwcOjs7FSwd5eXl8RkMpH29vYfERERkJCQAOnp6TA7O1vnjsFjc7i1tfW8trZ2b39/n+Tk5OgrKyvfnZ6eRi0sLBQg0AtUcQqFwl9FRUVKLy8vS1dXl3x1dTUkKyvLOjAwIPLx8bHe8hANX8XGxgICaYxGo7ijo0MRFhYGYrEYJBKJq6amxpWUlASYCujp6fmAD+cVFBQYMjIy4Pr6OoTF4QBdLpdfU1PT8tra2puGhobFgIAAmJ6ehpubG1hfXwetVgsWiwW6u7sBvQGFQvENPZQ0Nzer0J7nAcguzNsEhgQajQZYqa+vh8bGRu48NTUFAoEAlErlR2pjNpvJvYB2u12YmpoKUqmUMRweHobx8XEOyGAwwMXFBbPPz8+HkpISx8nJCf/8/NwTcHd3lwwODlZFR0fDwcEBIC0AQwJ61ul0cHV1xVSfeudwOGBsbAwSExNhY2Mj290pjtiYWIJVfRoaGkrQgFaaiEQisrOzQ5BvJD4+nszNzZGYmBhSVlZGsDjE29ubhht8dnbmSWyqEBkZacKwCJ/PJzMzM8TX15dgAcj8/DxNBwNKv729vZTgjB6uc+rMvcRGujyj1Ghra4P/CfIRCgsLAdnxxB3DnTbMt6+v709gYCCsrKxwxq2trdDS0sKdVSoV+Pv7w/Ly8ve7LOE2TqeT3T9G4ytqMDo6yvBwcXGRAaGFwQdZHpqprrszt1qPFazwI71e/xYHhEwul/vRIiBFmKLRXFKKYANYc3Nz32NP9wUHB9vvHQ57e3uMMoanplQ5PDx8jUuB57/Yjq7q6mqXTCa7QJ1Pm5ubdTQt+OBXaosU43C4KqMxsVqtBDtAhfyKRgL/RpJPYGWrsI+ZiiMQCQoKItvb23lpaWl6nEw/maHK53vSho4nmkfs4UkEwkdt+uPjY4YmOGUItiPjydHREfVEm5mZ+RnTsURt6R0rvIf+C/gnwABBPec5UzOlgQAAAABJRU5ErkJggg==',
  notiBell: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpDMjhFNDI0QzYyOURFMjExOEQwMUUwQkVBMzJBREI2MiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4N0EzMEJDMDlENjIxMUUyODhFNUM1MTdFQzA2NTAwQiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4N0EzMEJCRjlENjIxMUUyODhFNUM1MTdFQzA2NTAwQiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMzOEU0MjRDNjI5REUyMTE4RDAxRTBCRUEzMkFEQjYyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMyOEU0MjRDNjI5REUyMTE4RDAxRTBCRUEzMkFEQjYyIi8+IDwvcmRmOkRlc2NyaXB0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',
  jobTime: 'data:image/png;base64,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',
  
});



/*
TWDB.ReportAnalyser2 = new Object ({
	ready: false,
	failedReports: [],
	gui: {},
	locked: false,
	reports: [],
  init: function () {
		if( typeof(this.statistic) != 'undefined') {
			return;
		};
		var tmp = TWDB.Cache.load('statistic');
		if ( typeof(tmp) == 'object' && tmp != null ) {
			this.statistic = tmp;
		} else {
			this.reset('all',true);
		};
		if ( typeof (this.statistic.ver) == 'undefined' || this.statistic.ver != 3 ) {
			this.reset('all',true,1);
		};
		this.backup = jQuery.extend(true, {}, this.statistic);
    TWDB.GameInject.addTabOnMessagesWindow( 'Job-Analyser' , 'analyser-job' , function(){TWDB.ReportAnalyser.show('job');});

		this.ready = true;
  },
	reset: function(type , confirm , last) {
		if ( confirm == true ) {
			if ( !last ) {
				var id = 0;
			} else {
				var rep = /\[report=([0-9]+)([A-Fa-f0-9]{10})\]/;
				var matches = String(last).match(rep)
				if ( matches ) {
					var last = matches[1];
				};
			};
			if ( isNaN(parseInt(last)) ) {
				var id = 0;
			} else {
				var id = parseInt(last)-1;
			};
      switch ( type ) {
        case 'job' : 
          this.statistic[type] = {'last':id,'items':{'last':0}};
          break;
        case 'duel' : 
          this.statistic[type] = {'last':id};
          break;
        case 'all' : 
          this.statistic = {'ver':3,'job':{'last':id,'items':{'last':0}},'duel':{'last':id}};
          break;
      };
		} else {
			var _self = this;
			var div = jQuery('<div><h2>Do you really want to reset the ReportAnalyser statistics?</h2><span style="font-size:12px"><br />Give Report-Link of first Report which should be read after Reset</span></div>');
			var input = new TWDB.GameAPI.gui.textfield("twdb_analyser_last").setSize(40);
			input.setLabel('Report-Link:');
			div.append(input.getMainDiv());
			var checkbox1 = new TWDB.GameAPI.gui.checkbox('or use all reports&nbsp;&nbsp;');
			var checkbox2 = new TWDB.GameAPI.gui.checkbox('or use only future reports');
			checkbox1.setCallback(function(state) {
				if(state) {
					checkbox2.setSelected(false);
					input.setValue('');
				};
			});
			checkbox2.setCallback(function(state) {
				if(state) {
					checkbox1.setSelected(false);
					input.setValue('');
				};
			});
			jQuery(input.getMainDiv()).find('span').css('font-size','12px');
			jQuery(input.getMainDiv()).find('input').keyup(function(){
					checkbox1.setSelected(false);
					checkbox2.setSelected(false);
			});
			
			div.append((jQuery('<div style="display:block;" />').append(checkbox1.getMainDiv()).append(checkbox2.getMainDiv())));
			var Box = new TWDB.GameAPI.gui.dialog ('ReportAnalyser - #RESET#',div);
			Box.addButton('ok',function(){
				if(checkbox1.isSelected()){
					_self.reset(type,true);
				} else if (checkbox2.isSelected()) {
					_self.reset(type,true,_self.statistic[type].last+1);
				} else {
					_self.reset(type,true,input.getValue());
				};
				Box.hide();
				_self.open(type);
			});
			Box.addButton('cancel');
			Box.show();
		};
	},
	analyse : function (type) {
		if ( !this.ready ) {
			this.init();
		};
		if ( this.locked ) {
			return;
		};
		this.reports = new Array();
		this.locked = true;
		this.queryReports(type);
	},
	queryReports : function (type,page) {
		if ( typeof(page) == 'undefined' ) {
			page = 1;
		}
		var _self = this;
		this.lastPage = page;
    Ajax.remoteCall('reports', 'get_reports', {page: page,folder: type}, function (json) {_self.readReports(type,json);});
	},
	readReports : function (type,json) {
		var status = true;
		if(typeof(json.reports) != 'object' ) {
			json.reports = [];
			status = false;
		};
		if(typeof(json.page) == 'undefined' || this.lastPage != json.page) {
			json.reports = [];
			status = false;
		};
		for ( var i = 0 ; i < json.reports.length ; i++ ) {
			var report = json.reports[i];
			if ( report.report_id <= this.statistic[type].last ) {
				status = false;
				break;
			};
			this.reports.push({'id':report.report_id,'hash':report.hash,'type':type});
		};
		this.gui.bar.setMaxValue(this.reports.length);
    var _self = this;
		if ( status ) {
      window.setTimeout(function(){ _self.queryReports(type,(_self.lastPage+1)); }, TWDB.Timer.getTimeout());
		} else {
			this.analyseReports(type);
		};
	},
	analyseReports : function(type) {
		if ( this.reports.length > 0 ) {
			this.gui.bar.setValue(this.gui.bar.getValue()+1);
			this.queryReport(this.reports.pop());
		} else {
			TWDB.Cache.save('statistic',this.statistic);
			this.locked = false;
			this.show(type,true);
		};
	},
	queryReport : function(report){
		var _self = this;
		jQuery.post('game.php?window=reports&mode=show_report',{'flash':null,'hash':report.hash,'report_id':report.id},function(json){_self.readReport(report.type,json);},'json');
	},
	readReport : function(type,json) {
  
		if ( typeof(json.report_id) == 'undefinied' || typeof(json.publishHash) == 'undefinied' ) {
			return false;
		};
		
		if( typeof(json.page) != 'string' || typeof(json.title) != 'string' || typeof(json.js) != 'string') {
			this.failedReports.push(data.id);
			return false;
		};
    
    switch(type) {
      case 'job' : this.analyseJobReport(json); break;
      case 'duel' : this.analyseDuelReport(json); break;
    };
    
    this.statistic[type].last = json.report_id;
    var _self = this;
    window.setTimeout(function(){ _self.analyseReports(type); }, TWDB.Timer.getTimeout());
  },
  analyseJobReport: function(json) {
    var _self = this;
    try { 

      data =  {
                id:null,
                hash:null,
                job:null,
                motivation:null,
                duration:null,
                wage:null,
                bond:null,
                experience:null,
                injury:0,
                killed:false,
                items:{},
              };
                
      data.id = json.report_id;
      data.hash = json.publishHash;
      var job = TWDB.Jobs.getJobByName(json.title.slice(json.title.indexOf(':')+1));
      if ( !job ) {
        _self.failedReports.push(data.id);
        return false;
      };
      data.job = job.id;
      data.duration = job.duration;
      
      var tmp = jQuery(json.page);
      tmp.find(".rp_row_jobdata").each(function(index) {
        var str = jQuery.trim(jQuery(this).children('span:last-child').html());
        str = str.split('&nbsp;').join(' ');
        switch (index) {
          case 0 :	data.motivation = parseInt(str.slice(0,str.indexOf(' ')));
                    break;
          case 2 :	data.wage = parseInt(str.slice(str.indexOf(' ')+1));
                    break;
          case 3 :	data.bond = parseInt(str);
                    break;
          case 4 :	data.experience = parseInt(str.slice(0,str.indexOf(' ')));
                    break;
        };
      });
      tmp.find(".rp_hurtmessage_text").each(function() {
        var reg = new RegExp('[0-9]+');
        data.injury = Number(reg.exec(jQuery(this).html()));
      });
      tmp.find(".rp_row_killmessage").each(function() {
        data.killed = true;
      });

      var tmp = (json.js).split(';');
      jQuery(tmp).each(function() {
        var reg = new RegExp(/jqItem\(\s*ItemManager\.get\(([0-9]+)\)\s*\)\.setCount\(([0-9]+)\)/m);
        var array = reg.exec(this);
        if ( array ) {
          data.items[Number(array[1])] = Number(array[2]);
        };
      });
        
      if ( !_self.statistic.job[data.job] ) {
        _self.statistic.job[data.job] =  { count:0 , products:{} };
      }
      var jobstats = _self.statistic.job[data.job];
      jobstats.count++;
      
      if ( !jobstats[data.motivation] ) {
        jobstats[data.motivation] = {
                                      count:0,
                                      wage:0,
                                      bond:0,
                                      experience:0,
                                      injury:{},
                                      killed:0,
                                      items:{},
                                      extraitems:{}
                                    };
      };
      var stats = jobstats[data.motivation];
      
      stats.count++;
      stats.wage += data.wage;
      stats.bond += data.bond;
      stats.experience += data.experience;
      if ( !stats.injury[data.injury] ) {
        stats.injury[data.injury] = 0;
      };
      stats.injury[data.injury]++;
      if (data.killed) {
        stats.killed ++;
      };
      
      for ( var key in data.items ) {
        var id = Number(key);
        var count = data.items[id];
        var item = ItemManager.get(id);
        if ( TWDB.Jobs.isProduct(id) !== -1  ) {
          if ( !jobstats.products[id] ) {
            jobstats.products[id] = {'last':0};
          };
          var tmp = jobstats.products[id];
          for ( var i = 0 ; i < count ; i++ ) {
            var last = jobstats.count - tmp.last
            tmp.last = jobstats.count;
            if ( !tmp[last] ) {
              tmp[last] = 0;
            }
            tmp[last]++;
          };
        }
        else if ( item.price == 0 ) {
          if ( !stats.extraitems[id] ) {
            stats.extraitems[id] = 0;
          };
          stats.extraitems[id]++;
        }
        else {
          luck = true;
          if ( !stats.items[id] ) {
            stats.items[id] = 0;
          };
          stats.items[id]++;
        };
      };
    }
    catch (e) {
      _self.failedReports.push(data.id);
      return false;
    }
  },
  analyseDuelReport: function(json) {
  },
	open: function(type) {
    MessagesWindow.open('analyser-'+type);
	},
	show: function(type,finish){
		var _self = this;
		if (!MessagesWindow.window) {
			return;
		};
		this.gui.window = jQuery(MessagesWindow.window.getContentPane()).find('.messages-analyser-'+type);
		if( typeof(finish) == 'undefined' ){
			MessagesWindow.window.showLoader();
			this.gui.bar = new TWDB.GameAPI.gui.progressbar(0,this.reports.length);
			this.gui.window.children().remove();
			this.gui.window.append(this.gui.bar.getMainDiv());
			this.analyse(type);
		} else {
      switch ( type ) {
        case 'job' : var div = this.showJobs();break;
        case 'duel' : var div = this.showDuels();break;
      };
      this.gui.window.children().remove();
			this.gui.window.append(div);
      this.sort();
      this.switchAvg();
      this.sort();
			MessagesWindow.window.hideLoader();
    };
  },
  showJobs: function() {
    var _self = this;
    this.sorting = {'ord':1,'type':0,'avg':'avg'};
    var table = jQuery(
                        '<div class="fancytable">'
                        + '<div class="_bg tw2gui_bg_tl"></div>'
                        + '<div class="_bg tw2gui_bg_tr"></div>'
                        + '<div class="_bg tw2gui_bg_bl"></div>'
                        + '<div class="_bg tw2gui_bg_br"></div>'
                        + '<div class="trows">'
                          + '<div class="thead statics">'
                            + '<div class="row_head">'
                              + '<div class="cell_0" style="width:91px; text-align:center;">'
                                + '<span title="#NAME#" style="cursor:pointer, margin-bottom:3px;">'
                                  + '<img src="'+TWDB.images.iconName+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_1" style="width:50px; text-align:center;">'
                                + '<span title="#COUNT#">'
                                  + '<img src="'+TWDB.images.iconCount+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_2" style="width:50px; text-align:center;">'
                                + '<span title="#DURATION#">'
                                  + '<img src="'+TWDB.images.iconClock+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_3" style="width:50px; text-align:center;">'
                                + '<span title="#EXPERIENCE#">'
                                  + '<img src="'+TWDB.images.iconExperience+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_4" style="width:50px; text-align:center;">'
                                + '<span title="#WAGE#">'
                                  + '<img src="'+TWDB.images.iconDollar+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_5" style="width:50px; text-align:center;">'
                                + '<span title="#BOND#">'
                                  + '<img src="'+TWDB.images.iconUpb+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_6" style="width:50px; text-align:center;">'
                                + '<span title="#MOTIVATION#">'
                                  + '<img src="'+TWDB.images.iconMoti+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_7" style="width:50px; text-align:center;">'
                                + '<span title="#DANGER#">'
                                  + '<img src="'+TWDB.images.iconDanger+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_8" style="width:50px; text-align:center;">'
                                + '<span title="#KILLED#">'
                                  + '<img src="'+TWDB.images.iconKilled+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_9" style="width:50px; text-align:center;">'
                                + '<span title="#PRODUCTS#">'
                                  + '<img src="'+TWDB.images.iconYield+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_10" style="width:50px; text-align:center;">'
                                + '<span title="#ITEM#">'
                                  + '<img src="'+TWDB.images.iconItem+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_11" style="width:41px; text-align:center;">'
                                + '<span title="#LUCK#">'
                                  + '<img src="'+TWDB.images.iconLuck+'" />'
                                + '</span>'
                              + '</div>'
                              + '<div class="cell_12" style="width:20px; text-align:right;">'
                                + '<span title="#RESET#">'
                                  + '<img src="'+TWDB.images.iconReset+'" />'
                                + '</span>'
                              + '</div>'
                            + '</div>'
                          + '</div>'
                          + '<div class="tbody">'
                            + '<div class="_bg tw2gui_bg_l"></div>'
                            + '<div class="_bg tw2gui_bg_r"></div>'
                          + '</div>'
                          + '<div class="tfoot statics">'
                            + '<div class="row row_foot"></div>'
                          + '</div>'
                        + '</div>'
                      + '</div>'
                    );
    table.find('.row_head').find('img').each(function(index){
      if ( index == 12 ) {
        jQuery(this).click(function(){_self.reset('job');});
      } else {
        jQuery(this).click(function(){_self.sort(index);});
      };
    });
    table.find('.row_head').find('img').css('cursor','pointer');

    var i = 0;
    var sum = {'jobs':0, 'count':0, 'duration':0, 'experience':0, 'wage':0, 'bond':0, 'motivation':0,'injury':0,'killed':0 ,'products':0,'items':0,'luck':0};
    var stats = _self.statistic.job;
    var div = jQuery();
    this.gui.rows=[];
    for ( var jobid in stats ) {
      var job = JobList.getJobById(jobid);
      if ( !job ) {
        continue;
      };
      var row = { 'count':0, 'duration':0, 'experience':0, 'wage':0, 'bond':0, 'motivation':0 , 'injury':0, 'killed':0, 'products':0, 'items':0, 'luck':0};
      var data = stats[jobid];
      
      row.count = data.count;
      row.duration = data.count*job.duration;
      
      for ( var itemid in data.products ) {
        for ( var tmp in data.products[itemid] ) {
          if ( tmp == 'last' ) {
            continue;
          };
          var item = ItemManager.get(itemid);
          row.products += Number(data.products[itemid][tmp]);
          row.luck += Number(item.price * data.products[itemid][tmp]);
        };
      };
      for ( var moti in data ) {
        if ( moti == 'count' || moti == 'products' ) {
          continue;
        };
        var tmp = data[moti];
        row.motivation += (moti * tmp.count);
        row.bond += tmp.bond;
        row.experience += tmp.experience;
        for ( var injury in tmp.injury ) {
          row.injury += injury*tmp.injury[injury];
        };
        for ( var itemid in tmp.items ) {
          var item = ItemManager.get(itemid);
          row.items += Number(tmp.items[itemid]);
          row.luck += Number(item.price * tmp.items[itemid]);
        };
        row.killed += tmp.killed;
        row.wage += tmp.wage;
      };

      var dom = jQuery('<div class="row row_' + i + '" />');
      
      var tmp = jQuery('<div class="cell_0" style="width:91px; text-align:left;cursor:pointer;" ></div>');
      tmp.data('sum',job.name);
      tmp.data('sum-t',job.name);
      tmp.data('avg',job.name);
      tmp.data('avg-t',job.name);
      dom.append(tmp);
      sum.jobs++;
      
      var tmp = jQuery('<div class="cell_1" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.count);
      tmp.data('sum-t',row.count);
      tmp.data('avg',row.count);
      tmp.data('avg-t',row.count);
      dom.append(tmp);
      sum.count += row.count;
      
      var tmp = jQuery('<div class="cell_2" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',(row.duration/3600).round(2));
      tmp.data('sum-t',String((row.duration/3600).round(2)) + ' #HOURS#');
      tmp.data('avg',(row.duration/(3600*row.count)).round(2));
      tmp.data('avg-t','&Oslash; ' + String((row.duration/(3600*row.count)).round(2)) + ' #HOURS#');
      dom.append(tmp);
      sum.duration += row.duration;
      
      var tmp = jQuery('<div class="cell_3" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.experience);
      tmp.data('sum-t',String(row.experience));
      tmp.data('avg',(row.experience/row.count).round(2));
      tmp.data('avg-t','&Oslash; ' + String((row.experience/row.count).round(2)));
      dom.append(tmp);
      sum.experience += row.experience;
      
      var tmp = jQuery('<div class="cell_4" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.wage);
      tmp.data('sum-t','$' + String(row.wage));
      tmp.data('avg',(row.wage/row.count).round(2));
      tmp.data('avg-t','&Oslash; $' + String((row.wage/row.count).round(2)));
      dom.append(tmp);
      sum.wage += row.wage;
      
      var tmp = jQuery('<div class="cell_5" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.bond);
      tmp.data('sum-t',String(row.bond));
      tmp.data('avg',(((row.bond/row.count)*100).round(2)));
      tmp.data('avg-t','&Oslash; ' + String(((row.bond/row.count)*100).round(2)) + '%');
      dom.append(tmp);
      sum.bond += row.bond;
      
      var tmp = jQuery('<div class="cell_6" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.motivation);
      tmp.data('sum-t',String(row.motivation) + '%');
      tmp.data('avg',(row.motivation/row.count).round(2));
      tmp.data('avg-t','&Oslash; ' + String((row.motivation/row.count).round(2)) + '%');
      dom.append(tmp);
      sum.motivation += row.motivation;
      
      var tmp = jQuery('<div class="cell_7" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.injury);
      tmp.data('sum-t',String(row.injury));
      tmp.data('avg',(row.injury/row.count).round(2));
      tmp.data('avg-t','&Oslash; ' + String((row.injury/row.count).round(2)));
      dom.append(tmp);
      sum.injury += row.injury;
      
      var tmp = jQuery('<div class="cell_8" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.killed);
      tmp.data('sum-t',String(row.killed));
      tmp.data('avg',(((row.killed/row.count)*100).round(2)));
      tmp.data('avg-t','&Oslash; ' + String(((row.killed/row.count)*100).round(2)) + '%');
      dom.append(tmp);
      sum.killed += row.killed;

      var tmp = jQuery('<div class="cell_9" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.products);
      tmp.data('sum-t',String(row.products));
      tmp.data('avg',((row.products/row.count)*100).round(2));
      tmp.data('avg-t','&Oslash; ' + String(((row.products/row.count)*100).round(2)) + '%');
      dom.append(tmp);
      sum.products += row.products;
      
      var tmp = jQuery('<div class="cell_10" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.items);
      tmp.data('sum-t',String(row.items));
      tmp.data('avg',((row.items/row.count)*100).round(2));
      tmp.data('avg-t','&Oslash; ' + String(((row.items/row.count)*100).round(2)) + '%');
      dom.append(tmp);
      sum.items += row.items;
      
      var tmp = jQuery('<div class="cell_11" style="width:50px; text-align:center;cursor:pointer;" ></div>');
      tmp.data('sum',row.luck);
      tmp.data('sum-t','$' + String(row.luck));
      tmp.data('avg',(row.luck/row.count).round(2));
      tmp.data('avg-t','&Oslash; $' + String((row.luck/row.count).round(2)));
      dom.append(tmp);
      sum.luck += row.luck;
      
      this.gui.rows.push(dom);
      dom.click(function(){
        _self.detail(jQuery(this).children('.cell_0').html());
      });

      i++;
    };
    this.gui.bodyscroll = new TWDB.GameAPI.gui.scrollpane();
    jQuery(this.gui.bodyscroll.getMainDiv()).css('height','300px');
    table.find('.tbody').append(this.gui.bodyscroll.getMainDiv());
    this.gui.footer = table.find('.row_foot');

    
    var tmp = jQuery('<div class="cell_0" style="width:71px; text-align:center;" ></div>');
    tmp.data('sum',sum.jobs);
    tmp.data('sum-t',sum.jobs + ' #JOBS#');
    tmp.data('avg',sum.jobs);
    tmp.data('avg-t',sum.jobs + ' #JOBS#');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_0" style="width:20px; text-align:center;cursor:pointer;color:#444;" ></div>');
    tmp.mouseenter(function(){jQuery(this).css('color','#888')}).mouseleave(function(){jQuery(this).css('color','#444')});
    tmp.click(function(){_self.switchAvg();});
    tmp.data('sum','&sum;');
    tmp.data('sum-t','#SWITCH# &Oslash;');
    tmp.data('avg','&Oslash;');
    tmp.data('avg-t','#SWITCH# &sum;');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_1" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.count);
    tmp.data('sum-t',sum.count);
    tmp.data('avg',sum.count);
    tmp.data('avg-t',sum.count);
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_2" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',(sum.duration/3600).round(2));
    tmp.data('sum-t',String((sum.duration/3600).round(2)) + '#HOURS#');
    tmp.data('avg',(sum.duration/(3600*sum.count)).round(2));
    tmp.data('avg-t','&Oslash; ' + String((sum.duration/(3600*sum.count)).round(2)) + '#HOURS#');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_3" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.experience);
    tmp.data('sum-t',String(sum.experience));
    tmp.data('avg',(sum.experience/sum.count).round(2));
    tmp.data('avg-t','&Oslash; ' + String((sum.experience/sum.count).round(2)));
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_4" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.wage);
    tmp.data('sum-t','$'+String(sum.wage));
    tmp.data('avg',(sum.wage/sum.count).round(2));
    tmp.data('avg-t','&Oslash; $' + String((sum.wage/sum.count).round(2)));
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_5" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.bond);
    tmp.data('sum-t',String(sum.bond));
    tmp.data('avg',(((sum.bond/sum.count)*100).round(2)));
    tmp.data('avg-t','&Oslash; ' + String(((sum.bond/sum.count)*100).round(2)) + '%');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_6" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.motivation);
    tmp.data('sum-t',String(sum.motivation) + '%');
    tmp.data('avg',(sum.motivation/sum.count).round(2));
    tmp.data('avg-t','&Oslash; ' + String((sum.motivation/sum.count).round(2)) + '%');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_7" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.injury);
    tmp.data('sum-t',String(sum.injury));
    tmp.data('avg',(sum.injury/sum.count).round(2));
    tmp.data('avg-t','&Oslash; ' + String((sum.injury/sum.count).round(2)));
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_8" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.killed);
    tmp.data('sum-t',String(sum.killed));
    tmp.data('avg',(((sum.killed/sum.count)*100).round(2)));
    tmp.data('avg-t','&Oslash; ' + String(((sum.killed/sum.count)*100).round(2)) + '%');
    this.gui.footer.append(tmp);

    var tmp = jQuery('<div class="cell_9" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.products);
    tmp.data('sum-t',String(sum.products));
    tmp.data('avg',((sum.products/sum.count)*100).round(2));
    tmp.data('avg-t','&Oslash; ' + String(((sum.products/sum.count)*100).round(2)) + '%');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_10" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.items);
    tmp.data('sum-t',String(sum.items));
    tmp.data('avg',((sum.items/sum.count)*100).round(2));
    tmp.data('avg-t','&Oslash; ' + String(((sum.items/sum.count)*100).round(2)) + '%');
    this.gui.footer.append(tmp);
    
    var tmp = jQuery('<div class="cell_11" style="width:50px; text-align:center;" ></div>');
    tmp.data('sum',sum.luck);
    tmp.data('sum-t','$' + String(sum.luck));
    tmp.data('avg',(sum.luck/sum.count).round(2));
    tmp.data('avg-t','&Oslash; $' + String((sum.luck/sum.count).round(2)));
    this.gui.footer.append(tmp);
    
    var div = jQuery('<div style="margin: 0px 6px 0px 6px;width:680px;" />').append(table); 
    
    return div;
  },
  switchAvg: function() {
    var _self = this;
    switch (_self.sorting.avg) {
      case 'avg' : _self.sorting.avg = 'sum'; break;
      case 'sum' : _self.sorting.avg = 'avg'; break;
    }
    jQuery(_self.gui.window).find('div.row div').each(function(index) {
      var data = jQuery(this).data(String(_self.sorting.avg));
      var title = jQuery(this).data(String(_self.sorting.avg)+'-t');
      jQuery(this).html(data).attr('title',title);
    });
  },
	sort: function(col){
    if ( typeof(col) != 'undefined' ) {
      if ( this.sorting.type == col ) {
        this.sorting.ord *= -1;
      } else {
        this.sorting.ord = 1;
        this.sorting.type = col;
      };
    } else {
      var col = this.sorting.type;
    };
		var order = this.sorting.ord;
    var sorting = function (x,y) {
      var d1 = jQuery(x).find('.cell_'+col).html();
      var d2 = jQuery(y).find('.cell_'+col).html()
      if ( Number(d1) == d1 ) {
				return d1 * 1 > d2 * 1 ? order : -order;
      }
      else {
        return d1 > d2 ? order : -order;
      };
    }; 
		this.gui.rows.sort(sorting);
		for ( var i = 0 ; i<this.gui.rows.length ; i++ ) {
			this.gui.bodyscroll.appendContent(this.gui.rows[i])
		};
	},
	detail: function (job) {
    return;
		try {
			var data = this.statistic.job[job];
			var count1 = 0;
			var count2 = 0;
			var luck = 0;
			for ( var key in data.products) {
				count1 += data.products[key].count;
				var itemData = ItemManager.get(key);
				luck += itemData.price*data.products[key].count;
			};
			for ( var key in data.items) {
				count2 += data.items[key];
				var itemData = ItemManager.get(key);
				luck += itemData.price;
			};
			
			var bodyscroll = new TWDB.GameAPI.gui.scrollpane();
			jQuery(bodyscroll.getMainDiv()).css('height','370px');
			
			var table = jQuery('<div class="fancytable" style="margin: 0px 5px 0px 5px;width:680px;" ><div class="_bg tw2gui_bg_tl"></div><div class="_bg tw2gui_bg_tr"></div><div class="_bg tw2gui_bg_bl"></div><div class="_bg tw2gui_bg_br"></div><div class="trows"><div class="thead statics"><div class="row_head">'
				+ '<div class="cell_0" style="width:15px; text-align:center;"><span style="cursor:pointer, margin-bottom:3px;">&nbsp;</span></div>'
				+ '<div class="cell_1" style="width:70px; text-align:center;"><span title="#DURATION#"><img src="'+TWDB.images.iconClock+'" /></span></div>'
				+ '<div class="cell_2" style="width:70px; text-align:center;"><span title="#EXPERIENCE#"><img src="'+TWDB.images.iconExperience+'" /></span></div>'
				+ '<div class="cell_3" style="width:70px; text-align:center;"><span title="#WAGE#"><img src="'+TWDB.images.iconDollar+'" /></span></div>'
				+ '<div class="cell_4" style="width:70px; text-align:center;"><span title="#BOND#"><img src="'+TWDB.images.iconUpb+'" /></span></div>'
				+ '<div class="cell_5" style="width:70px; text-align:center;"><span title="#MOTIVATION#"><img src="'+TWDB.images.iconMoti+'" /></span></div>'
				+ '<div class="cell_6" style="width:70px; text-align:center;"><span title="#PRODUCTS#"><img src="'+TWDB.images.iconYield+'" /></span></div>'
				+ '<div class="cell_7" style="width:70px; text-align:center;"><span title="#ITEM#"><img src="'+TWDB.images.iconItem+'" /></span></div>'
				+ '<div class="cell_8" style="width:70px; text-align:center;"><span title="#LUCK#"><img src="'+TWDB.images.iconLuck+'" /></span></div>'
				+ '</div></div><div class="tbody" style="min-height:50px;background: url(' + Game.cdnURL + '/images/tw2gui/table/table_row.png) repeat scroll center bottom transparent;">'
				+ '<div class="row row_0">'
				+ '<div class="cell_0" style="width:20px; text-align:center;"><span style="text-size:14px;text-weigth:bold;">&sum;</span></div>'
				+ '<div class="cell_1" style="width:70px; text-align:center;"><span title="' + (Math.round(data.duration/36))/100 + '">' + (Math.round(data.duration/36))/100 + '</span></div>'
				+ '<div class="cell_2" style="width:70px; text-align:center;"><span title="' + data.experience + '">' + data.experience + '</span></div>'
				+ '<div class="cell_3" style="width:70px; text-align:center;"><span title="' + data.wage + '">' + data.wage + '</span></div>'
				+ '<div class="cell_4" style="width:70px; text-align:center;"><span title="' + data.bond + '">' + data.bond + '</span></div>'
				+ '<div class="cell_5" style="width:70px; text-align:center;"><span title="' + data.motivation + '">' + data.motivation + '</span></div>'
				+ '<div class="cell_6" style="width:70px; text-align:center;"><span title="' + count1 + '">' + count1 + '</span></div>'
				+ '<div class="cell_7" style="width:70px; text-align:center;"><span title="' + count2 + '">' + count2 + '</span></div>'
				+ '<div class="cell_8" style="width:70px; text-align:center;"><span title="' + luck + '">' + luck + '</span></div>'
				+ '</div>'
				+ '<div class="row row_1">'
				+ '<div class="cell_0" style="width:20px; text-align:center;"><span style="text-size:14px;text-weigth:bold;">&Oslash;</span></div>'
				+ '<div class="cell_1" style="width:70px; text-align:center;"><span title="' + (Math.round(data.duration/(36*data.reports)))/100 + '">' + (Math.round(data.duration/(36*data.reports)))/100 + '</span></div>'
				+ '<div class="cell_2" style="width:70px; text-align:center;"><span title="' + (Math.round(data.experience*100/data.reports))/100 + '">' + (Math.round(data.experience*100/data.reports))/100 + '</span></div>'
				+ '<div class="cell_3" style="width:70px; text-align:center;"><span title="' + (Math.round(data.wage*100/data.reports))/100 + '">' + (Math.round(data.wage*100/data.reports))/100 + '</span></div>'
				+ '<div class="cell_4" style="width:70px; text-align:center;"><span title="' + (Math.round(data.bond*TWDB.Time.getBase()/data.duration*100000))/1000 + '">' + (Math.round(data.bond*TWDB.Time.getBase()/data.duration*100000))/1000 + '%</span></div>'
				+ '<div class="cell_5" style="width:70px; text-align:center;"><span title="' + (Math.round(data.motivation*100/data.reports))/100 + '">' + (Math.round(data.motivation*100/data.reports))/100 + '</span></div>'
				+ '<div class="cell_6" style="width:70px; text-align:center;"><span title="' + (Math.round(count1*TWDB.Time.getBase()/data.duration*10000))/100 + '">' + (Math.round(count1*TWDB.Time.getBase()/data.duration*10000))/100 + '%</span></div>'
				+ '<div class="cell_7" style="width:70px; text-align:center;"><span title="' + (Math.round(count2*TWDB.Time.getBase()/data.duration*10000))/100 + '">' + (Math.round(count2*TWDB.Time.getBase()/data.duration*10000))/100 + '%</span></div>'
				+ '<div class="cell_8" style="width:70px; text-align:center;"><span title="' + (Math.round(luck*100/data.reports))/100 + '">' + (Math.round(luck*100/data.reports))/100 + '</span></div>'
				+ '</div>'
				+ '</div></div></div>');
			
			bodyscroll.appendContent(table);
			bodyscroll.appendContent('<div style="margin:5px 0px 5px 0px;width:710px;height:10px;display:block;background: url(' + Game.cdnURL + '/images/window/dailyactivity/wood_devider_horiz.png) repeat-x scroll 0 0 transparent;" />');
			
			for ( var id in data.products ) {
				var item = (new InventoryItem(ItemManager.get(id))).getMainDiv().clone(true);
				jQuery(item).children('div').remove();
				jQuery(item).css('cursor','normal');
				bodyscroll.appendContent(jQuery('<div style="display:block;height:65px;margin: 0px 5px 0px 10px;" />').append(item).append('<div style="display:inline-block;margin:5px;">' + data.products[id].count + '</div><br /><div style="display:inline-block;margin:5px;">' + (Math.round(data.products[id].count*TWDB.Time.getBase()/data.duration*10000))/100 + '%</div>'));
				bodyscroll.appendContent(this.diagram(data.products[id]));
				bodyscroll.appendContent('<div style="margin:5px 0px 5px 0px;width:710px;height:10px;display:block;background: url(' + Game.cdnURL + '/images/window/dailyactivity/wood_devider_horiz.png) repeat-x scroll 0 0 transparent;" />');
			};
			var div = jQuery('<div style="display:block;margin: 0px 5px 0px 10px;"/>');
			for ( var id in data.items ) {
				var item = new InventoryItem(ItemManager.get(id));
				item.setCount(data.items[id]);
				item = item.getMainDiv().clone(true);
				jQuery(item).children('div').remove();
				jQuery(item).css('cursor','normal');
				div.append(jQuery('<div style="display:inline-block;margin: 2px; height:62px;width:62px;" />').append(item));
			};
			bodyscroll.appendContent(div);
			var win = GameAPI.wman.open(job, null, "noreload").setMiniTitle(job).setTitle(job).appendToContentPane(bodyscroll.getMainDiv());
		} catch(e) {
			TWDB.Error.report(e,'Report Detail');
		};
	},	
	diagram: function (data) {
		try {
			var stats = data.attempts;
			var max1 = 0;
			var max2 = 0;
			for ( var key in stats ) {
				if ( stats[key] > max1 ) {
					max1 = stats[key];
				};
				if ( Number(key) > max2) {
					max2 = Number(key);
				};
			};
			var w = Math.round(660/max2);
			if ( w > 10 ) {
				w = 10;
			} else if ( w < 1 ) {
				w = 1;
			};
			var m = Math.floor(w/4);
			var diagram = jQuery('<div style="position:absolute;top:0;bottom:10;left:0;right:0;padding:0px 0px 10px 10px;" />');
			var label = jQuery('<div style="position:relative;top:-9px;display:block;height:20px;"><div style="display:inline-block;width:' + (w*5+10) + 'px;">&nbsp;</div></div>');
			for ( var i = 1; i <= max2 ; i++ ) {
				if ( typeof(stats[i]) == 'undefined' ) {
					diagram.append('<div style="display:inline-block;height:180px;width:' + (w-m) + 'px;margin:9px 0px 0px ' + m + 'px;" />');
				} else {
					var h = (stats[i]/max1)*180;
					h = h < 5 ? 5 : h;
					var bar = jQuery('<div style="display:inline-block;height:' + h + 'px;width:' + (w-m) + 'px;margin:9px 0px 0px  ' + m + 'px;bottom:0px;background: url(' + Game.cdnURL + '/images/tw2gui/window2_scrollbar_vertical.png) repeat-y scroll -48px 0 transparent;" title="' + stats[i] + 'x ' + i + ' #ATTEMPTS#"/>');
					bar.hover(function(){jQuery(this).css('opacity','0.5');},function(){jQuery(this).css('opacity','1');});
					diagram.append(bar);
				};
				if ( !((i-1)%10) ) {
					label.append('<div style="display:inline-block;width:' + (w*10) + 'px;text-align:center;font-size:10px;">' + (i+9) + '</div>');
				};
			};
			var div = jQuery('<div style="position:relative;width:100%;height:200px;display:block;" >'
				+ '<div style="position:absolute;top:0;bottom:0;left:0;width:58px;background-image: url(' + Game.cdnURL + '/images/tw2gui/table/table_border.png?3);background-position: left bottom;" />'
				+ '<div style="position:absolute;height:7px;bottom:4px;left:58px;right:0;background: url(' + TWDB.images.tableBorder + ');" />'
				+ '</div>');
			div.append(diagram);
			return (jQuery('<div style="margin: 0px 5px 0px 5px;width:' + ((Math.ceil(max2/10/1) * (10*w) ) + (5*w) + 10) + 'px;height:220px;display:block;"/>').append(div).append(label));
		} catch(e) {
			TWDB.Error.report(e,'Analyser diagram');
		};
	},
	itemReport: function(slots){
		var stats = this.statistic.jobs._finds.detailed;
		var quotient = 100/slots;
		var total1 = {};
		var total2 = {};
		var _attempts = 0;
		var _finds = 0;
		
		var head = '<div class="cell_0" style="width:95px; text-align:center;sfont-size:12px;"></div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="#OVERALL#">#OVERALL#</div>';
		for ( var i=0; i<slots; i++ ) {
			head += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="#MOTIVATION# >= ' + Math.round(100-((i+1) * quotient)) + '%">' +  Math.round(100-((i+1) * quotient)) + '%</div>';
		};
	
	
		var list = [];
		for ( var time in stats ) {
			list.push(parseInt(time));
		};
		list.sort(function(a,b){return b-a});
	
		var bodyscroll = new TWDB.GameAPI.gui.scrollpane();
		jQuery(bodyscroll.getMainDiv()).css('height','300px');
		var r = 0;
		for ( var j = 0; j<list.length; j++ ) {
			var time = list[j];
			var timeset = stats[time];
			var cells1 = {};
			var cells2 = {};
			var attempts = 0;
			var finds = 0;
			for ( var moti in timeset ) {
				var slot = Math.ceil((100-moti)/quotient)-1;
				slot = slot < 0 ? 0 : slot;
				if ( typeof(cells1[slot]) == 'undefined'){
					cells1[slot] = 0;
					cells2[slot] = 0;
				};
				if ( typeof(total1[slot]) == 'undefined'){
					total1[slot] = 0;
					total2[slot] = 0;
				};
				cells1[slot] += timeset[moti].finds;
				cells2[slot] += timeset[moti].count;
				total1[slot] += timeset[moti].finds;
				total2[slot] += timeset[moti].count;
				finds += timeset[moti].finds;
				attempts += timeset[moti].count;
				_finds += timeset[moti].finds;
				_attempts += timeset[moti].count;
			};
			var body1 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#FINDINGS#" >#FINDINGS#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + finds + '">' + finds + '</div>';
			var body2 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#ATTEMPTS#" >#ATTEMPTS#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + attempts + '">' + attempts + '</div>';
			var body3 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#RATE#" >#RATE#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + Math.round((finds/attempts)*10000)/100 + '%">' + Math.round((finds/attempts)*10000)/100 + '%</div>';;
			for ( var i=0 ; i<slots ; i++ ) {
				if( typeof(cells2[i]) != 'undefined' ) {
					body1 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + cells1[i] + '">' +  cells1[i] + '</div>';
					body2 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + cells2[i] + '">' +  cells2[i] + '</div>';
					body3 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + Math.round((cells1[i]/cells2[i])*10000)/100 + '%">' +  Math.round((cells1[i]/cells2[i])*10000)/100 + '%</div>';
				} else {
					body1 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
					body2 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
					body3 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
				};
			};
			bodyscroll.appendContent('<div class="row row_' + (r) + '"><div class="cell_0" style="width:595px; text-align:center;font-size:12px;" title="' + TWDB.Time.time2str(time) + '">' + TWDB.Time.time2str(time) + '</div></div><div class="row row_' + (r+1) + '">' + body1 + '</div><div class="row row_' + (r+2) + '">' + body2 + '</div><div class="row row_' + (r+3) + '">' + body3 + '</div>');
			r +=4;
		};
	
		var body1 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#FINDINGS#" >#FINDINGS#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + _finds + '">' + _finds + '</div>';
		var body2 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#ATTEMPTS#" >#ATTEMPTS#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + _attempts + '">' + _attempts + '</div>';
		var body3 = '<div class="cell_0" style="width:95px; text-align:center;font-size:12px;" title="#RATE#" >#RATE#</div><div class="cell_1" style="width:50px; text-align:center;font-size:12px;" title="' + Math.round((_finds/_attempts)*10000)/100 + '%">' + Math.round((_finds/_attempts)*10000)/100 + '%</div>';;
		for ( var i=0 ; i<slots ; i++ ) {
			if( typeof(total2[i]) != 'undefined' ) {
				body1 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + total1[i] + '">' +  total1[i] + '</div>';
				body2 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + total2[i] + '">' +  total2[i] + '</div>';
				body3 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="' + Math.round((total1[i]/total2[i])*10000)/100 + '%">' +  Math.round((total1[i]/total2[i])*10000)/100 + '%</div>';
			} else {
				body1 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
				body2 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
				body3 += '<div class="cell_' + (i+2) + '" style="width:50px; text-align:center;font-size:12px;" title="">0</div>';
			};
		};
		bodyscroll.appendContent('<div class="row row_' + (r) + '"><div class="cell_0" style="width:595px; text-align:center;font-size:12px;" title="#OVERALL#">#OVERALL#</div></div><div class="row row_' + (r+1) + '">' + body1 + '</div><div class="row row_' + (r+2) + '">' + body2 + '</div><div class="row row_' + (r+3) + '">' + body3 + '</div>');
	
		var table = jQuery('<div class="fancytable"><div class="_bg tw2gui_bg_tl"></div><div class="_bg tw2gui_bg_tr"></div><div class="_bg tw2gui_bg_bl"></div><div class="_bg tw2gui_bg_br"></div><div class="trows"><div class="thead statics"><div class="row_head">' + head + '</div></div><div class="tbody"></div><div class="tfoot statics"></div></div></div>');
		table.find('.tbody').append(bodyscroll.getMainDiv());
	
		var div = jQuery('<div style="margin: 0px 6px 0px 6px;width:680px;" />').append(table);
	
		var guiWindow = GameAPI.wman.open('twdb_itemreport', null,'noreload').setMiniTitle("TWDB Item-Report").setTitle('tw-db.info Item-Report');
		guiWindow.appendToContentPane(div);
	},
});
*/



TWDB.ClothCalc = new Object({
	uid: "twdb_clothcalc",
	_type2id:{'animal':1,'body':2,'foot':3,'head':4,'left_arm':5,'neck':6,'right_arm':7,'yield':8,'pants':9,'belt':10},
	_id2type:{1:'animal',2:'body',3:'foot',4:'head',5:'left_arm',6:'neck',7:'right_arm',8:'yield',9:'pants',10:'belt'},
	_skill2id:{'strength':1,'flexibility':2,'dexterity':3,'charisma':4,'build':5,'punch':6,'tough':7,'endurance':8,'health':9,'ride':10,'reflex':11,'dodge':12,'hide':13,'swim':14,'aim':15,'shot':16,'pitfall':17,'finger_dexterity':18,'repair':19,'leadership':20,'tactic':21,'trade':22,'animal':23,'appearance':24},
	_id2skill:{1:'strength',2:'flexibility',3:'dexterity',4:'charisma',5:'build',6:'punch',7:'tough',8:'endurance',9:'health',10:'ride',11:'reflex',12:'dodge',13:'hide',14:'swim',15:'aim',16:'shot',17:'pitfall',18:'finger_dexterity',19:'repair',20:'leadership',21:'tactic',22:'trade',23:'animal',24:'appearance'},
	_class2id:{'greenhorn':1,'adventurer':2,'duelist':3,'worker':4,'soldier':5},
	ready: false,
	data:{'skills':{},'items':{},'jobs':{},'custom':{}},
	calcdata:{'skills':{},'items':{},'jobs':{},'custom':{},'animals':[],'buyTip':{},'jobBoni':{},'used':{},'loaded':false},
	loaded: false,
	up2date: true,
	gui: {'job':{},'custom':{}},
// initialise ClothCalc  
	init: function () {
		if ( this.ready ) {
			return;
		};
		var _self = this;
		this.jobs.setParent(this);
		this.joblist.parent = this;
		this.customs.setParent(this);
		this.bag.setParent(this);
    
    //TWDB.Eventer.set('TWDBdataLoaded', function(){_self.handleTWDBData();});

		//define gui general  
			this.gui.copyright = jQuery('<div style="position:absolute;bottom:0px;left:0px;height:15px;display:block;font-size:10px;color:#000000;">.:powered by tw-db team:.&nbsp;|&nbsp;<a href="http://tw-db.info" style="font-weight:normal;color:#000000;" target="_blank">.:tw-db.info:.</a>&nbsp;|&nbsp;' + ( TWDB.script.version/100/1 + ' rev. ' + TWDB.script.revision) + '</div>');
			this.gui.cache = jQuery('<div style="position:absolute;top:10px;right:8px;width:20px;height:20px;cursor:pointer;" />');
			this.gui.bag = jQuery('<div style="position:absolute;top:95px;left:1px;width:252px;height:186px;" />');
		
		//load Bag if not already loaded and set initBag 
			if(!Bag.loaded) {
				Bag.loadItems();
			};
			this.BagInt=window.setInterval(function(){_self.finishInit();},100);
      
		//get custom jobs or define default value  
			this.data.custom = TWDB.Settings.get('custom',{1:{id:1,type:"speed",para:{},name:"Speed"},2:{id:2,type:"custom",para:{9:1},name:"max Health"},3:{id:3,type:"regen",para:{},name:"Health Regeneration"},4:{id:4,type:"fort",para:{att:200,def:20,health:100,type:0},name:"Fortbattle Attacker (Att)"},5:{id:5,type:"fort",para:{att:20,def:200,health:100,type:0},name:"Fortbattle Attacker (Def)"},6:{id:6,type:"fort",para:{att:200,def:20,health:100,type:1},name:"Fortbattle Defender (Att)"},7:{id:7,type:"fort",para:{att:20,def:200,health:100,type:1},name:"Fortbattle Defender (Def)"},8:{id:8,type:"duel",para:{12:1,15:1,16:1,24:1},name:"Range Dueler (Att)"},9:{id:9,type:"duel",para:{12:1,15:1,16:1,21:1},name:"Range Dueler (Def)"},10:{id:10,type:"duel",para:{6:1,7:1,11:1,15:1},name:"Melee Dueler"}});
			
		// load cache if version didn't not changed  
			if ( !TWDB.Updater.wasUpdated() ) {
				//load calcdata from cache 
					var data = TWDB.Cache.load('calcdata');
					if ( typeof(data) == 'object' && data != null && isDefined(data.loaded) ) {
						this.calcdata = data;
					};
			};
	},
// finish init process if Bag is loaded  
	finishInit: function() {
		if(typeof(this.BagInt ) == 'undefined' ) {
			return;	
		};
		if(Bag.loaded) {
			window.clearInterval(this.BagInt);
			delete(this.BagInt);
			this.loaded = true;
			this.ready = true;
			this.addButton();
		};
	},	
// add Button  
	addButton: function() {
    if ( this.ready === false ) {
      return;
    }
    var _self=this;
    var div = jQuery('<div title="tw-db.info ClothCalc " class="menulink" />').css('background-image','url('+TWDB.images.button+')').css('background-position','0px -25px').mouseenter(function(){jQuery(this).css('background-position','-25px -25px');}).mouseleave(function(){jQuery(this).css('background-position','0px -25px');}).click(function(){_self.open();});
    jQuery('#ui_menubar').append(jQuery('<div class="ui_menucontainer" />').append(div).append('<div class="menucontainer_bottom" />'));
	},
// check if skill has changed  
	checkSkill: function () {
		for ( var key in this.data.skills ) {
			if ( typeof(this.calcdata.skills[key]) == 'undefined' ) {
				return true;
			};
			if ( this.data.skills[key].val != this.calcdata.skills[key].val ) {
				return true;
			};
		};
		return false;
	},
// check if inventory has changed  
	checkItems: function () {
		for ( var key in this.data.items ) {
			if ( typeof(this.calcdata.items[key]) == 'undefined' ) {
				return true;
			};
		};	
		for ( var key in this.calcdata.items ) {
			if ( typeof(this.data.items[key]) == 'undefined' ) {
				return true;
			};
		};
		return false;
	},
// check if inventory has changed  
	checkCustom: function () {
		var key = 0
		for ( var key in this.data.custom ) {
			if ( typeof(this.calcdata.custom[key]) == 'undefined' ) {
				return true;	
			};
			if ( this.calcdata.custom[key].name != this.data.custom[key].name) {
				return true;
			};
			for ( var ref in this.data.custom[key].para ) {
				if ( typeof(this.calcdata.custom[key].para[ref]) == 'undefined' ) {
					return true;
				};
				if ( this.calcdata.custom[key].para[ref] != this.data.custom[key].para[ref] ) {
					return true;
				};
			}
		};	
		if ( typeof(this.calcdata.custom[(Number(key)+1)]) != 'undefined' ) {
			return true;	
		};
		return false;
	},
// check if cached data is up2date  
	checkCache: function () {
		var items = this.checkItems();
		var skill = this.checkSkill();
		var custom = this.checkCustom();
		this.gui.cache.children().remove();
		if(items||skill||custom) {
			var title = '#DATA_OLD#';
			if(items) {
				title+=' [#INVENTORY#]';
			};		
			if(skill) {
				title+=' [#SKILL#]';
			};
			if(custom) {
				title+=' [#CUSTOM#]';
			};
			var Data= jQuery('<div title="'+title+'" style="position:absolute;top:0px;right:0px;width:20px;height:20px;background: url('+TWDB.images.iconData+')no-repeat 0px 0px;" />');
			this.up2date=false;
		} else {
			var Data = jQuery('<div title="#DATA_OK#" style="position:absolute;top:0px;right:0px;width:20px;height:20px;background: url('+TWDB.images.iconData+')no-repeat -20px 0px;" /></div>');
			this.up2date=true;
		};
		this.gui.cache.append(Data);
		var _self = this;
		Data.click(function(){TWDB.DataManager.loadData(true);});
	},	
// open ClothCalc Window  	
	open: function ( _id , _type ) {
		var _self = this;
		if(this.ready == false) {
			return;
		};
		if( TWDB.GameAPI.wman.getById(this.uid) ) {
      if ( isDefined(_id) && isDefined(_type) ) {
        switch ( _type ) {
          case 'job' : 
            var tmp = TWDB.Jobs.getJobById(_id); 
            if(isDefined(tmp) ) {
              var tmp = tmp.name;
            }
            else {
              var tmp = '';
            };
          break;
          case 'item' : var tmp = _id; break;
          case 'default' : var tmp = null; break;
        };
        if ( isDefined(tmp) ) {
          _self.joblist.open(tmp);
        };     
      }
			return;
		};
		if(typeof(this.eventOpen)!='undefined')	{
			TWDB.Eventer.remove('getGameData',this.eventOpen);
		};
		var count = 0;
		for ( var key in this.calcdata.jobs ) {
			count++;
			break;
		};
		if(count == 0){
			this.eventOpen = TWDB.Eventer.set('getGameData',function(){TWDB.DataManager.loadData(true);},1);
			this.up2date = false;
			this.getGameData();
		} else {
			this.eventOpen = TWDB.Eventer.set('getGameData',function(){_self.finishOpening();},1);
			this.getGameData();
		};
		
		var state = TWDB.GameAPI.wman.getById(Inventory.uid);
		Wear.open();
		var inventory = TWDB.GameAPI.wman.getById(Inventory.uid);
		if ( typeof(state) == 'undefined' && typeof(inventory) != 'undefined' ) {
			inventory.fireEvent(TWE('WINDOW_CLOSE'),inventory); 
		};


		//define gui job  
			this.jobs.selected = 0;
			this.gui.job.sort = jQuery('<div style="position:absolute;top:10px;left:0px;height:20px;" />')
        .append('<img src="'+TWDB.images.iconName+'" title=" #ORDER_NAME# " alt=" #ORDER_NAME# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'name\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        .append('<img src="'+TWDB.images.iconExperience+'" title=" #ORDER_EXP# " alt=" #ORDER_EXP# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'experience\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        .append('<img src="'+TWDB.images.iconDollar+'" title=" #ORDER_WAGES# " alt=" #ORDER_WAGES# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'wages\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        .append('<img src="'+TWDB.images.iconLuck+'" title=" #ORDER_LUCK# " alt=" #ORDER_LUCK# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'luck1\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        //.append('<img src="'+TWDB.images.iconDanger+'" title=" #ORDER_DANGER# " alt=" #ORDER_DANGER# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'danger\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        .append('<img src="'+TWDB.images.iconLaborpoints+'" title=" #ORDER_LP# " alt=" #ORDER_LP# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'laborpoints\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        //.append('<img src="'+TWDB.images.iconClock+'" title=" #ORDER_DURATION# " alt=" #ORDER_DURATION# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'duration\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />')
        .append('<img src="'+TWDB.images.iconMoti+'" title=" #ORDER_MOTIVATION# " alt=" #ORDER_MOTIVATION# " onclick="javascript:TWDB.ClothCalc.joblist.order(\'motivation\')" style="margin:0px 2px 0px 2px;cursor:pointer;" />');

      this.gui.job.title = jQuery('<div style="position:absolute;top:36px;left:0px;width:190px;height:19px;font-weight:bold;text-align:center;">#SELECTJOB# >></div>');
			this.gui.job.mode = jQuery('<div style="position:absolute;top:10px;right:30px;width:20px;height:20px;background:url(\''+TWDB.images.jobTime+'\') no-repeat scroll 0 0 transparent;cursor:pointer;display:block;" title=" #JOB_TIME# " />');
			this.gui.job.search = jQuery('<div style="position:absolute;top:35px;right:50px;width:20px;height:20px;background:url(\''+TWDB.images.iconSearch+'\') no-repeat scroll 0 0 transparent;cursor:pointer;display:none;" title=" #SEARCHJOB# " />');
			this.gui.job.checkbox = new TWDB.GameAPI.gui.checkbox('', (this.joblist.all?'':'tw2gui_checkbox_checked'), function () { if (this.isSelected()) { _self.joblist.all = false; _self.joblist.update(); } else { _self.joblist.all = true; _self.joblist.update(); };});
			this.gui.job.checkbox.setTooltip('#HIDEJOBS#');
			(this.gui.job.checkbox.getMainDiv()).css('position','absolute').css('top','35px').css('right','30px');
			this.gui.job.button = jQuery('<div style="position:absolute;top:35px;right:4px;width:26px;height:20px;background:url(\'/images/window/character/title_editbtn.jpg\') no-repeat scroll 0 0 transparent;cursor:pointer;" title=" #SELECTJOB# " />');
			this.gui.job.skills = jQuery('<div style="position:absolute;top:60px;left:1px;width:252px;height:30px;display:block;" />');
			this.gui.job.mainDiv = jQuery('<div style="position:absolute;top:0px;left:0px;height:100%;width:100%;" />');
			this.gui.job.mainDiv.append(this.gui.job.sort);
			this.gui.job.mainDiv.append(this.gui.job.title);
			this.gui.job.mainDiv.append(this.gui.job.mode);
			this.gui.job.mainDiv.append(this.gui.job.search);
			this.gui.job.mainDiv.append(this.gui.job.checkbox.getMainDiv());
			this.gui.job.mainDiv.append(this.gui.job.button);
			this.gui.job.mainDiv.append(this.joblist.getMainDiv());
			this.gui.job.mainDiv.append(this.gui.job.skills);
			this.gui.job.button.click(function(){if(_self.joblist.getMainDiv().is(':visible')){_self.joblist.close();}else{_self.joblist.open();}}.bind(this));
			this.gui.job.search.click(function(){_self.jobSearch();}.bind(this));
			this.gui.job.searchDiv = jQuery('<div />');
		
      if ( _self.joblist.getMainDiv().is(':visible') ) {
        _self.joblist.close();
      }
      _self.joblist.name=null;
      if ( isDefined(_id) && isDefined(_type) ) {
        switch ( _type ) {
          case 'job' :
            var tmp = TWDB.Jobs.getJobById(_id); 
            if(isDefined(tmp) ) {
              var tmp = tmp.name;
            }
            else {
              var tmp = '';
            };
            break;
          case 'item' : var tmp = _id; break;
          case 'default' : var tmp = null; break;
        }
        if ( isDefined(tmp) ) {
          _self.joblist.name = tmp;
        }      
      }
    
		//define gui custom  
			this.customs.selected = 0;
			this.gui.custom.title = jQuery('<div style="position:absolute;top:36px;left:0px;width:210px;height:19px;font-weight:bold;text-align:center;">#SELECTJOB# >></div>');
			this.gui.custom.settings = jQuery('<div title="#SETTINGS#" style="position:absolute;top:35px;right:30px;width:20px;height:20px;background:url('+TWDB.images.iconSetting+');cursor:pointer;" />');
			this.gui.custom.settings.click(function(){_self.customs.showConfig();});
			this.gui.custom.button = jQuery('<div style="position:absolute;top:35px;right:4px;width:26px;height:20px;background:url(\'/images/window/character/title_editbtn.jpg\') no-repeat scroll 0 0 transparent;cursor:pointer;" title=" #SELECTJOB# " />');
			this.gui.custom.selectbox = new TWDB.GameAPI.gui.selectbox();
			this.gui.custom.selectbox.setWidth(300).addListener(function(key){_self.customs.switch(key);});
			this.gui.custom.skills = jQuery('<div style="position:absolute;top:60px;left:1px;width:252px;height:30px;display:block;" />');
			this.gui.custom.mainDiv = jQuery('<div style="position:absolute;top:0px;left:0px;height:100%;width:100%;" />').hide();;
			this.gui.custom.mainDiv.append(this.gui.custom.title);
			this.gui.custom.mainDiv.append(this.gui.custom.settings);
			this.gui.custom.mainDiv.append(this.gui.custom.button);
			this.gui.custom.mainDiv.append(this.gui.custom.skills);
			this.gui.custom.button.click(function(e){_self.gui.custom.selectbox.show(e);});

		//define general gui  
			this.gui.bag.children().remove();
			var tabclick = function (win, id) {_self.showTab(win,id);};
			this.gui.window = TWDB.GameAPI.wman.open(this.uid, null, 'noreload').setMiniTitle("TWDB Cloth Calc").setTitle('tw-db.info Cloth Calc').addTab('#JOB#', 'Jobs', tabclick).addTab('#CUSTOM#', 'Custom', tabclick).appendToContentPane(this.gui.job.mainDiv).appendToContentPane(this.gui.custom.mainDiv).appendToContentPane(this.gui.cache).appendToContentPane(this.gui.bag).appendToContentPane(this.gui.copyright);
			this.gui.window.showLoader();
			var save = $('<div title="#SAVE_POSITION#" style="width:20px;height:20px;position:absolute;left:0px;top:0px;background:url(\''+TWDB.images.iconSave+'\') no-repeat scroll 0px -20px transparent;cursor:pointer;display:block;" />')
        .hover(function(){$(this).css('background-position','0px 0px');} , function(){$(this).css('background-position','0px -20px');} )
        .click(function(){
          TWDB.Settings.set('clothPos','custom');
          var tmp = _self.gui.window.saveAppearance();
          TWDB.Settings.set('clothPosition',{x:tmp.x,y:tmp.y});
          new UserMessage( '#SAVE_SUCCESSFUL#', UserMessage.TYPE_SUCCESS).show();
        });
      $(this.gui.window.divMain).find('.tw2gui_window_buttons').append(save);
      $(this.gui.window.divMain).children(".tw2gui_window_tabbar").css("right","22px");

      var pos = this.gui.window.saveAppearance();
      switch ( TWDB.Settings.get('clothPos','left') ) {
        case 'right' : pos.x = Wear.window.divMain.offsetLeft + Wear.window.divMain.offsetWidth - 15;  break;
        case 'left' : pos.x = Wear.window.divMain.offsetLeft - 295; break;
        case 'custom' : var pos = TWDB.Settings.get('clothPosition',{x:0,y:0}); break;
      };
      
			this.gui.window.restoreAppearance({
				h: 410,
				w: 310,
				x: pos.x,
        y: pos.y,
			});
			return;
	},
// finish open of ClothCalc Window  	
	finishOpening: function () {
    this.jobs.mode(1);
    this.joblist.init(this);
    this.customs.createSelectbox();
		if(typeof(this.gui.window)!='undefined') {
			this.checkCache();
			delete(this.eventOpen);
			this.gui.window.hideLoader();
		};
	},
// switch Tab  	
	showTab: function(win,id){
		this.gui.window.activateTab(id);
		this.gui.window.showLoader();
		this.gui.bag.children().remove();
			switch (id) {
				case 'Jobs': 	
                this.gui.custom.mainDiv.hide();
								if(this.jobs.selected!=0) {
									this.jobs.switch(this.jobs.selected);
								};
								this.gui.job.mainDiv.show();
								break;
				case 'Custom':	
                this.gui.job.mainDiv.hide();
								if(this.customs.selected!=0) {
									this.customs.switch(this.customs.selected);
								};
								this.gui.custom.mainDiv.show();
								break;
			};
		this.gui.window.hideLoader();
	},
// get Data from Game (Character Skill, Inventory Items  
	getGameData: function (store) {
		var _self = this;
		if(typeof(store)=='undefined') {
			this.getState={'skill':false,'items':false,'jobs':false};
			TWDB.Eventer.set('getSkill',function(){_self.getGameData('skill');},1);
			TWDB.Eventer.set('getItems',function(){_self.getGameData('items');},1);
      TWDB.Eventer.set('getJobs',function(){_self.getGameData('jobs');},1);
      TWDB.DataManager.loadData();
			this.getSkill();
			this.getItems();
			this.getJobs();
		} else	{
			this.getState[store]=true;
			var state = true;
			for ( var key in this.getState) {
				if(!this.getState[key]) {
					state=false;
					break;
				};
			};
			if(state) {
				delete(this.getState);
				TWDB.Eventer.trigger('getGameData');
			};
		}
	},
// get Skill from Character
	getSkill: function (data) {
		if(typeof(data)=='undefined'){
			var _self=this;
			setTimeout(function(){_self.getSkill(CharacterSkills.skills);},10);
			return;
		} else {
			this.data.skills = {};
			for ( var key in data ) {
				var id = this._skill2id[key];
				this.data.skills[id]={'id':id,'val':data[key].points};
			};
			TWDB.Eventer.trigger('getSkill');
		};
	},
// get Inventory Items
	getItems: function (data) {
		if(typeof(data)=='undefined'){
			var _self=this;
			jQuery.post('game.php?window=inventory', {}, function(data){_self.getItems(data);} , 'json');
			return;
		} else {
			this.data.items = {};
			for ( var i = 0; i < data.wear.length; i++ ) {
				var object = ItemManager.get(data.wear[i]);
				if(!this.isItemUsable(object.item_id)) {
					continue;
				};
				this.data.items[object.item_id]={'id':object.item_id};
			};
			for ( var type in Bag.items ) {
				for ( var i in Bag.items[type] ) {
					var object = ItemManager.get(Number(i));
					if(!this.isItemUsable(object.item_id)) {
						continue;
					};
					this.data.items[object.item_id]={'id':object.item_id};
				};
			};
			TWDB.Eventer.trigger('getItems');
		};
	},
// get Jobs
	getJobs: function (data) {
		if(typeof(data)=='undefined'){
			var _self=this;
			jQuery.post('game.php?window=work&mode=index', {}, function(data){_self.getJobs(data);} , 'json');
			return;
		} else {
			this.data.jobs = data;
			TWDB.Eventer.trigger('getJobs');
		};
	}, 
// check if Item could be used through character and gives a bonus  
	isItemUsable: function (item_id , ignorelevel) {
		var object = ItemManager.get(item_id);
		if (typeof(object)=='undefined') {
			return false;
		};
		var bonus = false;
		if( !this.itemHasBonus(object) ) {
			return false;
		};
		if( object.characterClass !== null && object.characterClass !== Character.charClass ) {
			return false;
		};
		if( object.characterSex !== null && object.characterSex !== Character.charSex ) {
			return false;
		};
		if( object.level !== null && object.level > (Character.level + Character.itemLevelRequirementDecrease['all'] + (typeof(Character.itemLevelRequirementDecrease[object.type])!='undefined'?Character.itemLevelRequirementDecrease[object.type]:0)) ) {
			if ( isDefined(ignorelevel) && ignorelevel ) {
        return true;
      }
      else {
        return false;
      }
		};
		return true;
	},
// check if item has a bonus or is part of set or is weapon
	itemHasBonus: function (object) {
		if ( object.type == 'left_arm' || object.type == 'right_arm'  ) {
			return true;
		};
		if ( typeof(object.set) != 'undefined' && object.set != null ) {
			return true;
		};
		if ( typeof(object.speed) != 'undefined' && object.speed != null ) {
			return true;
		};
		if(typeof(object.bonus) == 'undefined' ) {
			return false;
		};
		if ( typeof(object.bonus.skills) != 'undefined' ) {
			for ( var key in object.bonus.skills ) {
				if (!(jQuery.isFunction(object.bonus.skills[key]))) {
					return true;
				};
			};
		};		
		if ( typeof(object.bonus.attributes) != 'undefined' ) {
			for ( var key in object.bonus.attributes ) {
				if (!(jQuery.isFunction(object.bonus.attributes[key]))) {
					return true;
				};
			};
		};
		if ( typeof(object.bonus.fortbattle) != 'undefined' ) {
			for ( var key in object.bonus.fortbattle ) {
				if ( object.bonus.fortbattle[key]>0 ) {
					return true;
				};
			};
		};	
		if ( typeof(object.bonus.fortbattlesector) != 'undefined' ) {
			for ( var key in object.bonus.fortbattlesector ) {
				if ( object.bonus.fortbattle[key]>0 ) {
					return true;
				};
			};
		};
		return false;
	},
// handle return Data from twdb.info  
	handleTWDBData: function () {
    var data  = TWDB.DataManager.getData('twdb');
    var _self = this;
    
		this.calcdata.items = jQuery.extend(true, {}, _self.data.items);
		this.calcdata.skills = jQuery.extend(true, {}, _self.data.skills);
		this.calcdata.time = data.time;
		this.calcdata.jobs = data.jobs;
		this.calcdata.custom = data.custom;
		this.calcdata.loaded = true;
    
		this.calcdata.used = {};
		try {
			this.jobs.init();
		} catch(e) {
    	TWDB.Error.report(e,'GENERICERROR#; handle Jobs');
		};		
		try {
			this.joblist.reset();
		} catch(e) {
    	TWDB.Error.report(e,'GENERICERROR#; handle Jobslist');
		};		
		try {
			this.customs.init();
		} catch(e) {
    	TWDB.Error.report(e,'GENERICERROR#; handle Customs');
		};		
		try {
			this.setUsedItems();
		} catch(e) {
    	TWDB.Error.report(e,'GENERICERROR#; setUsedItems');
		};		
		TWDB.Cache.save('calcdata',this.calcdata);
		this.finishOpening();
	},
// object that handles job section of clothcalc  	
	jobs: new Object({ 
		selected:0,
    base: 1,
    basetime: 1,
		'sort': {'list':[],'type':'name','order':1},
	// save pointer to parent   
		setParent: function (parent) {
			this.parent = parent;
		},
	// create calcdata list for jobs  
		init: function() {
			var Job2Id = [];
      var i = 0;
      var state = 0;
			while ( true ) {
        i++;
        var job = JobList.getJobById(i);
        if ( !job ) {
          state++;
          if ( state > 5 ) {
            break;
          };
          continue;
        }
        state = 0;
				Job2Id[job.shortname]=job.id;
			};
			for ( var jobid in this.parent.calcdata.jobs ) {
        var job = this.parent.calcdata.jobs[jobid];
				if ( typeof(Job2Id[job.short_name]) == 'undefined') {
					if ( job.short_name == 'construction' ) {
						job.name = '#CONSTRUCTION#';
            job.skills = {};
						job.gameid = 0;
						job.laborpoints.current = 0;
            job.duration = (7200)*Number(this.parent.data.jobs.workspeed);
            job.energy = 24;
					} else {
						job.name = '!!' . job.short_name;
            job.skills = {};
						job.gameid = 0;
						job.laborpoints.current = 0;
            job.duration = 0;
            job.energy = 0;
          };
					continue;
				};
        var tmp = JobList.getJobById(Job2Id[job.short_name]);
				job.name = tmp.name;
				job.skills = tmp.skills;
				job.gameid = tmp.id;
        job.difficulty = tmp.malus;
        job.duration = 0;
        job.energy = tmp.energy;
				job.laborpoints.current = 0;
			};
		},
	// 
    update: function () {
      if ( typeof(this.parent.calcdata.jobs[this.selected]) != 'undefined') {
        var job = this.calcJob(this.selected);
        var string = job.name.substring(0, 18) + ' [' + job.laborpoints.current + '/' + job.laborpoints.sum + ']';
        this.parent.gui.job.title.html(string);
      };
    },	
	// switch selected job  
		switch: function(jobid){
			if( typeof(this.parent.calcdata.jobs[jobid] ) == 'undefined' || typeof(this.parent.calcdata.jobs[jobid].cloth ) == 'undefined' ) {
				return;
			};
			var p = this.parent;
      var job = p.calcdata.jobs[jobid]
			if ( job.gameid != 0) {
        TWDB.Map.setMinimapJob(job.name)
				p.gui.job.search.show();
			} else {
				p.gui.job.search.hide();
			};
			this.selected = jobid;
			var string = job.name.substring(0, 18) + ' [' + job.laborpoints.current + '/' + job.laborpoints.sum + ']';
			p.gui.job.title.html(string);
			p.bag.showItems(job.cloth, 'jobs');
			
			p.gui.job.skills.children().remove();
      for ( var key in job.skills ) {
        for ( var i = 0 ; i < job.skills[key] ; i++ ) {
          var div = jQuery('<div style="float:left;widht;30px;height:30px;" />');
          p.gui.job.skills.append(div.append(p.getSkillImg(key,30)));
        };
      };
		},
  // set Mode for JobList
    mode: function(mode) {
      var _self = this;
      this.parent.gui.job.mode.unbind('click');
      switch (mode) {
        case 0 :    this.base = 0;
                          this.basetime = 15;
                          this.parent.gui.job.mode.css('background-position','0px 0px').click(function(){_self.mode(1);_self.parent.joblist.update();});
                          break;
        case 2 :     this.base = 2;
                          this.basetime = 3600;
                          this.parent.gui.job.mode.css('background-position','-40px 0px').click(function(){_self.mode(0);_self.parent.joblist.update();});
                          break;
        case 1 :         this.base = 1;
                          this.basetime = 1800;
                          this.parent.gui.job.mode.css('background-position','-20px 0px').click(function(){_self.mode(2);_self.parent.joblist.update();});
                          break;
      };
    },
     
    calcJob: function(jobid) {
      var premium = Number(Premium.hasBonus('money'));
      var job = this.parent.calcdata.jobs[jobid];
      job.laborpoints.skills = 0;
      for ( var key in job.skills ) {
        job.laborpoints.skills += Number(job.skills[key]) * Number(CharacterSkills.skills[key].points);
      };
      job.laborpoints.sum = job.laborpoints.cloth;
      job.laborpoints.sum += job.laborpoints.skills;
      job.laborpoints.sum -= (job.difficulty + 1);
       
      var tmp = JobList.getJobById(job.gameid);
      if ( tmp ) {
        job.laborpoints.current = tmp.calcJobPoints() - (tmp.malus + 1);
      } else {
        job.laborpoints.current = 0;
      }

       
      var lp = job.laborpoints.sum > 0 ? job.laborpoints.sum + 1 : 1;

      job.values = {};
      if (job.gameid!=0) {
        job.values.experience = this.parent.data.jobs.jobs[job.gameid].durations[this.base].xp;
        job.values.motivation = this.parent.data.jobs.jobs[job.gameid].motivation;
      } else {
        job.values.experience = 0;
        job.values.motivation = 0;
      }
      
      job.values.name = job.name;
      
      job.values.laborpoints = Number(job.laborpoints.sum);
      job.values.duration = Number(this.basetime);
      
      job.values.luck1 = Math.floor((((0.9 * job.luck + 5) * Math.pow(lp, 0.2))) * (5 + premium * 2.5));
      job.values.luck2 = Math.floor((((0.9 * job.luck + 5) * Math.pow(lp, 0.2))) * (15 + premium * 7.5));
      
      job.values.danger = Number(job.danger);
      
      job.values.wages = Math.round( job.wages * ( 1 + job.values.duration / 4000 * Math.pow(lp, 0.2) ) + job.values.duration / 720 * Math.pow(lp, 0.2) + 0.5)
      if ( premium ) {
        job.values.wages *= 1.5;
      }
      job.values.wages *= job.values.motivation;
      job.values.wages = job.values.wages;
      
      return job;
    },
    
    getJobPopup: function(jobid) {
      var data = this.parent.calcdata.jobs[jobid].values;
      data.laborpoints = this.parent.calcdata.jobs[jobid].laborpoints.sum;
      var div = '<table>'
          + '<tr><td colspan="4" style="font-weight:bold;text-align:center;font-size:11px;">'+this.parent.calcdata.jobs[jobid].name+'</td></tr>'
          + '<tr><td><img src="'+TWDB.images.iconExperience+'" title=" #EXPERIENCE# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.experience + '</td>'
          + '<td><img src="'+TWDB.images.iconDollar+'" title=" #WAGES# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.wages + '</td></tr>'
          + '<tr><td><img src="'+TWDB.images.iconLuck+'" title=" #LUCK# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.luck1 + '-' + data.luck2 + '</td>'
          + '<td><img src="'+TWDB.images.iconDanger+'" title=" #DANGER# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.danger + '</td></tr>'
          + '<tr><td><img src="'+TWDB.images.iconLaborpoints+'" title=" #LABORPOINTS# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.laborpoints + '</td>'
          + '<td><img src="'+TWDB.images.iconClock+'" title=" #DURATION# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.duration + '</td></tr>'
          + '<tr><td><img src="'+TWDB.images.iconMoti+'" title=" #MOTIVATION# "  height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + data.motivation*100 + '</td><td></td><td></td></tr>'
        + '</table>';
      return div;
    },    
    
  }),
// object that handles the job selection box  
  joblist: {
    ready: false,
    gui: {},
    elements : [],
    focused: 0,
    sort: {'type':'name','order':1},
    all: false,
    name: null,
    reset: function() {
      this.ready=false;
      delete(this.elements);
      this.elements = [];
      this.getMainDiv().children().remove();
      this.getMainDiv().append('<style type="text/css">.TWDB_hide{display:none;}.TWDB_filter{display:none;}</style>');
      this.init(this.parent);
    },
    init: function(parent) {
      if ( this.ready ) {
        return;
      }
      this.ready = true;
      this.parent = parent;
      if ( !this.gui.main ) {
        this.gui.main = this.getMainDiv();
      };
      this.gui.result = jQuery('<div class="tw2gui_jobsearchbar_allresults" style="width:285px;" />');
      this.gui.input = new TWDB.GameAPI.gui.textfield().maxlength(12).setClass4Input('tw2gui_jobsearch_string').setWidth(265);
      this.gui.button = jQuery('<div class="tw2gui_jobsearch_showall" style="display:block;cursor:pointer;"></div>')
      this.gui.scrollpane = new TWDB.GameAPI.gui.scrollpane();
      jQuery(this.gui.scrollpane.getMainDiv()).css('width','285px').css('height','250px');
      
      for (var jobid in parent.calcdata.jobs){
        var job = parent.calcdata.jobs[jobid];
        var div = jQuery('<p>'+job.name+'</p>');
        var tmp = {};
        tmp.dom = div;
        tmp.id = jobid;
        tmp.str = job.name.toUpperCase() + ' ';
        if ( job.gameid != 0 ) {
          var data = JobList.getJobById(job.gameid);
          for ( var itemid in data.yields ) {
            if ( isNaN(itemid) ) continue;
            var item = ItemManager.get(itemid);
            tmp.str += item.name.toUpperCase() + ' ';
          }
        }
        this.elements.push(tmp);
      };
      this.gui.main.append(jQuery('<div style="position:relative;top:0;left:0;width:305px" />').append(this.gui.input.getMainDiv()).append(this.gui.button)).append(this.gui.result);
      this.update();
      if(this.name) {
        this.open(this.name);
      }
    },
    open: function(name){
      var _self = this;
      this.gui.result.show();
      jQuery(this.gui.input.getMainDiv()).keyup(function(ev){_self.keyHandler(ev)});
      jQuery(this.gui.input.getMainDiv()).find('input').focus(function(){_self.gui.result.show();});
      delete(this.gui.scrollpane);
      this.gui.scrollpane = new TWDB.GameAPI.gui.scrollpane();
      jQuery(this.gui.scrollpane.getMainDiv()).css('width','285px').css('height','250px');
      var state = true;
      jQuery.each(this.elements,function (k, el) {
        _self.updateJob(k);
        if(state&&el.dom.is(':visible')){
          this.focused = k;
          el.dom.addClass('focused');
          state = false;
        } else {
          el.dom.removeClass('focused');
        }
        el.dom.addMousePopup(TWDB.ClothCalc.jobs.getJobPopup(el.id));
        el.dom.click((function(id){return function(){_self.close();TWDB.ClothCalc.jobs.switch(id)}})(el.id));
        _self.gui.scrollpane.appendContent(el.dom);
      });
      this.gui.result.children().remove();
      this.gui.result.append(this.gui.scrollpane.getMainDiv());
      this.gui.button.click(function(){if(_self.gui.result.is(':visible')){_self.gui.result.hide();}else{jQuery(_self.gui.input.getMainDiv()).find('input').focus();};});
      this.gui.main.show();
      if(isDefined(name)) {
        jQuery(this.gui.input.getMainDiv()).find('input').attr('value',name);
        jQuery(this.gui.input.getMainDiv()).keyup();
      }
    },
    search: function(string){
      var regexp = new RegExp(string.toUpperCase(), 'i');
      var state = true;
      var _self = this;
      jQuery.each(this.elements,function (k, el) {
        el.dom.removeClass('focused');
        if ( regexp.test(el.str) ) {
          el.dom.removeClass('TWDB_filter');
          if(state&&el.dom.is(':visible')){
            _self.focused = k;
            el.dom.addClass('focused');
            state = false;
          }
        }
        else {
          el.dom.addClass('TWDB_filter');
        };
      });
    },
    keyHandler: function(ev){
      var keyCode = ev.keyCode ? ev.keyCode : ev.which;
      if ( keyCode == 38 || keyCode == 40 ) {
        if (keyCode == 38 ) {
          this.elements[this.focused].dom.removeClass('focused');
          for ( var i = 0 ; i < this.elements.length ; i++ ) {
            this.focused--;
            if ( this.focused < 0 ) {
              this.focused = this.elements.length - 1;
            };
            if (this.elements[this.focused].dom.is(':visible')) {
              this.elements[this.focused].dom.addClass('focused')
              break;
            }
          }
        } else {
          this.elements[this.focused].dom.removeClass('focused');
          for ( var i = 0 ; i < this.elements.length ; i++ ) {
            this.focused++;
            if ( this.focused >= this.elements.length ) {
              this.focused = 0 ;
            };
            if (this.elements[this.focused].dom.is(':visible')) {
              this.elements[this.focused].dom.addClass('focused')
              break;
            }
          }
        }
        var pos1 = this.elements[this.focused].dom.offset().top;
        var pos2 = jQuery(this.gui.scrollpane.clipPane).offset().top;
        if ( pos1 - pos2 > 180 ) {
          var dif = ( pos1 - pos2 - 90 ) / 16;
          this.gui.scrollpane.scrollTo(0,dif);
        } else if ( pos2 - pos1 > 0 ) {
          var dif = ( pos1 - pos2 - 90 ) / 16;
          this.gui.scrollpane.scrollTo(0,dif);
        }
      }
      else if (keyCode == 13) {
        this.elements[this.focused].dom.click();
      }
      else {
        this.search(this.gui.input.getValue());
      };
    },
    order: function (type) {
      var quick = true;
      if(type) {
        if ( type == this.sort.type) {
          this.sort.order *= -1;
        }
        else {
          quick = false;
          if ( type == 'danger' || type == 'name') {
            this.sort.order = 1;
          } 
          else {
            this.sort.order = -1;
          }
          this.sort.type=type;
        }
      };
      var order = this.sort.order;
      var type = this.sort.type;
      function sortByTxt(x, y) {
        var val1 = TWDB.ClothCalc.calcdata.jobs[x.id].values[type];
        var val2 = TWDB.ClothCalc.calcdata.jobs[y.id].values[type]
        return val1 > val2 ? order : -order;
      };
      function sortByNum(x, y) {
        var val1 = TWDB.ClothCalc.calcdata.jobs[x.id].values[type];
        var val2 = TWDB.ClothCalc.calcdata.jobs[y.id].values[type]
        return val1 * 1 > val2 * 1 ? order : -order;
      };
      if (type == 'name') {
        this.elements.sort(sortByTxt);
      } else {
        this.elements.sort(sortByNum);
      };
      var _self = this;
      var state = true;
      jQuery.each(this.elements,function (k, el) {
        if(!quick){
          _self.updateJob(k);
        };
        if(state&&el.dom.is(':visible')){
          this.focused = k;
          el.dom.addClass('focused');
          state = false;
        } else {
          el.dom.removeClass('focused');
        };
        _self.gui.scrollpane.appendContent(el.dom);
      });
    },  
    updateJob: function (id) { 
      var el = this.elements[id];
      var job = TWDB.ClothCalc.jobs.calcJob(el.id);
      el.dom.removeClass('TWDB_hide');
      
      var name = job.name;
      name += ' [' + job.laborpoints.current + '/' + job.laborpoints.sum + '] ';
      switch ( this.sort.type ) {
        case 'luck1' : 
          name += '$' + job.values.luck1 + ' - ' + '$' + job.values.luck2;
          break;
        case 'laborpoints' : 
          name += job.values.laborpoints;
          break;
        case 'experience' : 
          name += job.values.experience + 'exp';
          break;
        case 'wages' : 
          name += '$' + job.values.wages;
          break;
        case 'danger' : 
          name += job.values.danger + '!';
          break;
        case 'duration' : 
          name += job.values.duration + ' sec';
          break;
        case 'motivation' : 
          name += job.values.motivation*100 + '%';
          break;
      };
      el.dom.html(name);
      if (job.laborpoints.current < 0 ){
        if ( job.laborpoints.sum < 0  && ( TWDB.Jobs.getJobById(job.id).level > window.Character.level ) ) {
          el.dom.css('color','red');
          if ( !this.all ) {
            el.dom.addClass('TWDB_hide');
          }
        }
        else {
          if ( job.laborpoints.sum < 0 ) {
            el.dom.css('color','OrangeRed');
          }
          else {
            el.dom.css('color','orange');
          }
        }
      }
      else {
        el.dom.css('color','#333333')
      }
      return job;
    },
    update: function() {
      var _self = this;
      jQuery.each(this.elements,function (k, el) {
        _self.updateJob(k);
      });
      this.order();
    },
    getMainDiv: function(){
      if ( !this.gui.main ) {
        this.gui.main = jQuery('<div style="position:absolute;left: 255px; top: 30px; display: none;" />').append('<style type="text/css">.TWDB_hide{display:none;}.TWDB_filter{display:none;}</style>');
      } 
      return this.gui.main;
    },
    close: function(){
      this.gui.main.hide();
    },
  },
   
  
  
// object that handles custom section of clothcalc  	
	customs: new Object({ 
		selected:0,
	// save pointer to parent   
		setParent: function (parent) {
			this.parent = parent;
		},
	// create calcdata list for custom jobs  	
		init: function() {
			for ( var key in this.parent.calcdata.custom ) {
				try {
					var tupel = this.parent.calcdata.custom[key];
					switch ( tupel.type ) {
						case 'speed' :
							var ride = 0;
							var speed = 0;
							if ( typeof(tupel.cloth[1]) != 'undefined' ) {
								if ( typeof(tupel.cloth[1]['other'][1]) != 'undefined' ) {
									ride = tupel.cloth[1]['other'][1];						
								};
							};
							if ( typeof(tupel.boni.other[1]) != 'undefined' ) {
								speed = tupel.boni.other[1];
							};
							speed -= ride;
							ride += typeof(tupel.boni.skill[2]) != 'undefined' ? tupel.boni.skill[2] : 0;
							ride += typeof(tupel.boni.skill[10]) != 'undefined' ? tupel.boni.skill[10] : 0;
							ride += CharacterSkills.skills.ride.points;
							tupel.skills = ['ride'];
							tupel.laborpoints = Math.round((100 + ride) * (1 + (speed / 100))) + '%';
							break;
						case 'regen' :
							tupel.skills = ['health'];
							tupel.laborpoints = '';
							break;
						case 'fort' : 
							if (tupel.para.type == 0) {
								var skills = {};
								skills.aim = CharacterSkills.skills.aim.points + (typeof(tupel.boni.skill[3]) != 'undefined' ? tupel.boni.skill[3] : 0) + (typeof(tupel.boni.skill[15]) != 'undefined' ? tupel.boni.skill[15] : 0);
								skills.endurance = CharacterSkills.skills.endurance.points + (typeof(tupel.boni.skill[1]) != 'undefined' ? tupel.boni.skill[1] : 0) + (typeof(tupel.boni.skill[8]) != 'undefined' ? tupel.boni.skill[8] : 0);
								skills.dodge = CharacterSkills.skills.dodge.points + (typeof(tupel.boni.skill[2]) != 'undefined' ? tupel.boni.skill[2] : 0) + (typeof(tupel.boni.skill[12]) != 'undefined' ? tupel.boni.skill[12] : 0);
								skills.leadership = CharacterSkills.skills.leadership.points + (typeof(tupel.boni.skill[4]) != 'undefined' ? tupel.boni.skill[4] : 0) + (typeof(tupel.boni.skill[20]) != 'undefined' ? tupel.boni.skill[20] : 0);
								skills.health = CharacterSkills.skills.health.points + (typeof(tupel.boni.skill[1]) != 'undefined' ? tupel.boni.skill[1] : 0) + (typeof(tupel.boni.skill[9]) != 'undefined' ? tupel.boni.skill[9] : 0);
								
								var lp = (100 + ((Character.level - 1) * Character.lifePointPerHealthSkill) + skills.health * (Character.lifePointPerHealthSkill + Character.lifePointPerHealthSkillBonus)) + ' | ';
								lp += Math.round((25 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.aim, 0.4) + Math.pow(skills.endurance, 0.4))*100)/100 + ' | ';
								lp += Math.round((10 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.dodge, 0.4) + Math.pow(skills.endurance, 0.4))*100)/100;
								
							} else {
								var skills = {};
								skills.aim = CharacterSkills.skills.aim.points + (typeof(tupel.boni.skill[3]) != 'undefined' ? tupel.boni.skill[3] : 0) + (typeof(tupel.boni.skill[15]) != 'undefined' ? tupel.boni.skill[15] : 0);
								skills.hide = CharacterSkills.skills.hide.points + (typeof(tupel.boni.skill[2]) != 'undefined' ? tupel.boni.skill[2] : 0) + (typeof(tupel.boni.skill[13]) != 'undefined' ? tupel.boni.skill[13] : 0);
								skills.dodge = CharacterSkills.skills.dodge.points + (typeof(tupel.boni.skill[2]) != 'undefined' ? tupel.boni.skill[2] : 0) + (typeof(tupel.boni.skill[12]) != 'undefined' ? tupel.boni.skill[12] : 0);
								skills.leadership = CharacterSkills.skills.leadership.points + (typeof(tupel.boni.skill[4]) != 'undefined' ? tupel.boni.skill[4] : 0) + (typeof(tupel.boni.skill[20]) != 'undefined' ? tupel.boni.skill[20] : 0);
								skills.health = CharacterSkills.skills.health.points + (typeof(tupel.boni.skill[1]) != 'undefined' ? tupel.boni.skill[1] : 0) + (typeof(tupel.boni.skill[9]) != 'undefined' ? tupel.boni.skill[9] : 0);
								
								var lp = (100 + ((Character.level - 1) * Character.lifePointPerHealthSkill) + skills.health * (Character.lifePointPerHealthSkill + Character.lifePointPerHealthSkillBonus)) + ' | ';
								lp += Math.round((25 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.aim, 0.4) + Math.pow(skills.hide, 0.4))*100)/100 + ' | ';
								lp += Math.round((10 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.dodge, 0.4) + Math.pow(skills.hide, 0.4))*100)/100;
							};
							tupel.skills = ['health','attacker','defender'];
							tupel.laborpoints = lp;
							break;
						case 'duel' : 
							tupel.skills = [];
							var lp = 0;
							for ( var skillid in tupel.para ) {
								var attrid = Math.floor(skillid / 5);
								if ( typeof(tupel.boni.skill[skillid]) != 'undefined') {
									lp += tupel.boni.skill[skillid]
								};
								if ( typeof(tupel.boni.skill[attrid]) != 'undefined') {
									lp += tupel.boni.skill[attrid];
								};
								if ( typeof(this.parent._id2skill[skillid]) != 'undefined') {
									tupel.skills.push(this.parent._id2skill[skillid]);
									if ( typeof(CharacterSkills.skills[this.parent._id2skill[skillid]]) != 'undefined' ) {
										lp += CharacterSkills.skills[this.parent._id2skill[skillid]].points;
									} else if ( typeof(CharacterSkills.attributes[this.parent._id2skill[skillid]]) != 'undefined' ) {
										lp += CharacterSkills.attributes[this.parent._id2skill[skillid]].points;
									};
								};
							};
							tupel.laborpoints = lp;
							break;
						case 'custom' : 
							tupel.skills = [];
							var lp = 0;
							for ( var skillid in tupel.para ) {
								var attrid = Math.floor(skillid / 5);
								if ( typeof(tupel.boni.skill[skillid]) != 'undefined') {
									lp += tupel.boni.skill[skillid]
								};
								if ( typeof(tupel.boni.skill[attrid]) != 'undefined') {
									lp += tupel.boni.skill[attrid];
								};
								if ( typeof(this.parent._id2skill[skillid]) != 'undefined') {
									tupel.skills.push(this.parent._id2skill[skillid]);
									if ( typeof(CharacterSkills.skills[this.parent._id2skill[skillid]]) != 'undefined' ) {
										lp += CharacterSkills.skills[this.parent._id2skill[skillid]].points;
									} else if ( typeof(CharacterSkills.attributes[this.parent._id2skill[skillid]]) != 'undefined' ) {
										lp += CharacterSkills.attributes[this.parent._id2skill[skillid]].points;
									};
								};
							};
							tupel.laborpoints = lp;
							break;
						default : return;
							break;
		
					};
				} catch (e) {
          TWDB.Error.report(e,'GENERICERROR#; handle Customs');
				};
			};
		},
	// calc bonus values for given custom job  
		calc: function() {
			if ( typeof(this.parent.calcdata.custom[this.selected]) == 'undefined' ) {
				return '';
			};
      var custom = this.parent.calcdata.custom[this.selected];
      if ( custom.type == 'fort' ) {
        return '0|0|0'
      }
			return 0;	
		},
	// create Selectbox for custom jobs  
		createSelectbox: function() {
      if ( !this.parent.gui.custom.selectbox) {
        return;
      }
			this.parent.gui.custom.selectbox.elContent.empty();
			this.parent.gui.custom.selectbox.value = null;
			this.parent.gui.custom.selectbox.items = [];
			for ( var id in this.parent.calcdata.custom ) {
				var name = this.parent.calcdata.custom[id].name + ' [' + this.parent.calcdata.custom[id].laborpoints + ']';
				this.parent.gui.custom.selectbox.addItem(id , name );
			};	
			this.switch(this.selected);
		},
	// switch custom job  	
		switch: function(id){
			if( typeof(this.parent.calcdata.custom[id] ) == 'undefined' || typeof(this.parent.calcdata.custom[id].cloth ) == 'undefined' ) {
				return;
			};
			var _self = this.parent;
			this.parent.customs.selected = id;
			var string = ' [' + this.parent.calcdata.custom[id].laborpoints + ']';
			string = this.parent.calcdata.custom[id].name.substring(0, (35-string.length)) + string;
			this.parent.gui.custom.title.html(string);
			this.parent.bag.showItems(this.parent.calcdata.custom[id].cloth, 'custom');
			this.showSkill();
		},	
	// show Skill Images and custom job bonus  	
		showSkill: function () {
			this.parent.gui.custom.skills.children().remove();
			if ( typeof(this.parent.calcdata.custom[this.parent.customs.selected]) == 'undefinied' ) {
				return;
			};
      if ( this.parent.calcdata.custom[this.parent.customs.selected].type == 'fort' ) {
        return;
      }
			var lp = this.calc();
			var tmp = (String(lp)).split('|');
			for ( var i = 0 ; i<this.parent.calcdata.custom[this.selected].skills.length ; i++ ) {
				var div = jQuery('<div style="float:left;width:30px;height:30px;" />');
				div.append(this.parent.getSkillImg(this.parent.calcdata.custom[this.selected].skills[i],30));
				this.parent.gui.custom.skills.append(div);
				if ( this.parent.calcdata.custom[this.parent.customs.selected].type == 'fort' && typeof(tmp[i]) != 'undefined' ) {
					var span = jQuery('<div style="float:left;height:25px;padding:5px 10px 0px 5px ;font-weight:bold;">' + tmp[i] + '</div>');
					this.parent.gui.custom.skills.append(span);
				};
			};
			if (this.parent.calcdata.custom[this.parent.customs.selected].type != 'fort') {
				var span = jQuery('<div style="float:left;height:25px;padding:5px 0px 0px 5px ;font-weight:bold;">' + lp + '</div>');
				this.parent.gui.custom.skills.append(span);
			};
		},	
	// show settings window for custom jobs  
		showConfig: function () {
			var _self = this;
			var guiEdit = jQuery('<div title="#EDIT#" style="display:inline-block;vertical-align:top;height:16px;width:16px;cursor:pointer;background:url(\''+Game.cdnURL+'/images/window/messages/head-icons.png\') repeat scroll 0 16px transparent;" />');
			var guiDelete = jQuery('<div title="#DELETE#" style="display:inline-block;vertical-align:top;height:16px;width:16px;cursor:pointer;background:url(\''+Game.cdnURL+'/images/icons/delete.png\') repeat scroll 0px 0px transparent;" />');
			var guiAdd = jQuery('<div title="#ADD#" style="display:block;margin-top:2px;vertical-align:top;height:20px;width:25px;cursor:pointer;background:url(\''+Game.cdnURL+'/images/window/messages/icons.png\') repeat scroll 72px -5px transparent;" />');
			
			var guiList = jQuery('<div />');
			for ( var key in this.parent.data.custom ) {
				var entry = this.parent.data.custom[key];
				var name = jQuery('<div style="display:inline-block;vertical-align:top;height:16px;width:300px;overflow:hidden;" />').html(entry.name);
				var edit = guiEdit.clone(false);
				var del = guiDelete.clone(false);
				var row = jQuery('<div style="display:block;height:18px;padding: 3px 0px 0px 0px;border-bottom: 1px solid #666" />').append(name).append(edit).append(del);
				guiList.append(row);
				var call = function(key){ return function () { _self.editConfig(key);}}(key);
				edit.click(call);
				var call = function(key){ return function () { _self.deleteConfig(key);}}(key);
				del.click(call);
			};
			var count = 0;
			for ( var key in  this.parent.data.custom ) {
				count++;
			};
	
			if ( count < 15 ) {
				guiList.append(guiAdd);
				guiAdd.click(function(){_self.addConfig()});
			};
			this.parent.gui.custom.config = new TWDB.GameAPI.gui.dialog ('#CUSTOM#',guiList);
			this.parent.gui.custom.config.addButton('ok',function(){_self.parent.checkCache();});
			this.parent.gui.custom.config.show();
		},	
	// add customs job  
		addConfig: function () {
			var count = 0;
			for ( var key in  this.parent.data.custom ) {
				count++;		
			};
			if ( count >= 15 ) {
				new UserMessage('#CLOTHCALC_TOOMUCH#', UserMessage.TYPE_ERROR).show();
			} else {
				count++;
				this.editConfig(count);
			};
		},	
	// edit custom job -_>
		editConfig: function (key,confirm) {
			if ( typeof(confirm) == 'undefined' ) {
				var _self = this;
				var name = '';
				var code = '';
				var title = '#ADD# - ';
				if ( typeof(this.parent.data.custom[key]) != 'undefined' ) {
					title = '#EDIT# - ';
					var name = this.parent.data.custom[key].name;
					var code = JSON.stringify({'type':this.parent.data.custom[key].type,'para':this.parent.data.custom[key].para}); 
				};
				this.tmp = {'name':name,'code':code};
				this.parent.gui.custom.name = new TWDB.GameAPI.gui.textfield("twdb_cc_custom_name").setSize(30).setValue(name);
				this.parent.gui.custom.code = new TWDB.GameAPI.gui.textfield("twdb_cc_custom_code").setSize(30).setValue(code);
				var gui = jQuery('<table width="400px" />');
				gui.append(jQuery('<tr />').append('<td style="vertical-align:middle">#NAME#:</td>').append(jQuery('<td />').append(this.parent.gui.custom.name.getMainDiv())));
				gui.append(jQuery('<tr />').append('<td style="vertical-align:middle">#CODE#:</td>').append(jQuery('<td />').append(this.parent.gui.custom.code.getMainDiv())));
				gui.append('<tr><td colspan="2">#CLOTHCALC_CUSTOMHELP# <a href="http://tw-db.info/?strana=calc" target="_blank">tw-db.info #CALCULATOR#</a></td></tr>');
				var gui = new TWDB.GameAPI.gui.dialog (title + '#CUSTOM#',gui);
				gui.addButton('ok',function(){return _self.editConfig(key,true)});
				gui.addButton('cancel');
				gui.show();
			} else {
				var error = function (message) {
					new UserMessage('#WRONG_INSERTS#: '+message, UserMessage.TYPE_ERROR).show();
					return false;
				};
				if ( this.parent.gui.custom.name.getValue() == '' ) {
					return error('#EMPTY# #NAME#');
				};
				if ( this.parent.gui.custom.code.getValue() == '' ) {
					return error('#EMPTY# #CODE# [1]');
				};
				if ( this.parent.gui.custom.name.getValue() == this.tmp.name && this.parent.gui.custom.code.getValue() == this.tmp.code ) {
					return true;
				};
				try {
					var code = jQuery.parseJSON(this.parent.gui.custom.code.getValue());
				} catch (e) {
					return error('#WRONG# #CODE# [2]');
				};
				if ( typeof(code.type) == 'undefined' || typeof(code.para) == 'undefined' ) {
					return error('#WRONG# #CODE# [3]');
				};
				var count = 0;
				for ( var i in code.para ) {
					count++;
				};
				switch (code.type) {
					case 'speed' : 
					case 'regen' :
						if ( count != 0 ) {
							return error('#WRONG# #CODE# [4]');
						};
						break;
					case 'fort' : 
						if ( typeof(code.para.type) == 'undefined' || typeof(code.para.att) == 'undefined' || typeof(code.para.def) == 'undefined' || typeof(code.para.health) == 'undefined' ) {
							return error('#WRONG# #CODE# [5]');
						};
						if ( code.para.type != 1 && code.para.type != 0) {
							return error('#WRONG# #CODE# [6]');
						};
						if ( !jQuery.isNumeric(code.para.att) || code.para.att < 0 ) {
							return error('#WRONG# #CODE# [7]');
						};
						if ( !jQuery.isNumeric(code.para.def) || code.para.def < 0 ) {
							return error('#WRONG# #CODE# [8]');
						};
						if ( !jQuery.isNumeric(code.para.health) || code.para.health < 0 ) {
							return error('#WRONG# #CODE# [9]');
						};
						break;
					case 'duel' :
					case 'custom' : 
						if ( count <= 0 ) {
							return error('#WRONG# #CODE# [10]');
						};
						break;
					default:
						return error('#WRONG# #CODE# [11]');
				};
				delete(this.tmp);
				this.parent.data.custom[key] = {'id':Number(key),'type':code.type,'para':code.para,'name':this.parent.gui.custom.name.getValue()};
				this.parent.gui.custom.config.hide();
				this.showConfig();
				TWDB.Settings.set('custom',this.parent.data.custom); 
			};
		},
	// delete custom job  
		deleteConfig: function (key,confirm) {
			if ( typeof(confirm) == 'undefined' ) {
				var _self = this;
				var gui = new TWDB.GameAPI.gui.dialog ('#DELETE# - #CUSTOM#','#DELETE#: ' + this.parent.data.custom[key].name + '?');
				gui.addButton('ok',function(){_self.deleteConfig(key,true)});
				gui.addButton('cancel');
				gui.show();
			} else {
				var tmp = this.parent.data.custom;
				delete(tmp[key]);
				this.parent.data.custom = {};
				var count = 0;
				for ( var key in tmp ) {
					count++;
					this.parent.data.custom[count] = tmp[key];
					this.parent.data.custom[count].id = count;
				};
				this.parent.gui.custom.config.hide();
				this.showConfig();
				TWDB.Settings.set('custom',this.parent.data.custom); 
			};
		},
	}),
// get images for skill or attribute  
	getSkillImg: function(skill, height) {
		var scaleX = 1;
		var scaleY = 1;
		var margin = 0;
		switch(skill) {
			case 'build' : var img = Game.cdnURL+'/images/skill/skills_strength.png'; scaleY = 2; break;
			case 'punch' : var img = Game.cdnURL+'/images/skill/skills_strength.png'; margin = 1; scaleY = 2; break;
			case 'tough' : var img = Game.cdnURL+'/images/skill/skills_strength.png'; margin = 2; scaleY = 2; break;
			case 'endurance' : var img = Game.cdnURL+'/images/skill/skills_strength.png'; margin = 3; scaleY = 2; break;
			case 'health' : var img = Game.cdnURL+'/images/skill/skills_strength.png'; margin = 4; scaleY = 2; break;
			case 'ride' : var img = Game.cdnURL+'/images/skill/skills_flexibility.png'; scaleY = 2; break;
			case 'reflex' : var img = Game.cdnURL+'/images/skill/skills_flexibility.png'; margin = 1; scaleY = 2; break;
			case 'dodge' : var img = Game.cdnURL+'/images/skill/skills_flexibility.png'; margin = 2; scaleY = 2; break;
			case 'hide' : var img = Game.cdnURL+'/images/skill/skills_flexibility.png'; margin = 3; scaleY = 2; break;
			case 'swim' : var img = Game.cdnURL+'/images/skill/skills_flexibility.png'; margin = 4; scaleY = 2; break;
			case 'aim' : var img = Game.cdnURL+'/images/skill/skills_dexterity.png'; scaleY = 2; break;
			case 'shot' : var img = Game.cdnURL+'/images/skill/skills_dexterity.png'; margin = 1; scaleY = 2; break;
			case 'pitfall' : var img = Game.cdnURL+'/images/skill/skills_dexterity.png'; margin = 2; scaleY = 2; break;
			case 'finger_dexterity' : var img = Game.cdnURL+'/images/skill/skills_dexterity.png'; margin = 3; scaleY = 2; break;
			case 'repair' : var img = Game.cdnURL+'/images/skill/skills_dexterity.png'; margin = 4; scaleY = 2; break;
			case 'leadership' : var img = Game.cdnURL+'/images/skill/skills_charisma.png'; scaleY = 2; break;
			case 'tactic' : var img = Game.cdnURL+'/images/skill/skills_charisma.png'; margin = 1; scaleY = 2; break;
			case 'trade' : var img = Game.cdnURL+'/images/skill/skills_charisma.png'; margin = 2; scaleY = 2; break;
			case 'animal' : var img = Game.cdnURL+'/images/skill/skills_charisma.png'; margin = 3; scaleY = 2; break;
			case 'appearance' : var img = Game.cdnURL+'/images/skill/skills_charisma.png'; margin = 4; scaleY = 2; break;
			case 'strength' : var img = Game.cdnURL+'/images/attribute_circle/strength.png'; break;
			case 'flexibility' : var img = Game.cdnURL+'/images/attribute_circle/flexibility.png'; break;
			case 'dexterity' : var img = Game.cdnURL+'/images/attribute_circle/dexterity.png'; break;
			case 'charisma' : var img = Game.cdnURL+'/images/attribute_circle/charisma.png'; break;
			case 'attacker' : var img = TWDB.images.attacker; break;
			case 'defender' : var img = TWDB.images.defender; break;
			default: return jQuery('<div />');
		};
		var title = '';
		if ( typeof(CharacterSkills.skills[skill]) != 'undefined') {
			var title = CharacterSkills.skills[skill].name;
		} else 	if ( typeof(CharacterSkills.attribute[skill]) != 'undefined') {
			var title = CharacterSkills.attribute[skill].name;
		};
		img = '<img src="'+img+'" height="'+(height * scaleY) + '" title="'+title+'" style="margin-left:-'+(margin*height )+'px" />';
		img = jQuery(img);
		var div = '<div style="display:block;overflow:hidden;width:'+(height * scaleX)+'px;height:'+(height)+'px;"/>';
		div = jQuery(div);
		return div.append(img);
	},
// object that handles bag and item carry  
	bag: new Object({
		stack: {},
		interval: false,
		// save pointer to parent   
			setParent: function (parent) {
				this.parent = parent;
			},
		// show given items on bag gui   
			showItems: function(items, tab) {
				this.parent.gui.bag.children().remove();
				this.items = {};
				var _self = this;
				var animal = false;
				addItem = function (itemid){
					var itemData = ItemManager.get(itemid);
					var tmp = new tw2widget.InventoryItem(itemData);
					//var div = tmp.getMainDiv().clone(true);
					var div = tmp.getMainDiv();
					var callback = function(itemid) { return function () { _self.click(tmp,itemid,tab); }}(itemid);
					jQuery(div).removeAttr('id');
					jQuery(div).children('.TWDBbuyTip').remove();
					jQuery(div).children('.TWDBsellTip').remove();
					jQuery(div).children('.TWDBcollector').remove();
					jQuery(div).children('img:first-child').removeAttr('id').click(callback);
					jQuery(div).appendTo(_self.parent.gui.bag);
					_self.items[itemid] = jQuery(div);
				};
				for ( var typeid in items ) {
					if ( typeof(typeid) == 'function' ) {
						break;	
					};
					var item_id = items[typeid].id;
					var itemData = ItemManager.get(item_id);
					addItem(item_id);
					if(itemData.type=='animal'){
						animal = true;
					};
				};
        var animals = TWDB.DataManager.getAnimals();
				if(!animal && animals.length>0){
					addItem(animals[0]['id']);
				};
				this.wear();
			},
		// click on item   
			click: function(element,item_id,tab){
				var item = Bag.getItemByItemId(item_id);
				if (item === undefined) {
					return false;
				};
        
        Wear.carry(element)
        this.stack[item_id] = element;
        if ( this.interval === false ) {
          var _self = this;
          switch (tab) {
            case 'jobs' : 
              var update = function() {_self.wear();_self.parent.jobs.update();_self.parent.joblist.update();};
              break;
            case 'custom' : 
              var update = function() {_self.wear();_self.parent.customs.showSkill();};
              break;
          };
          TWDB.Eventer.set('carryChecker',update,1);
          this.interval = setInterval(function(){_self.carry()},100);
        };
        //element.elImg.css('opacity', 0.3);
        //jQuery(element).css('opacity', '0.3');
			},
		// check if game finished carry on   
			carry: function() {
				var count = 0;
				for ( var item_id in this.stack ) {
					//var item = Bag.getItemByItemId(item_id);
					var item = this.stack[item_id];
					if ( item == undefined || item.getImgEl().css('opacity') == 1 ) {
						//jQuery(this.stack[item_id]).css('opacity', '1.0');
						delete(this.stack[item_id]);
					} else {
						count++;
					};
				};
				if (count == 0 ) {
					clearInterval(this.interval);
					this.interval=false;
          
					TWDB.Eventer.trigger('carryChecker');
				};
			},
		// check of items are carried   
			wear: function() {
				for ( var key in Wear.wear ) {
					var itemid = Wear.wear[key].obj.item_id;
					if(typeof(this.items[itemid])!='undefined') {
						this.items[itemid].css('opacity', '0.5');
					};
				};
			},	
		
	}),
  setUsedItems : function ( ) {
    for ( var jobid in this.calcdata.jobs ) {
      for ( var type in this.calcdata.jobs[jobid].cloth ) {
        var itemid = this.calcdata.jobs[jobid].cloth[type].id;
        if ( typeof( this.calcdata.used[itemid] == 'undefined' ) ) {
          this.calcdata.used[itemid] = 1;
        } else {
          this.calcdata.used[itemid]++;
        };
      };
    };
    for ( var custom in this.calcdata.custom ) {
      for ( var type in this.calcdata.custom[custom].cloth ) {
        var itemid = this.calcdata.custom[custom].cloth[type].id;
        if ( typeof( this.calcdata.used[itemid] == 'undefined' ) ) {
          this.calcdata.used[itemid] = 1;
        } else {
          this.calcdata.used[itemid]++;
        };
      };
    };
  },
  jobSearch: function () {
    var _self = this;
    if ( this.jobs.selected == 0 ) {
      return ;
    };
    if(this.gui.job.searchDiv.parent().length) {
      this.jobs.switch(this.jobs.selected);
      return;
    };
    this.gui.bag.children().remove();
    
    var pos = TWDB.Map.getNearestJob(this.jobs.selected);
    var max = 4;
    var dom = jQuery('<table />');
    for ( var i = 0 ; i < pos.length ; i++ ) {
      if ( i == max ) {
        break;
      };
      var tmp = pos[i];
      var rot = 'rotate(' + tmp.angle + 'deg);';
      var tr = jQuery('<tr />');
      tr.append('<td style="text-align:left;vertical-align:middle">' + tmp.time.formatDuration() + '</td>');
      tr.append( 
        jQuery('<td style="text-align:left;vertical-align:middle">').append(
          jQuery('<img src="'+TWDB.images.arrow+'" title="#DIRECTION#" style="cursor:pointer;-moz-transform: ' + rot + '-webkit-transform:' + rot + '-o-transform:' + rot + '-ms-transform:' + rot + 'transform:' + rot + '" />').click((function(x,y){return function(){Map.center(x,y);};})(tmp.x,tmp.y))
        )
      );
      var td = jQuery('<td />');
      var btn = new TWDB.GameAPI.gui.button('#OPEN#',((function(id,x,y){return function(){TWDB.Jobs.openJob(id,x,y);}})(_self.jobs.selected,tmp.x,tmp.y)));
      jQuery(btn.divMain).css('min-width','50px').css('max-width','80px');
      (jQuery(btn.divMain).find('.textart_title')).css('overflow','hidden');
      btn.appendTo(td);
      tr.append(td);
      if ( Premium.hasBonus('automation') ) {
        var td = jQuery('<td />');
        var btn = new TWDB.GameAPI.gui.button('#JOB_START#',((function(id,x,y){return function(){TWDB.Jobs.startJob(id,x,y);}})(_self.jobs.selected,tmp.x,tmp.y)));
        jQuery(btn.divMain).css('min-width','50px').css('max-width','80px');
        (jQuery(btn.divMain).find('.textart_title')).css('overflow','hidden');
        btn.appendTo(td);
        tr.append(td);
      };
      dom.append(tr);
    };
    this.gui.job.searchDiv.children().remove();
    this.gui.job.searchDiv.append(dom);
    this.gui.bag.append(this.gui.job.searchDiv);
  },
  isUsedItem : function (id) {
    if ( this.calcdata.used[id] ) {
      return true;
    }
    else {
      return false;
    };
  },
  getClothForJob : function (jobid) {
    if ( !isDefined(this.calcdata.jobs[jobid]) || !isDefined(this.calcdata.jobs[jobid].cloth) ) {
      return null;
    };
    return this.calcdata.jobs[jobid].cloth
  },
  getLPForJob : function (jobid) {
    if ( !isDefined(this.calcdata.jobs[jobid]) || !isDefined(this.calcdata.jobs[jobid].laborpoints) ) {
      return null;
    };
    return this.calcdata.jobs[jobid].laborpoints;
  },
  getSelectedJob: function() {
    return this.jobs.selected;
  },
  isLoaded: function() {
    if ( isDefined(this.calcdata.loaded) ) {
      return this.calcdata.loaded;
    }
    return false;
  },
  
});



(function ($) {
  var _base = TWDB;
  var w = window;
  
	var _skill2id = {'strength':1,'flexibility':2,'dexterity':3,'charisma':4,'build':5,'punch':6,'tough':7,'endurance':8,'health':9,'ride':10,'reflex':11,'dodge':12,'hide':13,'swim':14,'aim':15,'shot':16,'pitfall':17,'finger_dexterity':18,'repair':19,'leadership':20,'tactic':21,'trade':22,'animal':23,'appearance':24};
	var _id2skill = {1:'strength',2:'flexibility',3:'dexterity',4:'charisma',5:'build',6:'punch',7:'tough',8:'endurance',9:'health',10:'ride',11:'reflex',12:'dodge',13:'hide',14:'swim',15:'aim',16:'shot',17:'pitfall',18:'finger_dexterity',19:'repair',20:'leadership',21:'tactic',22:'trade',23:'animal',24:'appearance'};
  var	_type2id = {'animal':1,'body':2,'foot':3,'head':4,'left_arm':5,'neck':6,'right_arm':7,'yield':8,'pants':9,'belt':10};
	var _id2type = {1:'animal',2:'body',3:'foot',4:'head',5:'left_arm',6:'neck',7:'right_arm',8:'yield',9:'pants',10:'belt'};
	var _class2id = {'greenhorn':1,'adventurer':2,'duelist':3,'worker':4,'soldier':5};
  
  var Images = _base.images;
  var ClothCalc = _base.ClothCalc;

  ///// complete ////////////////////////
  //
  //  Script Object: basic Data of Script (most is set on script generating)
  //  Init:         no need for init
  //  Methodes:     - getFooter ()
  //                    <- return jQuery Div
  //
  ///////////////////////////////////////
  var Script = _base.script;
  Script.uid = 'twdb_clothcalc';
  Script.title = 'tw-db.info ClothCalc';
  Script.getFooter = function( s ) {
    if ( s ) {
      var div = $('<div />').css({'width':'100%','text-align':'center','height':'15px','display':'block','font-size':'10px','color':'#000000'});
      div.append( $('<span style="cursor:pointer" >.:powered by scooby [de1]:.</span>').click(function(){w.TheWestApi.open()}) );
      div.append('<span>&nbsp;|&nbsp;</span>');
      div.append('<a href="http://' + this.url + '" style="font-weight:normal;color:#000000;" target="_blank">.:' + this.url + ':.</a>');
      div.append('<span>&nbsp;|&nbsp;</span>');
      div.append('<span>' + ( this.version/100 + ' rev. ' + this.revision ) + '</span>');
      return div;
    }
    else {
      var div = $('<div />').css({'width':'100%','text-align':'center','position':'absolute','bottom':'0px','left':'0px','height':'15px','display':'block','font-size':'10px','color':'#000000'});
      div.append( $('<span style="cursor:pointer" >.:powered by scoobydoo [de1] and tw-db team:.</span>').click(function(){w.TheWestApi.open()}) );
      div.append('<span>&nbsp;|&nbsp;</span>');
      div.append('<a href="http://' + this.url + '" style="font-weight:normal;color:#000000;" target="_blank">.:' + this.url + ':.</a>');
      div.append('<span>&nbsp;|&nbsp;</span>');
      div.append('<span>' + ( this.version/100 + ' rev. ' + this.revision ) + '</span>');
      return div;
    }
  }


  ///// complete ////////////////////////
  //
  //  Debugger Object: make the TWDB Objects visible for debugging
  //  Init:         no need for init
  //  Methodes:     
  //
  ///////////////////////////////////////
    var Debugger = (function ($) {
      var _self = {};
      return _self;
    })($);
    _base.Debugger = Debugger;

    ///// complete ////////////////////////
  //
  //  Game API:
  //  Init:       no need for init
  //  Methodes:     
  //
  ///////////////////////////////////////
    var GameAPI = (function ($) {
      var _self = {};
      _self.wman = wman;
      _self.gui = {};
      for ( var key in w.west.gui ) {
        if ( !w.west.gui.hasOwnProperty(key) ) {
          continue;
        };
        newName = key.toLowerCase();
        _self.gui[newName] = w.west.gui[key];
      }
      return _self;
    })($);
    _base.GameAPI = GameAPI;
    Debugger.GameAPI = GameAPI;

  ///// complete ////////////////////////
  //
  //  Error Object: to this Object all catched errors should be reported
  //  Init:         no need for init
  //  Methodes:     - report (e,msg)    
  //                    -> e must be the error from catch() 
  //                    -> msg is a custom string, which is used to declare where the error occured
  //                    <- no return;
  //
  ///////////////////////////////////////
    var Error = (function ($) {
      var _self = {};
      var uid = 'twdb_error';
      var log = [];
      _self.report = function ( e , msg ) {
        if ( !isDefined(e.message) ) {
          log.push({msg:'failed to add error' , e:msg});
        }
        else {
          log.push({msg:msg,e:e.message});
        }
        if ( log.length < 2 ) {
          w.WestUi.NotiBar.add( new OnGoingPermanentEntry(function(){show();}, 'tw-db.info: an error occured', 'tip') );
        };
      };
      var show = function () {
        var bodyscroll = new GameAPI.gui.scrollpane();
        var table = '<table border="1" cellpadding="0" cellspacing="0" >';
        for( var i = log.length-1 ; i >= 0 ; i-- ) {
          table += '<tr><td style="padding:0px 2px 0px 2px;" >' + i + '</td><td style="padding:0px 2px 0px 2px;">' + log[i].msg + '</td><td style="padding:0px 2px 0px 2px;">' + log[i].e + '</td></tr>';
        };
        table += '</table>';
        $(bodyscroll.getMainDiv()).css('height','370px').find('.tw2gui_scrollpane_clipper_contentpane').addClass('selectable');
        bodyscroll.appendContent(table);
        var win = GameAPI.wman.open(uid, null, 'noreload').setMiniTitle('TWDB Errorlog').setTitle('tw-db.info Errorlog').appendToContentPane(bodyscroll.getMainDiv()).appendToContentPane(Script.getFooter());
      };
      return _self;
    })($);
    _base.Error = Error;
    Debugger.Error = Error;
  
  ///// complete ////////////////////////
  //
  //  Loader:       is starting the several Script Features
  //  Init:         general script starter, run Loader.init();
  //  Methodes:     - add (key,call,finished,dependency) // add a Script Module to load
  //                    -> key: is the index
  //                    -> txt: Description for the gui
  //                    -> call: is the function to load
  //                    -> dependency: empty || array of Modules loaded first
  //                    <- object refernce {ready:false} // should be change through Module to true, if Module is loaded
  //                - init () // start loading modules
  //
  ///////////////////////////////////////
    var Loader = (function ($) {
      var _self = {};
      var stack = [];
      var loaded = {};
      var failed = {};
      var interval;
      var current = false;
      var locked = false;
      var loop = false;
      var round = 0;
      _self.add = function ( key , txt , call , dependency ) {
        var r = {ready:false};
        stack.push({key:key,txt:txt,call:call,dep:dependency||{},ready:r,count:0});
        return r;
      };
      _self.init = function() {
        if ( interval ) {
          return;
        }
        Gui.add();
        interval = w.setInterval(function(){worker();},500);
      };
      var worker = function() {
        if ( locked ) {
          return;
        }
        locked = true;
        if ( current === false ) {
          if ( !checkGame() ) {
            locked = false;
            return;
          };
          try {
            Updater.query();
            registerScript();
          } catch (e) {
            Error.report(e,'');
            new UserMessage('#APIERROR#', UserMessage.TYPE_FATAL).show();
            destroy();
            return;
          };
          if ( window.TheWestApi.version < 2.04 ) {
            new UserMessage('TWDB-ClothCalc Script is deactivated until the Gameversion on your world is updated to 2.04. Sorry', UserMessage.TYPE_FATAL).show();
            destroy();
            return;
          }
          next();
          return;
        }
        if ( isDefined(failed[current.key]) ) {
          next();
          return;
        }
        if ( current.ready.ready ) {
          loaded[current.key] = true;
          loop = false;
          next();
          return;
        }
        locked = false;
      };
      var checkGame = function () {
        if ( !isDefined(w.jQuery) || !isDefined(w.TheWestApi) || !isDefined(w.TheWestApi.version) || !w.ItemManager.isLoaded() ) {
          return false;
        }
        return true;
      };
      var registerScript = function ( ) {
        var TheWestApiGui = w.TheWestApi.register( Script.uid , Script.title , "1.34", String(Script.gameversion) , "scoobydoo [de1 - tw-db.info]", 'http://' + Script.url);
            var PayPal =    '<form action="https://www.paypal.com/cgi-bin/webscr" method="post">'
                            + '<input type="hidden" name="cmd" value="_s-xclick">'
                            + '<input type="hidden" name="hosted_button_id" value="CGFB9K7SKMBQ8">'
                            + '<input type="image" src="https://www.paypalobjects.com/en_US/DE/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">'
                            + '<img alt="" border="0" src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width="1" height="1">'
                          + '</form>';
            TheWestApiGui.setGui('#CCSCRIPT#'+PayPal+'Thank You!');
            if ( TheWestApiGui.isOutdated() ) {
              w.TheWestApi.displayOutdated();
            }
      };
      var next = function ( ) {
        if ( stack.length == 0 ) {
          Gui.del();
          destroy();
          return;
        }
        current = stack.shift();
        current.count++;
        if ( current.count > round ) {
          if ( loop ) {
            Error.report({'message':'deadlock detected'},'failed to load module: ' + current.key);
            failed[current.key] = true;
            next();
            return;
          }
          round++;
          loop = true;
        }
        for ( var module in current.dep ) {
          if ( !isDefined(loaded[module]) ) {
            if ( Settings.get('scooby') ) {
              console.log(current.key , 'needs ', module);
            };
            stack.push(current);
            next();
            return;
          };
        }
        Gui.update();
        try {
          current.call();
        }
        catch (e) {
          Error.report(e,'failed to load module: ' + current.key);
          failed[current.key] = true;
          next();
          return;
        };
        locked = false;
        worker();
      };
      var destroy = function ( ) {
      	w.clearInterval(interval);
        w.setTimeout(function(){delete(_self);},1000);
      };
      var Gui = (function($) {
        var _that = {};
        var gui = {}
        var total = 0;
        _that.add = function () {
          $('#ui_revision').hide();
          gui = $('<div style="color: white;display: block;font-size: 10px;font-weight: bold;line-height: 14px;padding: 0 4px 0 0; position: absolute;right: 0;text-align: right;text-shadow: 1px 1px 1px black;width: auto;z-index: 15;"/>');
          total = stack.length;
          $('#user-interface').append(gui);
        };
        _that.del = function () {
          var c = 0;
          for ( var key in failed ) {
            c++;
          };
          if ( c > 0 ) {
            if ( c = 1 ) {
              gui.html( 'ClothCalc Loader: ' + c + ' Module failed to load' );
            }
            else {
              gui.html( 'ClothCalc Loader: ' + c + ' Modules failed to load' );
            }
            gui.css({'color':'red','text-shadow': '1px 1px 1px white'});
          } 
          else {
            $('#ui_revision').show();
            gui.remove();
          }
        };
        _that.update = function () {
          var txt = 'ClothCalc Loader: ';
          if ( current !== false  ) {
            txt += current.txt;
          }
          txt += ' [' + String(total - stack.length) + '|' + total + ']';
          gui.html( txt );
        };
        return _that;
      })($);
      _self.stack = stack;
      _self.loaded = loaded;
      _self.failed = failed;
      _self.current = current;
      return _self;
    })($);
    Debugger.Loader = Loader;
    
  ///// complete ////////////////////////
  //
  //  Cache Object:   can store Data permanent into Browsers localStorage
  //  Init:           could be initialized at any time
  //  Methodes:       - load(key) // is used to load data
  //                      -> key: is the index
  //                  - save(key,data) // is used to store data
  //                      -> key: is the index
  //                      -> data: is the data to store
  //                  - reset() //delete stored data
  //
  ///////////////////////////////////////
    var Cache = (function ($) {
      var _self = {};
      var loader = {};
      var uid = '';
      var keys = {};
      var useKey = function (key) {
        if ( !keys[key] ) {
          keys[key] = true;
          _self.save('keys',keys);
        };
      };
      var init = function () {
        if ( loader.ready ) {
          return;
        };
        uid = 'twdb_' + Character.playerId + '_';
        keys = _self.load('keys');
        if ( !keys ) {
          keys = {'keys':true};
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Cache' , 'tw-db Cachesystem' , init );
      _self.load = function (key) {
        useKey(key);
        try {
          return $.parseJSON(decodeURIComponent(localStorage.getItem(uid+key)));
        } catch (e) {
          Error.report(e,'load ' + key + ' from cache');
          _self.save(key,null);
          return null;
        };
      };
      _self.save = function (key,data) {
        useKey(key);
        try {
          localStorage.setItem(uid+key,encodeURIComponent(JSON.stringify(data)));
          return true;
        } catch (e) {
          Error.report(e,'save ' + key + ' to cache');
          _self.save(key,null);
          return false;
        };
      };
      _self.reset = function ( confirm , type) {
        try {
          if ( confirm ) {
            if ( isDefined(type) ) {
              localStorage.removeItem(type);
            } else {
              for ( var key in keys ) {
                localStorage.removeItem(uid+key);
              };
            };
            new UserMessage( 'Reset Done, Site will now be reloaded' , UserMessage.TYPE_SUCCESS).show();
            location.href = location.href.replace(location.hash || '#','');
          }
          else {
            var div = $('<div><h2>#CACHE_RESET#</h2></div>');
            var input = new GameAPI.gui.textfield("twdb_cache_key").setSize(40).setLabel('Key:')
            div.append(input.getMainDiv());
            var checkbox = new GameAPI.gui.checkbox('all Keys').setSelected(true);
            checkbox.setCallback(function(state) {
              if(state) {
                input.setValue('');
              };
            });
            $(input.getMainDiv()).find('span').css('font-size','12px');
            $(input.getMainDiv()).find('input').keyup(function(){
                checkbox.setSelected(false);
            });
            div.append(($('<div style="display:block;" />').append(checkbox.getMainDiv())));
            new GameAPI.gui.dialog ('tw-db Cache Reset',div,GameAPI.gui.dialog.SYS_QUESTION).addButton('ok',function(){
              if(checkbox.isSelected()){
                _self.reset(true);
              } else {
                _self.reset(true,input.getValue());
              };
            }).addButton('cancel').show();
          };
        } catch (e) {
          Error.report(e,'cache reset');
        };
      };
      return _self;
    })($);
    _base.Cache = Cache;
    Debugger.Cache = Cache;
  
  ///// complete ////////////////////////
  //
  //  Worker Object:  working on performance heavy tasks without browser freeze
  //  Init:           no need for init
  //  Methodes:       - add ( todo ) // add something todo into the working stack
  //                      -> todo: function to run
  //
  ///////////////////////////////////////
    var Worker = (function ($) {
      var _self = {};
      var stack = [];
      var interval = false;
      var locked = false;
      _self.add = function ( todo ) {
        stack.push ( todo );
        if ( interval ) {
          return;
        };
        interval = w.setInterval(function(){work();}, 100);
      };
      var work = function ( ) {
        if ( locked ) {
          return;
        };
        locked = true;
        var todo = stack.shift();
        try {
          todo();
        } catch (e) {
          Error.report(e,'Worker');
        }
        if ( stack.length == 0 ) {
          w.clearInterval(interval);
          interval = false;
        }
        locked = false;
      };
      return _self;
    })($);
    Debugger.Worker = Worker;
  
  ///// complete ////////////////////////
  //
  //  Job Object:   Object that should handle all job relevant stuff
  //  Init:         should be loader after Cache Module
  //  Methodes:     - getJobByName(name)        -> get the Jobdata by the long Name of the Job
  //                - getJobByShortName(name)   -> get the Jobdata by the short Name of the Job
  //                - getJobById(id)            -> get the Jobdata by Id of the Job
  //                                              - drop rate is adjusted through char and pa bonus
  //
  //                - openJob(id,x,y)           -> open the Job Window
  //                - getAllJobs                -> return array of all jobs
  //                - startJob(id,x,y)          -> direct start the Job
  //                - isProduct(id)             -> checks if the given Item is a Job Product
  //                - getPopup(id,bonus)        -> get a popup for the given job (id), bonus is empty, silver or gold
  //
  ///////////////////////////////////////
    var Jobs = (function ($) {
      var _self = {};
      var loader = {};
      var AllJobs = [];
      var Name2Id = {};
      var Shortname2Id = {};
      var Products = [1828 , 1829 , 1830 , 2000 , 2003 , 2006 , 2009]; // uncut_ruby , uncut_emerald , uncut_diamond , habanero_chilis , cobra_fangs , cossack_saddle_blanket , gilded_cogs
      var construction;
      var jobdata = {};
      var cache = {}
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Eventer.set('TWDBdataLoaded', function(){ cache = {} } );

        var i = 0;
        var state = 0;
        var unique = {};
        while ( true ) {
          i++;
          var job = w.JobList.getJobById(i);
          if ( !job ) {
            state++;
            if ( state > 5 ) {
              break;
            };
            continue;
          };
          state = 0;
          AllJobs.push(job.id);
          Name2Id[(job.name).toLowerCase()] = job.id;
          Shortname2Id[(job.shortname).toLowerCase()] = job.id;
          for ( var key in job.yields ) {
            if ( isNaN(key) ) {
              continue;
            }
            if ( unique[key] ) {
              continue;
            };
            unique[key] = true;
            Products.push(Number(key));
          };
        };
        
        // hardcoded Costruction Job
          construction = (function ($) {
              var _self = {};
              _self.description = '';
              _self.duration = 1800;
              _self.energy = 6;
              _self.groupid = null;
              _self.id = 255;
              _self.malus = 0;
              _self.name  = '#CONSTRUCTION#';
              _self.randomyields = [];
              _self.shortname = 'construction';
              _self.skills = {'build':3,'repair':1,'leadership':1};
              _self.yields = {};
              _self.calcJobPoints = function (){return 0;};
              _self.canDo = function (){return true;};
              return _self;
            })($);
            AllJobs.push(255);
            Name2Id[(construction.name).toLowerCase()] = 255;
            Shortname2Id[(construction.shortname).toLowerCase()] = 255;
        // end hardcoded Construction Job

        var sortingFunc = function (x,y) {
          var job1 = x==255 ? construction : w.JobList.getJobById(x);
          var job2 = y==255 ? construction : w.JobList.getJobById(y);
          return job1.name > job2.name;
        };
        AllJobs.sort(sortingFunc);

        Products.sort();
        
        loader.ready = true;
      };
      loader = Loader.add ( 'Jobs' , 'tw-db Jobsystem' , init , {'Cache':true} );
      _self.getJobByName = function(name) {
        name = ($.trim(name)).toLowerCase();
        if ( !isDefined ( Name2Id[name] ) ) {
          return null;
        };
        return _self.getJobById(Name2Id[name]);
      };
      _self.getJobByShortname = function(name) {
        name = ($.trim(name)).toLowerCase();
        if ( !isDefined ( Shortname2Id[name] ) ) {
          return null;
        };
        return _self.getJobById(Shortname2Id[name]);
      };
      _self.getJobById = function ( id ) {
        if ( id == 255 ) {
          var job = construction;
        }
        else {
          var job = w.JobList.getJobById(id);
          if ( !job ) {
            return job;
          };
        };
        var data = $.extend(true, {}, job);

        var quote = 1;
        if ( w.Character.charClass == 'adventurer' ) {
          if (w.Premium.hasBonus('character')) {
            quote *= 1.2;
          }
          else {
            quote *= 1.1;
          };
        };
        if ( w.Premium.hasBonus('money') ) {
          quote *= 1.5;
        };
        for ( var i = 0 ; i < data.randomyields.length ; i++ ) {
          data.randomyields[i] = (data.randomyields[i]*quote).round(2);
        };
        if ( typeof(data.yields.length) == 'undefined' ) {
          for (  var itemid in data.yields ) {
            data.yields[itemid].prop = (data.yields[itemid].prop*quote).round(2);
          };
        };
        
        return data;
      };
      _self.openJob = function ( id , x , y ) {
        w.JobWindow.open( id , x , y );
      };
      _self.startJob = function ( id , x , y , duration ) {
        w.JobWindow.startJob( id , x , y , duration );
      };
      _self.getAllJobs = function() {
        return AllJobs;
      };
      _self.updateJobs = function ( ) {
        $.post('game.php?window=work&mode=index', {}, function(json){
          if (json.error) return new UserMessage(json.msg).show();
          jobdata = json.jobs;
          Eventer.trigger('JobsUpdated');
        } , 'json');
      };
      _self.isProduct = function( id ) {
        return $.inArray( Number(id), Products );
      };
      _self.getPopup = function( jobid , bonus ) {
        var div = '<div style="min-width:60px;text-align:center" >';
        var job = _self.getJobById ( jobid );
        if ( isDefined(job) ) {
          div += '<span style="font-weight:bold;display:block;">' + job.name + '</span>';
          div += '<div class="job" style="position:relative;left:50%;margin:10px -25px;"><div ' + (!isDefined(bonus)?'':'class="featured ' + bonus + '"') + '></div><img src="' + Game.cdnURL + '/images/jobs/' + job.shortname + '.png" class="job_icon" ></div>';
        };
        return div += '</div>';
      };
      _self.getPoints = function ( jobid , max ) {
        var job = _self.getJobById(jobid);
        if ( !isDefined(job) ) {
          return 0;
        };
        if ( isDefined(max) ) {
          var sum = 0;
          for ( var key in job.skills ) {
            sum += Number(job.skills[key]) * Number(CharacterSkills.skills[key].points);
          };
          sum += ClothCalc2.getClothPoins ( jobid );
          sum -= (job.malus + 1);
          return sum;
        }
        else {
          return job.calcJobPoints() - (job.malus + 1);
        }
      };
      _self.getExperience = function ( jobid , laborpoints ) {
        return 0;
      };
      _self.getWages = function ( jobid , laborpoints ) {
        return 0;
      };
      _self.getLuck = function ( jobid , laborpoints ) {
        return [0,0];
      };
      _self.getMotivation = function ( jobid , laborpoints ) {
        if ( isDefined(jobdata[jobid]) ) {
          return jobdata[jobid].motivation;
        }
        return 0;
      };
      _self.getItemsRatio = function ( jobid , laborpoints ) {
        return 0;
      };
      _self.getDanger = function ( jobid , laborpoints ) {
        return 0;
      };
      return _self;
    })($);
    _base.Jobs = Jobs;
    Debugger.Jobs = Jobs;
  
  ///// complete 2.03 ////////////////////////
  //
  //  Window Object:  handles Script Window
  //  Init:           could be initialized at any time
  //  Methodes:       - addTab(tab, name, title, callback ) -> adds a Tab into the Script Window, callback is the function which is called when this tab is clicked
  //                  - hideLoader() -> hides the Loader on the Script Window
  //
  ///////////////////////////////////////
    var Window = (function ($) {
      var _self = {};
      var uid = 'twdb_window';
      var wnd = null;
      var div = null;
      var tabs = {};
      var loader = {};
      var classes = [];
      var init = function () {
        if ( loader.ready ) {
          return;
        };
        var div = $('<div title="tw-db.info" class="menulink" />').css('background-image','url(' + Images.button + ')').mouseenter(function(){$(this).css('background-position','-25px 0px');}).mouseleave(function(){$(this).css('background-position','0px 0px');}).click(function(){show();});
        $('#ui_menubar').append($('<div class="ui_menucontainer" />').append(div).append('<div class="menucontainer_bottom" />'));
        ready = true;
        loader.ready = true;
      };
      loader = Loader.add ( 'Window' , 'tw-db Scriptwindow' , init );
      _self.open = function(tab) {
        show(tab);
      };
      var show = function(start) {
        wnd = GameAPI.wman.open(uid, null).setMiniTitle("tw-db.info").setTitle('tw-db.info');
        wnd.appendToContentPane($('<div style="width:100%;text-align:center;position:absolute;bottom:0px;left:0px;height:15px;display:block;font-size:12px;color:#000000;">.:powered by tw-db team:.&nbsp;|&nbsp;<a href="http://tw-db.info" style="font-weight:normal;color:#000000;" target="_blank">.:tw-db.info:.</a>&nbsp;|&nbsp;' + ( Script.version/100 + ' rev. ' + Script.revision) + '</div>'));
        wnd.appendToContentPane($('<div title=" tw-db support " style="width:19px;height:19px;position:absolute;bottom:-5px;right:5px;display:block;cursor:pointer;" />').append('<img src="' + Images.iconSupport + '" />').click(function(){Support.open();}));
        var first;
        for ( var tab in tabs ) {
          if ( !isDefined(first) ) {
            first = tab;
          }
          if ( start == tab ) {
            first = tab;
          }
          wnd.addTab(tabs[tab].name, tab, function(win,id){switchTab(id);} );
          tabs[tab].gui.children().remove();
          wnd.appendToContentPane(tabs[tab].gui);
        }
        if ( isDefined(first) ) {
          div = tabs[first].gui;
          switchTab(first);
        }
      };
      var switchTab = function(id) {
        div.hide();
        wnd.showLoader();
        var cl = null;
        while ( cl = classes.pop() ) {
          wnd.removeClass(cl);
        }
        wnd.activateTab(id);
        if( !isDefined(tabs[id]) ) {
          return;
        }
        if ( tabs[id].title != '' ) {
          wnd.setTitle('tw-db.info ' + tabs[id].title);
        } else {
          wnd.setTitle('');
        }
        div = tabs[id].gui;
        div.show();
        w.setTimeout(tabs[id].callback,10);
      };
      _self.addClass = function ( cl ) {
        wnd.addClass(cl);
        classes.push(cl);
        return _self;
      };
      _self.setTitle = function ( title ) {
        wnd.setTitle( 'tw-db.info ' + title );
        return _self;
      };
      _self.addTab = function(tab, name, title, callback ) {
        tabs[tab]={title:title,name:name,callback:callback,gui:null};
        tabs[tab].gui = $('<div style="margin-top:10px;width:100%;height:100%;"/>').hide();
        return tabs[tab].gui;
      };
      _self.hideLoader = function ( ) {
        wnd.hideLoader();
      };
      return _self;
    })($);
    Debugger.Window = Window;
  
  ///// complete ////////////////////////
  //
  //  Support Object:   Support Window
  //  Init:             no need for init
  //  Methodes:         - addKey(key,data) // add data to support text
  //                        -> key: index
  //                        -> data: text
  //                    - open() // open the Support Window
  //
  ///////////////////////////////////////
    var Support = (function ($) {
      var _self = {};
      var uid = 'twdb_support';
      var keys = {};
      _self.addKey = function ( key , data ) {
        keys[key] = data;
      };
      _self.open = function ( ) {
        var head = $('<p style="margin:10px;">Please copy the text from below into a Private Messages (PM) on <a href="http://forum.the-west.net" target="_blank" title=" The West Forum (.net) " >The West Forum (.net)</a> to scoobydoo84 or petee and write some additional Informations what the Mistake is and what you\'ve done as it occur. Thanks!</p>');
        var box = $('<div style="margin:10px;"/>');
        var txt = '[CODE]';
        for ( var key in keys ) {
          txt += String(key) + "\n";
          txt += String(keys[key]) + "\n";
          txt += '----------' + "\n";
        };
        txt += '[/CODE]';
        box.append(new GameAPI.gui.textarea().setContent(txt).setWidth(600).setHeight(250).setReadonly().getMainDiv());
        GameAPI.wman.open(uid, null).setMiniTitle('tw-db.info Support').setTitle('tw-db.info Support').appendToContentPane(head).appendToContentPane(box);
      };
      return _self;
    })($);
    Debugger.Support = Support;
  
  ///// complete ////////////////////////
  //
  //  Timer Object:   protecting script for running into the Anti-DoS Protection of Inno
  //  Init:           no need for init
  //  Methodes:       - getTimeout // returns timeout beforr calling next ajax requests
  //
  ///////////////////////////////////////
    var Timer = (function ($) {
      var _self = {};
      var last = 0;
      var count = 0;
      var count2 = 0;
      _self.getTimeout = function ( ) {
        var now = new Date().getTime();
        if ( now - last < 2000 ) {
          count++;
        }
        else {
          count = 0;
        };
        if ( now - last < 60000 ) {
          count2++;
        }
        else {
          count2 = 0;
        }
        last = now;
        var time = 0;
        if ( count2 > 50 ) {
          time = 60000;
        };
        if ( count < 20 ) {
          return time + 200;
        }
        return time + 2000;
      };
      return _self;
    })($);
    Debugger.Timer = Timer;
  
  ///// complete ////////////////////////
  //
  //  Eventer Object:   offer Event Trigger System
  //  Init:             no need for init
  //  Methodes:         - set(name,call,count) // add an Event
  //                        -> name: eventname
  //                        -> call: function which is called as trigger action
  //                        -> count: how often this could be triggered
  //                        <- trigger id
  //                    - trigger (name) // trigger Event
  //                        -> name: eventname
  //                    - remove (name,id) // removes an Event
  //                        -> name: eventname
  //                        -> id: trigger id
  //
  ///////////////////////////////////////
    var Eventer = (function ($) {
      var _self = {};
      var events = {};
      _self.set = function (name,call,count) {
        if( !isDefined(events[name]) ) {
          events[name] = {};
        };
        if( !isDefined(count) ) {
          var count = false;
        };
        var id = Number(new Date().getTime());
        events[name][id]={'id':id,'call':call,'count':count};
        return id;
      };
      _self.trigger = function(name) {
        if( !isDefined(events[name]) ) {
          return;
        };
        var count = 0;
        for ( var key in events[name] ) {
          if( !isDefined(events[name][key].id) ) {
            continue;
          };
          w.setTimeout(events[name][key].call,10);
          if(events[name][key].count==false) {
            count++;
            continue;
          };
          events[name][key].count--;
          if(events[name][key].count>0) {
            count++;
            continue;
          };
        };
        if(count == 0){
          delete(events[name]);
        };
      };
      _self.remove = function (name,id) {
        if( !isDefined(events[name]) || !isDefined(events[name][id]) ) {
          return false;
        };
        delete(events[name][id]);
      };
      return _self;
    })($);
    _base.Eventer = Eventer;
    Debugger.Eventer = Eventer;
  
  ///// complete ////////////////////////
  //
  //  Calculation Object:   calc laborpoints for sets and items
  //  Init:                 could be initialized at any time
  //  Methodes:             - getSetBonusForJob(setname,count,jobid) // calculate the laborpoints for given set and job
  //                            -> setname: name of set
  //                            -> count: count of used set items
  //                            -> jobid: job
  //                            <- laborpoints
  //                        - getItemBonusForJob(itemid,jobid) // calculate the laborpoints for given item and job
  //                            -> itemid: item
  //                            -> jobid: job
  //                            <- laborpoints
  //
  ///////////////////////////////////////
    var Calc = (function ($) {
      var _self = {};
      var ready = false;
      var sets = {};
      var calced = {'sets':{},'items':{}};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        sets = TWDBData.sets;
        TWDBData.sets = null;
        delete(TWDBData.sets);
        loader.ready = true;
      };
      loader = Loader.add ( 'Calc' , 'tw-db Calculator' , init , {} );
      _self.getSetBonusForJob = function(setname,count,jobid) {
        if ( isDefined(calced.sets[setname]) && isDefined(calced.sets[setname][count]) && isDefined(calced.sets[setname][count][jobid]) ) {
          return calced.sets[setname][count][jobid];
        }
        try {
          return calcSetBonusForJob(setname,count,jobid);
        } catch (e) {
          Error.report(e,'calcSetBonusForJob (' + setname + ' ' + count + ' ' + jobid + ')');
        }
        return 0;
      };
      _self.getItemBonusForJob = function(itemid,jobid) {
        if ( isDefined(calced.items[itemid]) && isDefined(calced.items[itemid][jobid]) ) {
          return calced.items[itemid][jobid];
        }
        try {
          return calcItemBonusForJob(itemid,jobid);
        } catch (e) {
          Error.report(e,'calcItemBonusForJob (' + itemid + ' ' + jobid + ')');
        }
        return 0;
      };
      _self.isCached = function(itemid,jobid) {
        if ( isDefined(calced.items[itemid]) && isDefined(calced.items[itemid][jobid]) ) {
          return true;
        }
        else {
          return false;
        }
      };
      // calculate the laborpoints for given set and job
      var calcSetBonusForJob = function(setname,count,jobid) {
        if ( !isDefined(sets[setname]) || !isDefined(sets[setname][count]) ) {
          return 0;
        }
        if ( !isDefined(sets[setname]) ) {
          Error.report({message:'unknown set '+setname},'calcSetBonusForJob');
          return 0;
        }
        if ( !isDefined(sets[setname][count]) ) {
          return 0;
        }
        var boni = sets[setname][count];
        var job = Jobs.getJobById(jobid);
        if ( !job) {
          return 0;
        };
        var lp = 0;
        
        if ( isDefined(boni.jobs['all']) ) {
          lp += boni.jobs['all']
        };
        
        if ( isDefined(boni.jobs[jobid]) ) {
          lp += boni.jobs[jobid]
        };
        
        for ( var skill in job.skills ) {
          var c = job.skills[skill];
          if ( isDefined(boni.skills[_skill2id[skill]]) ) {
            lp += boni.skills[_skill2id[skill]] * c;
          }
        }
        if ( !isDefined(calced.sets[setname]) ) {
          calced.sets[setname] = {};
        }
        if ( !isDefined(calced.sets[setname][count]) ) {
          calced.sets[setname][count] = {};
        }
        calced.sets[setname][count][jobid] = lp;
        return lp;
      };
      // calculate the laborpoints for given item and job
      var calcItemBonusForJob = function(itemid,jobid) {
        var item = ItemManager.get(itemid);
        if ( !item) {
          return 0;
        };
        var boni = item.bonus;
        var job = Jobs.getJobById(jobid);
        if ( !job) {
          return 0;
        };
        var lp = 0;
        for ( var skill in job.skills ) {
          var count = job.skills[skill];
          var attr = _id2skill[parseInt(_skill2id[skill]/5)];
          if ( isDefined(boni.skills[skill]) ) {
            lp += boni.skills[skill] * count;
          }
          if ( isDefined(boni.attributes[attr]) ) {
            lp += boni.attributes[attr] * count;
          }
        }
        if ( !isDefined(calced.items[itemid]) ) {
          calced.items[itemid] = {};
        }
        calced.items[itemid][jobid] = lp;
        return lp;
      }
      return _self;
    })($);
    Debugger.Calc = Calc;
  
  ///// complete ////////////////////////
  //
  //  Importer Object:  adds the tw-db Import Tab into Script Window
  //  Init:             should be loader after Window Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var Importer = (function ($) {
      var _self = {};
      var loader = {};
      _self.div = null;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        _self.div = Window.addTab('importer','Importer','',function(){open();});
        loader.ready = true;
      };
      loader = Loader.add ( 'Importer' , 'tw-db Importersystem' , init , {'Window':true} );
      var open = function() {
        _self.div.children().remove();
        Window.hideLoader();
        $.getScript('http://' + Script.url +'/cache/js/sDoImport_' + Script.lang + '.js');
      };
      return _self;
    })($);
    _base.Importer = Importer;
    Debugger.Importer = Importer;
  
  ///// complete ////////////////////////
  //
  //  Settings Object:  handles the Script Settings
  //  Init:             should be loader after Window Module and Cache Module
  //  Methodes:         - get (key,defValue) // get stored settingsvalue
  //                        -> key: index
  //                        -> key: defaultValue
  //                        <- value
  //                    - set (key,data) // set a settingsvalue
  //                        -> key: index
  //                        -> data: new value
  //
  /////////////////////////////
    var Settings = (function ($) {
      var _self = {};
      var settings = {};
      var wnd = null;
      var loader = {};
      var categories = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        var tmp = Cache.load('settings');
        if ( typeof(tmp) == 'object' && tmp != null ) {
          settings = tmp;
        } else {
          settings = {};
        };
        wnd = Window.addTab('settings','#SETTINGS#','#SETTINGS#',open);
        _self.addOption( 'Items' , 'collector' , 0 , '#HELP_COLLECTOR#' ).addOption( 'Items' , 'jobBoniTooltip' , 0 , '#HELP_JOBBONI#' ).addOption( 'Items' , 'buyTip' , 0 , '#HELP_BUYTIP#' ).addOption( 'Items' , 'sellTip' , 0 , '#HELP_SELLTIP#' , '#SELLTIP_SETTINGS#' ).addOption( 'Items' , 'sellTip1' , 0 , '#HELP_SELLTIP1#' , '#SELLTIP_SETTINGS#' ).addOption( 'Items' , 'sellTip2' , 0 , '#HELP_SELLTIP2#' , '#SELLTIP_SETTINGS#' ).addOption( 'Items' , 'sellTip3' , 0 , '#HELP_SELLTIP3#' , '#SELLTIP_SETTINGS#' ).addOption( 'Items' , 'sellTip4' , 0 , '#HELP_SELLTIP4#' , '#SELLTIP_SETTINGS#' );
        
        _self.addOption( 'Misc' , 'chat', 0 ,'#HELP_CHAT#');
        _self.addOption( 'Misc' , 'notes', 0 ,'#SETTING_NOTES#');
        
        
        _self.addOption( 'Misc' , 'showbonusjobs', 0 ,'#HELP_SHOWBONUSJOBS#');
        _self.addOption( 'Misc' , 'showscrollto', 0 ,'#HELP_SCROLLTO#');
        _self.addOption( 'Misc' , 'fastskillchange', 0 ,'#HELP_FASTSKILLCHANGE#');
        _self.addOption( 'Misc' , 'fortrecruitment', 0 ,'#HELP_FORTRECRUITMENT#');
        _self.addOption( 'Misc' , 'enhancedfortrecruitment', 0 ,'#HELP_ENHANCEDFORTRECRUITMENT#');
        _self.addOption( 'Misc' , 'forumlastpage', 0 ,'#HELP_FORUMLASTPAGE#');
        _self.addOption( 'Misc' , 'forumnewthread', 0 ,'#HELP_FORUMNEWTHREAD#');
        _self.addOption( 'Misc' , 'duelmotivation', 0 ,'#HELP_DUELMOTIVATION#');
        _self.addOption( 'Misc' , 'autodeposit', 0 ,'#HELP_AUTODEPOSIT#');
        _self.addOption( 'Misc' , 'deposit', 0 ,'#HELP_DEPOSIT#');
        _self.addOption( 'Misc' , 'marketmap', 0 ,'#HELP_MARKETMAP#');
        _self.addOption( 'Misc' , 'marketreminder', 0 ,'#HELP_MARKETREMINDER#');

        
        loader.ready = true;
      };
      loader = Loader.add ( 'Settings' , 'tw-db Settingssystem' , init , {'Cache':true,'Window':true} );
      /*
      var open2 = function() {
        wnd.children().remove();
        var bodyscroll = new GameAPI.gui.scrollpane();
        $(bodyscroll.getMainDiv()).css('height','300px');
        wnd.append(bodyscroll.getMainDiv());
        var values = [
                        [0,'collector','#HELP_COLLECTOR#',false],
                        [0,'jobBoniTooltip','#HELP_JOBBONI#',false],
                        [0,'buyTip','#HELP_BUYTIP#',false],
                        [0,'sellTip','#HELP_SELLTIP#',false],
                        [0,'sellTip1','#HELP_SELLTIP1#','#SELLTIP_SETTINGS#'],
                        [0,'sellTip2','#HELP_SELLTIP2#','#SELLTIP_SETTINGS#'],
                        [0,'sellTip3','#HELP_SELLTIP3#','#SELLTIP_SETTINGS#'],
                        [0,'sellTip4','#HELP_SELLTIP4#','#SELLTIP_SETTINGS#'],
                        [0,'sellTip5','#HELP_SELLTIP5#','#SELLTIP_SETTINGS#'],
                        [0,'chat','#HELP_CHAT#',false],
                        [0,'notes','#SETTING_NOTES#',false],
                        [0,'questgroup','#HELP_QUESTGROUP#',false],
                        [0,'questwiki','#HELP_QUESTWIKI#',false],
                        [0,'questcancle','#HELP_QUESTCANCEL#',false],
                        [0,'showbonusjobs','#HELP_SHOWBONUSJOBS#',false],
                        [0,'showscrollto','#HELP_SCROLLTO#',false],
                        [0,'removetips','#HELP_REMOVETIPS#',false],
                        [0,'fastskillchange','#HELP_FASTSKILLCHANGE#',false],
                        [0,'fortrecruitment','#HELP_FORTRECRUITMENT#',false],
                        [0,'enhancedfortrecruitment','#HELP_ENHANCEDFORTRECRUITMENT#',false],
                        [0,'noworkqueuepa','#HELP_NOWORKQUEUEPA#',false],
                        [0,'forumlastpage','#HELP_FORUMLASTPAGE#',false],
                        [0,'forumnewthread','#HELP_FORUMNEWTHREAD#',false],
                        [0,'duelmotivation','#HELP_DUELMOTIVATION#',false],
                        [0,'autodeposit','#HELP_AUTODEPOSIT#',false],
                        [0,'deposit','#HELP_DEPOSIT#',false],
                        [0,'marketmap','#HELP_MARKETMAP#',false],
                        [0,'marketreminder','#HELP_MARKETREMINDER#',false],
                        [0,'chestanalyser','#HELP_CHESTANALYSER#',false],
                        [0,'directsleep','#HELP_DIRECTSLEEP#',false],
                      ];
        var tmp = {};
        var table = $('<table />');
        var group = {};
        for ( var i=0;i<values.length;i++) {
          var name = values[i][1];
          tmp[name] = _self.get(name);
          var row = $('<tr />');
          switch ( values[i][0] ) {
            case 0 : 
                var callback = function(name) { return function () {tmp[name]=!(tmp[name]);}}(name);
                var checkbox = new GameAPI.gui.checkbox('', (!tmp[name]?'':'tw2gui_checkbox_checked'),callback );
                row.append($('<td style="width:25px;" />').append(checkbox.getMainDiv()));
                break;
          };
          row.append('<td>' + values[i][2] + '</td>');
          if ( values[i][3] ) {
            if ( !isDefined(group[values[i][3]]) ) {
              group[values[i][3]] = [];
              table.append( $('<tr><td style="width:25px;cursor:pointer;font-weigth:bold;"></td><td style="cursor:pointer;font-weigth:bold;">' + values[i][3] + '</td></tr>').click(function(name) { return function(){
                  for ( var i = 0 ; i < group[name].length ; i++ ) {
                    $(group[name][i]).children().toggle();
                  };
                }}(values[i][3]))
              );
            }
            group[values[i][3]].push(row);
            row.children().hide();
          }
          table.append(row);
        };
        var combobox = new GameAPI.gui.combobox();
        combobox.addItem('left','#LEFT#').addItem('right','#RIGHT#').addItem('custom','#CUSTOM_POSITION#');
        combobox.select(String(settings['clothPos']));
        
        var row = $('<tr />').append($('<td colspan="2" />').append(combobox.getMainDiv()).append('<span>&nbsp;#HELP_POSITION#</span>'));
        table.append(row);
        var btn = new GameAPI.gui.button('#SAVE#', function () {
            switch (combobox.getValue()) {
              case 'left' : settings['clothPos'] = 'left'; break;
              case 'right' : settings['clothPos'] = 'right'; break;
              default : settings['clothPos'] = 'custom'; break;
            }
            save(tmp);
          });
        var res = $('<div style="width:100%;text-align:right;" />').append($('<img style="position:relative;top:-20px;cursor:pointer;" title=" reset local Storage" src="' + Images.iconReset + '" />').click(function(){Cache.reset();}));
        bodyscroll.appendContent(table);;
        wnd.append(btn.getMainDiv()).append(res);
        Window.hideLoader();
      };
      */
      var open = function ( ) {
        wnd.children().remove();
        Window.addClass('options');
        Window.addClass('tabbg');
        var menuGui = $('<ul class="submenu" />');
  
        var contentDiv = $('<div />');
        var contentScroll = new GameAPI.gui.scrollpane();
        $(contentScroll.getMainDiv()).css({'top':'0px','height':'295px'});
        
        var tmp = {};
        var divs = {};
        
        for ( var category in categories ) {
          var div = $('<div class="twdbsettings" />').hide();
          divs [ category ] = div;
          contentDiv.append(div);
          var button = new GameAPI.gui.button(category, function ( category ) { return function () {
            $('.twdbsettings', contentDiv).hide();
            divs [ category ].show();
            contentScroll.scrollToTop();
            Window.setTitle('#SETTINGS# - ' + category);
          } } (category) ).setWidth(190);
          menuGui.append($('<li />').append(button.getMainDiv()));
          
          var prev = '';
          for ( var group in categories [ category ] ) {
            if ( prev != group ) {
              prev = group;
              var groupframe = new GameAPI.gui.groupframe('');
              $(groupframe.getMainDiv()).width('485px');
              div.append(groupframe.getMainDiv());
            }
            for ( var name in categories [ category ] [ group ] ) {
              var option = categories [ category ] [ group ] [ name ];
              tmp[name] = _self.get(name);
              switch ( option.type ) {
                case 0 : 
                    var callback = function(name) { return function () {tmp[name]=!(tmp[name]);}}(name);
                    groupframe.appendToContentPane($((new GameAPI.gui.checkbox(option.desc, (!tmp[name]?'':'tw2gui_checkbox_checked'),callback )).getMainDiv()).css({'display':'block'}));
                    break;
              };
            }
          }
        }
        
          
        var bntDiv = $('<div style="position:absolute;bottom:20px;left:215px;display:block;" />').append((new GameAPI.gui.button('#SAVE#', function(){save(tmp);})).getMainDiv());
        var res = $('<div style="position:absolute;bottom:20px;right:5px;display:block;" />').append($('<img style="cursor:pointer;" title=" reset local Storage" src="' + Images.iconReset + '" />').click(function(){Cache.reset();}));

        
        
        wnd.append($('<div class="tabwrapper Options-settings subbed"/>').append(menuGui).append(contentScroll.appendContent(contentDiv).getMainDiv())).append(bntDiv).append(res);

        Window.hideLoader();

      
      }
      _self.get = function(key,defValue) {
        if (!isDefined(settings[key])) {
          _self.set(key,defValue);
          return defValue;
        };
        return settings[key];
      };
      _self.set = function(key,data) {
        settings[key] = data;
        Cache.save('settings',settings);
      };
      _self.addOption = function ( category , name , type , desc , group ) {
        if ( !isDefined( categories [ category ] ) ) {
          categories [ category ] = {};
        }
        var group = group || 'misc';
        if ( !isDefined( categories [ category ] [ group ] ) ) {
          categories [ category ] [ group ] = {};
        }
        categories [ category ] [ group ] [ name ] = { type : type , desc : desc } ;
        return _self;
      };
      var save = function(tmp) {
        for ( var key in tmp ) {
          settings[key] = tmp[key];
        };
        if ( Cache.save('settings',settings) ) {
          new UserMessage( '#SAVE_SUCCESSFUL#', UserMessage.TYPE_SUCCESS).show();
        } else {
          new UserMessage( '#SAVE_ERROR#' , UserMessage.TYPE_ERROR).show();
        };
      };
      return _self;
    })($);
    _base.Settings = Settings;
    Debugger.Settings = Settings;
  
  ///// complete ////////////////////////
  //
  //  Tools Object:   Object that handles Javascript Includes for several Import Script
  //  Init:           should be loader after Window Module
  //  Methodes:       
  //
  ///////////////////////////////////////
    var Tools = (function ($) {
      var _self = {};
      var loader = {};
      var dom;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        dom = Window.addTab('tools','Tools','',function(){open();});
        loader.ready = true;
      };
      loader = Loader.add ( 'Tools' , 'tw-db Toolsystem' , init , {'Window':true} );
      var open = function() {
        dom.children().remove();
        (new GameAPI.gui.button('open Tool',function(){
          w.open('http://' + Script.url + '/?strana=politic_map&world=' + location.hostname.split('.')[0]);
        })).appendTo(dom);
        var btn2 = new GameAPI.gui.button();
        btn2.setCaption("Alliance Import".escapeHTML()).click(function () {
          btn2.disable();
          $.getScript('http://' + Script.url +'/js/sDoAllianceImport.js');
        }).appendTo(dom);
        Window.hideLoader();
      };
      return _self;
    })($);
    Debugger.Tools = Tools;
  
  ///// complete ////////////////////////
  //
  //  Updater Object:   handle the Update Check for Script and the Release Notes
  //  Init:             should be loader after Window Module and Cache Module
  //  Methodes:         - query() // gets the update js snippet from tw-db
  //                    - check(ver, rev, uid) // is called through the snippet to check if update is needed
  //                        -> ver: version on tw-db server
  //                        -> rev: revision on tw-db server
  //                        -> uid: not used anymore
  //                    - wasUpdated() // returns true/false if script was updated or not until last script start
  //
  ///////////////////////////////////////
    var Updater = (function ($) {
      var _self = {};
      var loader = {};
      var div;
      var updated = false;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        div = Window.addTab('notes','Release Notes','Release Notes',function(){open();});
        if ( Cache.load('version') && ( Script.version + ' ' + Script.revision ) != Cache.load('version') ) {
          Cache.save('version',(Script.version + ' ' + Script.revision ));
          updated = true;
          var title = '#WAS_UPDATED#';
          var msg = '<div class="txcenter">#OPEN_RELEASENOTES#</div>';
          msg = msg.replace('=1=','<b>'+Script.name+'</b>');
          (new GameAPI.gui.dialog(title,msg,GameAPI.gui.dialog.SYS_WARNING)).addButton('yes',function(){Window.open('notes');}).addButton('no').show();
				};
        loader.ready = true;
      };
      loader = Loader.add ( 'Updater' , 'tw-db Updater' , init , {'Cache':true,'Window':true} );
      var update = function (ver, rev) {
        var title = '#NEED_UPDATE#';
        var msg = '<div class="txcenter">#MAKE_UPDATE#</div>';
        msg = msg.replace('=1=','<b>'+Script.name+'</b>');
        msg += '<div><br />current version: ' + (Script.version / 100) + ' revision ' + Script.revision + '<br />new version: ' + (ver / 100) + ' revision ' + rev + '</div>';
        var url = 'http://' + Script.update;
        if ($.browser.webkit) {
            url += '?' + Script.version + Script.revision;
        };
        var refresh = function () {
          try {
            location.href = url ;
          } catch (e){};
        };
        (new GameAPI.gui.dialog(title,msg,GameAPI.gui.dialog.SYS_WARNING)).addButton('ok', refresh).show();
      };
      _self.wasUpdated = function() {
        return updated;
      };
      var open = function () {
        div.children().remove();
        var bodyscroll = new GameAPI.gui.scrollpane();
        $(bodyscroll.getMainDiv()).css('height','335px');
        var hidden = false;
        for ( var i=0; i < Script.notes.length ; i++ ) {
          var head = $('<h3><a>Version ' + String(Script.notes[i].version/100) + '</a></h3>').css('border-bottom','1px solid #000000').click(function(){$(this).next().toggle();});
          var body = $('<div>'+Script.notes[i].notes+'</div>');
          bodyscroll.appendContent(head).appendContent(body);
          if (hidden) {
            body.hide();
          };
          hidden = true;
        };
        div.append(bodyscroll.getMainDiv());
        Window.hideLoader();
      };
      _self.query = function () {
        setTimeout(function(){$.getScript('http://' + Script.check + '?' + (new Date().getTime()));},500);
      };
      // never touch this without adjust serverside component
      _self.check = function (ver, rev, uid) {
        if ( Script.version != ver || Script.revision != rev ) {
          update(ver, rev);
        };
      };
      return _self;
    })($);
    _base.Updater = Updater;
    Debugger.Updater = Updater;
  
  ///// complete - 2.03////////////////////////
  //
  //  Sleep Object:   add Button for direct Access to Sleep Possibilities
  //  Init:           should be loader after Settings Module and Cache Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var Sleep = (function ($) {
      var _self = {};
      var btn = null;
      var forts = [];
      var tmp = [];
      var cache = {};
      var days = 1;
      var opened = false;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Settings.addOption( '#INTERFACE#' , 'directsleep', 0 ,'#HELP_DIRECTSLEEP#');
        if ( Settings.get('directsleep',true) ) {
					cache = Cache.load('barracks');
          if ( cache == null || typeof(cache) != 'object' ) {
            cache = {};
          };
          if ( Character.homeTown.town_id != 0 ) {
            addButton();
            getForts();
          };
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Sleep' , 'tw-db DirectSleep' , init , {'Cache':true,'Settings':true} );
      var addButton = function () {
        btn = GameInject.CharacterButton.add(Images.buttonSleep);
        btn.click(function(e) {
          if ( w.Character.homeTown.town_id != 0 && forts.length == 0 ) {
            sleepHotel();
          }
          else {
            createMenu(e);
          }
        }).addMousePopup('#SLEEP#');
      };
      var createMenu = function(e) {
        if ( forts.length == 0 ) {
          return;
        };
        var pos = Map.getLastPosition();
        pos.x = pos[0];
        pos.y = pos[1];
        for ( var i = 0 ; i < forts.length ; i++ ) {
          var fort = forts[i];
          fort.distance = w.Map.calcWayTime(pos,fort);
        };
        forts.sort(function(a, b){ return(a.distance==b.distance)?0:(a.distance>b.distance)?1:-1;});
        var selectbox = (new GameAPI.gui.selectbox(true)).addItem(0, '#HOTEL#&nbsp;' + w.Map.calcWayTime(pos,w.Character.homeTown).formatDuration()).addListener(function (key) {
            switch (key) {
                case 0:
                  sleepHotel();
                  break;
                default:
                  sleepFort(key);
                  break;
            }
        });
        for ( var i = 0 ; i < forts.length ; i++ ) {
          var fort = forts[i];
          if ( fort.stage != 0 ) {
            selectbox.addItem(fort.id, '#STAGE#&nbsp;' + fort.stage + '&nbsp;' + fort.distance.formatDuration() + '&nbsp;|&nbsp;' + fort.name);
          };
        };
        selectbox.show(e);
      };
      var sleepHotel = function () {
        Ajax.remoteCallMode("building_hotel", "get_data", {
            town_id: w.Character.homeTown.town_id
        }, function (resp) {
          if (resp.error) {
            new UserMessage(resp.error, UserMessage.TYPE_ERROR).show();
            return;
          };
          var room = '';
          for ( var key in resp.rooms ) {
            if ( resp.rooms[key].available ) {
              room = key;
            };
          };
          w.TaskQueue.add(new TaskSleep(w.Character.homeTown.town_id,room));
        });
      };
      var sleepFort = function (id) {
        if ( isDefined(cache[id]) ) {
          w.TaskQueue.add(new TaskFortSleep(id, cache[id].x, cache[id].y));
        }
      };
      var getForts = function ( ) {
        if ( w.Character.homeTown.alliance_id == 0 ) {
          return;
        };
        Ajax.remoteCallMode("alliance", "get_data", {
            alliance_id: w.Character.homeTown.alliance_id
        }, function (resp) {
          if (resp.error) {
            new UserMessage(resp.error, UserMessage.TYPE_ERROR).show();
            return;
          };
          tmp = resp.data.forts;
         if ( tmp.length > 0 ) {
            w.setTimeout(function(){ getFort(); }, Timer.getTimeout());
          };
        });
      };
      var getFort = function() {
        try {
          if ( tmp.length <= 0 ) {
            return;
          }
          var fort = tmp.pop();
          var id = fort.fort_id;
          if ( !isDefined(cache[id]) ) {
            cache[id] = { 'time' : 0 , 'stage' : 0 };
          };
          cache[id].id = id;
          cache[id].x = fort.x;
          cache[id].y = fort.y;
          cache[id].name = fort.name;
          cache[id].type = fort.type;

          if ( cache[id].stage != 5 && ( cache[id].time + ( 60 * 60 * 24 * days ) ) > (new Date().getTime()/1000) ) {
            forts.push(cache[id]);
            if ( tmp.length > 0 ) {
              w.setTimeout(function(){ getFort(); }, Timer.getTimeout());
            }
            else {
              Cache.save('barracks',cache);
            };
            return;
          };
          Ajax.remoteCallMode('fort_building_barracks', 'index', {
            fort_id: id
          }, function (resp) {
            if (resp.error) {
              new UserMessage(resp.error, UserMessage.TYPE_ERROR).show();
            } else {
              cache[id].time = Number(new Date().getTime()/1000).round(0);
              if ( isDefined(resp.barrackStage) ) {
                cache[id].stage = resp.barrackStage;
              }
            }
            forts.push(cache[id]);
            if ( tmp.length > 0 ) {
              w.setTimeout(function(){ getFort(); }, Timer.getTimeout());
            }
            else {
              Cache.save('barracks',cache);
            };
          });
        }
        catch (e) {
        	Error.report(e,'getFortData');
        }
      }
      return _self;
    })($);
    Debugger.Sleep = Sleep;
  
  ///// complete - 2.03 ////////////////////////
  //
  //  Analyser Object:  analyses Job and Duel (planned) Reports to create a Statistic
  //  Init:             should be loader after Settings, Cache and Jobs Module
  //  Methodes:         - restore() // restores the backupdata, which is created on initialion
  //
  ///////////////////////////////////////
  var Analyser = (function ($) {
      var _self = {};
      var ready = false;
      var statistic = null;
      var backup = null;
      var locked = false;
      var reports = [];
      var failedReports = [];
      var lastPage = 0;
      var gui = {};
      var sorting = {};
      _self.extra = false;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Settings.addOption( '#TOOLS#' , 'jobanalyser', 0 ,'#HELP_JOBANALYSER#');
        Settings.addOption( '#TOOLS#' , 'chestanalyser', 0 ,'#HELP_CHESTANALYSER#');

        var tmp = Cache.load('statistic');
        if ( typeof(tmp) == 'object' && tmp != null ) {
          statistic = tmp;
        } 
        else {
          reset('all',true);
        };
        
        if ( !statistic.ver ) {
          reset('all',true);
        }
        
        switch(statistic.ver) {
          case 1 :  reset('job',true,1);
                    reset('duel',true,1);
                    statistic.ver = 2;
          case 2 :  reset('job',true,1);
                    reset('duel',true,1);
                    statistic.ver = 3;
          case 3 :  reset('chest',true,1);
                    statistic.ver = 4;
        };
        
        backup = $.extend(true, {}, statistic);

        if ( Settings.get('jobanalyser',true) ) {
          GameInject.addTabOnMessagesWindow( '#JOBANALYSER#' , 'analyser-job' , function(){show('job');} );
        }

        if ( Settings.get('chestanalyser',true) ) {
          GameInject.ItemUse(Chest.add);
          GameInject.addTabOnMessagesWindow( '#CHESTANALYSER#' , 'analyser-chest' , function(){Chest.show();} );
        }
        
        loader.ready = true;
      };
      loader = Loader.add ( 'Analyser' , 'tw-db Job-Analyser' , init , {'Cache':true,'Settings':true,'Jobs':true} );
      _self.restore = function() {
        statistic = $.extend(true, {}, backup);
      };
      _self.debug = function() {
        console.log(statistic);
        console.log(sorting);
      };
      var reset = function(type , confirm , last) {
        if ( confirm == true ) {
          if ( !last ) {
            var last = 0;
          }
          else {
            var rep = /\[report=([0-9]+)([A-Fa-f0-9]{10})\]/;
            var matches = String(last).match(rep)
            if ( matches ) {
              var last = matches[1];
            };
          };
          
          if ( isNaN(parseInt(last)) ) {
            var id = 0;
          } 
          else {
            var id = parseInt(last)-1;
          };
          
          switch ( type ) {
            case 'job' : 
              statistic[type] = {'last':id,'items':{'last':0}};
              break;
            case 'duel' : 
              statistic[type] = {'last':id};
              break;
            case 'chest' : 
              statistic[type] = {};
              break;
            case 'all' : 
              statistic = {'ver':4};
              reset('job',true,id+1);
              reset('duel',true,id+1);
              reset('chest',true,id+1);
              break;
          };
        }
        else {
          var div = $('<div><h2>Do you really want to reset the ReportAnalyser statistics?</h2><span style="font-size:12px"><br />Give Report-Link of first Report which should be read after Reset</span></div>');
          var input = new GameAPI.gui.textfield("twdb_analyser_last").setSize(40);
          input.setLabel('Report-Link:');
          div.append(input.getMainDiv());
          var checkbox1 = new GameAPI.gui.checkbox('or use all reports&nbsp;&nbsp;');
          var checkbox2 = new GameAPI.gui.checkbox('or use only future reports');
          checkbox1.setCallback(function(state) {
            if(state) {
              checkbox2.setSelected(false);
              input.setValue('');
            };
          });
          checkbox2.setCallback(function(state) {
            if(state) {
              checkbox1.setSelected(false);
              input.setValue('');
            };
          });
          $(input.getMainDiv()).find('span').css('font-size','12px');
          $(input.getMainDiv()).find('input').keyup(function(){
              checkbox1.setSelected(false);
              checkbox2.setSelected(false);
          });
          
          div.append(($('<div style="display:block;" />').append(checkbox1.getMainDiv()).append(checkbox2.getMainDiv())));
          var Box = new GameAPI.gui.dialog ('ReportAnalyser - #RESET#',div);
          Box.addButton('ok',function(){
            if(checkbox1.isSelected()){
              reset(type,true);
            } else if (checkbox2.isSelected()) {
              reset(type,true,statistic[type].last+1);
            } else {
              reset(type,true,input.getValue());
            };
            Box.hide();
            MessagesWindow.open('analyser-'+type);
          });
          Box.addButton('cancel');
          Box.show();
        };
      };
      
      var Chest = (function ($) {
        var _that = {};
        _that.add = function ( item , data ) {
          var added = false;
          for (i = 0; i < data.msg.effects.length; i += 1) {
            var m = data.msg.effects[i];
            if ( m.type == 'lottery' || m.type == 'content' ) {
              if ( !isDefined(statistic.chest[item]) ) {
                statistic.chest[item] = {'count':0,'items':{}};
              }
              var stats = statistic.chest[item];
              if ( !added ) {
                stats.count++;
                added = true;
              };
              m.items.each(function (m) {
                if ( !isDefined(stats.items[m.item_id] ) ) {
                  stats.items[m.item_id] = 0;
                }
                stats.items[m.item_id] += m.count;
              });
            };
          };
          Cache.save('statistic',statistic);
        };
        _that.show = function () {
          if (!MessagesWindow.window) {
            return;
          };
          var gui = $(MessagesWindow.window.getContentPane()).find('.messages-analyser-chest');
          MessagesWindow.window.showLoader();
          gui.children().remove();
          var bodyscroll = new GameAPI.gui.scrollpane();
          $(bodyscroll.getMainDiv()).css('height','385px');
          gui.append(bodyscroll.getMainDiv());

          // 680 breite
          for ( var chest in statistic.chest ) {
            var stat = statistic.chest[chest];
            var item = new tw2widget.Item(ItemManager.get(chest) , 'item_inventory').setCount(stat.count);
            item.getImgEl().addClass('item_inventory_img');
            bodyscroll.appendContent( $('<div style="float:left;position:relative;height:61px;width:60px;margin:5px" />').append(item.getMainDiv()) );
            var count = 0;
            var div = $('<div style="float:left;position:relative;width:590px;margin:5px" />');
            for ( var itemid in stat.items ) {
              count++;
              var item = new tw2widget.Item(ItemManager.get(itemid) , 'item_inventory').setCount(stat.items[itemid]);
              item.getImgEl().addClass('item_inventory_img');
              div.append(item.getMainDiv());
            }
            div.css('height', (parseInt(count/10)+1)*61 + 'px');
            bodyscroll.appendContent('<div style="float:left;position:relative;width:10px;height:' + String((parseInt(count/10)+1)*61 + 10 ) + 'px;background: url(' + Game.cdnURL + '/images/window/report/devider_report.png) repeat-x scroll 0 0 transparent;" />');
            bodyscroll.appendContent( div );
            
            bodyscroll.appendContent('<div style="clear:both;position:relative;width:100%;height:10px;display:block;background: url(' + Game.cdnURL + '/images/window/dailyactivity/wood_devider_horiz.png) repeat-x scroll 0 0 transparent;" />');
          }
          
          
          MessagesWindow.window.hideLoader();
        };
        return _that;
      })($);
      
      
      
      // start Analyse Process
      var analyse = function (type) {
        if ( locked ) {
          return;
        };
        locked = true;
        reports = [];
        queryReports(type);
      };
      // query Report Overview Page from Server
      var queryReports = function (type,page) {
        if ( !page ) {
          page = 1;
        };
        lastPage = page;
        Ajax.remoteCall('reports', 'get_reports', {page: page,folder: type}, function (json) {readReports(type,json);});
      };
      // put Reports into Array, which are needed to analyse from Response of Report Overview Query
      var readReports = function (type,json) {
        var status = true;
        if(typeof(json.reports) != 'object' ) {
          json.reports = [];
          status = false;
        };
        if(typeof(json.page) == 'undefined' || lastPage != json.page) {
          json.reports = [];
          status = false;
        };
        for ( var i = 0 ; i < json.reports.length ; i++ ) {
          var report = json.reports[i];
          if ( report.report_id <= statistic[type].last ) {
            status = false;
            break;
          };
          reports.push({'id':report.report_id,'hash':report.hash,'type':type});
        };
        gui.bar.setMaxValue(reports.length);
        if ( status ) {
          window.setTimeout(function(){ queryReports(type,(lastPage+1)); }, Timer.getTimeout());
        } else {
          analyseReports(type);
        };
      };
      // Work on Report Array of to analysed Reports
      var analyseReports = function(type) {
        if ( reports.length > 0 ) {
          gui.bar.setValue(gui.bar.getValue()+1);
          queryReport(reports.pop());
        } else {
          Cache.save('statistic',statistic);
          locked = false;
          show(type,true);
        };
      };
      // query Report from Server
      var queryReport = function(report) {
        $.post('game.php?window=reports&mode=show_report',{'flash':null,'hash':report.hash,'report_id':report.id},function(json){readReport(report.type,json);},'json');
      };
      // work on Report-Query Response
      var readReport = function(type,json) {
        if ( !json || !json.report_id || !json.publishHash ) {
          new UserMessage( 'empty Server Response' , UserMessage.TYPE_ERROR).show();
          return false;
        };
        
        if( typeof(json.page) != 'string' || typeof(json.title) != 'string' || typeof(json.js) != 'string') {
          failedReports.push(json.report_id);
        }
        else {
          switch(type) {
            case 'job' : analyseJobReport(json); break;
            case 'duel' : analyseDuelReport(json); break;
          };
          statistic[type].last = json.report_id;
        };
        window.setTimeout(function(){ analyseReports(type); }, Timer.getTimeout());
      };
      // Analyser Duel Report
      var analyseDuelReport = function(json) {
      
      };
      // Analyser Job Report
      var analyseJobReport = function(json) {
        try { 
          data =  {
                    id:null,
                    hash:null,
                    job:null,
                    motivation:null,
                    duration:null,
                    wage:null,
                    bond:null,
                    experience:null,
                    injury:0,
                    killed:false,
                    date_received:null,
                    items:{},
                  };
          data.id = json.report_id;
          data.hash = json.publishHash;
          var job = Jobs.getJobByName(json.title.slice(json.title.indexOf(':')+1));
          if ( !job ) {
            failedReports.push(data.id);
            return false;
          };
          data.job = job.id;
          data.date_received = json.date_received;
          
          var tmp = $(json.page);
          tmp.find(".rp_row_jobdata").each(function(index) {
            var str = $.trim($(this).children('span:last-child').html());
            str = str.split('&nbsp;').join(' ');
            switch (index) {
              case 0 :	data.motivation = parseInt(str.slice(0,str.indexOf(' ')));
                        break;
              case 1 :	var tmp = str.replace('h',' * 3600 + '); 
                        tmp = tmp.replace('m',' * 60 + '); 
                        tmp = tmp.replace('s',' * 1 + ');
                        tmp += '0';
                        try {
                          data.duration = parseInt(eval(tmp));
                        }
                        catch (e) {
                          throw {message:"unrecognized time on report: " + str};
                        }
                        break;
              case 2 :	data.wage = parseInt(str.slice(str.indexOf(' ')+1));
                        break;
              case 3 :	data.bond = parseInt(str);
                        break;
              case 4 :	data.experience = parseInt(str.slice(0,str.indexOf(' ')));
                        break;
            };
          });
          tmp.find(".rp_hurtmessage_text").each(function() {
            var reg = new RegExp('[0-9]+');
            data.injury = Number(reg.exec($(this).html()));
          });
          tmp.find(".rp_row_killmessage").each(function() {
            data.killed = true;
          });
          
          var tmp = (json.js).split(';');
          $(tmp).each(function() {
            var reg = new RegExp(/\s*ItemManager\.get\(([0-9]+)\)\s*\)\.setCount\(([0-9]+)\)/m);
            var array = reg.exec(this);
            if ( array ) {
              data.items[Number(array[1])] = Number(array[2]);
            };
          });
          if ( !statistic.job[data.job] ) {
            statistic.job[data.job] =  { count:0 , products:{} };
          }
          var jobstats = statistic.job[data.job];
          jobstats.count++;
          
          if ( !jobstats[data.motivation] ) {
            jobstats[data.motivation] = {
                                          count:0,
                                          duration:0,
                                          wage:0,
                                          bond:0,
                                          experience:0,
                                          injury:{},
                                          killed:0,
                                          items:{},
                                          extraitems:{}
                                        };
          };
          var stats = jobstats[data.motivation];
          
          if ( !isDefined(stats.duration) ) {
            stats.duration = 0;
          }
          
          stats.count++;
          stats.duration += data.duration;
          stats.wage += data.wage;
          stats.bond += data.bond;
          stats.experience += data.experience;
          if ( !stats.injury[data.injury] ) {
            stats.injury[data.injury] = 0;
          };
          stats.injury[data.injury]++;
          if (data.killed) {
            stats.killed ++;
          };
          
          for ( var key in data.items ) {
            var id = Number(key);
            if ( id === 138 ) {
              if ( !isDefined(statistic.extra) ) {
                statistic.extra = {'count':0};
                _self.extra = true;
              };
              statistic.extra.count++;
              statistic.extra[statistic.extra.count] = data;
            }
            var count = data.items[id];
            var item = ItemManager.get(id);
            if ( Jobs.isProduct(id) !== -1  ) {
              if ( !jobstats.products[id] ) {
                jobstats.products[id] = {'last':0};
              };
              var tmp = jobstats.products[id];
              for ( var i = 0 ; i < count ; i++ ) {
                var last = jobstats.count - tmp.last
                tmp.last = jobstats.count;
                if ( !tmp[last] ) {
                  tmp[last] = 0;
                }
                tmp[last]++;
              };
            }
            else if ( item.price == 0 ) {
              if ( !stats.extraitems[id] ) {
                stats.extraitems[id] = 0;
              };
              stats.extraitems[id]++;
            }
            else {
              luck = true;
              if ( !stats.items[id] ) {
                stats.items[id] = 0;
              };
              stats.items[id]++;
            };
          };
        }
        catch (e) {
          failedReports.push(data.id);
          return false;
        };
      };
      // create the Content of ReportWindow
      var show = function(type,finish){
        if (!MessagesWindow.window) {
          return;
        };
        gui.window = $(MessagesWindow.window.getContentPane()).find('.messages-analyser-'+type);
        if( typeof(finish) == 'undefined' ){
          MessagesWindow.window.showLoader();
          gui.bar = new GameAPI.gui.progressbar(0,reports.length);
          gui.window.children().remove();
          gui.window.append(gui.bar.getMainDiv());
          analyse(type);
        } else {
          switch ( type ) {
            case 'job' : var div = showJobs();break;
            case 'duel' : var div = showDuels();break;
          };
          gui.window.children().remove();
          gui.window.append(div);
          sort();
          switchAvg();
          sort();
          MessagesWindow.window.hideLoader();
        };
      };
      // sort Table
      var sort = function(col){
        try {
          if ( typeof(col)!='undefined' ) {
            if ( sorting.type == col ) {
              sorting.ord *= -1;
            } else {
              sorting.ord = 1;
              sorting.type = col;
            };
          } else {
            var col = sorting.type;
          };
          var order = sorting.ord;
          var sortingFunc = function (x,y) {
            var d1 = $(x).find('.cell_'+col).html();
            var d2 = $(y).find('.cell_'+col).html()
            if ( Number(d1) == d1 ) {
              return (d1 * 1) > (d2 * 1) ? order : -order;
            }
            else {
              return d1 > d2 ? order : -order;
            };
          };
          
          gui.rows.sort(sortingFunc);
          for ( var i = 0 ; i < gui.rows.length ; i++ ) {
            gui.bodyscroll.appendContent(gui.rows[i])
          };
        }
        catch (e) {
          Error.report(e,'Analyser sort');
        };
      };
      // switch between absolute values and average values
      var switchAvg = function() {
        switch (sorting.avg) {
          case 'avg' : sorting.avg = 'sum'; break;
          case 'sum' : sorting.avg = 'avg'; break;
        };
        $(gui.window).find('div.row div').each(function(index) {
          var data = $(this).data(String(sorting.avg));
          var title = $(this).data(String(sorting.avg)+'-t');
          $(this).html(data).attr('title',title);
        });
      };
      // show the Job Statistic
      var showJobs = function() {
        sorting = {'ord':1,'type':0,'avg':'avg'};
        var table = $(
                            '<div class="fancytable">'
                            + '<div class="_bg tw2gui_bg_tl"></div>'
                            + '<div class="_bg tw2gui_bg_tr"></div>'
                            + '<div class="_bg tw2gui_bg_bl"></div>'
                            + '<div class="_bg tw2gui_bg_br"></div>'
                            + '<div class="trows">'
                              + '<div class="thead statics">'
                                + '<div class="row_head">'
                                  + '<div class="cell_0" style="width:91px; text-align:center;">'
                                    + '<span title="#NAME#" style="cursor:pointer, margin-bottom:3px;">'
                                      + '<img src="'+Images.iconName+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_1" style="width:50px; text-align:center;">'
                                    + '<span title="#COUNT#">'
                                      + '<img src="'+Images.iconCount+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_2" style="width:50px; text-align:center;">'
                                    + '<span title="#DURATION#">'
                                      + '<img src="'+Images.iconClock+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_3" style="width:50px; text-align:center;">'
                                    + '<span title="#EXPERIENCE#">'
                                      + '<img src="'+Images.iconExperience+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_4" style="width:50px; text-align:center;">'
                                    + '<span title="#WAGE#">'
                                      + '<img src="'+Images.iconDollar+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_5" style="width:50px; text-align:center;">'
                                    + '<span title="#BOND#">'
                                      + '<img src="'+Images.iconUpb+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_6" style="width:50px; text-align:center;">'
                                    + '<span title="#MOTIVATION#">'
                                      + '<img src="'+Images.iconMoti+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_7" style="width:50px; text-align:center;">'
                                    + '<span title="#DANGER#">'
                                      + '<img src="'+Images.iconDanger+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_8" style="width:50px; text-align:center;">'
                                    + '<span title="#KILLED#">'
                                      + '<img src="'+Images.iconKilled+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_9" style="width:50px; text-align:center;">'
                                    + '<span title="#PRODUCTS#">'
                                      + '<img src="'+Images.iconYield+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_10" style="width:50px; text-align:center;">'
                                    + '<span title="#ITEM#">'
                                      + '<img src="'+Images.iconItem+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_11" style="width:41px; text-align:center;">'
                                    + '<span title="#LUCK#">'
                                      + '<img src="'+Images.iconLuck+'" />'
                                    + '</span>'
                                  + '</div>'
                                  + '<div class="cell_12" style="width:20px; text-align:right;">'
                                    + '<span title="#RESET#">'
                                      + '<img src="'+Images.iconReset+'" />'
                                    + '</span>'
                                  + '</div>'
                                + '</div>'
                              + '</div>'
                              + '<div class="tbody">'
                                + '<div class="_bg tw2gui_bg_l"></div>'
                                + '<div class="_bg tw2gui_bg_r"></div>'
                              + '</div>'
                              + '<div class="tfoot statics">'
                                + '<div class="row row_foot"></div>'
                              + '</div>'
                            + '</div>'
                          + '</div>'
                        );
        table.find('.row_head').find('img').each(function(index){
          if ( index == 12 ) {
            $(this).click(function(){reset('job');});
          } else {
            $(this).click( function(col){ return function(){sort(col);}}(index));
          };
        });
        table.find('.row_head').find('img').css('cursor','pointer');

        var i = 0;
        var sum = {'jobs':0, 'count':0, 'duration':0, 'experience':0, 'wage':0, 'bond':0, 'motivation':0,'injury':0,'killed':0 ,'products':0,'items':0,'luck':0};
        var stats = statistic.job;
        var div = $();
        gui.rows=[];
        for ( var jobid in stats ) {
          var job = Jobs.getJobById(jobid);
          if ( !job ) {
            continue;
          };
          var row = { 'count':0, 'duration':0, 'experience':0, 'wage':0, 'bond':0, 'motivation':0 , 'injury':0, 'killed':0, 'products':0, 'items':0, 'luck':0};
          var data = stats[jobid];
          
          row.count = data.count;
          
          var targetQuote = 0;
          for ( var i = 0 ; i < job.randomyields.length ; i++ ) {
            targetQuote += job.randomyields[i];
          };
          if ( typeof(job.yields.length) == 'undefined' ) {
            for (  var itemid in job.yields ) {
              targetQuote += job.yields[itemid].prop;
            };
          };
          
          for ( var itemid in data.products ) {
            for ( var tmp in data.products[itemid] ) {
              if ( tmp == 'last' ) {
                continue;
              };
              var item = ItemManager.get(itemid);
              row.products += Number(data.products[itemid][tmp]);
              row.luck += Number(item.price * data.products[itemid][tmp]);
            };
          };
          
          for ( var moti in data ) {
            if ( moti == 'count' || moti == 'products' ) {
              continue;
            };
            var tmp = data[moti];
            row.motivation += (moti * tmp.count);
            row.bond += tmp.bond;
            row.duration = tmp.duration;
            row.experience += tmp.experience;
            for ( var injury in tmp.injury ) {
              row.injury += injury*tmp.injury[injury];
            };
            for ( var itemid in tmp.items ) {
              var item = ItemManager.get(itemid);
              row.items += Number(tmp.items[itemid]);
              row.luck += Number(item.price * tmp.items[itemid]);
            };
            row.killed += tmp.killed;
            row.wage += tmp.wage;
          };

          var dom = $('<div class="row row_' + i + '" />');
          
          var tmp = $('<div class="cell_0" style="width:91px; text-align:left;cursor:pointer;font-size:11px;" ></div>');
          tmp.data('sum',job.name);
          tmp.data('sum-t',job.name);
          tmp.data('avg',job.name);
          tmp.data('avg-t',job.name);
          dom.append(tmp);
          sum.jobs++;
          
          var tmp = $('<div class="cell_1" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.count);
          tmp.data('sum-t',row.count);
          tmp.data('avg',row.count);
          tmp.data('avg-t',row.count);
          dom.append(tmp);
          sum.count += row.count;
          
          var tmp = $('<div class="cell_2" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',(row.duration/3600).round(2));
          tmp.data('sum-t',String((row.duration/3600).round(2)) + ' #HOURS#');
          tmp.data('avg',(row.duration/(3600*row.count)).round(2));
          tmp.data('avg-t','&Oslash; ' + String((row.duration/(3600*row.count)).round(2)) + ' #HOURS#');
          dom.append(tmp);
          sum.duration += row.duration;
          
          var tmp = $('<div class="cell_3" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.experience);
          tmp.data('sum-t',String(row.experience));
          tmp.data('avg',(row.experience/row.count).round(2));
          tmp.data('avg-t','&Oslash; ' + String((row.experience/row.count).round(2)));
          dom.append(tmp);
          sum.experience += row.experience;
          
          var tmp = $('<div class="cell_4" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.wage);
          tmp.data('sum-t','$' + String(row.wage));
          tmp.data('avg',(row.wage/row.count).round(2));
          tmp.data('avg-t','&Oslash; $' + String((row.wage/row.count).round(2)));
          dom.append(tmp);
          sum.wage += row.wage;
          
          var tmp = $('<div class="cell_5" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.bond);
          tmp.data('sum-t',String(row.bond));
          tmp.data('avg',(((row.bond/row.count)*100).round(2)));
          tmp.data('avg-t','&Oslash; ' + String(((row.bond/row.count)*100).round(2)) + '%');
          dom.append(tmp);
          sum.bond += row.bond;
          
          var tmp = $('<div class="cell_6" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.motivation);
          tmp.data('sum-t',String(row.motivation) + '%');
          tmp.data('avg',(row.motivation/row.count).round(2));
          tmp.data('avg-t','&Oslash; ' + String((row.motivation/row.count).round(2)) + '%');
          dom.append(tmp);
          sum.motivation += row.motivation;
          
          var tmp = $('<div class="cell_7" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.injury);
          tmp.data('sum-t',String(row.injury));
          tmp.data('avg',(row.injury/row.count).round(2));
          tmp.data('avg-t','&Oslash; ' + String((row.injury/row.count).round(2)));
          dom.append(tmp);
          sum.injury += row.injury;
          
          var tmp = $('<div class="cell_8" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.killed);
          tmp.data('sum-t',String(row.killed));
          tmp.data('avg',(((row.killed/row.count)*100).round(2)));
          tmp.data('avg-t','&Oslash; ' + String(((row.killed/row.count)*100).round(2)) + '%');
          dom.append(tmp);
          sum.killed += row.killed;

          var tmp = $('<div class="cell_9" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.products);
          tmp.data('sum-t',String(row.products));
          tmp.data('avg',((row.products/row.count)*100).round(2));
          tmp.data('avg-t','&Oslash; ' + String(((row.products/row.count)*100).round(2)) + '% [' + (targetQuote*100) + '%]');
          dom.append(tmp);
          sum.products += row.products;
          
          var tmp = $('<div class="cell_10" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.items);
          tmp.data('sum-t',String(row.items));
          tmp.data('avg',((row.items/row.count)*100).round(2));
          tmp.data('avg-t','&Oslash; ' + String(((row.items/row.count)*100).round(2)) + '%');
          dom.append(tmp);
          sum.items += row.items;
          
          var tmp = $('<div class="cell_11" style="width:50px; text-align:center;cursor:pointer;" ></div>');
          tmp.data('sum',row.luck);
          tmp.data('sum-t','$' + String(row.luck));
          tmp.data('avg',(row.luck/row.count).round(2));
          tmp.data('avg-t','&Oslash; $' + String((row.luck/row.count).round(2)));
          dom.append(tmp);
          sum.luck += row.luck;
          
          gui.rows.push(dom);
          dom.click(function(){
            detail($(this).children('.cell_0').html());
          });

          i++;
        };
        gui.bodyscroll = new GameAPI.gui.scrollpane();
        $(gui.bodyscroll.getMainDiv()).css('height','300px');
        table.find('.tbody').append(gui.bodyscroll.getMainDiv());
        gui.footer = table.find('.row_foot');

        
        var tmp = $('<div class="cell_0" style="width:71px; text-align:center;" ></div>');
        tmp.data('sum',sum.jobs);
        tmp.data('sum-t',sum.jobs + ' #JOBS#');
        tmp.data('avg',sum.jobs);
        tmp.data('avg-t',sum.jobs + ' #JOBS#');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_0" style="width:20px; text-align:center;cursor:pointer;color:#444;" ></div>');
        tmp.mouseenter(function(){$(this).css('color','#888')}).mouseleave(function(){$(this).css('color','#444')});
        tmp.click(function(){switchAvg();});
        tmp.data('sum','&sum;');
        tmp.data('sum-t','#SWITCH# &Oslash;');
        tmp.data('avg','&Oslash;');
        tmp.data('avg-t','#SWITCH# &sum;');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_1" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.count);
        tmp.data('sum-t',sum.count);
        tmp.data('avg',sum.count);
        tmp.data('avg-t',sum.count);
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_2" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',(sum.duration/3600).round(2));
        tmp.data('sum-t',String((sum.duration/3600).round(2)) + '#HOURS#');
        tmp.data('avg',(sum.duration/(3600*sum.count)).round(2));
        tmp.data('avg-t','&Oslash; ' + String((sum.duration/(3600*sum.count)).round(2)) + '#HOURS#');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_3" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.experience);
        tmp.data('sum-t',String(sum.experience));
        tmp.data('avg',(sum.experience/sum.count).round(2));
        tmp.data('avg-t','&Oslash; ' + String((sum.experience/sum.count).round(2)));
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_4" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.wage);
        tmp.data('sum-t','$'+String(sum.wage));
        tmp.data('avg',(sum.wage/sum.count).round(2));
        tmp.data('avg-t','&Oslash; $' + String((sum.wage/sum.count).round(2)));
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_5" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.bond);
        tmp.data('sum-t',String(sum.bond));
        tmp.data('avg',(((sum.bond/sum.count)*100).round(2)));
        tmp.data('avg-t','&Oslash; ' + String(((sum.bond/sum.count)*100).round(2)) + '%');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_6" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.motivation);
        tmp.data('sum-t',String(sum.motivation) + '%');
        tmp.data('avg',(sum.motivation/sum.count).round(2));
        tmp.data('avg-t','&Oslash; ' + String((sum.motivation/sum.count).round(2)) + '%');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_7" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.injury);
        tmp.data('sum-t',String(sum.injury));
        tmp.data('avg',(sum.injury/sum.count).round(2));
        tmp.data('avg-t','&Oslash; ' + String((sum.injury/sum.count).round(2)));
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_8" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.killed);
        tmp.data('sum-t',String(sum.killed));
        tmp.data('avg',(((sum.killed/sum.count)*100).round(2)));
        tmp.data('avg-t','&Oslash; ' + String(((sum.killed/sum.count)*100).round(2)) + '%');
        gui.footer.append(tmp);

        var tmp = $('<div class="cell_9" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.products);
        tmp.data('sum-t',String(sum.products));
        tmp.data('avg',((sum.products/sum.count)*100).round(2));
        tmp.data('avg-t','&Oslash; ' + String(((sum.products/sum.count)*100).round(2)) + '%');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_10" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.items);
        tmp.data('sum-t',String(sum.items));
        tmp.data('avg',((sum.items/sum.count)*100).round(2));
        tmp.data('avg-t','&Oslash; ' + String(((sum.items/sum.count)*100).round(2)) + '%');
        gui.footer.append(tmp);
        
        var tmp = $('<div class="cell_11" style="width:50px; text-align:center;" ></div>');
        tmp.data('sum',sum.luck);
        tmp.data('sum-t','$' + String(sum.luck));
        tmp.data('avg',(sum.luck/sum.count).round(2));
        tmp.data('avg-t','&Oslash; $' + String((sum.luck/sum.count).round(2)));
        gui.footer.append(tmp);
        
        var div = $('<div style="margin: 0px 6px 0px 6px;width:680px;" />').append(table); 
        
        return div;
      };      
      // detailed JobReport
      var	detail = function (job) {
      };
      _self.getExtra = function ( ) {
        if ( isDefined(statistic.extra) ) {
          return statistic.extra;
        };
        return null;
      };

      return _self;
    })($);
    Debugger.Analyser = Analyser;
  
  ///// complete - 2.03 ////////////////////////
  //
  //  Notes Object:   save a notes, addsnew Notes Tab into Message Window
  //  Init:           should be loader after Settings Module and Cache Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var Notes = (function ($) {
      var _self = {};
      var win = null;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };

        if ( loader.ready ) {
          return;
        };
        if ( (Settings.get('notes',true)) ) {
          GameInject.addTabOnMessagesWindow( '#NOTES#' , 'notes' , function(){show();} );
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Notes' , 'tw-db Notes' , init , {'Cache':true,'Settings':true} );
      var show = function() {
        if (!w.MessagesWindow.window) {
          return;
        };
        win = $(w.MessagesWindow.window.getContentPane()).find('.messages-notes');
        win.css('width','680px').css('margin' , '0 auto').css('position' , 'relative').css('top' , '0');
        view(Cache.load('notes'));
      };
      var save = function ( txt ) {
        Cache.save('notes',txt);
        new UserMessage( '#SAVE_SUCCESSFUL#' , UserMessage.TYPE_SUCCESS).show();
      };
      var edit = function ( txt ) {
        win.children().remove();
        w.MessagesWindow.window.showLoader();
        var area = new GameAPI.gui.textarea().setWidth(660).setHeight(300).setContent(txt);
        win.append($('<div style="margin-left:8px" />').append(new GameAPI.gui.bbcodes(area).getMainDiv()))
           .append(area.getMainDiv())
           .append($('<div style="margin-left:8px" />').append(new GameAPI.gui.button("#SAVE#".escapeHTML(), function(){save(area.getContent());view(area.getContent());}).getMainDiv()).append(new GameAPI.gui.button("#PREVIEW#".escapeHTML(), function(){view(area.getContent());}).getMainDiv()));
        w.MessagesWindow.window.hideLoader();
      };
      var view = function ( txt ) {
        win.children().remove();
        var body = new GameAPI.gui.scrollpane();
        $(body.getMainDiv()).css('height','324px');
        $(body.getMainDiv()).find(".tw2gui_scrollpane_clipper_contentpane").addClass("selectable");
        win.append($('<div style="margin:8px" />').append(body.getMainDiv()))
           .append( $('<div style="margin-left:8px" />')
                                  .append(new GameAPI.gui.button("#SAVE#".escapeHTML(), function(){save(txt)}).getMainDiv())
                                  .append(new GameAPI.gui.button("#EDIT#".escapeHTML(), function(){edit(txt);}).getMainDiv())
                                );
        if ( txt ) {
          w.MessagesWindow.window.showLoader();
          Ajax.remoteCall("settings", "get_parsed_text", {
            text: txt
          }, function (resp) {
            body.appendContent(w.Game.TextHandler.parse(resp.parsed_text));
            w.MessagesWindow.window.hideLoader();
          });
        };
      };
      return _self;
    })($);
    Debugger.Notes = Notes;
  
  ///// complete - 2.03 ////////////////////////
  //
  //  Map Object:     Object that should handle all Map relevant stuff
  //  Init:           should be loader after Settings Module
  //  Methodes:       - getNearestJob(jobid) // returns a sorted array (nearest top) of all job positions
  //                      -> jobid: id of job 
  //                  - getLastPosition() // returns an array [x,y] with the latest character position, so it's including the task queue
  //                  - setMinimapJob(name) // select a job on minimap window
  //                      -> name: jobname to set on minimap
  //
  ///////////////////////////////////////
    var Map = (function ($) {
      var _self = {};
      var ready = false;
      var maxX = 181; // 181
      var maxY = 79; // 79;
      var curX = 0;
      var curY = 0;
      var JobPos = {};
      var bonusJobs = {};
      var interval = null;
      var timeout = null;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('showscrollto',true) ) {
          showScrollTo();
        }
        Ajax.get('map', 'get_minimap', {}, function (json) {
          if (json.error) {
            loader.failed = true;
            return (new UserMessage(json.msg)).show();
          }
          JobPos = json.job_groups;
          loader.ready = true;
        });
      };
      loader = Loader.add ( 'Map' , 'tw-db Map' , init , {'Settings':true} );
      _self.getNearestJob = function(id) {
        var job = JobList.getJobById(id);
        var tmp = JobPos[job.groupid];
        if ( !tmp ) {
          return [];
        };
        var list = [];
        var pos = _self.getLastPosition();
        for ( var i = 0 ; i < tmp.length ; i++ ) {
          var x = tmp[i][0] - pos[0];
          var y = tmp[i][1] - pos[1];
          var dist = Math.sqrt(x*x+y*y);
          var time = window.Map.calcWayTime({x:tmp[i][0],y:tmp[i][1]},{x:pos[0],y:pos[1]});
          var angle = Number(Math.atan( y / x ) * 180 / Math.PI).round(0);
          if ( x < 0 ) {
            angle -= 180;
          };
          list.push({dist:dist,time:time,x:tmp[i][0],y:tmp[i][1],angle:angle});
        };
        var sort = function(x,y) {
          return (x.dist * 1) > (y.dist * 1) ? 1 : -1;
        };
        list.sort(sort);
        return list;
      };
      _self.getLastPosition = function() {
        var x = Character.position.x;
        var y = Character.position.y;
        var queue = TaskQueue.queue;
        for ( var i = 0 ; i < queue.length ; i++ ) {
          var pos = queue[i].wayData;
          if ( pos.x ) {
            x = pos.x;
            y = pos.y;
          };
        };
        return [x,y];
      };
      _self.setMinimapJob = function(jobname) {
        if ( interval ) {
          window.clearInterval(timeout);
          window.clearInterval(interval);
        };
        var worker = function(job) {
          if ( !MinimapWindow.window || $(MinimapWindow.window.divMain).find('.tw2gui_jobsearch_string').length == 0 || !$(MinimapWindow.window.divMain).find('.tw2gui_jobsearch_string').is(':visible') ) {
            return;
          };
          window.clearInterval(interval);
          window.clearInterval(timeout);
          interval = null;
          timeout = null;
          MinimapWindow.resetSearchContext();
          $('input.tw2gui_jobsearch_string', MinimapWindow.DOM).val(job).keyup();
        };
        timeout = setInterval(function(){window.clearInterval(interval);window.clearInterval(timeout);interval=null;timeout=null;},300000);
        interval = setInterval(function(){worker(jobname)},200);
      };
      var getMap = function ( req ) {
        var load = false;
        var count = 0 ;
        var req = [];
        var x = curX;
        var y = curY;
        for ( var x = curX ; x <= maxX ; x++ ) {
          for ( var y = curY ; y <= maxY ; y++ ) {
            count++;
            req.push([x,y]);
            if ( count > 299 ) {
              load = true;
              break;
            };
          };
          if ( load ) {
            break;
          };
          curY = 0;
        };
        curX = x;
        curY = y+1;
        if ( req.length > 0 ) {
          window.Map.Data.Loader.load(req,function(){setTimeout(function(){_self.loadMap()},Timer.getTimeout());});
        }
      };
      _self.loadMap = function () {
        getMap();
      };
      var showScrollTo = function () {
        var inject = function ( ) {
          var dom = $('<div style="position:absolute;bottom:45px;left:5px;display:block:height:30px;" />');
          var x = new GameAPI.gui.textfield();
          var y = new GameAPI.gui.textfield();
          var orgX = '';
          var orgY = '';
          x.setWidth(45);
          y.setWidth(45).setMaxLength(5);
          var go = function() {
            var cordX = Number(x.getValue());
            var cordY = Number(y.getValue());
            window.Map.center(cordX,cordY);
            x.setValue('');
            y.setValue('');
          }
          $(x.getMainDiv()).find('input').keyup( function(e){window.setTimeout( function() {
            if ( e.ctrlKey && e.keyCode == 86 && !e.altKey) {
              var pattern = new RegExp("^([0-9]{1,5})([^0-9]+)([0-9]{1,5})$").exec($.trim(x.getValue()));
              if ( pattern ) {
                x.setValue(pattern[1]);
                y.setValue(pattern[3]);
                $(y.getMainDiv()).find('input').focus();
                orgX = x.getValue();
                orgY = y.getValue();
                return;
              }
              var pattern = new RegExp("^([0-9]{1,5})$").exec($.trim(x.getValue()));
              if ( pattern ) {
                x.setValue(pattern[1]);
                $(y.getMainDiv()).find('input').focus();
                orgX = x.getValue();
                return;
              }
              x.setValue(orgX);
            }
            if(e.keyCode==13){
              go();
              return;
            };
            if ( String($.trim(x.getValue())).length == 0 ) {
              orgX = x.getValue();
              return;
            }
            var pattern = new RegExp("^([0-9]{1,5})$").exec($.trim(x.getValue()));
            if ( pattern ) {
              x.setValue(pattern[1]);
              if ( String(pattern[1]).length == 5 ) {
                $(y.getMainDiv()).find('input').focus();
              }
              orgX = x.getValue();
              return;
            }
            x.setValue(orgX);            
          } , 100 )});
          $(y.getMainDiv()).find('input').keyup( function(e){window.setTimeout( function() {
            if ( e.ctrlKey && e.keyCode == 86 && !e.altKey) {
              var pattern = new RegExp("^([0-9]{1,5})$").exec($.trim(y.getValue()));
              if ( pattern ) {
                y.setValue(pattern[1]);
                $(y.getMainDiv()).find('input').focus();
                orgY = y.getValue();
                return;
              }
              y.setValue(orgY);
            }
            if(e.keyCode==13){
              go();
              return;
            };
            if ( String($.trim(y.getValue())).length == 0 ) {
              orgY = y.getValue();
              return;
            }
            var pattern = new RegExp("^([0-9]{1,5})$").exec($.trim(y.getValue()));
            if ( pattern ) {
              y.setValue(pattern[1]);
              if ( String(pattern[1]).length == 5 ) {
                $(y.getMainDiv()).find('input').focus();
              }
              orgY = y.getValue();
              return;
            }
            y.setValue(orgY);            
          } , 100 )});
          var button = new GameAPI.gui.button('Ok', function () { go() } , null , null , '#SCROLL_TO#');
          button.setWidth('50');
          var icon = $('<img title="#SHOW_COORDS#" src="'+Images.iconCount+'" style="cursor:pointer;opacity:0.5;position:relative;vertical-align:top;position:relative;top:6px;" />').click(function(){
            if ( $(this).css('opacity') == 1 ) {
              $(this).css('opacity','0.5');
              window.Map.hideCoords();
            }
            else {
              $(this).css('opacity','1');
              window.Map.showCoords();
            }
          });
          var span = $('<span style="position:relative;top:-5px" />').append(x.getMainDiv()).append('<span>|</span>').append(y.getMainDiv())
          dom.append(icon).append(span).append(button.getMainDiv());
          $(MinimapWindow.window.divMain).find('.minimap-right').append(dom);
        };
        GameInject.injectMinimap(function(){inject();});
      }
      return _self;
    })($);
    _base.Map = Map;
    Debugger.Map = Map;
  
  ///// complete - 2.03 ////////////////////////
  //
  //  Bonus Jobs:   the Bonus Job Feature
  //  Init:         should be loader after Settings, Cache and Jobs Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var BonusJobs = (function ($) {
      var _self = {};
      var bonusJobs = {};
      var loader = {};
      var bonus = {'gold':false,'silver':false};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( !Settings.get('showbonusjobs',true) ) {
          loader.ready = true;
          return;
        }
        bonusJobs = Cache.load('bonusjobs');
        if ( !isDefined(bonusJobs) ) {
          bonusJobs = {};
        };
        bonus = Cache.load('bonusdisplay');
        if ( !isDefined(bonus) ) {
          bonus = {'gold':false,'silver':false};
        };

        for (key in bonusJobs) {
          if (!bonusJobs.hasOwnProperty(key)) {
            continue;
          }
          var spot = bonusJobs[key];
          var count = 0;
          for ( var jobId in spot) {
            if (!spot.hasOwnProperty(jobId)) {
              continue;
            };
            if ( spot[jobId].gold ) {
              count++;
              continue;
            };
            var d = new Date();
            var tmp = new Date();
            tmp.setHours(2);
            tmp.setMinutes(15); 
            tmp.setSeconds(0); 
            tmp.setMilliseconds(0);
            var stamp = tmp.getTime()
            if ( d.getHours() < 2 || ( d.getHours() == 2 && d.getMinutes() < 15) ) {
              stamp -= 24 * 60 * 60 * 1000;
            };
            if ( spot[jobId].time > stamp ) {
              count++;
            }
            else {
              delete(spot[jobId]);
            }
          };
          if ( count == 0 ) {
            delete(bonusJobs[key]);
          }
        }
        injectBonusJobs();
        injectRadialmenu();          
        loader.ready = true;
      };
      loader = Loader.add ( 'BonusJobs' , 'tw-db BonusJobs' , init , {'Settings':true,'Cache':true,'Jobs':true} );
      var injectRadialmenu = function () {
        var inject = function(spot) {
        
          var pos = window.Map.Helper.getPosition(spot.parent);
          if ( !isDefined(pos) || !isDefined(pos.x) || !isDefined(pos.y) ) {
            return;
          };
          if ( !isDefined(window.Map.JobHandler.Featured[ pos.x + '-' + pos.y]) ) {
            if ( isDefined(bonusJobs[ pos.x + '-' + pos.y] ) ) {
              delete(bonusJobs[ pos.x + '-' + pos.y]);
              Cache.save('bonusjobs',bonusJobs);
            };
            return;
          };
          var spot = window.Map.JobHandler.Featured[ pos.x + '-' + pos.y];
          bonusJobs[pos.x + '-' + pos.y] = {};
          for ( var jobId in spot) {
            if (!spot.hasOwnProperty(jobId)) {
              continue;
            }
            bonusJobs[pos.x + '-' + pos.y][jobId] = spot[jobId];
            bonusJobs[pos.x + '-' + pos.y][jobId]['time'] = new Date().getTime();
          }
          Cache.save('bonusjobs',bonusJobs);
        };
        GameInject.injectRadialmenu(function(para){inject(para);});
      };
      var injectBonusJobs = function () {
        var inject = function ( ) {
          var dom = $('<div style="position:absolute;top:40px;right:10px;display:block:height:30px;" />')
            .append($('<input title="#HELP_GOLD#" type="checkbox" ' + (bonus.gold?'checked="checked"':'') + ' style="vertical-align:top;margin-left:5px;margin-right:5px;" />').change(function(){
                if($(this).attr('checked')){
                  bonus.gold = true;
                }
                else{
                  bonus.gold = false;
                };
                handleBonusJobs();
              }))
            .append('<div title="#HELP_GOLD#" style="position:relative;display:inline-block;height:9px;width:9px;background-color:yellow;border:1px solid red;margin:1px;"></div>')
            .append($('<input title="#HELP_SILVER#" type="checkbox" ' + (bonus.silver?'checked="checked"':'') + 'style="vertical-align:top;margin-left:5px;margin-right:5px;" />').change(function(){
                if($(this).attr('checked')){
                  bonus.silver = true;
                }
                else{
                  bonus.silver = false;
                };
                handleBonusJobs();
              }))
            .append('<div title="#HELP_SILVER#" style="position:relative;display:inline-block;height:9px;width:9px;background-color:white;border:1px solid black;margin:1px;"></div>')
            .append($('<img title="#BONUS_JOBS# #EXPORT#" style="margin-left:3px;cursor:pointer;position:relative;display:inline-block;height:16px;width:16px;vertical-align:top;top:-2px;" src="'+Images.iconExport+'" />').click(function(){exportBonusJobs();}))
            .append($('<img title="#BONUS_JOBS# #IMPORT#" style="margin-left:3px;cursor:pointer;position:relative;display:inline-block;height:16px;width:16px;vertical-align:top;top:-2px;" src="'+Images.iconImport+'" />').click(function(){importBonusJobs();}))
            .append($('<img title="#BONUS_JOBS# #RESET#" style="margin-left:3px;cursor:pointer;position:relative;display:inline-block;height:16px;width:16px;vertical-align:top;top:-2px;" src="'+Images.iconReset2+'" />').click(function(){reset();}));
            
          $(MinimapWindow.window.divMain).find('.minimap-right').append(dom);
          handleBonusJobs();
        };
        GameInject.injectMinimap(function(){inject();});
      };
      var handleBonusJobs = function () {
        Cache.save('bonusdisplay',bonus);
        $(MinimapWindow.window.divMain).find('#minimap_worldmap').find('.TWDBbonusjob').remove();
        var addMMP = function ( x , y , gold , count , popup ) {
          var c = 0.00513;
          var mx = parseInt(x*c)-3;
          var my = parseInt(y*c)+2;
          var rot = '';
          if ( count > 1 ) {
            rot = '-moz-transform:rotate(45deg);-webkit-transform:rotate(45deg);-o-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);';
          };
          var div = $('<div class="TWDBbonusjob" style="z-index:7;position:absolute;display:block;width:4px;height:4px;background-color:' + (gold?'yellow':'white') + ';left:' + mx + 'px;top:' + my + 'px;' + rot + 'border:1px solid ' + (gold?'red':'black') + ';" />')
            .click(function(x,y){return function(){window.Map.center(x,y);}}(x,y))
            .addMousePopup('<div style="min-width:60px;text-align:center">' + popup.join('<div class="marker_popup_divider"></div>') + '</div>');
          $(MinimapWindow.window.divMain).find('#minimap_worldmap').append(div);
        };
        var array = bonusJobs; 
        if ( Settings.get('scooby',false) ) {
          array = window.Map.JobHandler.Featured;
        }
        for (key in array) {
          if (!array.hasOwnProperty(key)) {
            continue;
          }
          var spot = array[key];
          var gold = false;
          var count = 0;
          var popup = [];
          
          for ( var jobId in spot) {
            if (!spot.hasOwnProperty(jobId)) {
              continue;
            }
            if (spot[jobId].gold) {
              if ( !bonus.gold) {
                continue;
              }
              gold = true;
              count++;
            }
            if (spot[jobId].silver) {
              if ( !bonus.silver) {
                continue;
              }
              count++;
            }
            var x = spot[jobId].x;
            var y = spot[jobId].y;
            job = JobList.getJobById(spot[jobId].job_id);
            popup.push(Jobs.getPopup(spot[jobId].job_id, (spot[jobId].gold?'gold':'silver')));
          };
          if ( count > 0 ) {
            addMMP( x , y , gold , count , popup );
          };
        };
      };
      var exportBonusJobs = function () {
        var list = [];
        for ( var key in bonusJobs ) {
          if (!bonusJobs.hasOwnProperty(key)) {
            continue;
          }
          var spot = bonusJobs[key];
          for ( var jobId in spot) {
            if (!spot.hasOwnProperty(jobId)) {
              continue;
            }
            var job = Jobs.getJobById(jobId);
            var country = Math.ceil(spot[jobId].x/6635) + (spot[jobId].y>10176?7:0);
            list.push({'name':job.name,'bonus':(spot[jobId].gold?'gold':'silver'),'country':country,'x':spot[jobId].x,'y':spot[jobId].y,'id':jobId});
          }
        }
        var area = $('<textarea />').css({'width':'500px','height':'200px','background-color':'transparent','border-width':'0px'}).click(function(){this.select()});
        var sortby = '';
        var order = 1;
        var doSort = function ( type ) {
          if ( sortby != type ) {
            sortby = type;
            order = 1;
          }
          else {
            order *= -1;
          }
          var sorting = function(a,b) {
            return a[sortby] > b[sortby] ? order : (-1*order);
          }
          list.sort(sorting);
          var txt = '';
          var country = '';
          for ( var i = 0 ; i < list.length ; i++ ) {
            var job = list[i];
            if ( sortby == 'country' && country != job.country ) {
              country = job.country;
              txt += '-- #COUNTRY# ' + country + ' --' + "\n";
            }
            txt += job.name + '; ' + job.bonus + '; ' + job.x + '-' + job.y + '; ' + job.id + "\n";
          };
          area.val(txt);
        };
        doSort('name');
        var bar = $('<div />').css({'width':'500px','height':'22px','position':'relative','display':'block'}).append($('<img src="' + Images.iconName + '" title=" #ORDER_NAME# "  style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){doSort('name');})).append($('<img src="' + Images.iconCount + '" title=" #ORDER_COUNTRY# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){doSort('country');}));
        new GameAPI.gui.dialog('#BONUS_JOBS# #EXPORT#',$('<div />').append(bar).append(area)).addButton('ok').show();
      }
      var importBonusJobs = function () {
        var area = $('<textarea />');
        area.css({'width':'400px','height':'100px'});
        var doimport = function () {
          var txt = area.val();
          var jobs = txt.split(/[\n,\r,\r\n]/);
          for ( var i = 0 ; i < jobs.length ; i++ ) {
            var parts = jobs[i].split(';',4);
            if ( parts.length != 4 ) {
              continue;
            };
            if ( Number(parts[3]) != parts[3] ) {
              continue;
            };
            if ( !Jobs.getJobById(Number(parts[3])) ) {
              continue;
            };
            var coords = String(parts[2]).split('-',2);
            if ( coords.length != 2 ) {
              continue;
            };
            if ( Number(coords[0]) != coords[0] || Number(coords[1]) != coords[1]) {
              continue;
            };
            var job = Jobs.getJobById(Number(parts[3]));
            var data =  { 'gold' : $.trim(parts[1]) == 'gold' ? true : false ,
                          'group_id' : job.groupid,
                          'job_id' : Number(parts[3]),
                          'silver' : $.trim(parts[1]) == 'gold' ? false : true ,
                          'x' : Number(coords[0]) ,
                          'y' : Number(coords[1]) , 
                          'time' : new Date().getTime()
                        }
            var cord = Number(coords[0]) + '-' + Number(coords[1]);
            if ( !isDefined(bonusJobs[cord]) ) {
              bonusJobs[cord] = {}
            }
            bonusJobs[cord][Number(parts[3])] = data
          }
          Cache.save('bonusjobs',bonusJobs);
          handleBonusJobs();
        }
        new GameAPI.gui.dialog('#BONUS_JOBS# #IMPORT#',area).addButton('ok',doimport).addButton('cancel').show();
      }
      var reset = function( confirm ) {
        try {
          if ( confirm ) {
            for ( var key in bonusJobs ) {
              if (!bonusJobs.hasOwnProperty(key)) {
                continue;
              }
              var spot = bonusJobs[key];
              var count = 0;
              for ( var jobId in spot) {
                if (!spot.hasOwnProperty(jobId)) {
                  continue;
                }
                if ( confirm == 'gold' && spot[jobId].gold ) {
                  count++;
                  continue;
                }
                if ( confirm == 'silver' && spot[jobId].silver ) {
                  count++;
                  continue;
                }
                delete(spot[jobId]);
              }
              if ( count == 0 ) {
                delete(bonusJobs[key]);
              }
            }
            Cache.save('bonusjobs',bonusJobs);
            handleBonusJobs();
            new UserMessage( '#BONUS_JOBS# #RESET#', UserMessage.TYPE_SUCCESS).show();
          }
          else {
            var title = 'tw-db #BONUS_JOBS# #RESET#';
            var msg = '<div class="txcenter">#BONUS_JOBS# #RESET#</div>';
            (new GameAPI.gui.dialog(title,msg,GameAPI.gui.dialog.SYS_QUESTION)).addButton('#ALL#', function(){reset('all');}).addButton('#GOLD#', function(){reset('silver');}).addButton('#SILVER#', function(){reset('gold');}).addButton('cancel').show();
          };
        } catch (e) {
          Error.report(e,'bonusjob reset');
        };
        
      }
      return _self;
    })($);  
    Debugger.BonusJobs = BonusJobs;
  
  ///// complete - 2.03 ////////////////////////
  //
  //  Chat Object:  manipulates Chat with Smilies Menu and Color Menu
  //  Init:         should be loader after Settings and Cache Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var Chat = (function ($) {
      var _self = {};
      var ready = false;
      var sm = {
        ":/": "sore",
        "=:)": "invader",
        ">:(": "angry",
        ":'(": "cry",
        ":)": "smile",
        ":D": "grin",
        ":(": "frown",
        ";)": "smirk",
        ":P": "tongue",
        ":o": "ohmy",
        ":x": "muted",
        ":\|": "silent",
        ">.<": "palm",
        "-.-": "nc",
        "o.O": "oo",
        "O.o": "oo",
        "^_^": "happy",
        "o_O": "oo",
        "x.x": "xx",
        "T.T": "cry",
        "el pollo diablo!": "elpollodiablo",
        "!el pollo diablo": "elpollodiablo_mirror",
        "el pollo diablo?!": "elpollodiablo_front"
      };
      var history = [];
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( (Settings.get('chat',true)) ) {
          GameInject.ChatLayout(function(chat){inject(chat);});
          GameInject.ChatSend(function(chat){send(chat);});
          var data = Cache.load('chathistory');
          if ( typeof(data) == 'object' && data != null ) {
            if ( data.color ) {
              data = data.color;
              Cache.save('chathistory',data);
            };
            history = data;
          };
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Chat' , 'tw-db Chat Enhancement' , init , {'Settings':true,'Cache':true} );
      var send = function(chat) {
        var val = chat.input.val();
        if ( !val ) {
          return;
        };
        var format = function(str) {
          if ( chat._caps ) {
            str = str.toUpperCase();
          };
          if ( chat._bold ) {
            str = str.replace(/\*/g, "~"); 
            str = '*' + str + '*';
          };
          return str;
        };
        if (val.substr(0, 1) == '/') {
          r = new RegExp("^\\/(tell|msg)\\s+([^:]+):(.+)$");
          v = val.match(r);
          if (v) {
            if ( chat._color ) {
              val = '/tell ' + v[2] + ':/' + chat._color + format(v[3]);
            } else {
              val = '/tell ' + v[2] + ':' + format(v[3]);
            };
          }
          chat.input.val(val);
          return;
        };
        val = format(val);
        if ( chat._color ) {
          val = '/' + chat._color + val;
        };
        chat.input.val(val);
        return;
      };
      var inject = function(chat) {
        var div = chat.mainDiv.find('.TWDBchat');
        if ( div.length == 0 ) {
          chat.mainDiv.find('.chat_input').find('.cbg').css('left', '38px').addClass('.TWDBchat');
          chat._color = null;
          chat._bold = false;
          chat._caps = false;
          injectSM(chat);
          injectColor(chat);
        }
      };
      var injectSM = function(chat) {
        var gui = $('<span style="padding:3px;display:none;width:160px;position:absolute;bottom:20px;left:-3px;" />');
        for ( var key in sm ) {
          gui.append($('<img src="' + Game.cdnURL+'/images/chat/emoticons/' + sm[key] + '.png?1" title="' + key + '" style="cursor:pointer;margin:1px;" />').click(
              function(key){ return function(){
                  chat.input.val( chat.input.val() + ' ' + key);
                  chat.input.focus();
                  gui.hide();
                }
              }(key)
            )
          );
        };
        var visible = false;
        chat.mainDiv.find('.chat_input').append(
          $('<div style="position:absolute;width:15px;height:15px;bottom:7px;vertical-align:top;left:23px;cursor:pointer;" />')
            .append($('<img style="vertical-align:top;" src="' + Images.iconChatSM + '" />'))
            .append(gui)
            .hover( 
              function(){visible=true;gui.show();} , 
              function(){visible=false;setTimeout(function(){if(!visible){gui.hide();}}, 200);} 
            )
        );
      };
      var fromRGB = function ( col ) {
        var tmp = col.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
        if ( tmp ) {
          return String(parseInt(tmp[1]*9/255+0.5)) + String(parseInt(tmp[2]*9/255+0.5)) + String(parseInt(tmp[3]*9/255+0.5));
        }
        else {
          return '000';
        };
      };
      var toRGB = function ( col ) {
        return 'rgb(' + parseInt(col[0]*255/9) + ',' + parseInt(col[1]*255/9) + ',' + parseInt(col[2]*255/9) + ')';
      };
      var transform = function ( chat , modifier ) {
        if ( isDefined(modifier.color) ) {
          var rgb = fromRGB(modifier.color);
          var j = history.length;
          for ( var i = 0; i < j ; i++ ) {
            var key = history.shift();
            if ( key != rgb ) {
              history.push(key);
            };
          };
          history.push(rgb);
          if ( history.length > 5 ) {
            history.shift();
          };
          Cache.save('chathistory',history);
          chat._color = rgb;
        };
        
        if ( modifier.color === null ) {
          chat._color = null;
        }
        
        if ( isDefined(modifier.bold) ) {
          chat._bold = modifier.bold;
        };
        
        if ( isDefined(modifier.caps) ) {
          chat._caps = modifier.caps;
        };
        
        if ( chat._bold ) {
          chat.mainDiv.find('.TWDBtext').css('font-weight','bold' );
        }
        else {
          chat.mainDiv.find('.TWDBtext').css('font-weight','normal' );
        }
        if ( chat._caps ) {
          chat.mainDiv.find('.TWDBtext').html('A');
        }
        else {
          chat.mainDiv.find('.TWDBtext').html('a');
        }
        
        if ( chat._color ) {
          chat.mainDiv.find('.TWDBcolor').children('div').children('div').css('background-color', toRGB(chat._color) );
          if ( chat._color[1] >=4 ) {
            chat.mainDiv.find('.TWDBtext').css('color', '#000');
          }
          else {
            chat.mainDiv.find('.TWDBtext').css('color', '#fff');
          }
        }
        else {
          chat.mainDiv.find('.TWDBcolor').children('div').children('div').css('background-color', '#e0e2e0');
          chat.mainDiv.find('.TWDBtext').css('color', '#000');
        }
        chat.input.focus();
      };
      var circle = function ( color ) {
        return  $('<div style="position:absolute;display:block;width:15px;height:15px;"/>')
                  .append($('<div style="position:absolute;width:15px;height:1px;top:7px;left:0px;background-color:' + color +';opacity:0.1;" />'))
                  .append($('<div style="position:absolute;width:1px;height:15px;top:0px;left:7px;background-color:' + color +';opacity:0.1;" />'))
                  
                  .append($('<div style="position:absolute;width:15px;height:3px;top:6px;left:0px;background-color:' + color +';opacity:0.33;" />'))
                  .append($('<div style="position:absolute;width:3px;height:15px;top:0px;left:6px;background-color:' + color +';opacity:0.33;" />'))

                  .append($('<div style="position:absolute;width:15px;height:5px;top:5px;left:0px;background-color:' + color +';opacity:0.47;" />'))
                  .append($('<div style="position:absolute;width:5px;height:15px;top:0px;left:5px;background-color:' + color +';opacity:0.47;" />'))
                  
                  .append($('<div style="position:absolute;width:13px;height:9px;top:3px;left:1px;background-color:' + color +';opacity:0.6;" />'))
                  .append($('<div style="position:absolute;width:9px;height:13px;top:1px;left:3px;background-color:' + color +';opacity:0.6;" />'))

                  .append($('<div style="position:absolute;width:11px;height:11px;top:2px;left:2px;background-color:' + color +';opacity:0.8;" />'))
                  
                  .append($('<div style="position:absolute;width:13px;height:7px;top:4px;left:1px;background-color:' + color +';" />'))
                  .append($('<div style="position:absolute;width:7px;height:13px;top:1px;left:4px;background-color:' + color +';" />'))
                  .append($('<div style="position:absolute;width:9px;height:11px;top:2px;left:3px;background-color:' + color +';" />'))
                  
                  .append($('<div style="position:absolute;width:11px;height:9px;top:3px;left:2px;background-color:' + color +';" />'))
      };
      var injectColor = function(chat) {
          try {
            var gui = $('<span style="position:relative;display:none;padding:3px;width:300px;position:absolute;bottom:17px;left:-5px;" />');
            gui.append('<div style="position:absolute;height: 50px; width:25;display:block" />');
            var colors = ['black','red','blue','yellow','green','brown','magenta','gray'];
            
            gui.append( $('<div style="display:inline-block;width:15px;height:15px;padding:2px;opacity:0.5;"/>')
                        .append(circle('#e0e2e0'))
                        .append($('<div style="position:absolute;width:15px;height:15px;" ><table border="0" cellspacing="0" cellpadding="0" style="padding:0px;margin:0px;border:0px;" ><tr><td style="display:block;width:15px;height:15px;vertical-align:top;text-align:center;font-size:11px;color:#000;font-weight:bold;">a</td></tr></table></div>'))
                        .click(function(){
                          if ( $(this).css('opacity') == 0.5 ) {
                            transform(chat,{bold:true});
                            $(this).css('opacity',1);
                          }
                          else {
                            transform(chat,{bold:false});
                            $(this).css('opacity',0.5);
                          }
                          gui.hide();
                        })
            );  
            
            gui.append( $('<div style="display:inline-block;width:15px;height:15px;padding:2px;opacity:0.5;"/>')
                        .append(circle('#e0e2e0'))
                        .append($('<div style="position:absolute;width:15px;height:15px;" ><table border="0" cellspacing="0" cellpadding="0" style="padding:0px;margin:0px;border:0px;" ><tr><td style="display:block;width:15px;height:15px;vertical-align:top;text-align:center;font-size:11px;color:#000;">A</td></tr></table></div>'))
                        .click(function(){
                          if ( $(this).css('opacity') == 0.5 ) {
                            transform(chat,{caps:true});
                            $(this).css('opacity',1);
                          }
                          else {
                            transform(chat,{caps:false});
                            $(this).css('opacity',0.5);
                          }
                          gui.hide();
                        })
            );  
            
            for ( var i = 0 ; i < colors.length ; i++ ) {
              gui.append(
                $('<div style="display:inline-block;width:15px;height:15px;padding:2px;"/>')
                  .append(circle(colors[i]))
                  .click(function(){
                    transform(chat,{color:($(this).children('div').children('div').css('background-color'))});
                    gui.hide();
                  })
              );
            };
            
            gui.append(
              $('<div style="margin:2px;display:inline-block;vertical-align:top;width:15px;height:15px;background:url(' + Images.iconChatNoColor + ')no-repeat 0px 0px transparent;"/>')
                .click(function(){
                  transform(chat,{color:null});
                  gui.hide();
                })
            );
            
            gui.append(
              $('<div style="margin:3px;display:inline-block;vertical-align:top;width:13px;height:13px;background:url(' + Images.iconChat + ')no-repeat 0px 0px transparent;"/>')
                .click(function(){
                  showColor(chat);
                  gui.hide();
                })
            );
            
            var visible = false;
            chat.mainDiv.find('.chat_input').append(
              $('<div class="TWDBcolor" style="position:absolute;width:15px;height:15px;bottom:7px;vertical-align:top;left:5px;cursor:pointer;" />')
                .append(circle('#e0e2e0'))
                .append($('<div style="position:absolute;width:15px;height:15px;" ><table border="0" cellspacing="0" cellpadding="0" style="padding:0px;margin:0px;border:0px;" ><tr><td class="TWDBtext" style="display:block;width:15px;height:15px;vertical-align:top;text-align:center;font-size:11px;color:#000;">a</td></tr></table></div>'))
                .append(gui)
                .hover( 
                  function(){visible=true;gui.show();} , 
                  function(){visible=false;setTimeout(function(){if(!visible){gui.hide();}}, 200);} 
                )
            );
          }
          catch (e) {
            Error.report(e,'injectColor');
          }
      };
      var showColor = function( chat ) {
        var el = chat.mainDiv.find('.TWDBcolor').children('div').children('div');
        var color = fromRGB(el.css('background-color'));
        
        // Color Result
          var gui = {};
          gui.customColor = $('<div style="width:50px;height:50px;display:inline-block;vertical-align:top;margin: 5px;" />');
          gui.customColor.css('background-color',toRGB(fromRGB(el.css('background-color'))));
        // End Color Result

        var switchColor = function(col,add){
          if ( ( add && color[col] == 9 ) || ( !add && color[col] == 0 ) ) {
            return;
          };
          var array = [ Number(color[0]) , Number(color[1]) , Number(color[2]) ];
          array[col] += add ? 1 : -1;
          color = String(array[0]) + String(array[1]) + String(array[2]);
          gui.input.val(color);
          if ( color[col] == 0 ) {
            gui.plusminus[col].children('.butMinus').css('opacity', 0.3);
          } else {
            gui.plusminus[col].children('.butMinus').css('opacity', 1);
          };
          if ( color[col] == 9 ) {
            gui.plusminus[col].children('.butPlus').css('opacity', 0.3);
          } else {
            gui.plusminus[col].children('.butPlus').css('opacity', 1);
          };
          gui.customColor.css('background-color',toRGB(color));
        };

        // Custom Color Input with input field
          var custom = $('<div style="width:42px;height:48px;display:inline-block;vertical-align:top;margin: 6px 5px 6px 5px;" />');
          gui.plusminus = [];
          for ( var i = 0; i<3 ; i++) {
            switch ( i ) {
              case 0: var rgb = '#f00';break;
              case 1: var rgb = '#0f0';break;
              case 2: var rgb = '#00f';break;
            }
            gui.plusminus[i] = $('<div class="tw2gui_plusminus" style="display:inline-block;background-color:' + rgb + ';width:12px;height:46px;padding:1px;"><span class="butPlus" style="cursor:pointer;"></span><span style="width:12px;height:10px;display:inline-block;"></span><span class="butMinus" style="cursor:pointer;"></span></div>');
            gui.plusminus[i].children('.butMinus').click(function(i){return function(){switchColor(i,false);}}(i));
            gui.plusminus[i].children('.butPlus').click(function(i){return function(){switchColor(i,true);}}(i));
            if ( color[i] == 0 ) {
              gui.plusminus[i].children('.butMinus').css('opacity', 0.3);
            };
            if ( color[i] == 9 ) {
              gui.plusminus[i].children('.butPlus').css('opacity', 0.3);
            };
            custom.append(gui.plusminus[i]);
          };
          custom.append(gui.plusminus[0]).append(gui.plusminus[1]).append(gui.plusminus[2]);
          
          
          gui.input = $('<input maxLength="3" type="text" value="' + color + '" style="position: relative; top: -35px; left: 2px;color: rgb(255, 255, 255); font-weight: bold; letter-spacing: 6px; text-shadow: 1px 1px 1px rgb(0, 0, 0); width: 43px; background: none repeat scroll 0pt 0pt transparent; border: medium none; height: 18px; line-height: 18px; margin: 0pt; outline: medium none;" />');
          gui.input.keyup(function(){
            var val = gui.input.val();
            if ( val.length < 3 ) {
              return;
            };
            if(!val.match(/(\d){3}/)){
              gui.input.val(color);
              return;
            };
            color = val;
            for ( var i = 0; i<3 ; i++) {
              if ( color[i] == 0 ) {
                gui.plusminus[i].children('.butMinus').css('opacity', 0.3);
              } else {
                gui.plusminus[i].children('.butMinus').css('opacity', 1);
              };
              if ( color[i] == 9 ) {
                gui.plusminus[i].children('.butPlus').css('opacity', 0.3);
              } else {
                gui.plusminus[i].children('.butPlus').css('opacity', 1);
              };
            };
            gui.customColor.css('background-color',toRGB(color));
            gui.input.attr('value',color);
          });
          custom.append(gui.input);
        // End Custom Color
        
        // Marker (bold, caps)
          var trans = {bold:chat._bold,caps:chat._caps};
          var mark = $('<div style="height:50px;display:inline-block;vertical-align:top;margin: 5px;" />');
          var checkbox = new GameAPI.gui.checkbox('*#BOLD#*', (trans.bold?'tw2gui_checkbox_checked':''),function(){trans.bold=trans.bold?false:true;});
          $(checkbox.getMainDiv()).css('display','block').css('margin-bottom','5px');
          mark.append(checkbox.getMainDiv());
          var checkbox = new GameAPI.gui.checkbox('#CAPITALIZE#', (trans.caps?'tw2gui_checkbox_checked':''),function(){trans.caps=trans.caps?false:true;});
          mark.append(checkbox.getMainDiv());
        // End Marker
        
        // Color History
          var hist = $('<div style="width:160px;height:50px;display:inline-block;vertical-align:top;border: 1px solid #000;padding: 0px;margin: 5px;" />');
          hist.append('<span style="width:140px;height:15px;display:inline-block;text-align:center;padding: 4px 0px 2px 0px;font-size:11px;">#HISTORY#</span>');
          
          for ( var i = 0 ; i < history.length; i++ ) {
            var col = $('<div style="width:20px;height:20px;display:inline-block;vertical-align:top;margin: 0px 0px 0px 10px;cursor:pointer;background-color:' + toRGB(history[i]) + ';" />');
            col.click(function(){transform(chat,{color:($(this).css('background-color')),bold:trans.bold,caps:trans.caps});gui.colorBox.hide();});
            hist.append(col);
          };
        // End Color History
        
        
        var dom = $('<div />').append(gui.customColor).append(custom).append(mark).append(hist);
        
        gui.colorBox = new GameAPI.gui.dialog ('#COLOR#',dom);
        gui.colorBox.addButton('ok',function(){transform(chat,{color:($(gui.customColor).css('background-color')),bold:trans.bold,caps:trans.caps});});
        gui.colorBox.addButton('cancel');
        gui.colorBox.show();
      };
      return _self;
    })(jQuery);
    Debugger.Chat = Chat;
  
  ///// complete ////////////////////////
  //
  //  sell Tip Object:  handles Information about Item should be sold or not
  //  Init:             should be loader after Settings and ClothCalc Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var SellTip = (function ($) {
      var _self = {};
      var ready = false;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('sellTip',true) ) {
          GameInject.injectItem('Inventory' , 'sellTip' , function(item){return getDiv(item);});
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'sellTip' , 'tw-db sellTip' , init , {'Settings':true,'ClothCalc':true} );
      var getDiv = function (el) {
        var id = el.obj.item_id
        var item = w.ItemManager.get(id);
        var sell = false;
        var title = '';
        
        if ( !item.sellable && !item.auctionable) {
          return;
        }
        
        /////
        // - doppelte Items -> 1
        // - nutzlose Items -> 2
        // - named Items behalten -> 3
        // - nicht kaufbare Items behalten -> 4
        // - set Items behalten -> 5

        if ( Settings.get('sellTip1',true) ) {
          var bagItem = w.Bag.getItemByItemId(item.item_id);
          var wearItem = w.Wear.wear[item.type];
          if (bagItem || (wearItem && wearItem.obj.item_id == item.item_id)) {
            var count = (bagItem != undefined ? bagItem.count : 0) + (wearItem != undefined && wearItem.obj.item_id == item.item_id ? 1 : 0);
            if ( count > 1 ) {
              sell = true;
              title = ('#DOUBLEITEM#').escapeHTML();
            };
          };
        };

        if ( Settings.get('sellTip2',true) && ClothCalc.isLoaded() ) {
          if ( !ClothCalc.isUsedItem(item.item_id) ) {
            sell = true;
            title = ('#NOTUSED#').escapeHTML();
          };
        };
              
        if ( Settings.get('sellTip3',true) ) {
          if ( item.named ) {
            sell = false;
          };
        };

        if ( Settings.get('sellTip4',true) ) {
          if ( item.traderlevel === null || item.traderlevel > 15 ) {
            sell = false;
          };
        };

        if ( Settings.get('sellTip5',true) ) {
          if ( item.set ) {
            sell = false;
          };
        };
        
        el.divMain.find('.TWDBsellTip').remove();
        if ( sell ) {
          el.divMain.append('<img src="' + Images.iconSell + '" class="TWDBsellTip" title="' + title + '" title=" #NOTATINV# " style="position:absolute;bottom:4px;right:0px;width:19px;height:19px;padding:0px;border:0px;margin:0px;" />');
        };
			};
      return _self;
    })($);
    Debugger.SellTip = SellTip;
  
  ///// complete ////////////////////////
  //
  //  Collector Object:   handle Collector Mode (own every Item)
  //  Init:               should be loader after Settings Module
  //  Methodes:
  //
  ///////////////////////////////////////
    var Collector = (function ($) {
      var _self = {};
      var ready = false;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('collector',true) ) {
          GameInject.injectItem('Trader' , 'collector' , function(item){return isNewItemTrader(item);});
          GameInject.injectItem('ItemTrader' , 'collector' , function(item){return isNewItemTrader(item);});
          GameInject.injectMarket('collector' , function(id){return isNewItemMarket(id);});
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Collector' , 'tw-db Collector' , init , {'Settings':true} );
      _self.isNewItem = function(id) {
        var count = 0;
        var item = w.ItemManager.get(id);
        var bagItem = w.Bag.getItemByItemId(item.item_id);
        var wearItem = w.Wear.wear[item.type];
        if (bagItem || (wearItem && wearItem.obj.item_id == item.item_id)) {
          count = (bagItem != undefined ? bagItem.count : 0) + (wearItem != undefined && wearItem.obj.item_id == item.item_id ? 1 : 0);
        };
        if ( count == 0 ) {
          return true;
        }
        else {
          return false;
        };
      };
      var isNewItemTrader = function(item) {
        item.divMain.find('.TWDBcollector').remove();
        if ( _self.isNewItem(item.obj.item_id) ) {
          item.divMain.append('<img src="' + Images.iconNew + '" class="TWDBcollector" title=" #NOTATINV# " style="position:absolute;top:-8px;left:-15px;padding:0px;border:0px;margin:0px;" />');
        }
      };
      var isNewItemMarket = function(id) {
        if ( _self.isNewItem(id) ) {
          return '<img src="' + Images.iconNew + '" class="TWDBcollector" title=" #NOTATINV# " style="width:18px;height:18px;position:relative;top:0px;left:0px;padding:0px;border:0px;margin:0px;" />'
        }
        else {
          return '';
        };
      };
      return _self;
    })($);
    Debugger.Collector = Collector;
  
  ///// complete ////////////////////////
  //
  //  Buy Tip Object:   handles Information about if an item on trader would give a better bonus than current best item
  //  Init:             should be loader after Settings, Cache, Collector, ClothCalc, Calc Module
  //  Methodes: 
  //
  ///////////////////////////////////////
    var BuyTip = (function ($) {
      var _self = {};
      var ready = false;
      var items = {};
      var counter = 0;
      var pipe = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('buyTip',true) ) {
          GameInject.injectItem('Trader' , 'buytip' , function(item){return inject(item,'trader');});
          GameInject.injectItem('ItemTrader' , 'buytip' , function(item){return inject(item,'trader');});
          GameInject.injectMarket('buytip' , function(item){return inject(item,'market');});
        };
        Eventer.set('TWDBdataLoaded', function(){_self.reset();});
        if ( !Updater.wasUpdated() ) { // load cache if version didn't not changed
          items = Cache.load('betteritems'); //load calcdata from cache 
          if ( items == null || typeof(items) != 'object' ) {
            items = {};
          };
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'BuyTip' , 'tw-db BuyTip' , init , {'Settings':true,'Cache':true,'Collector':true,'ClothCalc':true,'Calc':true} );
      _self.reset = function ( ) {
        items = {};
        Cache.save('betteritems',items);
      };
      var inject = function (el,type) {
        var id = type == 'market' ? el : el.obj.item_id;
        if ( !Collector.isNewItem(id) || ( isDefined(items[id]) && items[id].length == 0 ) ) {
          return '';
        };
        if ( type == 'market' ) {
          if ( isDefined(items[id]) ) {
            return getMarketDiv(id);
          }
          counter++;
          Worker.add( function(counter,id) {
              return function() {
                isBetterItem(id);
                var el = w.MarketWindow.DOM.find('#TWDBbuyTip' + counter);
                el.after(getMarketDiv(id));
                el.remove();
              };
            }(counter,id)
          );
          return '<span id="TWDBbuyTip' + counter + '" style="display:hidden" />';
        }
        
        if ( isDefined(items[id]) ) {
            el.divMain.find('.TWDBbuyTip').remove();
            el.divMain.append(getTraderDiv(id));
            return;
        }
        el.divMain.find('.TWDBbuyTip').remove();
        Worker.add( function(el,id) {
            return function() {
              isBetterItem(id);
              el.divMain.find('.TWDBbuyTip').remove();
              el.divMain.append(getTraderDiv(id));
            };
          }(el,id)
        );
      };      
      var isBetterItem = function (itemid) {
        if ( !ClothCalc.isLoaded() ) {
          return;
        };
        if ( !ClothCalc.isItemUsable(itemid,true) ) {
          return;
        };
        if ( isDefined(items[itemid]) ) {
          return;
        };
        items[itemid] = [];
        var item = ItemManager.get(itemid);
        var jobs = Jobs.getAllJobs();
        for ( var i = 0 ; i < jobs.length ; i++ ) {
          var jobid = jobs[i];
          var cloth = ClothCalc.getClothForJob(jobid);
          if ( !isDefined(cloth) ) {
            continue;
          }
          var bestap = 0;
          var newap = Calc.getItemBonusForJob(itemid,jobid);
          
          if ( isDefined(cloth[_type2id[item.type]]) ) {
            var best = ItemManager.get(cloth[_type2id[item.type]].id);
            bestap += Calc.getItemBonusForJob( best.item_id,jobid) ;
          }
          
          if ( (isDefined(best) && isDefined(best.set) ) || isDefined(item.set) ) {
            var set1 = (isDefined(best) && isDefined(best.set) ) ? best.set.key : null;
            var set2 = isDefined(item.set) ? item.set.key : null;
            var sets = {};
            sets[set1] = 0;
            sets[set2] = 0;
            for ( var slot in cloth ) {
              var tmp = ItemManager.get(cloth[slot].id);
              if ( !isDefined(tmp) ) {
                continue;
              }
              if ( tmp.set ) {
                if ( tmp.set.key == set1 ) {
                  sets[set1]++;
                };
                if ( tmp.set.key == set2 && set1 != set2 ) {
                  sets[set2]++;
                };
              };
            };
            if ( set1 ) {
              bestap += Calc.getSetBonusForJob(set1,sets[set1],jobid);
              bestap -= Calc.getSetBonusForJob(set1,sets[set1]-1,jobid);
            }
            if ( set2 ) {
              newap += Calc.getSetBonusForJob(set2,sets[set2],jobid);
              newap -= Calc.getSetBonusForJob(set2,sets[set2]-1,jobid);
            }
          }
          if ( newap > bestap ) {
            var lp = ClothCalc.getLPForJob(jobid);
            if ( isDefined(lp) ) {
              var sum = lp.sum - bestap + newap;
              items[itemid].push({job:jobid,newlp:sum,more:sum-lp.sum});
            }
            else {
              items[itemid].push({job:jobid,newlp:newap,more:newap});
            }
          }
        }
        Cache.save('betteritems',items);
      };
      var getMarketDiv = function ( id ) {
        if ( !isDefined(items[id]) ) {
          return '';
        }
        if ( items[id].length == 0 ) {
          return '';
        }
        pipe[id] = false;
        var popup = getPopup(id).escapeHTML();
        return '<img onload="$(this).next(\'.TWDBcollector\').remove();$(this).addMousePopup(\'' + popup + '\');" src="' + Images['iconStar'+(pipe[id]?'2':'')] + '" class="TWDBbuyTip" width="18px" height="18px" style="padding:0px;border:0px;margin:0px;" />';
      };
      var getTraderDiv = function ( id ) {
        if ( !isDefined(items[id]) ) {
          return;
        }
        if ( items[id].length == 0 ) {
          return;
        }
        
        pipe[id] = false;
        var popup = getPopup(id);
        return $('<img src="' + Images['iconStar'+(pipe[id]?'2':'')] + '" class="TWDBbuyTip" width="25px" height="25px" title=\'' + popup + '\' style="position:absolute;bottom:-8px;right:-5px;padding:0px;border:0px;margin:0px;" />');
      };
      var getPopup = function ( id ) {
        if ( !isDefined(items[id]) ) {
          return '';
        }
        var dom = '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr>';
        if ( !ClothCalc.isItemUsable(id) ) {
          var item = ItemManager.get(id);
          dom += '<td colspan=\"2\" style=\"text-align:center; font-weight:bold;\">' + item.level + ' #LEVEL#</td></tr><tr>';
        }
        for ( var i=0 ; i<items[id].length; i++ ) {
          var data = items[id][i];
          var job = Jobs.getJobById(data.job);
          var cell = '&nbsp;+' + data.more + ' ' + (job.name).escapeHTML() + ' [' + data.newlp + ']';
					if ( data.job == ClothCalc.getSelectedJob() ) {
						cell = '<b>' + cell + '</b>';
						pipe[id] = true;
					};
          
          if ( data.newlp < 0 ) {
            var color = '#FF0000'; //rot
          }
          else {
            if ( ( data.newlp - data.more ) < 0 ) {
              var color = '#0000FF'; //blau
            }
            else {
              var color = '#008000'; //grn
            }
          }
					dom += '<td style=\"color:' + color + ';\">' + cell + '</td>';
					if (i%2) {
						dom += '</tr><tr>';
					};
        }
				if (i%2) {
          dom += '<td></td></tr>';
				} else {
          dom = dom.substring(0,dom.length-4);
				};
				dom += '</table>';
        return dom;
      };
      return _self;
    })($);
    Debugger.BuyTip = BuyTip;
  
  ///// complete ////////////////////////
  //
  //  Laborpoint Information Object:  handles Information about loborpoint of an item for selected job
  //  Init:                           should be loader after Settings, Cache and Jobs Module
  //  Methodes: 
  //
  ///////////////////////////////////////
    var LpInfo = (function ($) {
      var _self = {};
      var ready = false;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('jobBoniTooltip',true) ) {
          GameInject.injectItem('Inventory' , 'lpInfo' , function(item){return inject(item);});
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'LpInfo' , 'tw-db LpInfo' , init , {'Settings':true,'Jobs':true,'Calc':true} );
      var inject = function (el) {
        el.divMain.find('.TWDBlpInfo').remove();
        var job = ClothCalc.getSelectedJob();
        if ( !isDefined(job) ) {
          return;
        };
        var id = el.obj.item_id;
        el.divMain.find('.TWDBlpInfo').remove();
        if ( Calc.isCached(id,job) ) {
          el.divMain.append(getDiv(id,job));
        }
        else {
          Worker.add( function(el,id,job) {
              return function() {
                el.divMain.find('.TWDBlpInfo').remove();
                el.divMain.append(getDiv(id,job));
              };
            }(el,id,job)
          );
        };
      };      
      var getDiv = function ( item, job ) {
        var lp = Calc.getItemBonusForJob(item,job);
        if ( lp <= 0 ) {
          return;
        }
        var job = Jobs.getJobById(job);
        return '<img src="' + Images.iconLaborpoints + '" title="+' + lp + ' ' + (job.name).escapeHTML() + '" class="TWDBlpInfo" style="position: absolute; top: 2px; right: 2px; width: 15px; height: 15px; border: 0px none; margin: 0px;"/>';
      };
      return _self;
    })($);
    Debugger.LpInfo = LpInfo;

  /////////////////////////////
  //
  //
  /////////////////////////////
    var Snippets = (function ($) {
      var _self = {};
      var timeout = null;
      var interval = null;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Settings.addOption( '#INTERFACE#' , 'noworkqueuepa', 0 ,'#HELP_NOWORKQUEUEPA#');
        Settings.addOption( '#INTERFACE#' , 'removetips', 0 ,'#HELP_REMOVETIPS#');
        Settings.addOption( '#INTERFACE#' , 'nocharbuffdiv', 0 ,'#HELP_NOCHARBUFFDIV#');
        trustTWDB();
        WestApi()
        if ( Settings.get('removetips',false) ) {
          removeTips();
        }
        if ( Settings.get('fastskillchange',true) ) {
          fastSkillChange();
        }
        if ( Settings.get('fortrecruitment',true) ) {
          activateFortRecruitment();
        }
        if ( Settings.get('noworkqueuepa',true) ) {
          removeWorkQueuePA();
        }
        if ( Settings.get('nocharbuffdiv',true) ) {
          removeCharClassBuff();
        }
        loader.ready = true;
      };
      loader = Loader.add ( 'Snippets' , 'tw-db Snippets' , init , {'Settings':true} );
      var trustTWDB = function() {
        try {
          var str = showlink.toString();
          str = str.replace('the-west','tw-db|the-west');
          str = str.replace('|com|','|com|info|');
          eval('showlink = ' + str);
        } catch (e) {
        
        };
      };
      var WestApi = function () {
        var inject = function ( ) {
          var wnd = null;
          if ( wnd = w.wman.getById('scripts') ) {
            $((wman.getById('scripts')).getMainDiv()).find('._tab_id_' + Script.uid).click()
          }
        }
        try {
          GameInject.TheWestApi(function(){inject()});
        } catch (e) {
        
        };
      }
      var fastSkillChange = function() {
        $("div.char_links.skills").click(function () {
          var attemptsLeft = 80,
            f = function () {
              if ($(".skills_content,.skills_content4Shaman").length != 2) {
                if (attemptsLeft-- <= 0 && interval != -1) {
                  clearInterval(interval);
                  interval = -1;
                }
              } else {
                $(".skills_content,.skills_content4Shaman").find(".butMinus,.butPlus").each(function () {
                  if ($(this).get(0).twdb_skills) return;
                  $(this).get(0).twdb_skills = true;

                  var i = 400,
                    timeout = -1,
                    button = $(this).css('cursor', 'pointer');

                  function timeh() {
                    i = Math.max(Math.round(i * (i / 200 + 1) / (i / 133 + 1)), 15);
                    button.click();
                    timeout = setTimeout(timeh, i);
                  }

                  function down() {
                    timeout = setTimeout(timeh, i);
                  }

                  function up() {
                    if (timeout != -1) {
                      clearTimeout(timeout);
                      timeout = -1;
                    }
                    i = 400;
                  }
                  button.mousedown(down).mouseup(up).mouseout(up);
                });
              }
            },
            interval = setInterval(f, 50);
        });	
      };      
      var removeTips = function ( ) {
        if ( !isDefined(WestUi.NotiBar) ) {
          return;
        }
        try {
          WestUi.NotiBar._add = WestUi.NotiBar.add;
          WestUi.NotiBar.add = function (entry) {
            try {
              if (!entry instanceof OnGoingEntry) {
                WestUi.NotiBar._add(entry);
              }
              if ( $(entry.element).find('.hint').length == 0 )  {
                WestUi.NotiBar._add(entry);
              } 
            }
            catch (e) {
              Error.report(e, 'handle WestUi.NotiBar.add');
              WestUi.NotiBar._add(entry);
            }
          }
          $('#ui_notibar').find('.hint').parent().click();
        }
        catch (e) {
          Error.report(e, 'manipulate WestUi.NotiBar.add');
        }
      }
      var removeWorkQueuePA = function ( ) {
        try {
          // remove PA Icon at Work Queue
          $('body').append('<style>#queuedTasks .buyPremiumTask {background: url("http://public.beta.the-west.net/images/transparent.png");}</style>');    
          // remove  Message Box with PA Question
          Premium.checkForAutomationPremium = function(){}; 
        }
        catch (e) {
          Error.report(e, 'manipulate WestUi.NotiBar.add');
        }
      }      
      var activateFortRecruitment = function() { 
        try {
          FortBattleWindow.getInfoArea = function () {
            var originalFunction = FortBattleWindow.getInfoArea;
            return function () {
              this.preBattle.battleData.canSetPrivilege = true;
              return originalFunction.bind(this)();
            };
          }();
        }
        catch (e) {
          Error.report(e, 'manipulate FortBattleWindow.getInfoArea');
        }
      };
      var removeCharClassBuff = function () {
        $('#buff_div_' + w.Character.charClass).hide();
      }
      return _self;
    })($);
    Debugger.Snippets = Snippets;

  /////////////////////////////
  //
  //  GameInject Object: through this Object should be done all Game Manipulation, like injects into Userinterface
  //  Methodes: - addTabOnMessagesWindow(name,shortname,callback)   -> adds a new tab to the messagewindow, callback the function which is called when the tab is clicked
  //            - injectItem(type,name,callback)                    -> adds a ui element to item divs, callback is function which gets the item element as parameter, name should be unique, type is the item type like Inventory or Trader
  //            - injectMarket(name,callback)                       -> adds a string into getClearName Function at Market, callback is function which returns a string, name should be unique
  //            - injectChatLayoutTab(name,callback)                -> adds function into every ChatLayoutTab which is automaticialy called on ChatLayoutTab init
  //            - ChatLayoutTabsend(name,callback)                  -> adds function into every send-Process at Chat
  //
  /////////////////////////////
    var GameInject = (function ($) {
      var _self = {};
      var save = {};
      var minimap = [];
      var questlog = [];
      var radialmenu = [];
      var quests = [];
      var ready = false;
      var timeout = null;
      var interval = null;
      var _duelmoti = [];
      var _position = [];
      var _reportreceived = [];
      _self.CharacterButton = (function ($) {
        var _that = {};
        var count = 0;
        var container = null;
        _that.add = function ( image ) {
          if ( count == 0 ) {
            container = $('<div style="width:35px;height:35px;position:absolute;left:141px;top:131px;background: url(' + Game.cdnURL + '/images/interface/character/character.png?3) no-repeat -141px -105px transparent;" />');
            $('#ui_character_container').prepend(container);
          };
          count++;
          container.css({
            'height': 10 + 26 * count + 'px',
            'background-position': '-141px ' + (26 * count - 131 ) + 'px', 
          });
          var bnt = $('<div class="char_links" style="top:' + ( 6 + ( count -1 ) * 26 ) + 'px;left:6px;background:url(' + image + ')no-repeat 0px 0px transparent;"/>');
          bnt.hover(function() { $(this).css('background-position','-25px 0px');}, function() {$(this).css('background-position','0px 0px');});
          container.append(bnt);
          return bnt;
        }
        return _that;
      })($);
      _self.ChatLayout = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            try {
              var org = window.Chat.Layout.Tab.prototype.getMainDiv;
              window.Chat.Layout.Tab.prototype.getMainDiv = function () {
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  try {
                    callbacks[i](this);
                  }
                  catch (e) {
                    Error.report(e, 'callbacks on Chat Layout');
                  };
                };
                return this.mainDiv;
              };
            }
            catch (e) {
              Error.report(e, 'manipulate Chat Layout');
            };
            callbacks.push(callback);
          };
        };
      })($);      
      _self.ChatSend = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            try {
              window.Chat.Layout.Tab.prototype._send = window.Chat.Layout.Tab.prototype.send;
              window.Chat.Layout.Tab.prototype.send = function () {
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  try {
                    callbacks[i](this);
                  }
                  catch (e) {
                    Error.report(e, 'callbacks on Chat Send');
                  };
                };
                this._send();
              };
            }
            catch (e) {
              Error.report(e, 'manipulate Chat Send');
            };
            callbacks.push(callback);
          };
        };
      })($);      
      _self.TheWestApi = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            try {
              var org = TheWestApi.open;
              TheWestApi.open = function ( ) {
                org();
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  try {
                    callbacks[i](this);
                  }
                  catch (e) {
                    Error.report(e, 'callbacks on TheWestApi');
                  };
                };
              }
            }
            catch (e) {
              Error.report(e, 'manipulate TheWestApi');
            };
            callbacks.push(callback);
          };
        };
      })($);      

      _self.MarketOfferTable = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            try {
              var org = MarketWindow.Offer.updateTable;
              MarketWindow.Offer.updateTable = function (data) {
                org(data);
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  try {
                    callbacks[i](data);
                  }
                  catch (e) {
                    Error.report(e, 'callbacks MarketOfferTable');
                  };
                };
              };
            }
            catch (e) {
              Error.report(e, 'manipulate MarketOfferTable');
            };
            callbacks.push(callback);
          };
        };
      })($);
      
      _self.MarketWatchlistTable = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            try {
              var org = MarketWindow.Watchlist.updateTable;
              MarketWindow.Watchlist.updateTable = function (data) {
                org(data);
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  try {
                    callbacks[i](data);
                  }
                  catch (e) {
                    Error.report(e, 'callbacks MarketWatchlistTable');
                  };
                };
              };
            }
            catch (e) {
              Error.report(e, 'manipulate MarketWatchlistTable');
            };
            callbacks.push(callback);
          };
        };
      })($);
      
      _self.ItemUse = (function ($) {
        var callbacks = [];
        return function ( callback ) {
          if ( callbacks.length == 0 ) {
            ItemUse.twdb = function ( item , data ) {
              try {
                for ( var i = 0 ; i < callbacks.length ; i++ ) {
                  callbacks[i]( item , data ) ;
                };
              }
              catch(e) {
                Error.report(e, 'callbacks on ItemUse');
              }
            }
            var org = ItemUse.doIt;
            try {
              var str = ItemUse.doIt.toString();
              var pos = str.indexOf("EventHandler.signal('item_used'");
              var inject = str.substr(0,pos) + 'ItemUse.twdb(itemId,res);' + str.substr(pos);
              eval('ItemUse.doIt = ' + inject);
            }
            catch (e) {
              ItemUse.doIt = org;
              Error.report(e, 'manipulate ItemUse');
            };
          };
          callbacks.push(callback);
        };
      })($);
      
      _self.injectSetDuelMotivation = function(callback) {
        try {
          if ( !window.Character._setDuelMotivation ) {
            window.Character._setDuelMotivation = window.Character.setDuelMotivation;
            window.Character.setDuelMotivation = function (data) {
              try {
                this._setDuelMotivation(data);
                for ( var i = 0 ; i < _duelmoti.length ; i++ ) {
                  _duelmoti[i](data);
                }
              }
              catch (e) {
                Error.report(e, 'Character.setDuelMotivation');
              };
            }
          };
        }
        catch (e) {
          Error.report(e, 'manipulate Character.setDuelMotivation');
        };
        _duelmoti.push(function(para){callback(para);});
      };
      
      _self.injectItem = function(type,name,callback) {
        var item = type+'Item';
        if ( typeof(save[item]) == 'undefined') {
          save[item] = tw2widget[item].prototype.getMainDiv.toString();
        };
        try {
          tw2widget[item].prototype['TWDB'+name] = function(item) {
            try {
              return callback(item);
            }
            catch (e) {
              Error.report(e, 'injected ' + item + ' function: ' + name);
            }
            return '';
          };
        } catch (e) {
          Error.report(e, 'inject ' + item + ' function: ' + name);
        };
        
        try {
          var inject =   'this.TWDB'+name+'(this);';
          inject.replace(/ /g,'');
          var newfunction = tw2widget[item].prototype.getMainDiv.toString().replace("return", inject + "\n return");
          eval('tw2widget[\''+item+'\'].prototype.getMainDiv = ' + newfunction);
        } catch(e) {
          Error.report(e,'manipulate ' + item + '.prototype.getMainDiv');
          eval(item+'.prototype.getMainDiv = ' + save[item]);
        };
      };
      
      _self.injectMarket = function(name,callback) {
        if ( typeof(save.MarketWindow) == 'undefined') {
          save.MarketWindow =  MarketWindow.getClearName.toString();
        };
        try {
          MarketWindow['TWDB'+name] = function(id) {
            try {
              return callback(id);
            }
            catch (e){
              Error.report(e, 'injected MarketWindow function:' + name);
            };
            return '';
          };
        } catch (e) {
          Error.report(e, 'inject MarketWindow function:' + name);
        };
        try {
          var str = MarketWindow.getClearName.toString();
          var inject =   'this.TWDB'+name+'(obj.item_id)'
          inject.replace(/ /g,'');
          var newfunction = '';
          while ( str.indexOf('return') != -1 ) {
            var pos = str.indexOf('return');
            newfunction += str.slice(0,pos+6) + ' ' + inject + ' + String(';
            str = str.substr(pos+7);
            var pos = str.indexOf(';');
            newfunction += str.slice(0,pos) + ');';
            str = str.substr(pos+1);
          };
          newfunction += str;
          eval('MarketWindow.getClearName = ' + newfunction);
        } catch(e) {
          Error.report(e,'manipulate MarketWindow.getClearName');
          eval('MarketWindow.getClearName = ' + save.MarketWindow);
        };
      };
      
      _self.addTabOnMessagesWindow = function(name,shortname,callback) {
        if (typeof (save.MessagesWindowOpen) == 'undefined') {
          save.MessagesWindowOpen = MessagesWindow.open.toString();
          save.MessagesWindowTab = MessagesWindow.showTab.toString();
        };
        try {
          var inject = 'MessagesWindow.window.addTab(\'' + name + '\', \'' + shortname + '\', tabclick).appendToContentPane($(\'<div class="messages-' + shortname + '"/>\'));';
          var newfunction = MessagesWindow.open.toString().replace(/MessagesWindow.Telegram.DOM/g, inject + 'MessagesWindow.Telegram.DOM');
          eval('(function ($) {' + 'MessagesWindow.open = ' + newfunction + '})(jQuery);');
        } catch (e) {
          Error.report(e, 'manipulate MessagesWindow.open');
          eval('(function ($) {' + 'MessagesWindow.open = ' + save.MessagesWindowOpen + '})(jQuery);');
        };
        try {
          MessagesWindow['TWDB-'+shortname] = function() {
            callback();
          };
        } catch (e) {
          Error.report(e, 'add showTab to MessagesWindow');
        };

        try {
          var inject = 'case \'' + shortname + '\':MessagesWindow[\'TWDB-' + shortname + '\']();break;';
          var newfunction = MessagesWindow.showTab.toString().replace(/switch(\s)*\(id\)(\s)*{/g, 'switch (id) { ' + inject);
          eval('(function ($) {' + 'MessagesWindow.showTab = ' + newfunction + '})(jQuery);;');
        } catch (e) {
          Error.report(e, 'manipulate MessagesWindow.showTab');
          eval('(function ($) {' + 'MessagesWindow.showTab = ' + save.MessagesWindowTab + '})(jQuery);');
        };
      };
      _self.addTabOnMarketWindow = function(name,shortname,callback) {
        var first = false;
        if (typeof (save.MarketWindowOpen) == 'undefined') {
          first = true;
          save.MarketWindowOpen = MarketWindow.open.toString();
          save.MarketWindowTab = MarketWindow.showTab.toString();
        };
        
        try {
          var inject = 'MarketWindow.window.addTab(\'' + name + '\', \'' + shortname + '\', tabclick).appendToContentPane($(\'<div class="marketplace-' + shortname + '"/>\'));';
          var newfunction = MarketWindow.open.toString().replace(/MarketWindow.DOM/, inject + 'MarketWindow.DOM');
          eval('(function ($) {' + 'MarketWindow.open = ' + newfunction + '})(jQuery);');
        } catch (e) {
          Error.report(e, 'manipulate MarketWindow.open');
          eval('(function ($) {' + 'MarketWindow.open = ' + save.MarketWindowOpen + '})(jQuery);');
        };
        
        try {
          MarketWindow['TWDB-'+shortname] = function() {
            callback();
          };
        } catch (e) {
          Error.report(e, 'add showTab to MarketWindow');
        };

        try {
          var inject = 'case \'' + shortname + '\':MarketWindow[\'TWDB-' + shortname + '\']();break;';
          var newfunction = MarketWindow.showTab.toString().replace(/switch(\s)*\(id\)(\s)*{/, 'switch (id) { ' + inject);
          eval('(function ($) {' + 'MarketWindow.showTab = ' + newfunction + '})(jQuery);;');
        } catch (e) {
          Error.report(e, 'manipulate MarketWindow.showTab (1)');
          eval('(function ($) {' + 'MarketWindow.showTab = ' + save.MarketWindowTab + '})(jQuery);');
        };
        
        if ( first ) {
          try {
            var inject = 'MarketWindow.window.setSize(748,471).removeClass(\'premium-buy\');';
            var newfunction = MarketWindow.showTab.toString().replace(/{/, '{' + inject);
            eval('(function ($) {' + 'MarketWindow.showTab = ' + newfunction + '})(jQuery);;');
          } catch (e) {
            Error.report(e, 'manipulate MarketWindow.showTab (2)');
            eval('(function ($) {' + 'MarketWindow.showTab = ' + save.MarketWindowTab + '})(jQuery);');
          };
        
        
        }
        
      };
      

      var waitForMinimap = function (array) {
        if ( interval ) {
          window.clearInterval(timeout);
          window.clearInterval(interval);
        };
        var worker = function() {
          if ( !MinimapWindow.window || $(MinimapWindow.window.divMain).find('.mmap_jobs').length == 0 ) {
            return;
          };
          if($(MinimapWindow.window).find('.loader').is(":visible")) {
            return;
          };
          window.clearInterval(timeout);
          window.clearInterval(interval);
          interval = null;
          timeout = null;
          for ( var i = 0 ; i < minimap.length ; i++ ) {
            try {
                minimap[i]();
            }
            catch (e) {
              Error.report(e, 'MinimapWindow inject');
            }
          }
        };
        timeout = setInterval(function(){window.clearInterval(interval);window.clearInterval(timeout);interval=null;timeout=null;},300000);
        interval = setInterval(function(){worker()},200);
      };
      _self.injectMinimap = function(callback) {
        try {
          if ( !MinimapWindow._open ) {
            MinimapWindow._open = MinimapWindow.open;
            MinimapWindow.open = function (searchterm) {
              try {
                MinimapWindow._open(searchterm);
                waitForMinimap()
              }
              catch (e) {
                Error.report(e, 'MinimapWindow.open');
              };
            }
          }
        }
        catch (e) {
          Error.report(e, 'manipulate MinimapWindow.open');
        };
        try {
          if ( !MinimapWindow._refreshWindow ) {
            MinimapWindow._refreshWindow = MinimapWindow.refreshWindow;
            MinimapWindow.refreshWindow = function () {
              try {
                MinimapWindow._refreshWindow();
                window.setTimeout(function(){waitForMinimap();}, 2500);
              }
              catch (e) {
                Error.report(e, 'MinimapWindow.refreshWindow');
              };
            }
          }
        }
        catch (e) {
          Error.report(e, 'manipulate MinimapWindow.refreshWindow');
        };
        minimap.push(function(){callback();});
      };
      _self.injectRadialmenu = function(callback) {
        try {
          if ( !window.Map.Radialmenu.prototype._open ) {
            window.Map.Radialmenu.prototype._open = window.Map.Radialmenu.prototype.open;
            window.Map.Radialmenu.prototype.open = function (noAnimation) {
              try {
                this._open(noAnimation);
                for ( var i = 0 ; i < radialmenu.length ; i++ ) {
                  radialmenu[i](this);
                }
              }
              catch (e) {
                Error.report(e, 'Radialmenu.open');
              };
            }
          };
        }
        catch (e) {
          Error.report(e, 'manipulate Radialmenu.open');
        };
        radialmenu.push(function(para){callback(para);});
      };
      _self.injectQuestLog = function(callback) {
        try {
          if ( !QuestEmployerView._buildQuestLog ) {
            QuestEmployerView._buildQuestLog = QuestEmployerView.buildQuestLog;
            QuestEmployerView.buildQuestLog = function (para) {
              try {
                QuestEmployerView._buildQuestLog(para);
                for ( var i = 0 ; i < questlog.length ; i++ ) {
                  questlog[i](para);
                }
              }
              catch (e) {
                Error.report(e, 'QuestEmployerView.buildQuestLog');
              };
            }
          }
          questlog.push(function(para){callback(para);});
        }
        catch (e) {
          Error.report(e, 'manipulate QuestEmployerView.buildQuestLog');
        };
      };
      _self.injectQuest = function(callback) {
        try {      
          if ( !Quest.prototype._render ) {
            Quest.prototype._render = Quest.render;
            Quest.prototype.render = function () {
              try {
                this._render();
                for ( var i = 0 ; i < quests.length ; i++ ) {
                  quests[i](this);
                }
              }
              catch (e) {
                Error.report(e, 'Quest.render');
              };
            }
          }
          quests.push(function(para){callback(para);});
        }
        catch (e) {
          Error.report(e, 'manipulate Quest.render');
        };
      };
      _self.injectReportReceivedEntry = function (callback) {
        try {
          if ( _reportreceived.length == 0 ) {
            try {
              var inject =   'this._TWDB(msg);';
              var newfunction = OnGoingReportReceivedEntry.toString().replace("{", "{\n" + inject + "\n");
              eval('OnGoingReportReceivedEntry = ' + newfunction);
              OnGoingReportReceivedEntry.prototype = new OnGoingEntry;
              OnGoingReportReceivedEntry.prototype._TWDB = function(msg){
                try {
                  for ( var i = 0 ; i < _reportreceived.length ; i++ ) {
                    _reportreceived[i](msg);
                  }
                }
                catch (e) {
                  Error.report(e, 'OnGoingReportReceivedEntry');
                };
              };
            } catch(e) {
              Error.report(e,'manipulate ' + item + '.prototype.getMainDiv');
              eval(item+'.prototype.getMainDiv = ' + save[item]);
            };
          };
        }
        catch (e) {
          Error.report(e, 'manipulate OnGoingReportReceivedEntry');
        };
        _reportreceived.push(function(para){callback(para);});
      };
      return _self;
    })($);
    Debugger.GameInject = GameInject;
  
  /////////////////////////////
  //
  //  DataManager Object: handles the Data-Download from tw-db.info
  //  Methodes: - getData()             -> get the last downloaded Data from tw-db
  //            - getSkills()           -> get the current Skills
  //            - getItems()            -> get the current from Char useable Items
  //            - getAnimals()          -> get speed-sorted Animals
  //            - getVersion()          -> get the current version of data, is incremented on every Data-Download
  //            - getUp2Date()          -> gets the up2date state of Data
  //            - loadData()            -> initiate the Data-Download ('TWDBdataLoaded' is triggered)
  //
  /////////////////////////////
    var DataManager = (function ($) {
      var _self = {};
      var ready = false;
      var data = {};
      var items = {};
      var skills = {};
      var animals = [];
      var version = 0;
      var cache = {items:{},skills:{}};
      var up2date = {items:true,skills:true,extra:true};
      var iframe = null;
      var loader = {};
      var extra = {};
      var img = null;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        img = $('<div title="#DATA_OK#" style="position:absolute;top:0px;right:0px;width:20px;height:20px;background: url(' + Images.iconData + ')no-repeat -20px 0px;" /></div>');
        // define eventer for cross site communication  
        var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
        var eventer = window[eventMethod];
        var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
        eventer(messageEvent,function(e) {
          if( e.origin !== 'http://' + Script.url ) { 
            return; 
          };
          try {
            var resp = $.parseJSON(e.data);
            if ( isDefined(resp.error) ) {
              new UserMessage( Script.url + ': ' + resp.error , UserMessage.TYPE_ERROR).show();
            }
            else {
              new UserMessage( Script.url + ': ' + resp.message, UserMessage.TYPE_SUCCESS).show();
              data = resp.data;
              cache.skills = skills;
              cache.items = items;
              Cache.save('datamanager',cache);
              up2date = {items:true,skills:true,extra:true};
              version++;
              updateImg(true);
              Eventer.trigger('TWDBdataLoaded');
            }
          } catch(e) {
            new UserMessage( Script.url + ': empty or corrupt data recieved' , UserMessage.TYPE_ERROR).show();
          };
        },false);
        var tmp = Cache.load('datamanager');
				if ( isDefined(tmp) && isDefined(tmp.skills) && isDefined(tmp.items) ) {
          cache = tmp;
        };
        if(!window.Bag.loaded) {
          window.Bag.loadItems();
        };
        var interval = window.setInterval( function(){
          if(window.Bag.loaded&&window.Wear.loaded) {
            window.clearInterval(interval);
            loader.ready = true;
          }
        },100);
      };
      loader = Loader.add ( 'DataManager' , 'tw-db DataManager' , init , {'Cache':true} );
      _self.getData = function( type ) {
        if ( isDefined(data[type] ) ) {
          return data[type];
        }
        return data;
      };
      _self.getSkills = function() {
        return skills;
      };
      _self.getItems = function() {
        return items;
      };
      _self.getAnimals = function() {
        return animals;
      };
      _self.getVersion = function() {
        return version;
      };
      _self.getUp2Date = function() {
        return up2date;
      };
      var loadSkill = function() {
        try {
          var tmp = $.extend(true, {}, cache.skills);
          skills = {};
          for ( var key in CharacterSkills.skills ) {
            var id = _skill2id[key];
            var val = CharacterSkills.skills[key].points;
            skills[id] = val;
            if ( isDefined(tmp[id]) ) {
              if ( tmp[id] != val ) {
                up2date.skills = false;
              };
              delete(tmp[id]);
            }
            else {
              up2date.skills = false;
            }
          };
          if ( !$.isEmptyObject(tmp) ) {
            up2date.skills = false;
          };
        }
        catch (e) {
          Error.report( e , 'DataManager loadSkill');
        }
        return up2date.skills;
      };
      var loadItems = function() {
        try {
          var tmp = $.extend(true, {}, cache.items);
          items = {};
          animals = [];
          for ( var type in Bag.items ) {
            for ( var i in Bag.items[type] ) {
              var id = Number(i);
              if ( ClothCalc.isItemUsable(id) ) {
                items[id] = true;
                if( type=='animal' ) {
                  animals.push({'id':id,'speed':Bag.items[type][id].obj.speed});
                };
                if ( isDefined(tmp[id]) ) {
                  delete(tmp[id]);
                }
                else {
                  up2date.items = false;
                };
              };
            };
          };
          for ( var type in Wear.wear ) {
            var id = Number(Wear.wear[type].getId());
            if ( isDefined(items[id]) ) {
              continue;
            };
            if ( ClothCalc.isItemUsable(id) ) {
              items[id] = true;
              if( type=='animal' ) {
                animals.push({'id':id,'speed':Wear.wear[type].obj.speed});
              };
              if ( isDefined(tmp[id]) ) {
                delete(tmp[id]);
              }
              else {
               up2date.items = false;
              };
            };
          };
          if ( !$.isEmptyObject(tmp) ) {
            up2date.items = false;
          };
          var sortSpeed = function (x, y) {
            return x['speed'] > y['speed'] ? true : false;
          };
          animals.sort(sortSpeed);
        }
        catch (e) {
          Error.report( e , 'DataManager loadItems');
        }
        return up2date.items;
      };
      var loadExtra = function() {
        var state = true;
        for ( var key in extra ) {
          try {
            state = state && (extra[key])();
          }
          catch (e) {
            Error.report( e , 'DataManager checkExtra');
          }
        }
        up2date.extra = state;
        return up2date.extra;
      }
      _self.loadData = function( force ) {
        updateImg ( loadSkill() && loadItems() && loadExtra() );
        loadItems();
        loadItems();
        if ( !up2date.items || !up2date.skills || !up2date.extra || force === true || Analyser.extra ) {
          sendForm();
        };
      };
      var sendForm = function ( ) {
        try {
          var _items = {};
          var _setitems = {};
          for ( var id in items ) {
            var obj = ItemManager.get(id);
            var type = Number(_type2id[obj.type]);
            if(!isDefined(_items[type])) { 
              _items[type] = [];
            };
            _items[type].push(id);
            if ( isDefined(obj.set) ) {
              if(!isDefined(_setitems[type])) { 
                _setitems[type] = [];
              };
              _setitems[type].push(id);
            };
          };

          var premium = {0:Number(Premium.hasBonus('regen')),1:Number(Premium.hasBonus('automation')),2:Number(Premium.hasBonus('money')),3:Number(Premium.hasBonus('character'))};
          
          var form = '<form name="TWDB_CC_Form" action="http://' + Script.url + '/ingame_calc.php" method="post">';
          form += '<input style="display:none" type="text" name="worldfull" value="' + window.location.host + '" />';
          form += '<input style="display:none" type="text" name="version" value="' + TheWestApi.version + '" />';
          form += '<input style="display:none" type="text" name="nick" value="' + Character.name + '" />';
          form += '<input style="display:none" type="text" name="level" value="' + Number(Character.level) + '" />';
          form += '<input style="display:none" type="text" name="class" value="' + Number(_class2id[Character.charClass]) + '" />';
          form += '<input style="display:none" type="text" name="premium" value=\'' + (JSON.stringify(premium).replace(/'/g, "\\\'")) + '\' />';
          form += '<input style="display:none" type="text" name="items" value=\'' + (JSON.stringify(_items)).replace(/'/g, "\\\'") + '\' />';
          form += '<input style="display:none" type="text" name="setitems" value=\'' + (JSON.stringify(_setitems)).replace(/'/g, "\\\'") + '\' />';
          form += '<input style="display:none" type="text" name="skill" value=\'' + (JSON.stringify(skills)).replace(/'/g, "\\\'") + '\' />';
          form += '<input style="display:none" type="text" name="custom" value=\'' + (JSON.stringify(Customs.getCustoms())).replace(/'/g, "\\\'") + '\' />';
          if ( Analyser.getExtra() ) {
            form += '<input style="display:none" type="text" name="report" value=\'' + (JSON.stringify(Analyser.getExtra())).replace(/'/g, "\\\'") + '\' />';
          }
          form += '</form>';
          form += '<script type="text/javascript">document.forms.TWDB_CC_Form.submit();</script>'
          form += '</body>';

          
            Support.addKey('world',window.location.host);
            Support.addKey('version',TheWestApi.version);
            Support.addKey('name',Character.name);
            Support.addKey('level',Number(Character.level));
            Support.addKey('class',Number(_class2id[Character.charClass]));
            Support.addKey('premium',(JSON.stringify(premium).replace(/'/g, "\\\'")));
            Support.addKey('items',(JSON.stringify(_items)).replace(/'/g, "\\\'"));
            Support.addKey('setitems',(JSON.stringify(_setitems)).replace(/'/g, "\\\'"));
            Support.addKey('skill',(JSON.stringify(skills)).replace(/'/g, "\\\'"));
            Support.addKey('custom',(JSON.stringify(Customs.getCustoms())).replace(/'/g, "\\\'"));
          
          
          if( isDefined(iframe) ) {
            $(iframe).remove();	
          };
          iframe = $('<iframe width="1px" height="1px" marginwidth="0" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="no" allowtransparency="false" style="display:none;" />');
          $('body').append(iframe);
          var ifr = iframe.get(0);
          var ifrd = (ifr.contentWindow || ifr.contentDocument);
          if (ifrd.document) ifrd = ifrd.document;
          ifrd.write(form);
        }
        catch (e) {
          Error.report( e , 'DataManager sendForm');
        }
      };
      _self.addExtraCheck = function ( key , callback ) {
        extra[key] = callback;
      };
      var updateImg = function ( state ) {
        if ( state ) {
          img.css('background-position','-20px 0px').addMousePopup('#DATA_OK#');
        }
        else {
        	var title = '#DATA_OLD#';
          if(!up2date.items) {
            title+=' [#INVENTORY#]';
          };		
          if(!up2date.skills) {
            title+=' [#SKILL#]';
          };
          if(!up2date.extra) {
            title+=' [#CUSTOM#]';
          };
          img.css('background-position','0px 0px').addMousePopup(title);
        }
      }
      _self.getImg = function () {
        return img;
      };
      return _self;
    })($);
    _base.DataManager = DataManager;
    Debugger.DataManager = DataManager;
  
  /////////////////////////////
  //
  //  Quest Object: manipulate Questsviews
  //  Methodes: 
  //
  /////////////////////////////
    var Quests = (function ($) {
      var _self = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Settings.addOption( 'Quest' , 'questgroup', 0 ,'#HELP_QUESTGROUP#');
        Settings.addOption( 'Quest' , 'questwiki', 0 ,'#HELP_QUESTWIKI#');
        Settings.addOption( 'Quest' , 'questcancle', 0 ,'#HELP_QUESTCANCEL#');
        Settings.addOption( 'Quest' , 'questnorewardbox', 0 ,'#HELP_QUESTNOREWARDBOX#');

        if ( Settings.get('questgroup',true) ) {
          groupDailies();
        }
        if ( Settings.get('questwiki',true) ) {
          QuestWiki();
        }
        if ( Settings.get('questcancle',true) ) {
          QuestCancel();
        }
        if ( Settings.get('questnorewardbox',true) ) {
          noRewardBox();
        }
        loader.ready = true;
      };
      loader = Loader.add ( 'Quests' , 'tw-db Quests' , init , {'Settings':true} );
      var groupDailies = function (  ) {
        var groups = {'#DAILIES#':$('<div class="TWDBBox" style="display:none;" / >')}; 
        var inject = function ( employer ) {
          if ( employer.key != 'paper' ) {
            return;
          };
          for ( var key in groups ) {
            groups[key].children().remove();
          };
          var count = {};
          var win = $(GameAPI.wman.getById('window-quest_employer').getMainDiv());
          for ( var i = 0 ; i < employer.open.length ; i++ ) {
            var quest = employer.open[i];
            var group = '#DAILIES#';
            for ( var j = 0 ; j < quest.requirements.length ; j++ ) {
              var req = quest.requirements[j];
              if ( !isDefined(req.jsInfo) || req.jsInfo.type!='task-finish-walk' ) {
                continue;
              };
              group = req.info;
            };
            if ( !isDefined(groups[group]) ) {
              groups[group] = $('<div class="TWDBBox" style="display:none;" / >');
            };
            groups[group].append(win.find('#open_quest_'+quest.id));
            
            var cssClass = 'exclamationgray';
            if (!quest.accepted) {
              if (quest.acceptable) {
                cssClass = 'exclamation';
              }
            } else {
              if (quest.finishable) {
                cssClass = 'question';
              } else {
                cssClass = 'questiongray';
              }
            }
            
            if ( !isDefined(count[group]) ) {
              count[group] = {};
            };
            if ( !isDefined(count[group][cssClass]) ) {
              count[group][cssClass] = 0;
            };
            count[group][cssClass]++;
          };
          var el = win.find('.quest_splitter').next();
          for ( var key in groups ) {
            var el2 = $('<span />');
            if ( isDefined(count[key]) ) {
              for ( var icon in count[key] ) {
                el2.append('<span style="margin-left:10px;">'+count[key][icon]+'x').append(GameAPI.gui.icon.get(icon));
              }
            };
            var dom = $('<div />')
              .append($('<span style="cursor:pointer;font-weigth:bold;margin-left:20px;" >'+key+'</span>').click(function(){$(this).parent().children('.TWDBBox').toggle();}).append(el2))
              .append(groups[key]).append('<div class="quest_splitter" />');
            el.append(dom);
          }          
        };
        GameInject.injectQuestLog(function(para){inject(para);});
      };
      var QuestWiki = function() {
        try {
          window.Quest.CCopen = function( id , type ) {
            try {
              ClothCalc.open(id , type);
            }
            catch(e) {
              Error.report(e,'ClothCalc.open ');
            }
          };
        }
        catch(e) {
          Error.report( e , 'open ClothCalc from Quest');
        }
        var inject = function(quest) {
          if (quest.requirements.length != 0) {
            quest.el.find('.quest_requirement').each(function(index) {
              if ( isDefined(quest.requirements[index]) ) {
                var req = quest.requirements[index];
                if ( isDefined(req.jsInfo) && isDefined(req.jsInfo.id) ) {
                  if ( req.jsInfo.type == "inventory_changed" ) {
                    var bagItem = Bag.getItemByItemId(req.jsInfo.id);
                    if (bagItem) {
                      $(this).children(':last').before('<span> [' + bagItem.count + ']</span>');
                    };
                    var item = ItemManager.get(req.jsInfo.id);
                    if ( item ) {
                      $(this).children('.quest_mmaplink').after('<span title="#SHOWJOBATCC#" class="quest_mmaplink" title="" onclick="javascript:void(Quest.CCopen(\'' + item.name + '\',\'item\'))"><img src="' + Images.iconLight + '" /></span>');
                    }
                  }
                  else if ( req.jsInfo.type == "task-finish-job" ) {
                    var job = Jobs.getJobById(req.jsInfo.id);
                    if ( job ) {
                      $(this).children('.quest_mmaplink').after('<span title="#SHOWJOBATCC#" class="quest_mmaplink" title="" onclick="javascript:void(Quest.CCopen(\'' + job.id + '\',\'job\'))"><img src="' + Images.iconLight + '" /></span>');
                    }
                  };
                };
              };
            });
          };
          quest.el.find('.questRequirementHelp').append('<a target="_blank" title="#QUESTWIKI#" href="http://' + Script.url + '/quest_redirect.php?id=' + quest.id + '" style="margin-left:10px;"><img src="'+Images.questwiki+'" /></a>');
        };
        GameInject.injectQuest(function(quest){inject(quest);});
      };
      var QuestCancel = function() {
        try {
          var original = QuestWindow.cancelQuest;
          QuestWindow.cancelQuest = function(quest_id) {	
            new GameAPI.gui.dialog('#QUESTCANCEL#','#QUESTCANCELDESC#')
              .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
              .setModal(true,false,{bg: Game.cdnURL + '/images/curtain_bg.png',opacity:0.4})
              .addButton('yes',function(){original(quest_id);})
              .addButton('no',function(){})
              .show();		
          } 
        }
        catch (e) {
          Error.report(e, 'inject QuestWindow.cancelQuest');
        }
      };
      var noRewardBox = function() {
        try {
          var original = Quest.showRewardBox;
          Quest.showRewardBox = function() {	
          
          } 
        }
        catch (e) {
          Error.report(e, 'inject QuestWindow.showRewardBox');
        }
      };
      return _self;
    })($);
    Debugger.Quests = Quests;
  
  /////////////////////////////
  //
  //  Object for ingame Forum: adjustments on the ingame forum
  //  Methodes:
  //
  /////////////////////////////
    var Forum = (function ($) {
      var _self = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('forumlastpage',true) || Settings.get('forumnewthread',true) ) {
          $('#windows').on('DOMNodeInserted', 'iframe', function() {
            $("iframe[src='forum.php']").load(function() {
              if ( Settings.get('forumlastpage',true) ) {
                lastPage(); 
              };
              if ( Settings.get('forumnewthread',true) ) {
                newThread();
              };
            })
          });
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Forum' , 'tw-db Forum' , init , {'Settings':true} );
      var lastPage = function() {
        var iframe = $('iframe[src="forum.php"]').contents();
        if(iframe.find('.tw2gui_groupframe ').length==1) {
          iframe.find(".row").each(function(i) {
            var page = Math.floor($(this).find(".cell_4").html()/10)+1;
            var link = $(this).find('.cell_1 a').attr("onclick").match(/\d+/);
            $(this).find(".cell_3").append('<img src="' + Game.forumURL + '/the-west/buttons/lastpost.gif" style="position:absolute;cursor:pointer;margin-left:3px;" onclick="Forum.openThread('+link+', '+page+')"></img>');
          });
        };
      };
      var newThread = function() {
        var iframe = $('iframe[src="forum.php"]').contents();
        var button_read = iframe.find('#thread_overview .tfoot .tw2gui_button');
        var new_place = iframe.find('.forum .tw2gui_groupframe_content_pane');
        if(button_read.length>0 && new_place.find('.tw2gui_button').length==2) {
          var new_button = button_read.first().clone().click(function(){ $('iframe')[0].contentWindow.Forum.openNewThread($('iframe')[0].contentWindow.Forum.forumId); });
          new_place.find('.tw2gui_button:first').before(new_button);   
        };
      };
      return _self;
    })($);
    Debugger.Forum = Forum;
  
  /////////////////////////////
  //
  //  Object for DuelMotivation Bar : 
  //  Methodes:
  //
  /////////////////////////////
    var DuelMotivation = (function ($) {
      var _self = {};
      var bar = null;
      var loader = {};
      var kotimeout = 0;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( !Settings.get('duelmotivation',true) ) {
          loader.ready = true;
          return;
        };
        if ( w.Character.homeTown.town_id == 0 ) {
          init2();
          return;
        };
        Ajax.remoteCallMode('building_sheriff', 'index', {
            town_id: w.Character.homeTown.town_id
        }, function (json) {
            if (json.error) return new UserMessage(json.msg).show();
            kotimeout = (new Date().getTime()) / 1000 + json.timeleft;
            init2();
        });
      };
      var init2 = function ( ) {
        addBar();
        GameInject.injectSetDuelMotivation(function(){refresh();});
        GameInject.injectReportReceivedEntry(function(data){if(data.type=='duel'){getMoti();}});
        getMoti();
        loader.ready = true;
      }
      loader = Loader.add ( 'DuelMotivation' , 'tw-db DuelMotivation' , init , {'Settings':true} );
      var addBar = function () {
        $('#ui_character_container').css({'background-repeat': 'no-repeat',  'height' : '191px'});
        var container = $('<div />').css({
            'background-image': $('#ui_character_container').css('background-image'),
            'background-repeat': 'no-repeat',
            'background-position': 'bottom left',
            'width' : '143px',
            'height' : '15px',
            'position' : 'absolute',
            'left' : '0px',
            'top' : '173px',
            'padding-top': '2px',
          });
        $('.energy_bar').before(container);	
        bar = $('<div />')
          .addClass('status_bar')
          .attr({'title' : '#DUELMOTIVATION#: 0%'})
          .text('0%');
        if ( Premium.hasBonus('regen') ){
          bar.css({'background-position' : '0px -13px', 'top' : '2px', 'left' : '3px'});
        } else {
          bar.css({'background-position' : '0px -26px', 'top' : '2px', 'left' : '3px'});
        }
        container.append(bar);
        $('.energy_add').css({'top' : '161px'});		
      };
      var getMoti = function () {
        Ajax.remoteCallMode('duel', 'get_data', {}, function (json) {
          if (json.error) {
            return new UserMessage(json.msg).show();
          }
          window.Character.setDuelMotivation(json.motivation);
          refresh();
        });
      };
      var refresh = function () {
        var motivation = Math.round(Character.duelMotivation*100);
        if ( Premium.hasBonus('regen') ){
          bar.css({'background-position' : '-'+Math.floor(137-motivation*1.37)+'px -13px'});
        } else {
          bar.css({'background-position' : '-'+Math.floor(137-motivation*1.37)+'px -26px'});
        }
        bar.text(motivation+'%').attr({'title' : '#DUELMOTIVATION#:'+motivation+'%'});
      };
      return _self;
    })($);
    Debugger.DuelMotivation = DuelMotivation;
  
  /////////////////////////////
  //
  //  Bank Object
  //  Methodes:
  //
  /////////////////////////////
    var Bank = (function ($) {
      var _self = {};
      var answer = true;
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('autodeposit',true) ) {
          EventHandler.listen('position_change',function(){autoDeposit();});
          autoDeposit();
        };
        if ( Settings.get('deposit',true) ) {
          addButton();
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Bank' , 'tw-db Bank' , init , {'Settings':true} );
      var addButton = function () {
        btn = GameInject.CharacterButton.add(Images.buttonBank);
        btn.click(function(){askDeposit()}).addMousePopup('#DEPOSIT#');
      };
      var askDeposit = function () {
          new GameAPI.gui.dialog('#DEPOSIT#',$('<span>#MONEY#:&nbsp;' + w.Character.money + '</span>') )
            .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
            .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
            .setModal(true,false,{bg: w.Game.cdnURL + '/images/curtain_bg.png',opacity:0.4})
            .addButton('yes',function(){depositMoney(1);})
            .addButton('no',function(){})
            .show();		
      };
      var autoDeposit = function () {
        try {
          if ( w.Character.homeTown.town_id == 0 || w.Character.money <= 10 ) {
            answer = true;
            return;
          }
          if ( w.Character.position.x == w.Character.homeTown.x && w.Character.position.y == w.Character.homeTown.y ) {
            if ( answer ) {
              answer = false;
              new GameAPI.gui.dialog('#DEPOSIT#',$('<span>#DEPOSITDESC# <br />#MONEY#:&nbsp;' + w.Character.money + '</span>') )
                .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
                .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
                .setModal(true,false,{bg: w.Game.cdnURL + '/images/curtain_bg.png',opacity:0.4})
                .addButton('yes',function(){ answer = true; depositMoney(w.Character.homeTown.town_id);})
                .addButton('no',function(){})
                .show();		
            };
          }
          else {
            answer = true;
          };
        }
        catch (e) {
        	Error.report(e,'autoDeposit');
        }
      };
      var depositMoney = function (townid) {
        if ( w.Character.money <= 0 ) {
          return;
        }
        w.BankWindow.townid = townid;
        w.BankWindow.DOM = new GameAPI.gui.textfield("tb_balance_input_" + w.BankWindow.townid).setSize(10).setValue(w.Character.money).getMainDiv();
        w.BankWindow.Balance.add();
      };
      return _self;
    })($);
    Debugger.Bank = Bank;
  
  /////////////////////////////
  //
  //  Market Object
  //  Methodes:
  //
  /////////////////////////////
    var Market = (function ($) {
      var _self = {};
      var dom = false;
      var map = false;
      var towns = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('marketmap',true) ) {
          GameInject.addTabOnMarketWindow('#MARKETMAP#','marketmap',function(){open()});
        };
        if ( Settings.get('marketreminder',true) ) {
          GameInject.MarketOfferTable(function(data){OfferTable(data)});
          GameInject.MarketWatchlistTable(function(data){WatchlistTable(data)});
          Reminder.init();
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Market' , 'tw-db Market' , init , {'Settings':true} );
      var OfferTable = function ( data ) {
        for (var i = 0; i < data.length; i++) {
          var bid = data[i];
          var el = $('<div class="mpo_alert" />');
          $(MarketWindow.offerTable.getMainDiv()).children().find('.marketBidsData_'+bid.market_offer_id).append(el);
          if ( !bid.isFinished ) {
            el.append( getReminderImg( bid ) );
          };
        };
      };
      var WatchlistTable = function ( data ) {
        for (var i = 0; i < data.length; i++) {
          var bid = data[i];
          var el = $('<div class="mpo_alert" />');
          $(MarketWindow.watchlistTable.getMainDiv()).children().find('.marketWatchData_'+bid.market_offer_id).append(el);
          if ( !bid.isFinished ) {
            el.append( getReminderImg( bid ) );
          };
        };
      };
      getReminderImg = function ( data ) {
        var img = $('<img src="' + Images.iconAlarm + '" />').css({'cursor':'pointer'});
        img.click((function( data , img ){ return function(){Reminder.create( data , img );}})( data , img ));
        if ( Reminder.exists ( data.market_offer_id ) === false  ) {
          img.css('opacity',0.5);
        } else {
          
        }
        return img;
      }
      var Reminder = (function ($) {
        var _that = {};
        var entries = {}
        var active = {};
        _that.init = function() {
          var tmp = Cache.load('marketreminder');
          if ( isDefined(tmp) ) {
            entries = tmp;
          };
          for ( var id in entries ) {
            activateTimer ( id );
          }
        };
        _that.exists = function( id ) {
          if ( isDefined(entries[id]) ) {
            return true;
          } else {
            return false
          }
        };
        var activateTimer = function ( id ) {
          var bid = entries[id];
          var time = bid.ends * 1000 - (new Date().getTime()) - ( bid.reminder * 60 * 1000 );
          if ( time < 0 ) {
            time = 100;
          }
          bid.timer = setTimeout(function(id){return function(){popup(id)}}(id),time);
        }
        var add = function ( data , input , img ) {
          var minutes = parseInt(input.getValue());
          if ( isNaN(minutes) || minutes < 1  ) {
            _that.create( data , img ) ;
            return;
          }
          if ( ( (new Date().getTime())/1000 + minutes * 60 ) >= data.auction_end_date ) {
            new UserMessage('#REMINDERTOOLATE#').show();
            _that.create( data , img ) ;
            return;
          }
          if ( _that.exists ( data.market_offer_id ) ) {
            clearTimeout(entries[data.market_offer_id].timer);
            delete ( entries[data.market_offer_id].timer );
          }
          entries[data.market_offer_id] = { 'ends':data.auction_end_date , 'reminder':minutes , 'id':data.market_offer_id , 'item':data.item_id };
          Cache.save('marketreminder',entries);
          activateTimer(data.market_offer_id);
        };
        var del = function ( id ) {
          delete(entries[id]);
          Cache.save('marketreminder',entries);
        };
        var popup = function ( id ) {
          var bid = entries[id];
          var item = ItemManager.get(bid.item);
          var entry = new OnGoingEntry();
          entry.init();
          entry.setTooltip('#AUCTION#: ' + item.name + ', #END#: ' + Number(bid.ends - (new Date().getTime())/1000).getTimeString4Timestamp() );
          entry.setImage($('<img src="' + Images.notiBell + '" />'));
          WestUi.NotiBar.add(entry);
          TitleTicker.setNotifyMessage('#AUCTION#: ' + item.name + ', #END#: ' + Number(bid.ends - (new Date().getTime())/1000).getTimeString4Timestamp() );
          AudioController.play(AudioController.SOUND_NEWMSG);
          del(id);
        }
        _that.create = function( data , img ) {
          var msg = $('<div />');
          msg.append('<span style="position:relative; width:100%;display:block;">#AUCTIONEND#:&nbsp;' + data.auction_ends_in.getTimeString4Timestamp() + '</span>');
          
          var input = new GameAPI.gui.textfield("twdb_analyser_last").maxlength(4).onlyNumeric().setLabel('#REMINDBEFORE#:&nbsp;').setPlaceholder('#MINUTES#');
          msg.append(input.getMainDiv());
          if ( _that.exists ( data.market_offer_id ) ) {
            input.setValue( entries[data.market_offer_id].reminder );
            img.css('opacity',1);
          }
          else {
            img.css('opacity',0.5);
          }
          var img = img;
          var box =  new GameAPI.gui.dialog('#MARKETREMINDER#', msg )
                      .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
                      .setIcon(GameAPI.gui.dialog.SYS_QUESTION)
                      .setModal(true,false,{bg: w.Game.cdnURL + '/images/curtain_bg.png',opacity:0.4})
                      .addButton('ok',function(){img.css('opacity',1);add(data,input,img);});
          if ( _that.exists ( data.market_offer_id ) ) {
            box.addButton('#DELETE#',function(){del(data.market_offer_id);img.css('opacity',0.5);});		
          }          
          box.addButton('cancel',function(){}).show();		
        };
        return _that;
      })($);
      var open = function() {
        try {
          window.MarketWindow.window.showLoader();
          window.MarketWindow.window.setTitle('#MARKETMAP#').setSize(840,655).addClass('premium-buy');
          var cordX = -111;
          var cordY = -1;
          map = $('<div style="position:relative;display:block;margin:10px 9px 10px 9px;width:770px;height:338px;" />');
          for ( var i = 1 ; i < 16 ; i++ ) {
            if ( i == 8 ) {
              cordY += 169
              cordX = -111;
            };
            cordX += 110;
            var img = $('<img style="position:absolute;border:1px solid #000;width:110px;height:169px;left:' + cordX + 'px;top:' + cordY + 'px;" src="' + Game.cdnURL + '/images/map/minimap/county_' + i + '.jpg" />');
            
            if ( i == 4 ) {
              img.css({'height':'114px'});
            }
            else {
              if ( i == 11 ) {
                img.css({'height':'114px','top':(cordY+55)+'px'});
              }
              else {
                if ( i == 15 ) {
                  img.css({'height':'108px','width':'109px','left':'329px','top':'114px'});
                }
              }
            };
            map.append(img);
          };
          dom = $('<div />').append(map);
          $(MarketWindow.window.getContentPane()).find('.marketplace-marketmap').children().remove();
          $(MarketWindow.window.getContentPane()).find('.marketplace-marketmap').append(dom);
          towns = {};
          getItems();
          getMoney();
          drawPoints();
          createTownList();
          window.MarketWindow.window.hideLoader();
        }
        catch(e){
        	Error.report(e,'Market');

        }
      };
      var addObject = function (town_id, name, x, y, offer_end, offer_unend, money) {
        if ( !isDefined(towns[town_id]) ) {
          towns[town_id] = {};
          towns[town_id]['name'] = name;
          towns[town_id]['town_id'] = town_id;
          towns[town_id]['x'] = x;
          towns[town_id]['y'] = y;
          towns[town_id]['count'] = 0;
          towns[town_id]['offers_end'] = {};
          towns[town_id]['offers_unend'] = {};
          towns[town_id]['money'] = 0;
          towns[town_id]['distance'] = window.Map.calcWayTime(window.Character.position,{'x':x,'y':y}).formatDuration();
        };
        var town = towns[town_id];
        if( offer_end != '' ) {
          if( !isDefined(town['offers_end'][offer_end['item_id']]) ) {
            town['count']++;
            town['offers_end'][offer_end['item_id']] = offer_end;
          }
          else {
            town['offers_end'][offer_end['item_id']]['count'] += offer_end['count'];
          }
        };
        if(offer_unend!='') {
          if( !isDefined(town['offers_unend'][offer_unend['item_id']])) {
            town['count']++;
            town['offers_unend'][offer_unend['item_id']] = offer_unend;
          }
          else {
            town['offers_unend'][offer_unend['item_id']]['count'] += offer_unend['count'];
          }
        };
        if(money!=0) {
          town['money'] += money;
        };
      };
      var getItems = function () { /* Abzuholende Items*/
        $.ajax({
            url : 'game.php?window=building_market&action=fetch_bids&h='+Player.h,
            type : 'POST',
            data : {},
            dataType: 'json',
            async: false,
            success : function(data_return) {
              var result = data_return.msg.search_result;
              for ( var i=0; i<result.length; i++) {
                if ( result[i]['auction_ends_in'] < 0 || result[i]['current_bid'] == result[i]['max_price'] ) {
                  var offer_end = new Object();
                  offer_end['item_id'] = result[i].item_id;
                  offer_end['count'] = result[i].item_count;
                  var offer_unend = '';
                }
                else {
                  var offer_unend = new Object();
                  offer_unend['item_id'] = result[i].item_id;
                  offer_unend['count'] = result[i].item_count;
                  var offer_end = '';
                };
                addObject(result[i].market_town_id, result[i].market_town_name, result[i].market_town_x, result[i].market_town_y, offer_end, offer_unend, 0);
              };
            }
        });
      };
      var getMoney = function () { /* Abzuholendes Geld */
        $.ajax({
            url : 'game.php?window=building_market&action=fetch_offers&h='+Player.h,
            type : 'POST',
            data : {},
            dataType: 'json',
            async: false,
            success : function(data_return) {
              var result = data_return.msg.search_result;
              for(var i=0; i<result.length; i++) {
                  addObject(result[i].market_town_id, result[i].market_town_name, result[i].market_town_x, result[i].market_town_y, '', '', result[i].current_bid);
              };
            }
        });
      }
      var drawPoints = function() {
        for(town_id in towns) {
          var obj = towns[town_id];
          var mouseover = '<div style="max-width: 305px;"><b>'+obj.name+'</b>'
            +((obj['money']==0) ? '' : ' '+obj['money']+'$')
            +'<br/>';
          var anzahl_item=0;
          for(item_id in obj['offers_end']) {
            anzahl_item++;
            if(anzahl_item>19) {
                mouseover += ' ... ';
                break;
            };
            var offer = obj['offers_end'][item_id];
            if(obj['offers_end'][item_id]!=0) {
                mouseover += '<div class="item item_inventory"><img width="53" height="53" src="'+ItemManager.get(item_id).image+'" class="tw_item item_inventory_img dnd_draggable dnd_dragElem" style="margin-left:3px;margin-top:4px;"><span class="count" style="display: block;"><p>'+offer.count+'</p></span></div>';
            };
          };
          for(item_id in obj['offers_unend']) {
            anzahl_item++;
            if(anzahl_item>19) {
              mouseover += ' ... ';
              break;
            };
            var offer = obj['offers_unend'][item_id];
            if(obj['offers_unend'][item_id]!=0) {
              mouseover += '<div style="opacity:0.35" class="item item_inventory"><img width="53" height="53" src="'+ItemManager.get(item_id).image+'" class="tw_item item_inventory_img dnd_draggable dnd_dragElem" style="margin-left:3px;margin-top:4px;"><span class="count" style="display: block;"><p>'+offer.count+'</p></span></div>';
            };
          };
          mouseover += '</div>';
          $('<img />')
            .css({'left' : (obj.x/(181*window.Map.tileSize)*770-8)+'px', 'top' : (obj.y/(79*window.Map.tileSize)*338-8)+'px', 'background-image' : 'url(' + Images.point.red + ')'})
            .attr({'class' : 'mmap_mappoint', 'id' : town_id, 'title' : mouseover})
            .click( function(town){ return function(){TownWindow.open(town.x, town.y);}}(obj))
            .appendTo(map);
        }
        $('<img />')
          .css({'left' : (Character.position.x/(181*window.Map.tileSize)*770-8)+'px', 'top' : (Character.position.y/(79*window.Map.tileSize)*338-8)+'px', 'background-image' : 'url('+Images.point.blue+')'})
          .attr({'class' : 'mmap_mappoint', 'id' : 'mmap_icon_pos', 'title' : '#YOURPOSITION#'})
          .appendTo(map);
      };
      var createTownList = function() {
        try {
          var a_towns = [];
          /* Object in Array umwandeln und sortieren*/
          for(var id in towns) {
            a_towns.push({'id':id,'distance':towns[id].distance});
          }
          a_towns.sort(function(a, b){ return(a.distance==b.distance)?0:(a.distance>b.distance)?1:-1;});
          /* Beschreibung */
          var text = '';
          for(var i=0; i < a_towns.length; i++) {
            var obj = towns[a_towns[i].id];
            text += '<div><a onclick="TownWindow.open('+obj.x+', '+obj.y+');">'+obj.name+'</a>'
                  + ' <a title="#SHOWTOWN#" onclick="Map.center('+obj['x']+', '+obj['y']+')"><img src="' + Game.cdnURL + '/images/icons/center.png" /></a>'
                  + ' #DISTANCE#: '+obj['distance']
                  + ' <a title="#TOWNWALK#" onclick="TaskQueue.add(new TaskWalk('+obj.town_id+',\'town\'))"><img src="' + Game.cdnURL + '/images/map/icons/instantwork.png"></a>'
                  + ((obj['money']==0) ? '' : ' '+obj['money']+'$')
                  + '<br />';
            for(item_id in obj['offers_end']) {
              var offer = obj['offers_end'][item_id];
              if(obj['offers_end'][item_id]!=0) {
                var popup = new ItemPopup(ItemManager.get(item_id));
                text += '<div class="item item_inventory" title="'+popup.getXHTML().escapeHTML()+'"><img width="53" height="53" src="'+ItemManager.get(item_id).image+'" class="tw_item item_inventory_img dnd_draggable dnd_dragElem" style="margin-left:3px;margin-top:4px;"><span class="count" style="display: block;"><p>'+offer.count+'</p></span></div>';
              }
            }
            
            for(item_id in obj['offers_unend']) {
              var offer = obj['offers_unend'][item_id];
              if(obj['offers_unend'][item_id]!=0) {
                var popup = new ItemPopup(ItemManager.get(item_id));
                text += '<div style="opacity:0.35" class="item item_inventory" title="'+popup.getXHTML().escapeHTML()+'"><img width="53" height="53" src="'+ItemManager.get(item_id).image+'" class="tw_item item_inventory_img dnd_draggable dnd_dragElem" style="margin-left:3px;margin-top:4px;"><span class="count" style="display: block;"><p>'+offer.count+'</p></span></div>';
              }
            }
             
            text += '</div>';
            for(var j=0;j<=(obj.count-obj.count%12)/12;j++) {
              text += (obj.count==0) ? '<br/>' : '<br/><br/><br/><br/>';
            }
          }
          var scrollbar = new GameAPI.gui.scrollpane;
          $(scrollbar.getMainDiv()).css({'height':'200px','margin-left':'8px'});
          scrollbar.appendContent(text);
          dom.append(scrollbar.getMainDiv());
        } catch (e) {
          Error.report(e, 'Market createTownList');
        };
      }
      return _self;
    })($);
    Debugger.Market = Market;
  
  /////////////////////////////
  //
  //  Fort Object
  //  Methodes:
  //
  /////////////////////////////
    var Fort = (function ($) {
      var _self = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        if ( Settings.get('enhancedfortrecruitment',true) ) {
          inject();
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'Fort' , 'tw-db Fort' , init , {'Settings':true} );
      var inject = function () {  
        try {
          var gradeValues = {
              TRAITOR: '-2',
              RESERVIST: '-1',
              RECRUIT: '0',
              PRIVATE: '1',
              CAPTAIN: '2',
              GENERAL: '3'
          };
          var gradeNames = {
            '-2': 'traitor',
            '-1': 'reservist',
            '0': 'recruit',
            '1': 'private',
            '2': 'captain',
            '3': 'general'
          };
          var getGradeImg = function (gradeId, title, cls, officer) {
            try {
              return '<img class="' + (cls || '') + '" src="' + window.Game.cdnURL + '/images/chat/servicegrade_' + gradeNames[gradeId] + '.png" title="' + (title ?  window.Chat.rankTitles[gradeNames[gradeId]].escapeHTML() : '') + ( isDefined(officer)&&officer!=''?(' ('+officer+')'):'' ) + '" />';
            } catch(e) {
              Error.report(e,'getGradeImg');
            }
          };
          
          var newfunction = String(FortBattleWindow.updateRecruitlist);
          
          // define total grade counter
          newfunction = newfunction.replace(/totalCnt\s{0,1}=\s{0,1}0;/ , ' totalCnt = 0 , totalCntTotal = 0 , gradeCountTotal = { \'-2\': 0, \'-1\': 0, \'0\': 0, \'1\': 0, \'2\': 0, \'3\': 0 };');
          // output of total grade counter
          newfunction = newfunction.replace(/gradeCount\[g\]/ , 'gradeCount[g] + \' [\' + gradeCountTotal[g] + \']\'');
          newfunction = newfunction.replace(/\+\s{0,1}totalCnt\s{0,1}\+/ , '+ totalCnt + \' [\' + totalCntTotal + \']\' +');
          // new filter definition and total grade count
          newfunction = newfunction.replace(/if\(this\.preBattle\.isHidden\(list\[i\]\['class'\],'rank_'\+priv\)\)continue;/g, 'totalCntTotal++;gradeCountTotal[priv]++;if(this.preBattle.isHidden(list[i][\'class\'],\'rank_\'+priv,list[i].coords.x,list[i].coords.y))continue;');
          // add officer into popup
          newfunction = newfunction.replace(/getGradeImg\(priv,true,'recruitplayer recruitplayer-'\+i\)/g, "getGradeImg(priv,true,'recruitplayer recruitplayer-'+i,list[i].officername||'')");
          // adjust colum title
          newfunction = newfunction.replace(/\.addColumns\(\['count','name','town','rank','class','status','evaluated'\]\)/g, '.addColumns([\'count\',\'name\',\'town\',\'rank\',\'class\',\'status\',\'healthpoints\'])');
          newfunction = newfunction.replace(/\.appendToThCell\('head','evaluated',.*,.*\);var list=/g, '.appendToThCell(\'head\',\'healthpoints\',\'#ORDER_HEALTH#\',\'<span class="sort sort-healthpoints">\'+\'Lp\'+\'</span>\');var list=');
          // add healthpoints into player rows
          newfunction = newfunction.replace(/evaluated:list\[i\]\.officername\|\|''/g, "healthpoints:'<p style=\"font-weight: 700; color: '+((this.preBattle.battleData.fortCoords.x-list[i].coords.x==0&&this.preBattle.battleData.fortCoords.y-list[i].coords.y==0) ? 'rgb(0, 153, 0)' : ((Math.abs(this.preBattle.battleData.fortCoords.x-list[i].coords.x)<=500&&Math.abs(this.preBattle.battleData.fortCoords.y-list[i].coords.y)<=500) ? 'rgb(255, 119, 0)' : 'rgb(255, 0, 0)'))+'\">'+list[i].currhealth+'/'+list[i].maxhealth+'</p>'");
          // inject new function
          eval ( 'FortBattleWindow.updateRecruitlist=(function(){ var lastStamp; return ' + newfunction + '})();' );
              
          var newfunction = String(PreBattle.getSortedPlayerlist);
          newfunction = newfunction.replace(/pa\s{0,1},\s{0,1}pb\s{0,1}\)/g, 'pa,pb,that)');
          
          eval ( 'PreBattle.getSortedPlayerlist = ' + newfunction );
     
              
                        /* alte Funktion laden und in String umwandeln */
          var fb_sort = String(FortBattleWindow.recruitListClick);
          /* funktionstchtig machen */
          fb_sort = 'FortBattleWindow.recruitListClick=' + fb_sort;
          /* Bentigte Variablen bergeben */
          /* Fr Filterfunktion */
          fb_sort = fb_sort.replace(/var hidden=function\(classKey,privKey\){return that\.preBattle\.isHidden\(classKey,'rank_'\+privKey\);};/g, "var hidden=function(classKey,privKey, location){return that.preBattle.isHidden(classKey,'rank_'+privKey, null, null, location);};");
          /* Weiterleitung zur Sortierfunktion fr Lebenspunkte */
          fb_sort = fb_sort.replace(/return{message:sorting,title:title};/g, 'else if(key==\'healthpoints\'){title=\'#ORDER_HEALTH#\';sorting.append(getSortLink(\'#SORT_CURRENT_HEALTH_ASC#\',\'>currhealth\'));sorting.append(getSortLink(\'#SORT_CURRENT_HEALTH_DESC#\',\'<currhealth\')); sorting.append(getSortLink(\'#SORT_MAX_HEALTH_ASC#\',\'>maxhealth\'));sorting.append(getSortLink(\'#SORT_MAX_HEALTH_DESC#\',\'<maxhealth\'));sorting.append(\'<br />\');sorting.append(getSortLink(\'#SORT_DISTANCE_ASC#\',\'>distance\'));sorting.append(getSortLink(\'#SORT_DISTANCE_DESC#\',\'<distance\'));sorting.append(getVisLink(hidden(null,\'-3\',\'atfort\')?\'#SHOW_PLAYER_AT_FORT#\':\'#HIDE_PLAYER_AT_FORT#\',\'atfort\'));sorting.append(getVisLink(hidden(null,\'-3\',\'nearbyfort\')?\'#SHOW_PLAYER_NEAR_FORT#\':\'#HIDE_PLAYER_NEAR_FORT#\',\'nearbyfort\'));sorting.append(getVisLink(hidden(null,\'-3\',\'notatfort\')?\'#SHOW_PLAYER_NOTAT_FORT#\':\'#HIDE_PLAYER_NOTAT_FORT#\',\'notatfort\'));}return{message:sorting,title:title};')
          /* Funktion berschreiben */
          eval(fb_sort);
          
          
          
          /* Funktion berschreiben */
          PreBattle.recruitSorting.currhealth = function (a, b, eq) {
              return eq ? a.currhealth == b.currhealth : a.currhealth < b.currhealth
          };
          PreBattle.recruitSorting.maxhealth = function (a, b, eq) {
              return eq ? a.maxhealth == b.maxhealth : a.maxhealth < b.maxhealth
          };
          PreBattle.recruitSorting.distance = function (a, b, eq , pa, pb ,that) {
              //var distance_a = Math.sqrt((a.coords.x - that.battleData.fortCoords.x) * (a.coords.x - that.battleData.fortCoords.x) + (a.coords.y - that.battleData.fortCoords.y) * (a.coords.y - that.battleData.fortCoords.y));
              //var distance_b = Math.sqrt((b.coords.x - that.battleData.fortCoords.x) * (b.coords.x - that.battleData.fortCoords.x) + (b.coords.y - that.battleData.fortCoords.y) * (b.coords.y - preBattle.battleData.fortCoords.y));
              //return eq ? that == distance_b : distance_a < distance_b
          };
          
          PreBattle.isHidden = function (recClass, recPriv, posX, posY, position) {
              if (position == null) {
                  var diffx = this.battleData.fortCoords.x - posX;
                  var diffy = this.battleData.fortCoords.y - posY;
                  var location = 'notatfort';
                  if (diffx == 0 && diffy == 0) {
                      location = 'atfort';
                  } else if (Math.abs(diffx) <= 500 && Math.abs(diffy) <= 500) {
                      location = 'nearbyfort';
                  }
              } else if (position != null) {
                  var location = position;
              }
              return (recClass != undefined && this.recruitlistVisibility[recClass]) || (recPriv != undefined && this.recruitlistVisibility[recPriv]) || (location != undefined && this.recruitlistVisibility[location]);
          }
          
              
        }
        catch (e) {
        	Error.report(e,'Fort');
        }
      }
      
      
      return _self;
    })($);
    Debugger.Fort = Fort;
  
  /////////////////////////////
  //
  //
  /////////////////////////////
    var ItemsWindow = (function ($) {
      var _self = {};
      var tabs = {};
      var loader = {};
      var uid = "twdb_itemswindow";
      var wnd = null;
      var div = $('<div />');
      var first = true;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        loader.ready = true;
      };
      loader = Loader.add ( 'ItemsWindow' , 'tw-db ItemsWindow' , init , {} );
      _self.addTab = function ( tab , title , img , callback ) {
        if ( isDefined ( tabs[tab] ) ) {
          return;
        };
        if ( first ) {
          first = false;
          addButton();
        };
        tabs[tab] = { title: title,
                      img: img,
                      callback: callback,
                      gui: $('<div style="margin-top:10px;width:100%;height:165px;"/>').hide(),
                    };
        return tabs[tab].gui;
      };
      var addButton = function() {
        var div = $('<div title=" tw-db.info ClothCalc " class="menulink" />').css('background-image','url(' + Images.button + ')').css('background-position','0px -25px').mouseenter(function(){$(this).css('background-position','-25px -25px');}).mouseleave(function(){$(this).css('background-position','0px -25px');}).click(function(){_self.open();});
        $('#ui_menubar').append($('<div class="ui_menucontainer" />').append(div).append('<div class="menucontainer_bottom" />'));
      };
      _self.open = function ( tab , options ) {
        if ( isDefined(tab) && !isDefined ( tabs[tab] ) ) {
          return;
        }
        show( tab , options );
      };
      var show = function( key , options ) {
      	
        //save state of Inventory Window
        var state = GameAPI.wman.getById(Inventory.uid);
        // open Wear Window
        Wear.open();
        // close Inventory Window if it was not opened
        var inventory = GameAPI.wman.getById(Inventory.uid);
        if ( !isDefined(state) && isDefined(inventory) ) {
          inventory.fireEvent(TWE('WINDOW_CLOSE'),inventory); 
        };

        wnd = GameAPI.wman.open(uid, null, 'noreload').setMiniTitle("TWDB ClothCalc").setTitle('tw-db.info ClothCalc');
        var pos = wnd.saveAppearance();
        switch ( Settings.get('clothPos','left') ) {
          case 'right' : pos.x = w.Wear.window.divMain.offsetLeft + w.Wear.window.divMain.offsetWidth - 15;  break;
          case 'left' : pos.x = w.Wear.window.divMain.offsetLeft - 295; break;
          case 'custom' : var pos = Settings.get('clothPosition',{x:0,y:0}); break;
        };
        wnd.restoreAppearance({h: 471,w: 310,x: pos.x,y: pos.y,});
        
        var open;
        for ( var tab in tabs ) {
          if ( !isDefined(open) || key == tab ) {
            open = tab;
          };
          wnd.addTab( '<img src="' + tabs[tab].img + '" title="' + tabs[tab].title + '" height="20px" />', tab, function(win,id){switchTab(id);} );
          tabs[tab].gui.children().remove();
          wnd.appendToContentPane(tabs[tab].gui);
        }
        wnd.appendToContentPane(Bag.getDiv()).appendToContentPane($('<div style="position:absolute;bottom:0px;left:-5px;width:100%;" />').append(Script.getFooter(true)));
        switchTab(open , options);
      };
      _self.showLoader = function ( ) {
        wnd.showLoader();
      };
      _self.hideLoader = function ( ) {
        wnd.hideLoader();
      };
      _self.addItems = function ( items , callback ) {
        Bag.addItems( items , callback )
      };
      _self.hideBag = function ( ) {
        Bag.hide();
      };
      _self.showBag = function ( ) {
        Bag.show();
      };
      var switchTab = function (tab , options) {
        if( !isDefined(tabs[tab]) ) {
          return;
        }
        div.hide();
        Bag.show();
        Bag.addItems([]);
        wnd.showLoader();
        wnd.activateTab(tab);
        div = tabs[tab].gui;
        div.show();
        Bag.setBottom( 175 - $(div).height() );
        w.setTimeout(function(){try{tabs[tab].callback(options)}catch ( e ) {Error.report ( e , 'ItemsWindow openTab' + tab );};},10);
        wnd.hideLoader();
      };
      var Bag = (function ($) {
        var _that = {};
        var div = null;
        var callback = null;
        var items = {};
        var stack = [];
        var interval = false;
        _that.getDiv = function() {
          div = $('<div style="position:absolute;bottom:10px;left:1px;width:252px;height:186px;" />');
          return div;
        };
        _that.setBottom = function ( bottom ) {
          div.css('bottom',bottom + 'px');
        };
        _that.addItems = function( _items , call ) {
          clearItems();
          for ( var i = 0 ; i < _items.length ; i++ ) {
            var item = new tw2widget.InventoryItem(w.ItemManager.get(_items[i]));
            $(item.getMainDiv()).removeAttr('id');
            $(item.getMainDiv()).children('.TWDBbuyTip').remove();
            $(item.getMainDiv()).children('.TWDBsellTip').remove();
            $(item.getMainDiv()).children('.TWDBcollector').remove();
            $(item.getMainDiv()).children('img:first-child').removeAttr('id');
            $(item.getMainDiv()).click(function(id){ return function(){carry(id)}}(_items[i]));
            $(item.getMainDiv()).appendTo(div);
            if ( isCarried(_items[i]) ) {
              item.getMainDiv().css('opacity', '0.5');
            };
            items[_items[i]] = item;
          };
          callback = call;
				};
        var carry = function ( id ) {
          if ( !isDefined(items[id])) {
            return false;
          };
          var item = items[id];
          var bagItem = w.Bag.getItemByItemId( id );
          if ( isDefined(bagItem) ) {
            w.Wear.carry(item);
          };
          stack.push(item);
          if ( interval === false ) {
            interval = w.setInterval( function(){checkCarry()} , 100 );
         };
        };
        var checkCarry = function ( ) {
          var len = stack.length;
          for ( var i = 0 ; i < len ; i++ ) {
            var item = stack.shift();
            if ( item.getImgEl().css('opacity') == 0.3 ) {
              stack.push(item);
              continue;
            };
            if ( isCarried(item.obj.item_id) ) {
              item.getImgEl().css('opacity', 1);
              item.getMainDiv().css('opacity', 0.5);
            }
            else {
              item.getImgEl().css('opacity', 1);
              item.getMainDiv().css('opacity', 1);
            };
          };
          if ( stack.length == 0 ) {
            w.clearInterval(interval);
            interval = false;
            try {
              if ( isDefined(callback) ) {
                callback();
              };
            }
            catch ( e ) {
              Error.report ( e , 'Callback on Itemcarry' );
            };
          };
        };
        var isCarried = function ( id ) {
          var item = w.ItemManager.get( id );
          var wearItem = w.Wear.wear[item.type];
          if ( wearItem && wearItem.obj.item_id == id ) {
            return true;
          }
          else {
            return false;
          };
        };
        var clearItems = function ( ) {
          if ( interval !== false ) {
            w.clearInterval(interval);
          };
          interval = false;
          stack = [];
          $(div).children().remove();
          items = {};
        };
        _that.show = function ( ) {
          div.show();
        };
        _that.hide = function ( ) {
          div.hide();
        };
        return _that;
      })($);
      return _self;
    })($);
    Debugger.ItemsWindow = ItemsWindow;




  /////////////////////////////
  //
  //
  /////////////////////////////
    var CCstarter = (function ($) {
      var _self = {};
      var loader = {};
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        

        ClothCalc.ready = loader.ready;
        ClothCalc.init();
        loader.ready = true;
      };
      loader = Loader.add ( 'ClothCalc' , 'tw-db ClothCalc' , init , {} );
      return _self;
    })($);
    Debugger.CCstarter = CCstarter;

  /////////////////////////////
  //
  //  Object for Job ClothCalc: 
  //  Methodes:
  //
  /////////////////////////////
    var ClothCalc2 = (function ($) {
      var _self = {};
      var jobs = {};
      var values = {};
      var gui = null;
      var selected = false;
      var loader = {};
      var DataGui = null;
      var TitleGui = null;
      var AllJobsGui = null;
      var JobStartGui = null;
      var SearchGui = null;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Eventer.set('TWDBdataLoaded', function(){ initCloth(); } );
        Eventer.set('JobsUpdated', function(){ updateValues(); } );
        
        jobs = Cache.load('clothcalc');
        if ( !jobs || typeof(jobs) != 'object') {
          jobs = {};
        };
        Cache.save('clothcalc',jobs);
        if ( Updater.wasUpdated() ) {
          for ( var key in jobs ) {
            if (!data.hasOwnProperty(key)) {
              continue;
            }
            jobs[key].cloth = {};
            jobs[key].ready = false;
          }
        };
        gui = ItemsWindow.addTab ( 'cc1' , '#JOB#' , to_cdn('/images/items/yield/toolbox.png') , open );
        gui.css('height','90px');
        DataManager.addExtraCheck ( 'clothcalc' , isUp2Date );
        updateValues ( );
        loader.ready = true;
      };
      loader = Loader.add ( 'ClothCalc2' , 'tw-db ClothCalc' , init , {'Settings':true,'Cache':true,'DataManager':true,'Jobs':true} );
      var isUp2Date = function() {
        var up2date = true;
        for ( var key in jobs ) {
          if (!jobs.hasOwnProperty(key)) {
            continue;
          };
          if ( !jobs[key].ready ) {
            up2date = false;
            break;
          };
        };
        return up2date;
      };	
      var open = function () {
        if ( $(gui).children().length > 0 ){
          DataGui.append(DataManager.getImg());
          if ( selected !== false ) {
            showJob(selected);
          }
          return;
        };
        Jobs.updateJobs();
        ItemsWindow.showLoader();
        selected = false;
        DataGui = $('<div style="position:absolute;top:10px;right:8px;width:20px;height:20px;cursor:pointer;" />').append(DataManager.getImg());
        TitleGui = $('<div style="position:absolute;top:36px;left:0px;width:190px;height:19px;font-weight:bold;text-align:center;">#SELECTJOB# >></div>');
        var SortGui = $('<div style="position:absolute;top:10px;left:0px;height:20px;" />')
          .append( $('<img src="'+ Images.iconName + '" title=" #ORDER_NAME# " alt=" #ORDER_NAME# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('name')}))
          .append( $('<img src="'+ Images.iconExperience + '" title=" #ORDER_EXP# " alt=" #ORDER_EXP# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('experience')}))
          .append( $('<img src="'+ Images.iconDollar + '" title=" #ORDER_WAGES# " alt=" #ORDER_WAGES# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('wages')}))
          .append( $('<img src="'+ Images.iconLuck + '" title=" #ORDER_LUCK# " alt=" #ORDER_LUCK# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('luck')}))
          .append( $('<img src="'+ Images.iconDanger + '" title=" #ORDER_DANGER# " alt=" #ORDER_DANGER# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('danger')}))
          .append( $('<img src="'+ Images.iconLaborpoints + '" title=" #ORDER_LP# " alt=" #ORDER_LP# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('laborpoints')}))
          .append( $('<img src="'+ Images.iconMoti + '" title=" #ORDER_MOTIVATION# " alt=" #ORDER_MOTIVATION# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('motivation')}))
          .append( $('<img src="'+ Images.iconYield + '" title=" #ORDER_ITEMSRATIO# " alt=" #ORDER_ITEMSRATIO# " style="margin:0px 2px 0px 2px;cursor:pointer;" />').click(function(){list.sort('itemsratio')}));

			  SearchGui = $('<div style="position:absolute;top:35px;right:50px;width:20px;height:20px;background:url(\'' + Images.iconSearch + '\') no-repeat scroll 0 0 transparent;cursor:pointer;display:none;" title=" #SEARCHJOB# " />').click(searchJobs);
        JobStartGui = $('<div style="position: absolute; bottom: 85px; left: 1px; width: 252px; height: 200px; display:none;" />');
        
        AllJobsGui = new GameAPI.gui.checkbox('','tw2gui_checkbox_checked', function(){list.switchAllJobs});
        AllJobsGui.setTooltip('#HIDEJOBS#');
        (AllJobsGui.getMainDiv()).css('position','absolute').css('top','35px').css('right','30px');
          
        gui.append(DataGui)
          .append(SortGui)
          .append(SearchGui)
          .append(AllJobsGui.getMainDiv())
          .append(TitleGui)
          .append(list.init())
          .append($('<div style="position:absolute;top:35px;right:4px;width:26px;height:20px;background:url(\'' + to_cdn('/images/window/character/title_editbtn.jpg') + '\') no-repeat scroll 0 0 transparent;cursor:pointer;" title=" #SELECTJOB# " />').click(list.open))
          .append(JobStartGui);
        DataManager.loadData()
        ItemsWindow.hideLoader();
      };
      var updateValues = function ( modul ) {
        values = {};
        for ( var key in jobs ) {
          if (!jobs.hasOwnProperty(key)) {
            continue;
          };
          var data = jobs[key];
          var job = Jobs.getJobById( data.id ) ;
          if ( !isDefined ( job ) ) {
            continue;
          };
          values[key] = {};
          if ( !isDefined(modul) || modul == 'laborpoints' ) {
            values[key].laborpoints = Jobs.getPoints( job.id , true ) ;
          };
          var points = values[key].laborpoints;
          if ( !isDefined(modul) || modul == 'name' ) {
            values[key].name = job.name;
          };
          if ( !isDefined(modul) || modul == 'experience' ) {
            values[key].experience = Jobs.getExperience( job.id , points) ;
          };
          if ( !isDefined(modul) || modul == 'wages' ) {
            values[key].wages = Jobs.getWages( job.id , points ) ;
          };
          if ( !isDefined(modul) || modul == 'luck'  ) {
            var tmp =  Jobs.getLuck( job.id , points ) ;
            values[key].luck = tmp[0];
            values[key].luckmax = tmp[1];
          };
          if ( !isDefined(modul) || modul == 'motivation'  ) {
            values[key].motivation = Jobs.getMotivation( job.id , points ) ;
          };
          if ( !isDefined(modul) || modul == 'itemsratio' ) {
            values[key].itemsratio = Jobs.getItemsRatio( job.id , points ) ;
          };
          if ( !isDefined(modul) || modul == 'danger' ) {
            values[key].danger = Jobs.getDanger( job.id , points ) ;
          };
          if ( !isDefined(modul) || modul == 'filter' ) {
            var txt = job.name;
            if ( isDefined(job.yields) ) {
              for ( var itemid in job.yields ) {
                if (!job.yields.hasOwnProperty(itemid)) {
                  continue;
                };
                var item = ItemManager.get(itemid);
                if ( !isDefined(item) ) {
                  continue;
                }
                txt += ';' + item.name;
              };
            }
            values[key].filter = txt.toUpperCase();
          };
        };
        list.updatePopups();
      };
      var initCloth = function () {
        var data = DataManager.getData('jobs');
        jobs = {};
        for ( var key in data ) {
          if (!data.hasOwnProperty(key)) {
            continue;
          }
          jobs[key] = data[key];
          jobs[key].ready = true;
        };
        Cache.save('clothcalc',jobs);
			};      
      var list = (function ($) {
        var _that = {};
        var gui = null;
        var scrollpane = null;
        var search = null;
        var sorting = [ 'name' , 1 , 2 ];
        var elements = [];
        var alljobs = true;
        _that.init = function() {
          try {
            if ( alljobs ) {
              AllJobsGui.getMainDiv().addClass('tw2gui_checkbox_checked');
            }
            else {
              AllJobsGui.getMainDiv().removeClass('tw2gui_checkbox_checked');
            };
          
            gui = $('<div style="position: absolute; left: 255px; top: 30px; display: block;" />').hide();
            
            search = new GameAPI.gui.textfield().maxlength(12).setClass4Input('tw2gui_jobsearch_string').setWidth(265);
            search.getMainDiv().keyup(function(ev){keyHandler(ev)});
            gui.append($('<div style="position:relative;top:0;left:0;width:305px" />').append(search.getMainDiv()).append('<div class="tw2gui_jobsearch_showall" style="display:block;" />'));
            
            scrollpane = new GameAPI.gui.scrollpane();
            $(scrollpane.getMainDiv()).css('width','285px').css('height','250px').append('<style type="text/css">.TWDB_hide{display:none;}.TWDB_filter{display:none;}</style>');

            elements = [];
            for ( var key in jobs ) {
              var data = jobs[key];
              var job = Jobs.getJobById( data.id ) ;
              if ( !isDefined ( job ) ) {
                continue;
              }
              var val = values[key];
              var el = $('<p stlye="cursor:pointer">' + job.name + '</p>')
                .click(function(id){return function(){_that.open();showJob(id)};}(key))
                .mouseover(function(){$(scrollpane.getContentPane()).children().removeClass('focused');$(this).addClass('focused');})
                .addMousePopup(getPopup(key));
              var points = $('<span />');
              var sort = $('<span />');
              el.append(points).append(sort);
              
              elements.push( { 'el':el , 'points':points , 'sort':sort , 'val' : val , 'id': key} );
              scrollpane.appendContent(el);
            };
            _that.update( true );
            gui.append($('<div class="tw2gui_jobsearchbar_allresults" style="width:285px;display:block;" />').append(scrollpane.getMainDiv()));
            return gui;
          }
          catch (e) {
            Error.report(e,'Clothcalc init Joblist');
          }
        };
        _that.open = function ( ) {
          if ( gui.is(':visible') ) {
            gui.hide();
          }
          else {
            gui.show();
            
          }
        };
        _that.switchAllJobs = function ( ) {
          alljobs = !alljobs;
          list.update();
        }
        _that.updatePopups = function ( ) {
          for ( var i = 0; i < elements.length ; i++ ) {
            var el = elements[i];
            el.el.addMousePopup(getPopup(el.id));
          }
        }
        _that.update = function ( points ) {
          if ( sorting [2] > 0 ) {
            var sortByTxt = function (x, y) {
              return x.val[sorting[0]] > y.val[sorting[0]] ? sorting[1] : -sorting[1];
            };
            var sortByNum = function (x, y) {
              return x.val[sorting[0]] * 1 >=y.val[sorting[0]] * 1 ? sorting[1] : -sorting[1];
            };
            if ( sorting[0] == 'name') {
              elements.sort(sortByTxt);
            } else {
              elements.sort(sortByNum);
            };
          };
          
          for ( var i = 0; i < elements.length ; i++ ) {
            var el = elements[i];
            if ( sorting [2] > 0 ) {
              switch ( sorting [0] ) {
                default : el.sort.html('');
                          break;
              };
              if ( sorting [2] > 0 ) {
                scrollpane.getContentPane().append(el.el);
              };
            };
            if ( points ) {
              el.points.html( '[' + Jobs.getPoints( el.id ) + '|' + values[el.id].laborpoints + ']' );
            };
            
            var lp = values[ el.id ].laborpoints;
            if ( Jobs.getPoints( el.id ) < 0 ) {
              if ( lp < 0  && ( Jobs.getJobById(el.id).level > window.Character.level ) ) {
                el.el.css('color','red');
                if ( !alljobs ) {
                  el.el.addClass('TWDB_hide');
                }
              }
              else {
                if ( lp < 0 ) {
                  el.el.css('color','OrangeRed');
                }
                else {
                  el.el.css('color','orange');
                }
              }
            }
            else {
              el.el.css('color','#333333');
            }
            
          };
          return;
        }
        _that.sort = function ( mode ) {
          if ( mode == sorting[0] ) {
            sorting[1] *= -1;
            sorting[2] = 1;
          }
          else {
            if ( mode == 'danger' || mode == 'name') {
              sorting[1] = 1;
            } 
            else {
              sorting[1] = -1;
              sorting[2] = 2;
            }
            sorting[0] = mode;
          }
          _that.update();
          sorting[2] = 0;
        };
        var keyHandler = function ( ev ) {
          var keyCode = ev.keyCode ? ev.keyCode : ev.which;
          if ( keyCode == 38 || keyCode == 40 ) {
            var focus = $(scrollpane.getContentPane()).children('.focused:first');
            $(scrollpane.getContentPane()).children().removeClass('focused');
            if ( focus.length <= 0 ) {
              focus = $(scrollpane.getContentPane()).children(':first');
            }
            if (keyCode == 38 ) {
              var loop = false;
              do {
                focus = focus.prev();
                if ( focus.length <= 0 ) {
                  if ( loop ) {
                    break;
                  }
                  focus = $(scrollpane.getContentPane()).children(':last');
                  loop = true;
                }
              } while ( !focus.is(':visible') );
              focus.addClass('focused');
            } else {
              var loop = false;
              do {
                focus = focus.next();
                if ( focus.length <= 0 ) {
                  if ( loop ) {
                    break;
                  }
                  focus = $(scrollpane.getContentPane()).children(':first');
                  loop = true;
                }
              } while ( !focus.is(':visible') );
              focus.addClass('focused');
            }
            if ( loop ) {
              if ( keyCode == 38 ) {
                scrollpane.scrollToEnd();
              }
              else {
                scrollpane.scrollToTop();
              }
            }
            else {
              var pos1 = focus.offset().top;
              var pos2 = $(scrollpane.clipPane).offset().top;
              if ( pos1 - pos2 > 180 ) {
                var dif = ( pos1 - pos2 - 90 ) / 16;
                scrollpane.scrollTo(0,dif);
              } else if ( pos2 - pos1 > 0 ) {
                var dif = ( pos1 - pos2 - 90 ) / 16;
                scrollpane.scrollTo(0,dif , true);
              }
            }
          }
          else if (keyCode == 13) {
            $(scrollpane.getContentPane()).children('.focused:first').click();
          }
          else {
            filter(search.getValue());
          };
        }
        var filter = function ( txt ) {
          var regexp = new RegExp(txt.toUpperCase(), 'i');
          var count = 0;
          for ( var i = 0; i < elements.length ; i++ ) {
            var el = elements[i];
            if ( regexp.test( el.val.filter ) ) {
              el.el.removeClass('TWDB_hide');
              if ( count == 0 ) {
                $(scrollpane.getContentPane()).children().removeClass('focused')
                el.el.addClass('focused');
              }
              count++;
            }
            else {
              el.el.addClass('TWDB_hide');
            }
          };
        };
        var getPopup = function ( id ) {
          var div = '<table>'
              + '<tr><td colspan="4" style="font-weight:bold;text-align:center;font-size:11px;">' + values[id].name + '</td></tr>'
              + '<tr><td><img src="' + Images.iconExperience + '" title=" #EXPERIENCE# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].experience + '</td>'
              + '<td><img src="' + Images.iconDollar + '" title=" #WAGES# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].wages + '</td></tr>'
              + '<tr><td><img src="' + Images.iconLuck + '" title=" #LUCK# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].luck + '-' + values[id].luckmax + '</td>'
              + '<td><img src="' + Images.iconDanger + '" title=" #DANGER# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].danger + '</td></tr>'
              + '<tr><td><img src="' + Images.iconLaborpoints + '" title=" #LABORPOINTS# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].laborpoints + '</td>'
              + '<td><img src="' + Images.iconYield + '" title=" #DURATION# " height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].itemsratio + '</td></tr>'
              + '<tr><td><img src="' + Images.iconMoti + '" title=" #MOTIVATION# "  height="15px" width="15px" /></td><td style="font-size:10px;vertical-align:bottom;">' + values[id].motivation*100 + '</td><td></td><td></td></tr>'
            + '</table>';
          return div;
        };
        return _that;
      })($);
      var showJob = function ( id ) {
        if ( !isDefined(jobs[id]) ) {
          return;
        };
        if ( id != 255 ) {
          SearchGui.show();
          Map.setMinimapJob(values[id].name);
        }
        JobStartGui.hide();
        ItemsWindow.showBag();
        selected = id;
        var data = jobs[id];
        var items = [];
        for ( var key in data.cloth ) {
          if ( data.cloth[key].hasOwnProperty(key)  ) {
            continue;
          }
          items.push(data.cloth[key].id);
        };
        ItemsWindow.addItems(items , function(){ updateTitle();list.update(true); } );
        updateTitle();
      };
      var updateTitle = function ( ) {
        if ( selected === false) {
          return;
        }
        TitleGui.html( values[selected].name.substring(0, 18) + ' [' + Jobs.getPoints( selected ) + '|' + values[selected].laborpoints + ']' );
      };
      var searchJobs = function () {
        if ( JobStartGui.is(':visible') ) {
          JobStartGui.hide();
          ItemsWindow.showBag();
          return;
        }
        if ( !isDefined(jobs[selected]) ) {
          return;
        };
        JobStartGui.show();
        ItemsWindow.hideBag();
        JobStartGui.children().remove();
        
        var job = Jobs.getJobById( selected ) ;
        var pos = Map.getNearestJob( selected );
        var max = 4;
        var dom = $('<table />');
        for ( var i = 0 ; i < pos.length ; i++ ) {
          if ( i == max ) {
            break;
          };
          var tmp = pos[i];
          var rot = 'rotate(' + tmp.angle + 'deg);';
          var tr = $('<tr />');
          tr.append('<td style="text-align:left;vertical-align:middle">' + tmp.time.formatDuration() + '</td>');
          tr.append( 
            $('<td style="text-align:left;vertical-align:middle">').append(
              $('<img src="' + Images.arrow + '" title="#DIRECTION#" style="cursor:pointer;-moz-transform: ' + rot + '-webkit-transform:' + rot + '-o-transform:' + rot + '-ms-transform:' + rot + 'transform:' + rot + '" />').click((function(x,y){return function(){w.Map.center(x,y);};})(tmp.x,tmp.y))
            )
          );
          var td = $('<td />');
          var btn = new GameAPI.gui.button('#OPEN#',((function(id,x,y){return function(){Jobs.openJob(id,x,y);}})(selected,tmp.x,tmp.y)));
          $(btn.divMain).css('min-width','50px').css('max-width','80px');
          ($(btn.divMain).find('.textart_title')).css('overflow','hidden');
          btn.appendTo(td);
          tr.append(td);
          if ( w.Premium.hasBonus('automation') ) {
            var td = $('<td />');
            var durs = JobList.getDurations();
            var c = 0;
            for (var dur in durs) {
              c++;
              if (Character.level >= durs[dur]['requirement']) {
                td.append( 
                  $('<div title="' + s('%1 #JOB_START#', durs[dur]['duration'].getTime2EndToken()) + '" style="background-image: url(\'' + to_cdn('images/map/icons/instant-work-' + c + '.png') + '\');display: inline-block;height: 20px;position: relative;right: 0px;top: 0px;width: 20px;margin:3px;cursor:pointer;" />')
                  .click( function(id,x,y,duration){return function(){Jobs.startJob(id,x,y,duration);}}(selected,tmp.x,tmp.y,durs[dur]['duration']))
                );
              }
            }
            tr.append(td);
          };
          dom.append(tr);
        };
        JobStartGui.append(dom);
      };
      _self.getClothPoins = function ( id ) {
        if ( !isDefined(jobs[id]) ) {
          return 0;
        };
        return jobs[id].laborpoints.cloth;
      };
      return _self;
    })($);
    Debugger.ClothCalc2 = ClothCalc2;

  /////////////////////////////
  //
  //  Object for Customs: the customized Jobs for calculating Wearsets
  //  Methodes:
  //
  /////////////////////////////
    var Customs = (function ($) {
      var _self = {};
      var customs = {};
      var gui = null;
      var selected = false;
      var loader = {};
      var DataGui = null;
      var TitleGui = null;
      var ConfigGui = null;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        Eventer.set('TWDBdataLoaded', function(){ initCloth(); } );
        var data = Cache.load('customs');
        if ( !data || typeof(data) != 'object') {
          var data = Settings.get('custom');
          if ( !data || typeof(data) != 'object') {
            reset();
            var data = customs;
          }
          else {
            for ( var key in data ) {
              if (!data.hasOwnProperty(key)) {
                continue;
              };
              data[key].cloth = {};
              data[key].ready = false;
            };
          };
        };
        customs = data;
        Cache.save('customs',customs);
        if ( Updater.wasUpdated() ) {
          for ( var key in data ) {
            if (!data.hasOwnProperty(key)) {
              continue;
            }
            data[key].cloth = {};
            data[key].ready = false;
          }
        };
        gui = ItemsWindow.addTab ( 'customs' , '#CUSTOMS#' , to_cdn('/images/items/yield/gilded_cogs.png') , open );
        gui.css('height','90px');
        DataManager.addExtraCheck ( 'customs' , isUp2Date );
        loader.ready = true;
      };
      loader = Loader.add ( 'Customs' , 'tw-db Customs' , init , {'Settings':true,'Cache':true,'DataManager':true} );
      var reset = function () {
        customs = { 1:{id:1,type:"speed",para:{},name:"Speed",cloth:{},ready:false},
                    2:{id:2,type:"custom",para:{9:1},name:"max Health",cloth:{},ready:false},
                    3:{id:3,type:"regen",para:{},name:"Health Regeneration",cloth:{},ready:false},
                    4:{id:4,type:"fort",para:{att:200,def:20,health:100,type:0},name:"Fortbattle Attacker (Att)",cloth:{},ready:false},
                    5:{id:5,type:"fort",para:{att:20,def:200,health:100,type:0},name:"Fortbattle Attacker (Def)",cloth:{},ready:false},
                    6:{id:6,type:"fort",para:{att:200,def:20,health:100,type:1},name:"Fortbattle Defender (Att)",cloth:{},ready:false},
                    7:{id:7,type:"fort",para:{att:20,def:200,health:100,type:1},name:"Fortbattle Defender (Def)",cloth:{},ready:false},
                    8:{id:8,type:"duel",para:{12:1,15:1,16:1,24:1},name:"Range Dueler (Att)",cloth:{},ready:false},
                    9:{id:9,type:"duel",para:{12:1,15:1,16:1,21:1},name:"Range Dueler (Def)",cloth:{},ready:false},
                    10:{id:10,type:"duel",para:{6:1,7:1,11:1,15:1},name:"Melee Dueler",cloth:{},ready:false}
                  };
      };
      var isUp2Date = function() {
        var up2date = true;
        for ( var key in customs ) {
          if (!customs.hasOwnProperty(key)) {
            continue;
          }
          if ( !customs[key].ready ) {
            up2date = false;
            break;
          }
        }
        return up2date;
      };	
      var open = function () {
        if ( $(gui).children().length > 0 ){
          DataGui.append(DataManager.getImg());
          if ( selected !== false ) {
            showCustom(selected);
          }
          return;
        };
        ItemsWindow.showLoader();
        selected = false;
        DataGui = $('<div style="position:absolute;top:10px;right:8px;width:20px;height:20px;cursor:pointer;" />').append(DataManager.getImg());
        TitleGui = $('<div style="position:absolute;top:36px;left:0px;width:210px;height:19px;font-weight:bold;text-align:center;">#SELECTJOB# >></div>');
        gui.append(DataGui).append(TitleGui).append($('<div title="#SETTINGS#" style="position:absolute;top:35px;right:30px;width:20px;height:20px;background:url(\'' + Images.iconSetting + '\');cursor:pointer;" />').click(showConfig)).append(list.init()).append($('<div style="position:absolute;top:35px;right:4px;width:26px;height:20px;background:url(\'' + to_cdn('/images/window/character/title_editbtn.jpg') + '\') no-repeat scroll 0 0 transparent;cursor:pointer;" title=" #SELECTJOB# " />').click(list.open));
        DataManager.loadData()
        ItemsWindow.hideLoader();
      };
      var showConfig = function () {
        if ( isDefined(ConfigGui) ) {
          ConfigGui.hide();
        }
        var div = $('<div />');
        var count = 0;
        for ( var key in customs ) {
          if (!customs.hasOwnProperty(key)) {
            continue;
          }
          var data = customs[key];
          var edit = $('<div title="#EDIT#" style="display:inline-block;vertical-align:top;height:16px;width:16px;cursor:pointer;background:url(\'' + to_cdn('/images/window/messages/head-icons.png') + '\') repeat scroll 0 16px transparent;" />').click(function(id){return function(){editConfig(id);}}(key));
          
          var del = $('<div title="#DELETE#" style="display:inline-block;vertical-align:top;height:16px;width:16px;cursor:pointer;background:url(\'' + to_cdn('/images/icons/delete.png') + '\') repeat scroll 0px 0px transparent;" />').click(function(id){return function(){delConfig(id);}}(key));
          
          div.append($('<div style="display:block;height:18px;padding: 3px 0px 0px 0px;border-bottom: 1px solid #666" />').append('<div style="display:inline-block;vertical-align:top;height:16px;width:300px;overflow:hidden;" title="' + String(data.name).escapeHTML() + '" >' + String(data.name).escapeHTML() + '</div>').append(edit).append(del));
          count++;
        }
        if ( count < 15 ) {
          div.append( $('<div title="#ADD#" style="display:block;margin-top:2px;vertical-align:top;height:20px;width:25px;cursor:pointer;background:url(\'' + to_cdn('/images/window/messages/icons.png') + '\') repeat scroll 72px -5px transparent;" />').click(function(){addConfig();}));
        };
        ConfigGui = new GameAPI.gui.dialog ('#CUSTOM#',div).addButton('ok',function(){DataManager.loadData()}).show();
      };
      var delConfig = function ( id ) {
        if ( !isDefined(customs[id]) ) {
          return;
        };
        var del = function() {
          var data = customs;
          var count = 0;
          customs = {};
          for ( var key in data ) {
            if (!data.hasOwnProperty(key)) {
              continue;
            };
            if ( key == id ) {
              continue;
            };
            count++
            customs[count] = data[key];
            customs[count].ready = false;
            customs[count].id = count;
          };
          saveConfig();
          showConfig();
        }
        new GameAPI.gui.dialog('#DELETE# - #CUSTOM#','#DELETE#: ' + String(customs[id].name).escapeHTML() + '?').addButton('ok',del).addButton('cancel').show();
      };
      var addConfig = function(){
        var count = 0;
        for ( var key in customs ) {
          if (!customs.hasOwnProperty(key)) {
            continue;
          };
          count++;		
        };
        if ( count >= 15 ) {
          new UserMessage('#CLOTHCALC_TOOMUCH#', UserMessage.TYPE_ERROR).show();
        } else {
          count++;
          editConfig(count);
        };
      };
      var editConfig = function(id) {
        if ( isDefined(customs[id]) ) {
          var name = customs[id].name;
          var code = JSON.stringify({'type':customs[id].type,'para':customs[id].para});
          var title = '#EDIT# - #CUSTOM#';
        }
        else {
          var name = '';
          var code = '';
          var title = '#ADD# - #CUSTOM#';
        };
        var guiName = new GameAPI.gui.textfield("twdb_cc_custom_name").setSize(30).setValue(name);
        var guiCode = new GameAPI.gui.textfield("twdb_cc_custom_name").setSize(30).setValue(code);
        var edit = function() {
          var error = function (message) {
            new UserMessage('#WRONG_INSERTS#: '+message, UserMessage.TYPE_ERROR).show();
            return false;
          };
          if ( guiName.getValue() == '' ) {
            return error('#EMPTY# #NAME#');
          };
          if ( guiCode.getValue() == '' ) {
            return error('#EMPTY# #CODE# [1]');
          };
          if ( guiName.getValue() == name && guiCode.getValue() == code ) {
            return true;
          };
          try {
            var code = $.parseJSON(guiCode.getValue());
          } catch (e) {
            return error('#WRONG# #CODE# [2]');
          };
          if ( typeof(code.type) == 'undefined' || typeof(code.para) == 'undefined' ) {
            return error('#WRONG# #CODE# [3]');
          };
          var count = 0;
          for ( var i in code.para ) {
            count++;
          };
          switch (code.type) {
            case 'speed' : 
            case 'regen' :
              if ( count != 0 ) {
                return error('#WRONG# #CODE# [4]');
              };
              break;
            case 'fort' : 
              if ( typeof(code.para.type) == 'undefined' || typeof(code.para.att) == 'undefined' || typeof(code.para.def) == 'undefined' || typeof(code.para.health) == 'undefined' ) {
                return error('#WRONG# #CODE# [5]');
              };
              if ( code.para.type != 1 && code.para.type != 0) {
                return error('#WRONG# #CODE# [6]');
              };
              if ( !$.isNumeric(code.para.att) || code.para.att < 0 ) {
                return error('#WRONG# #CODE# [7]');
              };
              if ( !$.isNumeric(code.para.def) || code.para.def < 0 ) {
                return error('#WRONG# #CODE# [8]');
              };
              if ( !$.isNumeric(code.para.health) || code.para.health < 0 ) {
                return error('#WRONG# #CODE# [9]');
              };
              break;
            case 'duel' :
            case 'custom' : 
              if ( count <= 0 ) {
                return error('#WRONG# #CODE# [10]');
              };
              break;
            default:
              return error('#WRONG# #CODE# [11]');
          };
          customs[id] = {'id':Number(id),'type':code.type,'para':code.para,'name':guiName.getValue(),ready:false};
          saveConfig();
          showConfig();
        };
        var div = $('<table width="400px" />').append($('<tr />').append('<td style="vertical-align:middle">#NAME#:</td>').append($('<td />').append(guiName.getMainDiv()))).append($('<tr />').append('<td style="vertical-align:middle">#CODE#:</td>').append($('<td />').append(guiCode.getMainDiv()))).append($('<tr><td colspan="2">#CLOTHCALC_CUSTOMHELP# <a href="http://' + Script.url + '/?strana=calc" target="_blank">tw-db.info #CALCULATOR#</a></td></tr>'));
        new GameAPI.gui.dialog (title,div).addButton('ok',edit).addButton('cancel').show();
      };
      var saveConfig = function() {
        Cache.save('customs',customs);
      };
      var initCloth = function () {
        var data = DataManager.getData('custom');
        for ( var key in data ) {
          try {
            if (!data.hasOwnProperty(key)) {
              continue;
            }
            if(!isDefined(customs[key])) {
              continue;
            }
            customs[key].cloth = data[key].cloth;
            customs[key].boni = data[key].boni;
            var tupel = customs[key];
            switch ( tupel.type ) {
              case 'speed' :
                var ride = 0;
                var speed = 0;
                if ( isDefined(tupel.cloth[1]) && isDefined(tupel.cloth[1]['other'][1]) ){
                  ride = tupel.cloth[1]['other'][1];
                }
                if ( isDefined(tupel.boni.other[1]) ) {
                  speed = tupel.boni.other[1];
                };
                speed -= ride;
                ride += isDefined(tupel.boni.skill[2]) ? tupel.boni.skill[2] : 0;
                ride += isDefined(tupel.boni.skill[10]) ? tupel.boni.skill[10] : 0;
                ride += CharacterSkills.skills.ride.points;
                tupel.skills = ['ride'];
                tupel.laborpoints = Number((100 + ride) * (1 + (speed / 100))).round(0) + '%';
                break;
              case 'regen' :
                tupel.skills = ['health'];
                tupel.laborpoints = '';
                break;
              case 'fort' : 
                if (tupel.para.type == 0) {
                  var skills = {};
                  skills.aim = CharacterSkills.skills.aim.points + (isDefined(tupel.boni.skill[3]) ? tupel.boni.skill[3] : 0) + (isDefined(tupel.boni.skill[15]) ? tupel.boni.skill[15] : 0);
                  skills.endurance = CharacterSkills.skills.endurance.points + (isDefined(tupel.boni.skill[1]) ? tupel.boni.skill[1] : 0) + (isDefined(tupel.boni.skill[8]) ? tupel.boni.skill[8] : 0);
                  skills.dodge = CharacterSkills.skills.dodge.points + (isDefined(tupel.boni.skill[2]) ? tupel.boni.skill[2] : 0) + (isDefined(tupel.boni.skill[12]) ? tupel.boni.skill[12] : 0);
                  skills.leadership = CharacterSkills.skills.leadership.points + (isDefined(tupel.boni.skill[4]) ? tupel.boni.skill[4] : 0) + (isDefined(tupel.boni.skill[20]) ? tupel.boni.skill[20] : 0);
                  skills.health = CharacterSkills.skills.health.points + (isDefined(tupel.boni.skill[1]) ? tupel.boni.skill[1] : 0) + (isDefined(tupel.boni.skill[9]) ? tupel.boni.skill[9] : 0);
                  
                  var health = (100 + ((Character.level - 1) * Character.lifePointPerHealthSkill) + skills.health * (Character.lifePointPerHealthSkill + Character.lifePointPerHealthSkillBonus));
                  var att = Number(25 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.aim, 0.4) + Math.pow(skills.endurance, 0.4)).round(2);
                  var def = Number(10 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.dodge, 0.4) + Math.pow(skills.endurance, 0.4)).round(2);
                } else {
                  var skills = {};
                  skills.aim = CharacterSkills.skills.aim.points + (isDefined(tupel.boni.skill[3]) ? tupel.boni.skill[3] : 0) + (isDefined(tupel.boni.skill[15]) ? tupel.boni.skill[15] : 0);
                  skills.hide = CharacterSkills.skills.hide.points + (isDefined(tupel.boni.skill[2]) ? tupel.boni.skill[2] : 0) + (isDefined(tupel.boni.skill[13]) ? tupel.boni.skill[13] : 0);
                  skills.dodge = CharacterSkills.skills.dodge.points + (isDefined(tupel.boni.skill[2]) ? tupel.boni.skill[2] : 0) + (isDefined(tupel.boni.skill[12]) ? tupel.boni.skill[12] : 0);
                  skills.leadership = CharacterSkills.skills.leadership.points + (isDefined(tupel.boni.skill[4]) ? tupel.boni.skill[4] : 0) + (isDefined(tupel.boni.skill[20]) ? tupel.boni.skill[20] : 0);
                  skills.health = CharacterSkills.skills.health.points + (isDefined(tupel.boni.skill[1]) ? tupel.boni.skill[1] : 0) + (isDefined(tupel.boni.skill[9]) ? tupel.boni.skill[9] : 0);
                  
                  var health = (100 + ((Character.level - 1) * Character.lifePointPerHealthSkill) + skills.health * (Character.lifePointPerHealthSkill + Character.lifePointPerHealthSkillBonus));
                  var att = Number(25 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.aim, 0.4) + Math.pow(skills.hide, 0.4)).round(2);
                  var def = Number(10 + Math.pow((skills.leadership * 1 + (Character.charClass=='soldier'?(Premium.hasBonus('character')?0.5:0.25):0)), 0.4) + Math.pow(skills.dodge, 0.4) + Math.pow(skills.hide, 0.4)).round(2);
                };
                
                att += isDefined(tupel.boni.other[11]) ? Number(tupel.boni.other[11]) : 0;  //fort_attack
                att += isDefined(tupel.boni.other[17]) ? Number(tupel.boni.other[17]) : 0;  //fortsector_attack
                def += isDefined(tupel.boni.other[12]) ? Number(tupel.boni.other[12]) : 0;  //fort_defense
                def += isDefined(tupel.boni.other[18]) ? Number(tupel.boni.other[18]) : 0;  //fortsector_defense
                
                tupel.skills = ['health','attacker','defender'];
                tupel.laborpoints = health + ' | ' + att.round(2) + ' | ' + def.round(2);
                
                break;
              case 'duel' : 
                tupel.skills = [];
                var lp = 0;
                for ( var skillid in tupel.para ) {
                  var attrid = Math.floor(skillid / 5);
                  if ( isDefined(tupel.boni.skill[skillid]) ) {
                    lp += tupel.boni.skill[skillid]
                  };
                  if ( isDefined(tupel.boni.skill[attrid])) {
                    lp += tupel.boni.skill[attrid];
                  };
                  if ( isDefined(_id2skill[skillid]) ) {
                    tupel.skills.push(_id2skill[skillid]);
                    if ( isDefined(CharacterSkills.skills[_id2skill[skillid]]) ) {
                      lp += CharacterSkills.skills[_id2skill[skillid]].points;
                    } else if ( isDefined(CharacterSkills.attributes[_id2skill[skillid]]) ) {
                      lp += CharacterSkills.attributes[_id2skill[skillid]].points;
                    };
                  };
                };
                tupel.laborpoints = lp;
                break;
              case 'custom' : 
                tupel.skills = [];
                var lp = 0;
                for ( var skillid in tupel.para ) {
                  var attrid = Math.floor(skillid / 5);
                  if ( isDefined(tupel.boni.skill[skillid]) ) {
                    lp += tupel.boni.skill[skillid]
                  };
                  if ( isDefined(tupel.boni.skill[attrid]) ) {
                    lp += tupel.boni.skill[attrid];
                  };
                  if ( isDefined(_id2skill[skillid]) ) {
                    tupel.skills.push(_id2skill[skillid]);
                    if ( isDefined(CharacterSkills.skills[_id2skill[skillid]]) ) {
                      lp += CharacterSkills.skills[_id2skill[skillid]].points;
                    } else if ( isDefined(CharacterSkills.attributes[_id2skill[skillid]]) ) {
                      lp += CharacterSkills.attributes[_id2skill[skillid]].points;
                    };
                  };
                };
                tupel.laborpoints = lp;
                break;
              default : return;
                break;
            };
            tupel.ready = true;
            saveConfig();
          } catch (e) {
            Error.report(e,'GENERICERROR#; handle Customs');
          };
        };
			};      
      var list = (function ($) {
        var _that = {};
        var gui = null;
        var scrollpane = null;
        var search = null;
        var elements = [];
        _that.init = function() {
          gui = $('<div style="position: absolute; left: 255px; top: 30px; display: block;" />').hide();
          
          search = new TWDB.GameAPI.gui.textfield().maxlength(12).setClass4Input('tw2gui_jobsearch_string').setWidth(265);
          gui.append($('<div style="position:relative;top:0;left:0;width:305px" />').append(search.getMainDiv()).append('<div class="tw2gui_jobsearch_showall" style="display:block;" />'));
          
          scrollpane = new TWDB.GameAPI.gui.scrollpane();
          $(scrollpane.getMainDiv()).css('width','285px').css('height','250px');
          
          _self.update();
            
          gui.append($('<div class="tw2gui_jobsearchbar_allresults" style="width:285px;display:block;" />').append(scrollpane.getMainDiv()));
          return gui;
        };
        _that.open = function ( ) {
          if ( gui.is(':visible') ) {
            gui.hide();
          }
          else {
            gui.show();
          }
        };
        _self.update = function ( ) {
          scrollpane.getContentPane().children().remove();
          for ( var key in customs ) {
            scrollpane.appendContent($('<p stlye="cursor:pointer">' + customs[key].name + ' [' + customs[key].laborpoints + ']' + '</p>').click(function(id){return function(){_that.open();showCustom(id)};}(key)));
          }
        }
        return _that;
      })($);
      showCustom = function ( id ) {
        if ( !isDefined(customs[id]) ) {
          return;
        };
        selected = id;
        var data = customs[id];
        var items = [];
        for ( var key in data.cloth ) {
          if ( data.cloth[key].hasOwnProperty(key)  ) {
            continue;
          }
          items.push(data.cloth[key].id);
        }
        ItemsWindow.addItems(items);
        TitleGui.html(data.name);
      };
      _self.getCustoms = function ( ) {
        return customs;
      };
      return _self;
    })($);
    Debugger.Customs = Customs;

  /////////////////////////////
  //
  //
  /////////////////////////////
    var Sets = (function ($) {
      var _self = {};
      var loader = {};
      var div = null;
      var count = 0;
      var selected = false;
      var init = function ( ) {
        if ( loader.ready ) {
          return;
        };
        div = ItemsWindow.addTab ( 'sets' , '#SETS#' , to_cdn('/images/items/yield/chest_medium.png') , open );
        loader.ready = true;
      };
      var open = function ( options ) {
        if ( $(div).children().length > 0 ) {
          if ( selected !== false ) {
            showSet(selected);
          }
          return;
        }
        ItemsWindow.showLoader();
        selected = false;
        var sets = w.west.storage.ItemSetManager.getAll();
        for ( var i = 0; i < sets.length; i++ ) {
          var set = sets[i];
          for ( var j = 0 ; j < set.items.length ; j++ ) {
            if ( hasItem ( set.items[j] ) ) {
              var item = ItemManager.get(set.items[0]);
              div.append( $('<img src="' + to_cdn(item.image) + '" witdh="30px" height="30px" style="padding-right:2px;cursor:pointer;" title="' + item.set.name + '" />').click( function(key){ return function(){showSet(key)}}(set.key)));
              break;
            };
          };
        };
        ItemsWindow.hideLoader();
      };
      var hasItem = function( id ) {
        var item = w.ItemManager.get( id );
        var bagItem = w.Bag.getItemByItemId( id );
        var wearItem = w.Wear.wear[item.type];
        if (bagItem || (wearItem && wearItem.obj.item_id == id)) {
          return true;
        }
        else {
          return false;
        };
      };
      var showSet = function(key) {
        selected = key;
        var set = w.west.storage.ItemSetManager.get(key);
        var items = [];
        for ( var i = 0 ; i < set.items.length ; i++ ) {
          if ( hasItem ( set.items[i] ) ) {
            items.push(set.items[i]);
          }
        }
        ItemsWindow.addItems(items);
      };
      loader = Loader.add ( 'Sets' , 'tw-db Sets' , init , {} );
      return _self;
    })($);
    Debugger.Sets = Sets;
    
            

        

    
  /////////////////////////////
  //
  //  And now let's go :-)
  //
  /////////////////////////////
    if ((w.location.href.indexOf(".the-west.") != -1 || w.location.href.indexOf(".tw.innogames.") != -1) && w.location.href.indexOf("game.php") != -1) {
      Loader.init();
    };
    
})(jQuery);
